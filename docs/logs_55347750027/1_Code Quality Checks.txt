2026-01-25T08:57:04.5261091Z Current runner version: '2.331.0'
2026-01-25T08:57:04.5289889Z ##[group]Runner Image Provisioner
2026-01-25T08:57:04.5290738Z Hosted Compute Agent
2026-01-25T08:57:04.5291308Z Version: 20260115.477
2026-01-25T08:57:04.5291901Z Commit: 4b342d620503cbe250a3154040964899ea7c9b00
2026-01-25T08:57:04.5292594Z Build Date: 2026-01-15T22:32:41Z
2026-01-25T08:57:04.5293607Z Worker ID: {1696f05c-62c4-4e90-bbce-c125cbdaa1c1}
2026-01-25T08:57:04.5294298Z Azure Region: northcentralus
2026-01-25T08:57:04.5294926Z ##[endgroup]
2026-01-25T08:57:04.5296409Z ##[group]Operating System
2026-01-25T08:57:04.5296981Z Ubuntu
2026-01-25T08:57:04.5297382Z 24.04.3
2026-01-25T08:57:04.5297922Z LTS
2026-01-25T08:57:04.5298364Z ##[endgroup]
2026-01-25T08:57:04.5298886Z ##[group]Runner Image
2026-01-25T08:57:04.5299568Z Image: ubuntu-24.04
2026-01-25T08:57:04.5300046Z Version: 20260119.4.1
2026-01-25T08:57:04.5301344Z Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20260119.4/images/ubuntu/Ubuntu2404-Readme.md
2026-01-25T08:57:04.5302764Z Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20260119.4
2026-01-25T08:57:04.5304108Z ##[endgroup]
2026-01-25T08:57:04.5305149Z ##[group]GITHUB_TOKEN Permissions
2026-01-25T08:57:04.5307454Z Contents: read
2026-01-25T08:57:04.5308110Z Metadata: read
2026-01-25T08:57:04.5308580Z Packages: read
2026-01-25T08:57:04.5309069Z ##[endgroup]
2026-01-25T08:57:04.5311610Z Secret source: Actions
2026-01-25T08:57:04.5312565Z Prepare workflow directory
2026-01-25T08:57:04.5715244Z Prepare all required actions
2026-01-25T08:57:04.5755741Z Getting action download info
2026-01-25T08:57:04.9965919Z Download action repository 'actions/checkout@v4' (SHA:34e114876b0b11c390a56381ad16ebd13914f8d5)
2026-01-25T08:57:05.3373958Z Download action repository 'actions/setup-python@v5' (SHA:a26af69be951a213d495a4c3e4e4022e16d87065)
2026-01-25T08:57:05.4465496Z Download action repository 'actions/upload-artifact@v4' (SHA:ea165f8d65b6e75b540449e92b4886f43607fa02)
2026-01-25T08:57:05.7194526Z Complete job name: Code Quality Checks
2026-01-25T08:57:05.7969529Z ##[group]Run actions/checkout@v4
2026-01-25T08:57:05.7970485Z with:
2026-01-25T08:57:05.7970951Z   repository: discipleartem/flask_blog
2026-01-25T08:57:05.7971817Z   token: ***
2026-01-25T08:57:05.7972294Z   ssh-strict: true
2026-01-25T08:57:05.7972743Z   ssh-user: git
2026-01-25T08:57:05.7973354Z   persist-credentials: true
2026-01-25T08:57:05.7973863Z   clean: true
2026-01-25T08:57:05.7974322Z   sparse-checkout-cone-mode: true
2026-01-25T08:57:05.7974884Z   fetch-depth: 1
2026-01-25T08:57:05.7975337Z   fetch-tags: false
2026-01-25T08:57:05.7975800Z   show-progress: true
2026-01-25T08:57:05.7976257Z   lfs: false
2026-01-25T08:57:05.7976844Z   submodules: false
2026-01-25T08:57:05.7977304Z   set-safe-directory: true
2026-01-25T08:57:05.7978058Z env:
2026-01-25T08:57:05.7978456Z   PYTHON_VERSION: 3.13
2026-01-25T08:57:05.7978925Z ##[endgroup]
2026-01-25T08:57:05.9119568Z Syncing repository: discipleartem/flask_blog
2026-01-25T08:57:05.9121810Z ##[group]Getting Git version info
2026-01-25T08:57:05.9122734Z Working directory is '/home/runner/work/flask_blog/flask_blog'
2026-01-25T08:57:05.9124252Z [command]/usr/bin/git version
2026-01-25T08:57:05.9921345Z git version 2.52.0
2026-01-25T08:57:05.9949366Z ##[endgroup]
2026-01-25T08:57:05.9964207Z Temporarily overriding HOME='/home/runner/work/_temp/52c46e36-ef60-4000-9fbb-6028c8e8fbde' before making global git config changes
2026-01-25T08:57:05.9966035Z Adding repository directory to the temporary git global config as a safe directory
2026-01-25T08:57:05.9969939Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/flask_blog/flask_blog
2026-01-25T08:57:06.0040656Z Deleting the contents of '/home/runner/work/flask_blog/flask_blog'
2026-01-25T08:57:06.0044859Z ##[group]Initializing the repository
2026-01-25T08:57:06.0049086Z [command]/usr/bin/git init /home/runner/work/flask_blog/flask_blog
2026-01-25T08:57:06.0507365Z hint: Using 'master' as the name for the initial branch. This default branch name
2026-01-25T08:57:06.0509762Z hint: will change to "main" in Git 3.0. To configure the initial branch name
2026-01-25T08:57:06.0511200Z hint: to use in all of your new repositories, which will suppress this warning,
2026-01-25T08:57:06.0512334Z hint: call:
2026-01-25T08:57:06.0512857Z hint:
2026-01-25T08:57:06.0513903Z hint: 	git config --global init.defaultBranch <name>
2026-01-25T08:57:06.0514793Z hint:
2026-01-25T08:57:06.0515543Z hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
2026-01-25T08:57:06.0516708Z hint: 'development'. The just-created branch can be renamed via this command:
2026-01-25T08:57:06.0517624Z hint:
2026-01-25T08:57:06.0518039Z hint: 	git branch -m <name>
2026-01-25T08:57:06.0518577Z hint:
2026-01-25T08:57:06.0519296Z hint: Disable this message with "git config set advice.defaultBranchName false"
2026-01-25T08:57:06.0544898Z Initialized empty Git repository in /home/runner/work/flask_blog/flask_blog/.git/
2026-01-25T08:57:06.0560973Z [command]/usr/bin/git remote add origin https://github.com/discipleartem/flask_blog
2026-01-25T08:57:06.0635477Z ##[endgroup]
2026-01-25T08:57:06.0636900Z ##[group]Disabling automatic garbage collection
2026-01-25T08:57:06.0640372Z [command]/usr/bin/git config --local gc.auto 0
2026-01-25T08:57:06.0669885Z ##[endgroup]
2026-01-25T08:57:06.0671215Z ##[group]Setting up auth
2026-01-25T08:57:06.0678256Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2026-01-25T08:57:06.0709287Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2026-01-25T08:57:06.2190903Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2026-01-25T08:57:06.2222114Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2026-01-25T08:57:06.2454673Z [command]/usr/bin/git config --local --name-only --get-regexp ^includeIf\.gitdir:
2026-01-25T08:57:06.2485439Z [command]/usr/bin/git submodule foreach --recursive git config --local --show-origin --name-only --get-regexp remote.origin.url
2026-01-25T08:57:06.2724552Z [command]/usr/bin/git config --local http.https://github.com/.extraheader AUTHORIZATION: basic ***
2026-01-25T08:57:06.2759354Z ##[endgroup]
2026-01-25T08:57:06.2760300Z ##[group]Fetching the repository
2026-01-25T08:57:06.2768911Z [command]/usr/bin/git -c protocol.version=2 fetch --no-tags --prune --no-recurse-submodules --depth=1 origin +25167c0ec1453462695b3abbd3c381747674edaf:refs/remotes/pull/33/merge
2026-01-25T08:57:06.6240850Z From https://github.com/discipleartem/flask_blog
2026-01-25T08:57:06.6242773Z  * [new ref]         25167c0ec1453462695b3abbd3c381747674edaf -> pull/33/merge
2026-01-25T08:57:06.6315359Z ##[endgroup]
2026-01-25T08:57:06.6317315Z ##[group]Determining the checkout info
2026-01-25T08:57:06.6319592Z ##[endgroup]
2026-01-25T08:57:06.6323122Z [command]/usr/bin/git sparse-checkout disable
2026-01-25T08:57:06.6403942Z [command]/usr/bin/git config --local --unset-all extensions.worktreeConfig
2026-01-25T08:57:06.6432791Z ##[group]Checking out the ref
2026-01-25T08:57:06.6437139Z [command]/usr/bin/git checkout --progress --force refs/remotes/pull/33/merge
2026-01-25T08:57:06.6572325Z Note: switching to 'refs/remotes/pull/33/merge'.
2026-01-25T08:57:06.6575826Z 
2026-01-25T08:57:06.6577211Z You are in 'detached HEAD' state. You can look around, make experimental
2026-01-25T08:57:06.6580233Z changes and commit them, and you can discard any commits you make in this
2026-01-25T08:57:06.6583466Z state without impacting any branches by switching back to a branch.
2026-01-25T08:57:06.6585336Z 
2026-01-25T08:57:06.6586448Z If you want to create a new branch to retain commits you create, you may
2026-01-25T08:57:06.6589283Z do so (now or later) by using -c with the switch command. Example:
2026-01-25T08:57:06.6591481Z 
2026-01-25T08:57:06.6592062Z   git switch -c <new-branch-name>
2026-01-25T08:57:06.6593431Z 
2026-01-25T08:57:06.6593985Z Or undo this operation with:
2026-01-25T08:57:06.6595054Z 
2026-01-25T08:57:06.6595530Z   git switch -
2026-01-25T08:57:06.6596310Z 
2026-01-25T08:57:06.6597748Z Turn off this advice by setting config variable advice.detachedHead to false
2026-01-25T08:57:06.6599957Z 
2026-01-25T08:57:06.6602546Z HEAD is now at 25167c0 Merge c274d1e247fdef4f4790ffb0cb33ecc629dc81da into a79abf4c41996c94c074e58ee3cbb42803678bc8
2026-01-25T08:57:06.6609487Z ##[endgroup]
2026-01-25T08:57:06.6618414Z [command]/usr/bin/git log -1 --format=%H
2026-01-25T08:57:06.6641396Z 25167c0ec1453462695b3abbd3c381747674edaf
2026-01-25T08:57:06.7059775Z ##[group]Run actions/setup-python@v5
2026-01-25T08:57:06.7060859Z with:
2026-01-25T08:57:06.7061560Z   python-version: 3.13
2026-01-25T08:57:06.7062380Z   cache: pip
2026-01-25T08:57:06.7063533Z   cache-dependency-path: pyproject.toml
requirements.txt

2026-01-25T08:57:06.7064896Z   check-latest: false
2026-01-25T08:57:06.7065976Z   token: ***
2026-01-25T08:57:06.7066743Z   update-environment: true
2026-01-25T08:57:06.7067675Z   allow-prereleases: false
2026-01-25T08:57:06.7068577Z   freethreaded: false
2026-01-25T08:57:06.7069499Z env:
2026-01-25T08:57:06.7070162Z   PYTHON_VERSION: 3.13
2026-01-25T08:57:06.7070947Z ##[endgroup]
2026-01-25T08:57:06.8799488Z ##[group]Installed versions
2026-01-25T08:57:06.9336611Z Successfully set up CPython (3.13.11)
2026-01-25T08:57:06.9339593Z ##[endgroup]
2026-01-25T08:57:06.9657357Z [command]/opt/hostedtoolcache/Python/3.13.11/x64/bin/pip cache dir
2026-01-25T08:57:08.2174047Z /home/runner/.cache/pip
2026-01-25T08:57:08.3757461Z Cache hit for: setup-python-Linux-x64-24.04-Ubuntu-python-3.13.11-pip-f6f74954b002367da21a619c33577c911090a4996ecc1f5fe684fd36213f5837
2026-01-25T08:57:09.0091765Z Received 27843171 of 27843171 (100.0%), 52.7 MBs/sec
2026-01-25T08:57:09.0092473Z Cache Size: ~27 MB (27843171 B)
2026-01-25T08:57:09.0124201Z [command]/usr/bin/tar -xf /home/runner/work/_temp/618cac35-422f-4de5-b72f-6ff9dd1449cb/cache.tzst -P -C /home/runner/work/flask_blog/flask_blog --use-compress-program unzstd
2026-01-25T08:57:09.0965425Z Cache restored successfully
2026-01-25T08:57:09.1022293Z Cache restored from key: setup-python-Linux-x64-24.04-Ubuntu-python-3.13.11-pip-cf355c00c370cef82828f30a3d8a6057f0bb504fe015d19bbbcce378e468d196
2026-01-25T08:57:09.1188702Z ##[group]Run python -m pip install --upgrade pip
2026-01-25T08:57:09.1189137Z [36;1mpython -m pip install --upgrade pip[0m
2026-01-25T08:57:09.1189454Z [36;1mpip install -e ".[dev]"[0m
2026-01-25T08:57:09.1229585Z shell: /usr/bin/bash -e {0}
2026-01-25T08:57:09.1229857Z env:
2026-01-25T08:57:09.1230047Z   PYTHON_VERSION: 3.13
2026-01-25T08:57:09.1230343Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:09.1230796Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.11/x64/lib/pkgconfig
2026-01-25T08:57:09.1231254Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:09.1231628Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:09.1231989Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:09.1232362Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.11/x64/lib
2026-01-25T08:57:09.1232675Z ##[endgroup]
2026-01-25T08:57:10.2858902Z Requirement already satisfied: pip in /opt/hostedtoolcache/Python/3.13.11/x64/lib/python3.13/site-packages (25.3)
2026-01-25T08:57:11.2423788Z Obtaining file:///home/runner/work/flask_blog/flask_blog
2026-01-25T08:57:11.2443355Z   Installing build dependencies: started
2026-01-25T08:57:12.3103449Z   Installing build dependencies: finished with status 'done'
2026-01-25T08:57:12.3111218Z   Checking if build backend supports build_editable: started
2026-01-25T08:57:12.6618212Z   Checking if build backend supports build_editable: finished with status 'done'
2026-01-25T08:57:12.6627048Z   Getting requirements to build editable: started
2026-01-25T08:57:13.0175659Z   Getting requirements to build editable: finished with status 'done'
2026-01-25T08:57:13.0185251Z   Preparing editable metadata (pyproject.toml): started
2026-01-25T08:57:13.2318169Z   Preparing editable metadata (pyproject.toml): finished with status 'done'
2026-01-25T08:57:13.3137691Z Collecting Flask>=3.1.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.3150643Z   Using cached flask-3.1.2-py3-none-any.whl.metadata (3.2 kB)
2026-01-25T08:57:13.3306476Z Collecting python-dotenv>=1.0.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.3317728Z   Using cached python_dotenv-1.2.1-py3-none-any.whl.metadata (25 kB)
2026-01-25T08:57:13.3528256Z Collecting werkzeug>=3.1.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.3539534Z   Using cached werkzeug-3.1.5-py3-none-any.whl.metadata (4.0 kB)
2026-01-25T08:57:13.3700718Z Collecting click>=8.1.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.3711896Z   Using cached click-8.3.1-py3-none-any.whl.metadata (2.6 kB)
2026-01-25T08:57:13.4056396Z Collecting pytest>=8.0.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.4068926Z   Using cached pytest-9.0.2-py3-none-any.whl.metadata (7.6 kB)
2026-01-25T08:57:13.4223802Z Collecting pytest-flask>=1.3.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.4235141Z   Using cached pytest_flask-1.3.0-py3-none-any.whl.metadata (14 kB)
2026-01-25T08:57:13.4385716Z Collecting pytest-cov>=6.0.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.4397159Z   Using cached pytest_cov-7.0.0-py3-none-any.whl.metadata (31 kB)
2026-01-25T08:57:13.4943297Z Collecting black>=24.0.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.4956614Z   Using cached black-26.1.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (88 kB)
2026-01-25T08:57:13.5236272Z Collecting flake8>=7.0.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.5248583Z   Using cached flake8-7.3.0-py2.py3-none-any.whl.metadata (3.8 kB)
2026-01-25T08:57:13.6307341Z Collecting mypy>=1.8.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.6327476Z   Using cached mypy-1.19.1-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (2.2 kB)
2026-01-25T08:57:13.6543864Z Collecting bandit>=1.7.0 (from flask_blog==0.3.0)
2026-01-25T08:57:13.7452839Z   Downloading bandit-1.9.3-py3-none-any.whl.metadata (7.1 kB)
2026-01-25T08:57:13.7987300Z Collecting PyYAML>=5.3.1 (from bandit>=1.7.0->flask_blog==0.3.0)
2026-01-25T08:57:13.8134387Z   Downloading pyyaml-6.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (2.4 kB)
2026-01-25T08:57:13.8390534Z Collecting stevedore>=1.20.0 (from bandit>=1.7.0->flask_blog==0.3.0)
2026-01-25T08:57:13.8540875Z   Downloading stevedore-5.6.0-py3-none-any.whl.metadata (2.3 kB)
2026-01-25T08:57:13.8983791Z Collecting rich (from bandit>=1.7.0->flask_blog==0.3.0)
2026-01-25T08:57:13.9131428Z   Downloading rich-14.3.1-py3-none-any.whl.metadata (18 kB)
2026-01-25T08:57:13.9371748Z Collecting mypy-extensions>=0.4.3 (from black>=24.0.0->flask_blog==0.3.0)
2026-01-25T08:57:13.9383405Z   Using cached mypy_extensions-1.1.0-py3-none-any.whl.metadata (1.1 kB)
2026-01-25T08:57:13.9534105Z Collecting packaging>=22.0 (from black>=24.0.0->flask_blog==0.3.0)
2026-01-25T08:57:13.9550464Z   Using cached packaging-26.0-py3-none-any.whl.metadata (3.3 kB)
2026-01-25T08:57:13.9665805Z Collecting pathspec>=1.0.0 (from black>=24.0.0->flask_blog==0.3.0)
2026-01-25T08:57:13.9678009Z   Using cached pathspec-1.0.3-py3-none-any.whl.metadata (13 kB)
2026-01-25T08:57:13.9873660Z Collecting platformdirs>=2 (from black>=24.0.0->flask_blog==0.3.0)
2026-01-25T08:57:13.9886529Z   Using cached platformdirs-4.5.1-py3-none-any.whl.metadata (12 kB)
2026-01-25T08:57:14.0030306Z Collecting pytokens>=0.3.0 (from black>=24.0.0->flask_blog==0.3.0)
2026-01-25T08:57:14.0044084Z   Using cached pytokens-0.4.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (3.8 kB)
2026-01-25T08:57:14.0181275Z Collecting mccabe<0.8.0,>=0.7.0 (from flake8>=7.0.0->flask_blog==0.3.0)
2026-01-25T08:57:14.0193946Z   Using cached mccabe-0.7.0-py2.py3-none-any.whl.metadata (5.0 kB)
2026-01-25T08:57:14.0328511Z Collecting pycodestyle<2.15.0,>=2.14.0 (from flake8>=7.0.0->flask_blog==0.3.0)
2026-01-25T08:57:14.0341020Z   Using cached pycodestyle-2.14.0-py2.py3-none-any.whl.metadata (4.5 kB)
2026-01-25T08:57:14.0482676Z Collecting pyflakes<3.5.0,>=3.4.0 (from flake8>=7.0.0->flask_blog==0.3.0)
2026-01-25T08:57:14.0498917Z   Using cached pyflakes-3.4.0-py2.py3-none-any.whl.metadata (3.5 kB)
2026-01-25T08:57:14.0622359Z Collecting blinker>=1.9.0 (from Flask>=3.1.0->flask_blog==0.3.0)
2026-01-25T08:57:14.0635842Z   Using cached blinker-1.9.0-py3-none-any.whl.metadata (1.6 kB)
2026-01-25T08:57:14.0793649Z Collecting itsdangerous>=2.2.0 (from Flask>=3.1.0->flask_blog==0.3.0)
2026-01-25T08:57:14.0806499Z   Using cached itsdangerous-2.2.0-py3-none-any.whl.metadata (1.9 kB)
2026-01-25T08:57:14.0958527Z Collecting jinja2>=3.1.2 (from Flask>=3.1.0->flask_blog==0.3.0)
2026-01-25T08:57:14.0970766Z   Using cached jinja2-3.1.6-py3-none-any.whl.metadata (2.9 kB)
2026-01-25T08:57:14.1520282Z Collecting markupsafe>=2.1.1 (from Flask>=3.1.0->flask_blog==0.3.0)
2026-01-25T08:57:14.1534355Z   Using cached markupsafe-3.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (2.7 kB)
2026-01-25T08:57:14.1749463Z Collecting typing_extensions>=4.6.0 (from mypy>=1.8.0->flask_blog==0.3.0)
2026-01-25T08:57:14.1762199Z   Using cached typing_extensions-4.15.0-py3-none-any.whl.metadata (3.3 kB)
2026-01-25T08:57:14.2777409Z Collecting librt>=0.6.2 (from mypy>=1.8.0->flask_blog==0.3.0)
2026-01-25T08:57:14.2795072Z   Using cached librt-0.7.8-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (1.3 kB)
2026-01-25T08:57:14.2935549Z Collecting iniconfig>=1.0.1 (from pytest>=8.0.0->flask_blog==0.3.0)
2026-01-25T08:57:14.2948963Z   Using cached iniconfig-2.3.0-py3-none-any.whl.metadata (2.5 kB)
2026-01-25T08:57:14.3065306Z Collecting pluggy<2,>=1.5 (from pytest>=8.0.0->flask_blog==0.3.0)
2026-01-25T08:57:14.3079141Z   Using cached pluggy-1.6.0-py3-none-any.whl.metadata (4.8 kB)
2026-01-25T08:57:14.3271818Z Collecting pygments>=2.7.2 (from pytest>=8.0.0->flask_blog==0.3.0)
2026-01-25T08:57:14.3287194Z   Using cached pygments-2.19.2-py3-none-any.whl.metadata (2.5 kB)
2026-01-25T08:57:14.7113720Z Collecting coverage>=7.10.6 (from coverage[toml]>=7.10.6->pytest-cov>=6.0.0->flask_blog==0.3.0)
2026-01-25T08:57:14.7128572Z   Using cached coverage-7.13.1-cp313-cp313-manylinux1_x86_64.manylinux_2_28_x86_64.manylinux_2_5_x86_64.whl.metadata (8.5 kB)
2026-01-25T08:57:14.7624934Z Collecting markdown-it-py>=2.2.0 (from rich->bandit>=1.7.0->flask_blog==0.3.0)
2026-01-25T08:57:14.7772418Z   Downloading markdown_it_py-4.0.0-py3-none-any.whl.metadata (7.3 kB)
2026-01-25T08:57:14.7996948Z Collecting mdurl~=0.1 (from markdown-it-py>=2.2.0->rich->bandit>=1.7.0->flask_blog==0.3.0)
2026-01-25T08:57:14.8151384Z   Downloading mdurl-0.1.2-py3-none-any.whl.metadata (1.6 kB)
2026-01-25T08:57:14.8363802Z Downloading bandit-1.9.3-py3-none-any.whl (134 kB)
2026-01-25T08:57:14.8640867Z Using cached black-26.1.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (1.8 MB)
2026-01-25T08:57:14.8665888Z Using cached click-8.3.1-py3-none-any.whl (108 kB)
2026-01-25T08:57:14.8677586Z Using cached flake8-7.3.0-py2.py3-none-any.whl (57 kB)
2026-01-25T08:57:14.8689290Z Using cached mccabe-0.7.0-py2.py3-none-any.whl (7.3 kB)
2026-01-25T08:57:14.8700469Z Using cached pycodestyle-2.14.0-py2.py3-none-any.whl (31 kB)
2026-01-25T08:57:14.8712289Z Using cached pyflakes-3.4.0-py2.py3-none-any.whl (63 kB)
2026-01-25T08:57:14.8723974Z Using cached flask-3.1.2-py3-none-any.whl (103 kB)
2026-01-25T08:57:14.8735898Z Using cached blinker-1.9.0-py3-none-any.whl (8.5 kB)
2026-01-25T08:57:14.8747398Z Using cached itsdangerous-2.2.0-py3-none-any.whl (16 kB)
2026-01-25T08:57:14.8758766Z Using cached jinja2-3.1.6-py3-none-any.whl (134 kB)
2026-01-25T08:57:14.8771272Z Using cached markupsafe-3.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (22 kB)
2026-01-25T08:57:14.8783368Z Using cached mypy-1.19.1-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (13.6 MB)
2026-01-25T08:57:14.8897494Z Using cached librt-0.7.8-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (193 kB)
2026-01-25T08:57:14.8909570Z Using cached mypy_extensions-1.1.0-py3-none-any.whl (5.0 kB)
2026-01-25T08:57:14.8920715Z Using cached packaging-26.0-py3-none-any.whl (74 kB)
2026-01-25T08:57:14.8931969Z Using cached pathspec-1.0.3-py3-none-any.whl (55 kB)
2026-01-25T08:57:14.8943137Z Using cached platformdirs-4.5.1-py3-none-any.whl (18 kB)
2026-01-25T08:57:14.8953874Z Using cached pytest-9.0.2-py3-none-any.whl (374 kB)
2026-01-25T08:57:14.8967532Z Using cached pluggy-1.6.0-py3-none-any.whl (20 kB)
2026-01-25T08:57:14.8978417Z Using cached iniconfig-2.3.0-py3-none-any.whl (7.5 kB)
2026-01-25T08:57:14.8989209Z Using cached pygments-2.19.2-py3-none-any.whl (1.2 MB)
2026-01-25T08:57:14.9008619Z Using cached pytest_cov-7.0.0-py3-none-any.whl (22 kB)
2026-01-25T08:57:14.9020052Z Using cached coverage-7.13.1-cp313-cp313-manylinux1_x86_64.manylinux_2_28_x86_64.manylinux_2_5_x86_64.whl (252 kB)
2026-01-25T08:57:14.9032224Z Using cached pytest_flask-1.3.0-py3-none-any.whl (13 kB)
2026-01-25T08:57:14.9043262Z Using cached python_dotenv-1.2.1-py3-none-any.whl (21 kB)
2026-01-25T08:57:14.9054449Z Using cached pytokens-0.4.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (267 kB)
2026-01-25T08:57:14.9202336Z Downloading pyyaml-6.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (801 kB)
2026-01-25T08:57:14.9519291Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 801.6/801.6 kB 32.5 MB/s  0:00:00
2026-01-25T08:57:14.9670272Z Downloading stevedore-5.6.0-py3-none-any.whl (54 kB)
2026-01-25T08:57:14.9705967Z Using cached typing_extensions-4.15.0-py3-none-any.whl (44 kB)
2026-01-25T08:57:14.9717666Z Using cached werkzeug-3.1.5-py3-none-any.whl (225 kB)
2026-01-25T08:57:14.9869092Z Downloading rich-14.3.1-py3-none-any.whl (309 kB)
2026-01-25T08:57:15.0048623Z Downloading markdown_it_py-4.0.0-py3-none-any.whl (87 kB)
2026-01-25T08:57:15.0220457Z Downloading mdurl-0.1.2-py3-none-any.whl (10.0 kB)
2026-01-25T08:57:15.0790716Z Building wheels for collected packages: flask_blog
2026-01-25T08:57:15.0802554Z   Building editable for flask_blog (pyproject.toml): started
2026-01-25T08:57:15.3287644Z   Building editable for flask_blog (pyproject.toml): finished with status 'done'
2026-01-25T08:57:15.3294755Z   Created wheel for flask_blog: filename=flask_blog-0.3.0-0.editable-py3-none-any.whl size=3177 sha256=e0dfd2d84cad4ed54fd205d15e80d0f4df24f9241719ee25ce4bef39464ea6f2
2026-01-25T08:57:15.3296913Z   Stored in directory: /tmp/pip-ephem-wheel-cache-ihkwee5w/wheels/92/68/f0/e4e21125bd6c1bad3b54462725f76e6985f9818075fb8ba31b
2026-01-25T08:57:15.3315316Z Successfully built flask_blog
2026-01-25T08:57:15.3937539Z Installing collected packages: typing_extensions, stevedore, PyYAML, pytokens, python-dotenv, pygments, pyflakes, pycodestyle, pluggy, platformdirs, pathspec, packaging, mypy-extensions, mdurl, mccabe, markupsafe, librt, itsdangerous, iniconfig, coverage, click, blinker, werkzeug, pytest, mypy, markdown-it-py, jinja2, flake8, black, rich, pytest-cov, Flask, pytest-flask, flask_blog, bandit
2026-01-25T08:57:19.5969442Z 
2026-01-25T08:57:19.6019463Z Successfully installed Flask-3.1.2 PyYAML-6.0.3 bandit-1.9.3 black-26.1.0 blinker-1.9.0 click-8.3.1 coverage-7.13.1 flake8-7.3.0 flask_blog-0.3.0 iniconfig-2.3.0 itsdangerous-2.2.0 jinja2-3.1.6 librt-0.7.8 markdown-it-py-4.0.0 markupsafe-3.0.3 mccabe-0.7.0 mdurl-0.1.2 mypy-1.19.1 mypy-extensions-1.1.0 packaging-26.0 pathspec-1.0.3 platformdirs-4.5.1 pluggy-1.6.0 pycodestyle-2.14.0 pyflakes-3.4.0 pygments-2.19.2 pytest-9.0.2 pytest-cov-7.0.0 pytest-flask-1.3.0 python-dotenv-1.2.1 pytokens-0.4.0 rich-14.3.1 stevedore-5.6.0 typing_extensions-4.15.0 werkzeug-3.1.5
2026-01-25T08:57:19.8130100Z ##[group]Run flake8 app/ tests/ --count --select=E9,F63,F7,F82 --show-source --statistics
2026-01-25T08:57:19.8130761Z [36;1mflake8 app/ tests/ --count --select=E9,F63,F7,F82 --show-source --statistics[0m
2026-01-25T08:57:19.8131353Z [36;1mflake8 app/ tests/ --count --exit-zero --max-complexity=10 --max-line-length=88 --statistics[0m
2026-01-25T08:57:19.8164462Z shell: /usr/bin/bash -e {0}
2026-01-25T08:57:19.8164714Z env:
2026-01-25T08:57:19.8164901Z   PYTHON_VERSION: 3.13
2026-01-25T08:57:19.8165186Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:19.8165608Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.11/x64/lib/pkgconfig
2026-01-25T08:57:19.8166021Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:19.8166407Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:19.8166772Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:19.8167180Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.11/x64/lib
2026-01-25T08:57:19.8167496Z ##[endgroup]
2026-01-25T08:57:20.4864603Z <unknown>:53: SyntaxWarning: invalid escape sequence '\d'
2026-01-25T08:57:20.5613383Z 0
2026-01-25T08:57:20.8537543Z <unknown>:53: SyntaxWarning: invalid escape sequence '\d'
2026-01-25T08:57:20.9274988Z app/__init__.py:23:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9275650Z app/__init__.py:29:89: E501 line too long (96 > 88 characters)
2026-01-25T08:57:20.9276344Z app/auth/__init__.py:7:1: F401 'app.auth.utils.hash_password' imported but unused
2026-01-25T08:57:20.9277089Z app/auth/__init__.py:7:1: F401 'app.auth.utils.verify_password' imported but unused
2026-01-25T08:57:20.9277883Z app/auth/__init__.py:7:1: F401 'app.auth.utils.generate_discriminator' imported but unused
2026-01-25T08:57:20.9278705Z app/auth/__init__.py:7:1: E402 module level import not at top of file
2026-01-25T08:57:20.9279441Z app/auth/routes.py:20:89: E501 line too long (108 > 88 characters)
2026-01-25T08:57:20.9280213Z app/auth/routes.py:43:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9280895Z app/auth/routes.py:53:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9281586Z app/auth/routes.py:55:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9282282Z app/auth/routes.py:66:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9283187Z app/auth/routes.py:70:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9283995Z app/auth/routes.py:74:89: E501 line too long (104 > 88 characters)
2026-01-25T08:57:20.9284726Z app/auth/routes.py:79:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9285408Z app/auth/routes.py:83:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9286092Z app/auth/routes.py:88:89: E501 line too long (92 > 88 characters)
2026-01-25T08:57:20.9286781Z app/auth/routes.py:94:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9287443Z app/auth/routes.py:99:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9288140Z app/auth/routes.py:102:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9288839Z app/auth/routes.py:104:89: E501 line too long (99 > 88 characters)
2026-01-25T08:57:20.9289545Z app/auth/routes.py:108:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9290214Z app/auth/routes.py:113:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9290991Z app/auth/routes.py:117:9: F841 local variable 'cursor' is assigned to but never used
2026-01-25T08:57:20.9291851Z app/auth/routes.py:118:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9292554Z app/auth/routes.py:125:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9293497Z app/auth/routes.py:129:89: E501 line too long (101 > 88 characters)
2026-01-25T08:57:20.9294183Z app/auth/routes.py:131:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9294877Z app/auth/routes.py:133:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9295548Z app/auth/routes.py:137:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9296787Z app/auth/routes.py:139:89: E501 line too long (99 > 88 characters)
2026-01-25T08:57:20.9297838Z app/auth/routes.py:143:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9298554Z app/auth/routes.py:149:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9299232Z app/auth/routes.py:155:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9299916Z app/auth/routes.py:158:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9300580Z app/auth/routes.py:161:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9301248Z app/auth/routes.py:168:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9301907Z app/auth/routes.py:175:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9302574Z app/auth/routes.py:180:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9303529Z app/auth/routes.py:183:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9304206Z app/auth/routes.py:187:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9304891Z app/auth/routes.py:189:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9305568Z app/auth/routes.py:195:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9306234Z app/auth/routes.py:199:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9306921Z app/auth/routes.py:205:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9307597Z app/auth/routes.py:208:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9308273Z app/auth/routes.py:214:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9308960Z app/auth/routes.py:218:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9309622Z app/auth/routes.py:224:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9310304Z app/auth/routes.py:228:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9310974Z app/auth/routes.py:233:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9311635Z app/auth/routes.py:236:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9312324Z app/auth/routes.py:241:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9313677Z app/auth/routes.py:245:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9314376Z app/auth/routes.py:248:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9315063Z app/auth/routes.py:253:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9315804Z app/auth/routes.py:255:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9316506Z app/auth/routes.py:257:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9317165Z app/auth/routes.py:266:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9317824Z app/auth/routes.py:272:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9318541Z app/auth/routes.py:278:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9319246Z app/auth/routes.py:287:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9319903Z app/auth/routes.py:299:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9320584Z app/auth/routes.py:303:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9321397Z app/auth/routes.py:308:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9322214Z app/auth/routes.py:314:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9323124Z app/auth/routes.py:317:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9323798Z app/auth/routes.py:322:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9324520Z app/auth/routes.py:326:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9325145Z app/auth/routes.py:328:27: W291 trailing whitespace
2026-01-25T08:57:20.9325713Z app/auth/routes.py:329:19: W291 trailing whitespace
2026-01-25T08:57:20.9326271Z app/auth/routes.py:330:47: W291 trailing whitespace
2026-01-25T08:57:20.9327003Z app/auth/routes.py:337:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9327669Z app/auth/routes.py:345:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9328364Z app/auth/routes.py:347:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9329382Z app/auth/routes.py:348:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9330299Z app/auth/routes.py:352:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9331043Z app/auth/routes.py:359:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9331817Z app/auth/routes.py:361:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9332510Z app/auth/routes.py:365:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9333684Z app/auth/routes.py:369:89: E501 line too long (105 > 88 characters)
2026-01-25T08:57:20.9334414Z app/auth/routes.py:374:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9335078Z app/auth/routes.py:377:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9335746Z app/auth/routes.py:382:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9336406Z app/auth/routes.py:385:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9337234Z app/auth/routes.py:389:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9337966Z app/auth/routes.py:391:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9338683Z app/auth/routes.py:397:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9339446Z app/auth/routes.py:401:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9340160Z app/auth/routes.py:406:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9340826Z app/auth/routes.py:409:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9341501Z app/auth/routes.py:413:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9342175Z app/auth/routes.py:415:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9342847Z app/auth/routes.py:422:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9343828Z app/auth/routes.py:425:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9344550Z app/auth/routes.py:430:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9345247Z app/auth/routes.py:443:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9345928Z app/auth/routes.py:445:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9346616Z app/auth/routes.py:451:43: W292 no newline at end of file
2026-01-25T08:57:20.9347420Z app/auth/utils.py:7:1: F401 'werkzeug.security.check_password_hash' imported but unused
2026-01-25T08:57:20.9348452Z app/auth/utils.py:7:1: F401 'werkzeug.security.generate_password_hash' imported but unused
2026-01-25T08:57:20.9349270Z app/auth/utils.py:15:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9349876Z app/auth/utils.py:19:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9350523Z app/auth/utils.py:26:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9351176Z app/auth/utils.py:29:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9351826Z app/auth/utils.py:32:5: F401 'hmac' imported but unused
2026-01-25T08:57:20.9352390Z app/auth/utils.py:33:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9353139Z app/auth/utils.py:37:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9353779Z app/auth/utils.py:43:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9354354Z app/auth/utils.py:48:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9354937Z app/auth/utils.py:55:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9355508Z app/auth/utils.py:60:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9356134Z app/auth/utils.py:63:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9356735Z app/auth/utils.py:67:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9357334Z app/auth/utils.py:71:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9357936Z app/auth/utils.py:81:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9358495Z app/forms/__init__.py:6:55: W291 trailing whitespace
2026-01-25T08:57:20.9359116Z app/forms/__init__.py:28:16: W291 trailing whitespace
2026-01-25T08:57:20.9359660Z app/forms/auth.py:8:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9360272Z app/forms/auth.py:13:89: E501 line too long (94 > 88 characters)
2026-01-25T08:57:20.9361346Z app/forms/auth.py:14:89: E501 line too long (135 > 88 characters)
2026-01-25T08:57:20.9362158Z app/forms/auth.py:15:89: E501 line too long (108 > 88 characters)
2026-01-25T08:57:20.9362752Z app/forms/auth.py:18:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9363613Z app/forms/auth.py:30:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9364215Z app/forms/auth.py:35:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9364815Z app/forms/auth.py:38:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9365385Z app/forms/auth.py:45:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9366094Z app/forms/base.py:38:89: E501 line too long (92 > 88 characters)
2026-01-25T08:57:20.9366684Z app/forms/base.py:65:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9367266Z app/forms/base.py:74:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9367845Z app/forms/base.py:78:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9368421Z app/forms/base.py:88:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9369049Z app/forms/comment.py:7:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9369695Z app/forms/comment.py:12:89: E501 line too long (92 > 88 characters)
2026-01-25T08:57:20.9370322Z app/forms/csrf.py:20:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9370923Z app/forms/csrf.py:24:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9371502Z app/forms/csrf.py:45:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9372055Z app/forms/csrf.py:49:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9372665Z app/forms/fields.py:41:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9373522Z app/forms/post.py:7:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9374098Z app/forms/post.py:15:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9374716Z app/forms/post.py:20:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9375371Z app/forms/validators.py:9:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9376062Z app/forms/validators.py:15:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9376757Z app/forms/validators.py:29:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9377428Z app/forms/validators.py:38:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9378048Z app/forms/validators.py:45:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9378700Z app/forms/validators.py:52:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9379376Z app/forms/validators.py:58:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9380057Z app/forms/validators.py:109:2: W291 trailing whitespace
2026-01-25T08:57:20.9380686Z app/main/routes.py:2:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9381366Z app/main/routes.py:6:1: F401 'app.models.Post' imported but unused
2026-01-25T08:57:20.9381991Z app/main/routes.py:24:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9382610Z app/main/routes.py:33:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9383554Z app/main/routes.py:39:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9384177Z app/main/routes.py:49:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9384771Z app/main/routes.py:53:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9385412Z app/main/routes.py:54:89: E501 line too long (106 > 88 characters)
2026-01-25T08:57:20.9386025Z app/main/routes.py:64:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9386591Z app/main/routes.py:67:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9387154Z app/main/routes.py:69:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9387716Z app/main/routes.py:78:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9388276Z app/main/routes.py:84:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9388842Z app/main/routes.py:95:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9389395Z app/main/routes.py:98:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9390703Z app/main/routes.py:106:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9391346Z app/main/routes.py:119:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9391923Z app/main/routes.py:121:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9392602Z app/main/routes.py:123:9: F841 local variable 'comment' is assigned to but never used
2026-01-25T08:57:20.9393524Z app/main/routes.py:134:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9394073Z app/main/routes.py:146:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9394635Z app/main/routes.py:154:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9395181Z app/main/routes.py:160:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9395741Z app/models/comment.py:8:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9396310Z app/models/comment.py:12:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9396892Z app/models/comment.py:30:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9397495Z app/models/comment.py:35:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9398076Z app/models/comment.py:38:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9398658Z app/models/comment.py:41:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9399312Z app/models/comment.py:46:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9399893Z app/models/comment.py:49:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9400461Z app/models/comment.py:63:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9401033Z app/models/comment.py:67:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9401604Z app/models/comment.py:70:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9402173Z app/models/comment.py:75:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9402776Z app/models/comment.py:78:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9403568Z app/models/comment.py:79:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9404172Z app/models/post.py:8:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9404777Z app/models/post.py:12:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9405309Z app/models/post.py:32:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9405857Z app/models/post.py:37:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9406410Z app/models/post.py:40:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9407018Z app/models/post.py:43:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9407682Z app/models/post.py:48:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9408255Z app/models/post.py:51:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9408822Z app/models/post.py:66:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9409357Z app/models/post.py:70:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9409934Z app/models/post.py:73:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9410506Z app/models/post.py:78:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9411051Z app/models/post.py:82:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9411663Z app/services/comment_service.py:11:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9412341Z app/services/comment_service.py:15:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9413202Z app/services/comment_service.py:19:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9413896Z app/services/comment_service.py:24:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9414578Z app/services/comment_service.py:34:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9415302Z app/services/comment_service.py:37:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9416024Z app/services/comment_service.py:41:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9416749Z app/services/comment_service.py:44:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9418017Z app/services/comment_service.py:51:89: E501 line too long (92 > 88 characters)
2026-01-25T08:57:20.9418952Z app/services/comment_service.py:57:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9419678Z app/services/comment_service.py:60:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9420424Z app/services/comment_service.py:66:89: E501 line too long (114 > 88 characters)
2026-01-25T08:57:20.9421158Z app/services/comment_service.py:70:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9421867Z app/services/comment_service.py:74:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9422572Z app/services/comment_service.py:77:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9423467Z app/services/comment_service.py:84:89: E501 line too long (92 > 88 characters)
2026-01-25T08:57:20.9424219Z app/services/comment_service.py:91:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9424993Z app/services/comment_service.py:99:89: E501 line too long (118 > 88 characters)
2026-01-25T08:57:20.9425804Z app/services/comment_service.py:103:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9426625Z app/services/comment_service.py:105:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9427379Z app/services/comment_service.py:109:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9428137Z app/services/comment_service.py:113:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9428875Z app/services/comment_service.py:118:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9429613Z app/services/comment_service.py:124:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9430356Z app/services/comment_service.py:127:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9431071Z app/services/comment_service.py:134:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9431796Z app/services/comment_service.py:136:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9432515Z app/services/comment_service.py:140:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9433669Z app/services/comment_service.py:143:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9434385Z app/services/comment_service.py:152:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9435096Z app/services/comment_service.py:154:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9435815Z app/services/comment_service.py:158:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9436511Z app/services/comment_service.py:163:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9437189Z app/services/comment_service.py:168:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9437959Z app/services/comment_service.py:174:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9438667Z app/services/comment_service.py:177:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9439401Z app/services/comment_service.py:184:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9440131Z app/services/post_service.py:2:1: F401 'datetime.datetime' imported but unused
2026-01-25T08:57:20.9440884Z app/services/post_service.py:11:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9441547Z app/services/post_service.py:15:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9442208Z app/services/post_service.py:19:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9442859Z app/services/post_service.py:24:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9443951Z app/services/post_service.py:34:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9444702Z app/services/post_service.py:37:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9445348Z app/services/post_service.py:41:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9446020Z app/services/post_service.py:44:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9446677Z app/services/post_service.py:57:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9447315Z app/services/post_service.py:60:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9448363Z app/services/post_service.py:71:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9449195Z app/services/post_service.py:74:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9449863Z app/services/post_service.py:75:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9450469Z app/services/post_service.py:87:61: W291 trailing whitespace
2026-01-25T08:57:20.9451018Z app/services/post_service.py:88:32: W291 trailing whitespace
2026-01-25T08:57:20.9451625Z app/services/post_service.py:93:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9452388Z app/services/post_service.py:106:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9453350Z app/services/post_service.py:108:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9454017Z app/services/post_service.py:112:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9454676Z app/services/post_service.py:117:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9455418Z app/services/post_service.py:127:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9456164Z app/services/post_service.py:129:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9456875Z app/services/post_service.py:133:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9457567Z app/services/post_service.py:136:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9458266Z app/services/post_service.py:143:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9458878Z app/services/post_service.py:145:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9459508Z app/services/post_service.py:149:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9460126Z app/services/post_service.py:152:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9460694Z tests/base.py:4:1: F401 'pytest' imported but unused
2026-01-25T08:57:20.9461212Z tests/base.py:11:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9461746Z tests/base.py:14:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9462322Z tests/base.py:20:89: E501 line too long (95 > 88 characters)
2026-01-25T08:57:20.9462862Z tests/base.py:21:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9463685Z tests/base.py:29:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9464292Z tests/base.py:30:89: E501 line too long (100 > 88 characters)
2026-01-25T08:57:20.9464845Z tests/base.py:32:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9465377Z tests/base.py:44:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9465924Z tests/base.py:47:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9466487Z tests/base.py:54:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9467090Z tests/base.py:56:89: E501 line too long (105 > 88 characters)
2026-01-25T08:57:20.9467663Z tests/base.py:59:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9468202Z tests/base.py:65:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9468846Z tests/base.py:68:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9469391Z tests/base.py:75:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9469899Z tests/base.py:78:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9470455Z tests/base.py:81:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9470963Z tests/base.py:85:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9471470Z tests/base.py:96:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9471991Z tests/base.py:100:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9472556Z tests/base.py:106:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9473362Z tests/base.py:112:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9473880Z tests/base.py:116:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9474435Z tests/base.py:118:89: E501 line too long (95 > 88 characters)
2026-01-25T08:57:20.9474986Z tests/base.py:120:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9475488Z tests/base.py:128:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9476683Z tests/base.py:135:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9477256Z tests/base.py:139:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9477802Z tests/base.py:145:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9478334Z tests/base.py:147:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9478869Z tests/base.py:155:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9479382Z tests/base.py:161:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9479919Z tests/base.py:164:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9480454Z tests/base.py:166:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9480950Z tests/base.py:170:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9481500Z tests/base.py:178:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9482048Z tests/base.py:179:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9482597Z tests/base.py:183:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9483359Z tests/base.py:189:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9483936Z tests/base.py:193:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9484457Z tests/base.py:197:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9484975Z tests/base.py:206:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9485498Z tests/base.py:210:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9486042Z tests/conftest.py:15:89: E501 line too long (109 > 88 characters)
2026-01-25T08:57:20.9486616Z tests/conftest.py:24:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9487174Z tests/conftest.py:32:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9487714Z tests/conftest.py:34:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9488297Z tests/conftest.py:38:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9488853Z tests/conftest.py:46:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9489417Z tests/conftest.py:50:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9489980Z tests/conftest.py:54:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9490582Z tests/conftest.py:60:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9491137Z tests/conftest.py:63:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9491738Z tests/conftest.py:66:89: E501 line too long (102 > 88 characters)
2026-01-25T08:57:20.9492336Z tests/conftest.py:70:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9493153Z tests/conftest.py:74:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9493763Z tests/conftest.py:78:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9494370Z tests/conftest.py:81:89: E501 line too long (107 > 88 characters)
2026-01-25T08:57:20.9494990Z tests/conftest.py:93:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9495582Z tests/conftest.py:95:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9496212Z tests/conftest.py:106:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9496840Z tests/conftest.py:108:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9497442Z tests/conftest.py:144:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9498024Z tests/conftest.py:146:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9498583Z tests/conftest.py:167:1: E303 too many blank lines (6)
2026-01-25T08:57:20.9499101Z tests/conftest.py:175:1: E303 too many blank lines (4)
2026-01-25T08:57:20.9499631Z tests/conftest.py:185:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9500240Z tests/conftest.py:200:89: E501 line too long (115 > 88 characters)
2026-01-25T08:57:20.9500849Z tests/conftest.py:204:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9501424Z tests/conftest.py:207:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9502001Z tests/conftest.py:215:89: E501 line too long (101 > 88 characters)
2026-01-25T08:57:20.9503223Z tests/conftest.py:218:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9504136Z tests/conftest.py:229:89: E501 line too long (114 > 88 characters)
2026-01-25T08:57:20.9504785Z tests/conftest.py:231:89: E501 line too long (91 > 88 characters)
2026-01-25T08:57:20.9505376Z tests/conftest.py:232:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9505981Z tests/conftest.py:239:89: E501 line too long (125 > 88 characters)
2026-01-25T08:57:20.9506599Z tests/conftest.py:242:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9507227Z tests/conftest.py:283:89: E501 line too long (97 > 88 characters)
2026-01-25T08:57:20.9507878Z tests/conftest.py:299:89: E501 line too long (91 > 88 characters)
2026-01-25T08:57:20.9508471Z tests/test_auth.py:86:40: W291 trailing whitespace
2026-01-25T08:57:20.9509008Z tests/test_auth.py:95:89: E501 line too long (101 > 88 characters)
2026-01-25T08:57:20.9509523Z tests/test_auth.py:111:32: W291 trailing whitespace
2026-01-25T08:57:20.9509979Z tests/test_auth.py:127:41: W291 trailing whitespace
2026-01-25T08:57:20.9510438Z tests/test_auth.py:143:41: W291 trailing whitespace
2026-01-25T08:57:20.9537020Z tests/test_auth.py:184:45: W291 trailing whitespace
2026-01-25T08:57:20.9537604Z tests/test_auth.py:191:51: W291 trailing whitespace
2026-01-25T08:57:20.9538015Z tests/test_auth.py:192:45: W291 trailing whitespace
2026-01-25T08:57:20.9538449Z tests/test_auth.py:203:46: W291 trailing whitespace
2026-01-25T08:57:20.9538847Z tests/test_auth.py:210:51: W291 trailing whitespace
2026-01-25T08:57:20.9539241Z tests/test_auth.py:211:45: W291 trailing whitespace
2026-01-25T08:57:20.9539613Z tests/test_auth.py:222:46: W291 trailing whitespace
2026-01-25T08:57:20.9539979Z tests/test_auth.py:229:51: W291 trailing whitespace
2026-01-25T08:57:20.9540353Z tests/test_auth.py:230:45: W291 trailing whitespace
2026-01-25T08:57:20.9540711Z tests/test_auth.py:242:44: W291 trailing whitespace
2026-01-25T08:57:20.9541075Z tests/test_auth.py:249:51: W291 trailing whitespace
2026-01-25T08:57:20.9541467Z tests/test_auth.py:250:45: W291 trailing whitespace
2026-01-25T08:57:20.9541919Z tests/test_comment_counts.py:2:1: F401 'pytest' imported but unused
2026-01-25T08:57:20.9542441Z tests/test_comment_counts.py:9:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9543300Z tests/test_comment_counts.py:11:89: E501 line too long (95 > 88 characters)
2026-01-25T08:57:20.9543898Z tests/test_comment_counts.py:14:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9544433Z tests/test_comment_counts.py:17:89: E501 line too long (98 > 88 characters)
2026-01-25T08:57:20.9545059Z tests/test_comment_counts.py:18:89: E501 line too long (125 > 88 characters)
2026-01-25T08:57:20.9545562Z tests/test_comment_counts.py:19:89: E501 line too long (114 > 88 characters)
2026-01-25T08:57:20.9546025Z tests/test_comment_counts.py:20:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9546452Z tests/test_comment_counts.py:25:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9546889Z tests/test_comment_counts.py:29:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9547383Z tests/test_comment_counts.py:36:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9547839Z tests/test_comment_counts.py:38:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9548276Z tests/test_comment_counts.py:41:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9548716Z tests/test_comment_counts.py:43:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9549191Z tests/test_comment_counts.py:47:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9549618Z tests/test_comment_counts.py:53:89: E501 line too long (107 > 88 characters)
2026-01-25T08:57:20.9550057Z tests/test_comment_counts.py:53:96: W605 invalid escape sequence '\d'
2026-01-25T08:57:20.9550475Z tests/test_comment_counts.py:55:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9550883Z tests/test_comment_counts.py:62:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9551294Z tests/test_comment_counts.py:67:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9552360Z tests/test_comment_counts.py:71:89: E501 line too long (111 > 88 characters)
2026-01-25T08:57:20.9552800Z tests/test_comment_counts.py:72:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9553462Z tests/test_comment_counts.py:77:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9553902Z tests/test_comment_counts.py:81:89: E501 line too long (111 > 88 characters)
2026-01-25T08:57:20.9554330Z tests/test_comments.py:2:1: F401 'pytest' imported but unused
2026-01-25T08:57:20.9554736Z tests/test_comments.py:3:1: F401 'flask.session' imported but unused
2026-01-25T08:57:20.9555139Z tests/test_comments.py:17:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9555538Z tests/test_comments.py:26:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9556084Z tests/test_comments.py:33:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9556496Z tests/test_comments.py:46:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9556908Z tests/test_comments.py:55:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9557308Z tests/test_comments.py:62:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9557709Z tests/test_comments.py:65:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9558088Z tests/test_comments.py:74:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9558479Z tests/test_comments.py:83:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9559104Z tests/test_comments.py:85:13: F841 local variable 'comment1' is assigned to but never used
2026-01-25T08:57:20.9559660Z tests/test_comments.py:90:13: F841 local variable 'comment2' is assigned to but never used
2026-01-25T08:57:20.9560185Z tests/test_comments.py:95:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9560589Z tests/test_comments.py:98:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9561024Z tests/test_comments.py:107:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9561430Z tests/test_comments.py:116:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9561849Z tests/test_comments.py:123:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9562275Z tests/test_comments.py:126:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9562707Z tests/test_comments.py:128:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9563337Z tests/test_comments.py:138:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9563734Z tests/test_comments.py:147:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9564143Z tests/test_comments.py:154:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9564527Z tests/test_comments.py:157:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9564913Z tests/test_comments.py:159:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9565298Z tests/test_comments.py:168:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9565707Z tests/test_comments.py:177:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9566100Z tests/test_comments.py:181:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9566490Z tests/test_comments.py:193:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9566875Z tests/test_comments.py:206:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9567268Z tests/test_comments.py:215:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9567656Z tests/test_comments.py:219:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9568038Z tests/test_comments.py:228:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9568425Z tests/test_comments.py:239:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9568810Z tests/test_comments.py:247:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9569224Z tests/test_comments.py:250:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9569612Z tests/test_comments.py:257:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9570007Z tests/test_comments.py:266:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9570681Z tests/test_comments.py:275:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9571420Z tests/test_comments.py:282:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9571829Z tests/test_comments.py:286:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9572262Z tests/test_comments.py:294:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9572666Z tests/test_comments.py:304:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9573270Z tests/test_comments.py:313:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9573682Z tests/test_comments.py:320:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9574089Z tests/test_comments.py:323:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9574473Z tests/test_comments.py:342:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9574857Z tests/test_comments.py:348:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9575298Z tests/test_comments.py:362:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9575725Z tests/test_comments.py:364:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9576122Z tests/test_comments.py:381:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9576500Z tests/test_comments.py:383:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9576962Z tests/test_database.py:4:1: F401 'pytest' imported but unused
2026-01-25T08:57:20.9577423Z tests/test_database.py:5:1: F401 'tempfile' imported but unused
2026-01-25T08:57:20.9577892Z tests/test_database.py:6:1: F401 'os' imported but unused
2026-01-25T08:57:20.9578273Z tests/test_database.py:17:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9578676Z tests/test_database.py:20:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9579192Z tests/test_database.py:29:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9579584Z tests/test_database.py:31:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9579970Z tests/test_database.py:45:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9580369Z tests/test_database.py:47:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9580779Z tests/test_database.py:61:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9581223Z tests/test_database.py:63:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9581631Z tests/test_database.py:67:89: E501 line too long (90 > 88 characters)
2026-01-25T08:57:20.9582049Z tests/test_database.py:81:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9582424Z tests/test_database.py:83:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9583134Z tests/test_database.py:89:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9583632Z tests/test_database.py:98:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9584024Z tests/test_database.py:105:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9584448Z tests/test_database.py:112:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9584847Z tests/test_database.py:115:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9585249Z tests/test_database.py:127:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9585630Z tests/test_database.py:129:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9586102Z tests/test_database.py:135:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9586511Z tests/test_database.py:145:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9586902Z tests/test_database.py:152:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9587281Z tests/test_database.py:159:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9587686Z tests/test_database.py:166:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9588160Z tests/test_database.py:172:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9588543Z tests/test_database.py:180:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9588933Z tests/test_database.py:182:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9589535Z tests/test_database.py:187:89: E501 line too long (97 > 88 characters)
2026-01-25T08:57:20.9590145Z tests/test_database.py:191:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9590559Z tests/test_database.py:196:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9590945Z tests/test_database.py:203:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9591329Z tests/test_database.py:208:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9591816Z tests/test_database.py:212:89: E501 line too long (93 > 88 characters)
2026-01-25T08:57:20.9592221Z tests/test_database.py:216:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9592644Z tests/test_database.py:224:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9593364Z tests/test_database.py:231:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9593760Z tests/test_database.py:237:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9594153Z tests/test_database.py:244:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9594546Z tests/test_database.py:250:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9594933Z tests/test_database.py:257:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9595321Z tests/test_database.py:274:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9595711Z tests/test_database.py:276:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9596109Z tests/test_database.py:280:89: E501 line too long (97 > 88 characters)
2026-01-25T08:57:20.9596506Z tests/test_database.py:284:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9596913Z tests/test_database.py:289:89: E501 line too long (101 > 88 characters)
2026-01-25T08:57:20.9597331Z tests/test_database.py:296:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9597727Z tests/test_database.py:308:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9598158Z tests/test_database.py:310:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9598547Z tests/test_database.py:331:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9598959Z tests/test_database.py:333:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9599354Z tests/test_database.py:339:89: E501 line too long (101 > 88 characters)
2026-01-25T08:57:20.9599773Z tests/test_database.py:342:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9600167Z tests/test_database.py:346:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9600548Z tests/test_database.py:350:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9600954Z tests/test_database.py:363:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9601422Z tests/test_database.py:365:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9601844Z tests/test_database.py:369:89: E501 line too long (97 > 88 characters)
2026-01-25T08:57:20.9602245Z tests/test_database.py:373:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9602651Z tests/test_database.py:380:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9603236Z tests/test_database.py:397:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9603667Z tests/test_database.py:399:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9604133Z tests/test_database.py:404:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9604526Z tests/test_database.py:414:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9604911Z tests/test_database.py:416:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9605289Z tests/test_database.py:419:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9605701Z tests/test_database.py:426:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9606229Z tests/test_database.py:429:89: E501 line too long (101 > 88 characters)
2026-01-25T08:57:20.9606633Z tests/test_database.py:432:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9607104Z tests/test_database.py:435:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9607532Z tests/test_database.py:438:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9608194Z tests/test_discriminator.py:3:1: F401 'pytest' imported but unused
2026-01-25T08:57:20.9608766Z tests/test_discriminator.py:13:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9609255Z tests/test_discriminator.py:15:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9609685Z tests/test_discriminator.py:27:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9610103Z tests/test_discriminator.py:30:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9610539Z tests/test_discriminator.py:33:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9610964Z tests/test_discriminator.py:39:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9611453Z tests/test_discriminator.py:43:89: E501 line too long (101 > 88 characters)
2026-01-25T08:57:20.9611903Z tests/test_discriminator.py:47:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9612321Z tests/test_discriminator.py:58:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9612874Z tests/test_discriminator.py:68:13: F401 'app.auth.utils.MAX_DISCRIMINATOR' imported but unused
2026-01-25T08:57:20.9613581Z tests/test_discriminator.py:69:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9614047Z tests/test_discriminator.py:72:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9614496Z tests/test_discriminator.py:78:89: E501 line too long (101 > 88 characters)
2026-01-25T08:57:20.9614951Z tests/test_discriminator.py:82:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9615445Z tests/test_discriminator.py:83:89: E501 line too long (91 > 88 characters)
2026-01-25T08:57:20.9615881Z tests/test_discriminator.py:87:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9616316Z tests/test_discriminator.py:99:89: E501 line too long (96 > 88 characters)
2026-01-25T08:57:20.9616864Z tests/test_discriminator.py:101:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9617293Z tests/test_discriminator.py:113:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9617730Z tests/test_discriminator.py:116:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9618181Z tests/test_discriminator.py:121:89: E501 line too long (97 > 88 characters)
2026-01-25T08:57:20.9618619Z tests/test_discriminator.py:125:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9619049Z tests/test_discriminator.py:131:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9619478Z tests/test_discriminator.py:134:89: E501 line too long (97 > 88 characters)
2026-01-25T08:57:20.9619910Z tests/test_discriminator.py:138:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9620343Z tests/test_discriminator.py:144:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9620756Z tests/test_forms.py:7:89: E501 line too long (151 > 88 characters)
2026-01-25T08:57:20.9621238Z tests/test_forms.py:9:1: F401 'app.forms.csrf.validate_csrf_token' imported but unused
2026-01-25T08:57:20.9621696Z tests/test_forms.py:25:89: E501 line too long (114 > 88 characters)
2026-01-25T08:57:20.9622098Z tests/test_forms.py:30:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9622492Z tests/test_forms.py:56:89: E501 line too long (106 > 88 characters)
2026-01-25T08:57:20.9623071Z tests/test_forms.py:75:1: E303 too many blank lines (4)
2026-01-25T08:57:20.9623446Z tests/test_forms.py:79:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9623812Z tests/test_forms.py:84:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9624180Z tests/test_forms.py:93:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9624531Z tests/test_forms.py:99:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9624903Z tests/test_forms.py:108:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9625277Z tests/test_forms.py:124:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9625641Z tests/test_forms.py:133:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9626064Z tests/test_forms.py:143:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9626461Z tests/test_forms.py:151:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9627182Z tests/test_forms.py:163:5: E741 ambiguous variable name 'l'
2026-01-25T08:57:20.9627547Z tests/test_forms.py:189:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9627909Z tests/test_forms.py:191:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9628271Z tests/test_forms.py:196:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9628649Z tests/test_forms.py:197:89: E501 line too long (123 > 88 characters)
2026-01-25T08:57:20.9629053Z tests/test_integration.py:4:1: F401 'pytest' imported but unused
2026-01-25T08:57:20.9629486Z tests/test_integration.py:5:1: F401 'flask.session' imported but unused
2026-01-25T08:57:20.9629964Z tests/test_integration.py:11:89: E501 line too long (105 > 88 characters)
2026-01-25T08:57:20.9630386Z tests/test_integration.py:20:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9630806Z tests/test_integration.py:25:89: E501 line too long (91 > 88 characters)
2026-01-25T08:57:20.9631232Z tests/test_integration.py:28:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9631638Z tests/test_integration.py:33:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9632060Z tests/test_integration.py:35:89: E501 line too long (91 > 88 characters)
2026-01-25T08:57:20.9632503Z tests/test_integration.py:37:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9633070Z tests/test_integration.py:42:89: E501 line too long (89 > 88 characters)
2026-01-25T08:57:20.9633490Z tests/test_integration.py:47:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9633922Z tests/test_integration.py:57:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9634377Z tests/test_integration.py:76:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9634803Z tests/test_integration.py:85:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9635214Z tests/test_integration.py:97:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9635659Z tests/test_integration.py:102:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9636085Z tests/test_integration.py:105:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9636536Z tests/test_integration.py:112:1: E303 too many blank lines (3)
2026-01-25T08:57:20.9636933Z tests/test_integration.py:121:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9637343Z tests/test_integration.py:128:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9637745Z tests/test_integration.py:142:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9638157Z tests/test_integration.py:157:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9638586Z tests/test_integration.py:161:89: E501 line too long (125 > 88 characters)
2026-01-25T08:57:20.9639013Z tests/test_integration.py:170:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9639416Z tests/test_integration.py:175:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9639824Z tests/test_integration.py:186:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9640237Z tests/test_integration.py:188:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9640658Z tests/test_integration.py:193:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9641094Z tests/test_integration.py:197:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9641522Z tests/test_integration.py:208:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9641956Z tests/test_integration.py:212:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9642367Z tests/test_integration.py:222:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9642778Z tests/test_integration.py:225:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9643500Z tests/test_integration.py:232:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9644002Z tests/test_integration.py:244:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9644410Z tests/test_integration.py:252:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9644818Z tests/test_integration.py:257:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9645528Z tests/test_integration.py:265:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9645940Z tests/test_integration.py:267:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9646350Z tests/test_integration.py:270:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9646769Z tests/test_main.py:4:1: F401 'pytest' imported but unused
2026-01-25T08:57:20.9647142Z tests/test_main.py:5:1: F401 'flask.session' imported but unused
2026-01-25T08:57:20.9647534Z tests/test_main.py:22:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9647897Z tests/test_main.py:28:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9648256Z tests/test_main.py:56:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9648609Z tests/test_main.py:67:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9648959Z tests/test_main.py:131:1: E303 too many blank lines (4)
2026-01-25T08:57:20.9649330Z tests/test_main.py:138:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9649699Z tests/test_main.py:141:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9650083Z tests/test_main.py:150:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9650486Z tests/test_main.py:153:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9650839Z tests/test_main.py:163:1: E303 too many blank lines (3)
2026-01-25T08:57:20.9651188Z tests/test_main.py:169:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9651548Z tests/test_main.py:177:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9651909Z tests/test_main.py:185:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9652288Z tests/test_main.py:192:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9652792Z tests/test_main.py:197:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9653303Z tests/test_posts.py:2:1: F401 'pytest' imported but unused
2026-01-25T08:57:20.9653702Z tests/test_posts.py:3:1: F401 'flask.session' imported but unused
2026-01-25T08:57:20.9654110Z tests/test_posts.py:5:1: F401 'app.models.Post' imported but unused
2026-01-25T08:57:20.9654519Z tests/test_posts.py:17:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9654884Z tests/test_posts.py:25:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9655245Z tests/test_posts.py:36:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9655623Z tests/test_posts.py:44:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9655990Z tests/test_posts.py:47:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9656350Z tests/test_posts.py:65:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9656782Z tests/test_posts.py:68:13: F841 local variable 'post1' is assigned to but never used
2026-01-25T08:57:20.9657269Z tests/test_posts.py:68:89: E501 line too long (91 > 88 characters)
2026-01-25T08:57:20.9657706Z tests/test_posts.py:69:13: F841 local variable 'post2' is assigned to but never used
2026-01-25T08:57:20.9658139Z tests/test_posts.py:69:89: E501 line too long (91 > 88 characters)
2026-01-25T08:57:20.9658524Z tests/test_posts.py:70:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9658890Z tests/test_posts.py:73:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9659248Z tests/test_posts.py:82:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9659621Z tests/test_posts.py:85:89: E501 line too long (105 > 88 characters)
2026-01-25T08:57:20.9660093Z tests/test_posts.py:86:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9660479Z tests/test_posts.py:89:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9660865Z tests/test_posts.py:99:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9661253Z tests/test_posts.py:102:89: E501 line too long (99 > 88 characters)
2026-01-25T08:57:20.9661635Z tests/test_posts.py:104:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9662007Z tests/test_posts.py:107:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9662373Z tests/test_posts.py:116:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9663121Z tests/test_posts.py:120:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9663542Z tests/test_posts.py:129:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9663912Z tests/test_posts.py:133:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9664321Z tests/test_posts.py:149:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9664709Z tests/test_posts.py:157:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9665116Z tests/test_posts.py:160:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9665479Z tests/test_posts.py:175:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9665882Z tests/test_posts.py:184:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9666332Z tests/test_posts.py:185:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9666769Z tests/test_posts.py:186:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9667158Z tests/test_posts.py:193:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9667706Z tests/test_posts.py:202:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9668140Z tests/test_posts.py:203:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9668566Z tests/test_posts.py:204:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9668932Z tests/test_posts.py:211:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9669317Z tests/test_posts.py:213:89: E501 line too long (92 > 88 characters)
2026-01-25T08:57:20.9670201Z tests/test_posts.py:215:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9670916Z tests/test_posts.py:232:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9671644Z tests/test_posts.py:233:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9672217Z tests/test_posts.py:234:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9672583Z tests/test_posts.py:243:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9673068Z tests/test_posts.py:253:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9673517Z tests/test_posts.py:254:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9673982Z tests/test_posts.py:255:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9674344Z tests/test_posts.py:264:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9674708Z tests/test_posts.py:268:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9675078Z tests/test_posts.py:277:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9675498Z tests/test_posts.py:278:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9675921Z tests/test_posts.py:279:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9676286Z tests/test_posts.py:286:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9676650Z tests/test_posts.py:297:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9677062Z tests/test_posts.py:298:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9677503Z tests/test_posts.py:299:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9677871Z tests/test_posts.py:306:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9678239Z tests/test_posts.py:314:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9678600Z tests/test_posts.py:325:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9679041Z tests/test_posts.py:326:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9679472Z tests/test_posts.py:327:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9679834Z tests/test_posts.py:336:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9680204Z tests/test_posts.py:346:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9680640Z tests/test_posts.py:347:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9681072Z tests/test_posts.py:348:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9681605Z tests/test_posts.py:357:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9682147Z tests/test_posts.py:361:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9682521Z tests/test_posts.py:370:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9683109Z tests/test_posts.py:371:9: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9683544Z tests/test_posts.py:372:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9683913Z tests/test_posts.py:379:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9684279Z tests/test_posts.py:385:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9684647Z tests/test_posts.py:392:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9685019Z tests/test_posts.py:400:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9685383Z tests/test_posts.py:407:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9685768Z tests/test_posts.py:409:89: E501 line too long (102 > 88 characters)
2026-01-25T08:57:20.9686287Z tests/test_security.py:9:1: F401 'app.forms.csrf.validate_csrf_token' imported but unused
2026-01-25T08:57:20.9686828Z tests/test_security.py:18:13: F841 local variable 'token' is assigned to but never used
2026-01-25T08:57:20.9687295Z tests/test_security.py:112:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9687690Z tests/test_security.py:115:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9688084Z tests/test_security.py:118:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9688479Z tests/test_security.py:125:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9688892Z tests/test_security.py:128:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9689282Z tests/test_security.py:134:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9689703Z tests/test_security.py:137:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9690096Z tests/test_security.py:145:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9690490Z tests/test_security.py:148:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9690884Z tests/test_security.py:151:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9691263Z tests/test_security.py:157:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9691650Z tests/test_security.py:164:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9692033Z tests/test_security.py:196:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9692430Z tests/test_security.py:202:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9692814Z tests/test_security.py:216:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9693530Z tests/test_security.py:226:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9693922Z tests/test_security.py:229:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9694316Z tests/test_security.py:242:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9694707Z tests/test_security.py:247:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9695105Z tests/test_security.py:250:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9695501Z tests/test_security.py:258:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9695902Z tests/test_security.py:263:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9696292Z tests/test_security.py:277:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9696679Z tests/test_security.py:279:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9697059Z tests/test_security.py:286:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9697441Z tests/test_security.py:295:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9697827Z tests/test_security.py:297:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9698215Z tests/test_security.py:301:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9698706Z tests/test_validation_stubs.py:9:1: F401 'app.forms.csrf.validate_csrf_token' imported but unused
2026-01-25T08:57:20.9699404Z tests/test_validation_stubs.py:25:89: E501 line too long (91 > 88 characters)
2026-01-25T08:57:20.9699983Z tests/test_validation_stubs.py:40:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9700419Z tests/test_validation_stubs.py:42:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9700857Z tests/test_validation_stubs.py:49:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9701309Z tests/test_validation_stubs.py:50:89: E501 line too long (96 > 88 characters)
2026-01-25T08:57:20.9701762Z tests/test_validation_stubs.py:57:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9702191Z tests/test_validation_stubs.py:64:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9702625Z tests/test_validation_stubs.py:78:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9703331Z tests/test_validation_stubs.py:86:1: E303 too many blank lines (4)
2026-01-25T08:57:20.9703767Z tests/test_validation_stubs.py:90:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9704198Z tests/test_validation_stubs.py:97:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9704639Z tests/test_validation_stubs.py:99:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9705090Z tests/test_validation_stubs.py:103:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9705530Z tests/test_validation_stubs.py:116:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9705971Z tests/test_validation_stubs.py:127:1: W293 blank line contains whitespace
2026-01-25T08:57:20.9706340Z 7     E303 too many blank lines (6)
2026-01-25T08:57:20.9706632Z 1     E402 module level import not at top of file
2026-01-25T08:57:20.9706924Z 88    E501 line too long (96 > 88 characters)
2026-01-25T08:57:20.9707197Z 1     E741 ambiguous variable name 'l'
2026-01-25T08:57:20.9707513Z 27    F401 'app.auth.utils.hash_password' imported but unused
2026-01-25T08:57:20.9707886Z 16    F841 local variable 'cursor' is assigned to but never used
2026-01-25T08:57:20.9708207Z 24    W291 trailing whitespace
2026-01-25T08:57:20.9708442Z 1     W292 no newline at end of file
2026-01-25T08:57:20.9708704Z 571   W293 blank line contains whitespace
2026-01-25T08:57:20.9708979Z 1     W605 invalid escape sequence '\d'
2026-01-25T08:57:20.9709224Z 737
2026-01-25T08:57:20.9737077Z ##[group]Run black --check --diff app/ tests/
2026-01-25T08:57:20.9737453Z [36;1mblack --check --diff app/ tests/[0m
2026-01-25T08:57:20.9770526Z shell: /usr/bin/bash -e {0}
2026-01-25T08:57:20.9770765Z env:
2026-01-25T08:57:20.9770944Z   PYTHON_VERSION: 3.13
2026-01-25T08:57:20.9771250Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:20.9771688Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.11/x64/lib/pkgconfig
2026-01-25T08:57:20.9772106Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:20.9772481Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:20.9772856Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:20.9773343Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.11/x64/lib
2026-01-25T08:57:20.9773643Z ##[endgroup]
2026-01-25T08:57:21.5593657Z --- /home/runner/work/flask_blog/flask_blog/app/auth/__init__.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.5596207Z +++ /home/runner/work/flask_blog/flask_blog/app/auth/__init__.py	2026-01-25 08:57:21.556781+00:00
2026-01-25T08:57:21.5596987Z @@ -1,9 +1,9 @@
2026-01-25T08:57:21.5597617Z  """Blueprint авторизации."""
2026-01-25T08:57:21.5598007Z  
2026-01-25T08:57:21.5598377Z  from flask import Blueprint
2026-01-25T08:57:21.5598785Z  
2026-01-25T08:57:21.5599178Z -bp = Blueprint('auth', __name__, url_prefix='/auth')
2026-01-25T08:57:21.5599774Z +bp = Blueprint("auth", __name__, url_prefix="/auth")
2026-01-25T08:57:21.5600260Z  
2026-01-25T08:57:21.5600842Z  from app.auth.utils import hash_password, verify_password, generate_discriminator
2026-01-25T08:57:21.5601533Z  
2026-01-25T08:57:21.5601885Z  from app.auth import routes  # noqa: E402, F401
2026-01-25T08:57:21.5623985Z would reformat /home/runner/work/flask_blog/flask_blog/app/auth/__init__.py
2026-01-25T08:57:21.5683190Z --- /home/runner/work/flask_blog/flask_blog/app/db/__init__.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.5684325Z +++ /home/runner/work/flask_blog/flask_blog/app/db/__init__.py	2026-01-25 08:57:21.567721+00:00
2026-01-25T08:57:21.5685083Z @@ -1,5 +1,5 @@
2026-01-25T08:57:21.5685640Z  """Модуль работы с базой данных."""
2026-01-25T08:57:21.5686510Z  
2026-01-25T08:57:21.5686926Z  from app.db.db import close_db, get_db, init_app, init_db
2026-01-25T08:57:21.5687466Z  
2026-01-25T08:57:21.5687859Z -__all__ = ['get_db', 'close_db', 'init_db', 'init_app']
2026-01-25T08:57:21.5688442Z +__all__ = ["get_db", "close_db", "init_db", "init_app"]
2026-01-25T08:57:21.5723686Z would reformat /home/runner/work/flask_blog/flask_blog/app/db/__init__.py
2026-01-25T08:57:21.5964650Z --- /home/runner/work/flask_blog/flask_blog/app/__init__.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.5965737Z +++ /home/runner/work/flask_blog/flask_blog/app/__init__.py	2026-01-25 08:57:21.593642+00:00
2026-01-25T08:57:21.5966554Z @@ -18,57 +18,62 @@
2026-01-25T08:57:21.5966903Z      Returns:
2026-01-25T08:57:21.5967626Z          Flask: готовое к запуску приложение.
2026-01-25T08:57:21.5968046Z      """
2026-01-25T08:57:21.5968421Z      # Загружаем переменные из .env файла
2026-01-25T08:57:21.5968833Z      load_dotenv()
2026-01-25T08:57:21.5969127Z -    
2026-01-25T08:57:21.5969397Z +
2026-01-25T08:57:21.5970021Z      # instance_relative_config=True означает, что конфиг и файлы instance
2026-01-25T08:57:21.5970926Z      # лежат вне пакета app/ (удобно для секретов и локальных настроек).
2026-01-25T08:57:21.5971536Z      app = Flask(__name__, instance_relative_config=True)
2026-01-25T08:57:21.5972001Z  
2026-01-25T08:57:21.5972381Z      # Базовые настройки приложения.
2026-01-25T08:57:21.5974658Z      # SECRET_KEY нужен для сессий/подписей (в проде брать только из env или instance/config.py).
2026-01-25T08:57:21.5975403Z      app.config.from_mapping(
2026-01-25T08:57:21.5975983Z -        SECRET_KEY=os.environ.get('SECRET_KEY', 'dev_key_123'),
2026-01-25T08:57:21.5976769Z +        SECRET_KEY=os.environ.get("SECRET_KEY", "dev_key_123"),
2026-01-25T08:57:21.5977871Z      )
2026-01-25T08:57:21.5978227Z  
2026-01-25T08:57:21.5978673Z      # Загружаем конфигурацию:
2026-01-25T08:57:21.5979463Z      # - обычный режим: из config.py и instance/config.py (если файл существует)
2026-01-25T08:57:21.5980214Z      # - тестовый режим: из test_config
2026-01-25T08:57:21.5980694Z      if test_config is None:
2026-01-25T08:57:21.5981173Z -        app.config.from_object('config.Config')
2026-01-25T08:57:21.5981789Z -        app.config.from_pyfile('config.py', silent=True)
2026-01-25T08:57:21.5982389Z +        app.config.from_object("config.Config")
2026-01-25T08:57:21.5983314Z +        app.config.from_pyfile("config.py", silent=True)
2026-01-25T08:57:21.5983859Z      else:
2026-01-25T08:57:21.5984230Z          app.config.from_mapping(test_config)
2026-01-25T08:57:21.5984774Z  
2026-01-25T08:57:21.5985424Z      # Гарантируем существование папки instance/ (там будет БД и локальный конфиг).
2026-01-25T08:57:21.5986130Z      os.makedirs(app.instance_path, exist_ok=True)
2026-01-25T08:57:21.5986631Z  
2026-01-25T08:57:21.5987052Z      # Добавляем кастомные фильтры для шаблонов
2026-01-25T08:57:21.5987515Z -    @app.template_filter('nl2br')
2026-01-25T08:57:21.5987927Z +    @app.template_filter("nl2br")
2026-01-25T08:57:21.5988327Z      def nl2br_filter(text):
2026-01-25T08:57:21.5988930Z would reformat /home/runner/work/flask_blog/flask_blog/app/__init__.py
2026-01-25T08:57:21.5989675Z          """Преобразует переносы строк в HTML теги <br>."""
2026-01-25T08:57:21.5990147Z          if text is None:
2026-01-25T08:57:21.5990504Z -            return ''
2026-01-25T08:57:21.5990835Z +            return ""
2026-01-25T08:57:21.5991193Z          import markupsafe
2026-01-25T08:57:21.5991688Z -        return markupsafe.Markup(text.replace('\n', '<br>\n'))
2026-01-25T08:57:21.5992245Z +
2026-01-25T08:57:21.5992701Z +        return markupsafe.Markup(text.replace("\n", "<br>\n"))
2026-01-25T08:57:21.5993787Z  
2026-01-25T08:57:21.5994229Z      # Добавляем CSRF токен в контекст всех шаблонов
2026-01-25T08:57:21.5994791Z      @app.context_processor
2026-01-25T08:57:21.5995194Z      def inject_csrf_token():
2026-01-25T08:57:21.5995760Z          """Добавляет CSRF токен в контекст всех шаблонов."""
2026-01-25T08:57:21.5996330Z          from app.forms.csrf import generate_csrf_token
2026-01-25T08:57:21.5996908Z -        return {'csrf_token': generate_csrf_token}
2026-01-25T08:57:21.5997386Z +
2026-01-25T08:57:21.5997762Z +        return {"csrf_token": generate_csrf_token}
2026-01-25T08:57:21.5998215Z  
2026-01-25T08:57:21.5998794Z      # Импорты внутри функции предотвращают циклические ссылки при импорте пакетов.
2026-01-25T08:57:21.5999348Z      from app import db
2026-01-25T08:57:21.5999696Z +
2026-01-25T08:57:21.5999976Z      db.init_app(app)
2026-01-25T08:57:21.6000315Z  
2026-01-25T08:57:21.6000694Z      # Blueprint авторизации: /auth/...
2026-01-25T08:57:21.6001188Z      from app.auth.routes import bp as auth_bp
2026-01-25T08:57:21.6001636Z +
2026-01-25T08:57:21.6001928Z      app.register_blueprint(auth_bp)
2026-01-25T08:57:21.6002359Z  
2026-01-25T08:57:21.6002738Z      # Главные страницы: /
2026-01-25T08:57:21.6003351Z      from app.main.routes import bp as main_bp
2026-01-25T08:57:21.6003860Z +
2026-01-25T08:57:21.6004198Z      app.register_blueprint(main_bp)
2026-01-25T08:57:21.6004607Z  
2026-01-25T08:57:21.6004892Z      return app
2026-01-25T08:57:21.6189400Z --- /home/runner/work/flask_blog/flask_blog/app/db/db.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.6190479Z +++ /home/runner/work/flask_blog/flask_blog/app/db/db.py	2026-01-25 08:57:21.617285+00:00
2026-01-25T08:57:21.6191221Z @@ -12,14 +12,14 @@
2026-01-25T08:57:21.6191589Z  import click
2026-01-25T08:57:21.6191957Z  from flask import g, current_app
2026-01-25T08:57:21.6192387Z  
2026-01-25T08:57:21.6193394Z  # Подавляем предупреждение об устаревшем конвертере временных меток Python 3.12+
2026-01-25T08:57:21.6194095Z  warnings.filterwarnings(
2026-01-25T08:57:21.6194499Z -    'ignore',
2026-01-25T08:57:21.6194833Z +    "ignore",
2026-01-25T08:57:21.6195655Z      category=DeprecationWarning,
2026-01-25T08:57:21.6196187Z -    module='sqlite3',
2026-01-25T08:57:21.6196661Z -    message='.*default timestamp converter.*'
2026-01-25T08:57:21.6197187Z +    module="sqlite3",
2026-01-25T08:57:21.6197640Z +    message=".*default timestamp converter.*",
2026-01-25T08:57:21.6198116Z  )
2026-01-25T08:57:21.6198409Z  
2026-01-25T08:57:21.6199015Z  
2026-01-25T08:57:21.6200101Z would reformat /home/runner/work/flask_blog/flask_blog/app/db/db.py
2026-01-25T08:57:21.6200741Z  def get_db():
2026-01-25T08:57:21.6206138Z      """Возвращает соединение с БД для текущего контекста запроса.
2026-01-25T08:57:21.6206949Z @@ -28,15 +28,14 @@
2026-01-25T08:57:21.6207399Z  
2026-01-25T08:57:21.6207843Z      Почему так:
2026-01-25T08:57:21.6208485Z      - g живёт ровно в рамках одного запроса,
2026-01-25T08:57:21.6209395Z      - мы избегаем глобального соединения и проблем с потоками/контекстами.
2026-01-25T08:57:21.6210151Z      """
2026-01-25T08:57:21.6210640Z -    if 'db' not in g:
2026-01-25T08:57:21.6211182Z +    if "db" not in g:
2026-01-25T08:57:21.6211986Z          # Создаём соединение с БД из конфигурации приложения
2026-01-25T08:57:21.6212649Z          g.db = sqlite3.connect(
2026-01-25T08:57:21.6213467Z -            current_app.config['DATABASE'],
2026-01-25T08:57:21.6214151Z -            detect_types=sqlite3.PARSE_DECLTYPES
2026-01-25T08:57:21.6214999Z +            current_app.config["DATABASE"], detect_types=sqlite3.PARSE_DECLTYPES
2026-01-25T08:57:21.6215807Z          )
2026-01-25T08:57:21.6216515Z          # Позволяет обращаться к колонкам по именам, как к словарю
2026-01-25T08:57:21.6217309Z          g.db.row_factory = sqlite3.Row
2026-01-25T08:57:21.6217901Z  
2026-01-25T08:57:21.6218305Z      return g.db
2026-01-25T08:57:21.6218762Z @@ -45,28 +44,28 @@
2026-01-25T08:57:21.6219274Z  def close_db(_=None):
2026-01-25T08:57:21.6220366Z      """Закрывает соединение с БД, если оно было открыто.
2026-01-25T08:57:21.6221043Z  
2026-01-25T08:57:21.6221857Z      Вызывается автоматически при завершении обработки запроса (teardown_appcontext).
2026-01-25T08:57:21.6222653Z      """
2026-01-25T08:57:21.6223333Z -    db = g.pop('db', None)
2026-01-25T08:57:21.6223907Z +    db = g.pop("db", None)
2026-01-25T08:57:21.6224432Z      if db is not None:
2026-01-25T08:57:21.6224933Z          db.close()
2026-01-25T08:57:21.6225460Z  
2026-01-25T08:57:21.6225864Z  
2026-01-25T08:57:21.6226261Z  def init_db():
2026-01-25T08:57:21.6227262Z      """Инициализирует БД: создаёт таблицы из SQL-скрипта schema.sql."""
2026-01-25T08:57:21.6227992Z      db = get_db()
2026-01-25T08:57:21.6228818Z      # current_app.open_resource ищет файл относительно пакета приложения
2026-01-25T08:57:21.6231143Z -    with current_app.open_resource('db/schema.sql') as f:
2026-01-25T08:57:21.6231811Z -        db.executescript(f.read().decode('utf8'))
2026-01-25T08:57:21.6232515Z +    with current_app.open_resource("db/schema.sql") as f:
2026-01-25T08:57:21.6233387Z +        db.executescript(f.read().decode("utf8"))
2026-01-25T08:57:21.6234203Z  
2026-01-25T08:57:21.6234544Z  
2026-01-25T08:57:21.6234890Z -@click.command('init-db')
2026-01-25T08:57:21.6235353Z +@click.command("init-db")
2026-01-25T08:57:21.6235812Z  def init_db_command():
2026-01-25T08:57:21.6236658Z      """CLI-команда: очистить/создать таблицы (запускается как `flask init-db`)."""
2026-01-25T08:57:21.6237294Z      init_db()
2026-01-25T08:57:21.6237837Z -    click.echo('База данных инициализирована.')
2026-01-25T08:57:21.6238506Z +    click.echo("База данных инициализирована.")
2026-01-25T08:57:21.6238959Z  
2026-01-25T08:57:21.6239238Z  
2026-01-25T08:57:21.6239536Z  def init_app(app):
2026-01-25T08:57:21.6240045Z      """Подключает БД к Flask-приложению.
2026-01-25T08:57:21.6240496Z  
2026-01-25T08:57:21.6296433Z --- /home/runner/work/flask_blog/flask_blog/app/forms/__init__.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.6303690Z +++ /home/runner/work/flask_blog/flask_blog/app/forms/__init__.py	2026-01-25 08:57:21.628831+00:00
2026-01-25T08:57:21.6304448Z @@ -1,35 +1,42 @@
2026-01-25T08:57:21.6304786Z  from .base import Form
2026-01-25T08:57:21.6305283Z  from .fields import StringField, PasswordField, TextAreaField
2026-01-25T08:57:21.6307358Z  from .validators import (
2026-01-25T08:57:21.6307667Z -    DataRequired, Length, EqualTo,
2026-01-25T08:57:21.6307943Z +    DataRequired,
2026-01-25T08:57:21.6308146Z +    Length,
2026-01-25T08:57:21.6308332Z +    EqualTo,
2026-01-25T08:57:21.6308819Z      # TODO: Валидаторы-заглушки (требуют реализации)
2026-01-25T08:57:21.6309163Z -    Email, Username, PasswordStrength, UniqueUsername, 
2026-01-25T08:57:21.6309477Z -    Slug, NumberRange, URL
2026-01-25T08:57:21.6309690Z +    Email,
2026-01-25T08:57:21.6309854Z +    Username,
2026-01-25T08:57:21.6310037Z +    PasswordStrength,
2026-01-25T08:57:21.6310263Z +    UniqueUsername,
2026-01-25T08:57:21.6310475Z +    Slug,
2026-01-25T08:57:21.6310937Z +    NumberRange,
2026-01-25T08:57:21.6311110Z +    URL,
2026-01-25T08:57:21.6311419Z      # TODO: Regexp - будет реализован в будущем
2026-01-25T08:57:21.6311679Z  )
2026-01-25T08:57:21.6311851Z  from .post import PostForm
2026-01-25T08:57:21.6312108Z  from .auth import RegistrationForm, LoginForm
2026-01-25T08:57:21.6312387Z  from .comment import CommentForm
2026-01-25T08:57:21.6312604Z  
2026-01-25T08:57:21.6312758Z  __all__ = [
2026-01-25T08:57:21.6313161Z -    'Form',
2026-01-25T08:57:21.6313380Z -    'StringField',
2026-01-25T08:57:21.6313576Z -    'PasswordField',
2026-01-25T08:57:21.6313990Z -    'TextAreaField',
2026-01-25T08:57:21.6314329Z -    'DataRequired',
2026-01-25T08:57:21.6314650Z -    'Length',
2026-01-25T08:57:21.6314952Z -    'EqualTo',
2026-01-25T08:57:21.6315249Z -    'PostForm',
2026-01-25T08:57:21.6315568Z -    'RegistrationForm',
2026-01-25T08:57:21.6315951Z -    'LoginForm',
2026-01-25T08:57:21.6316280Z -    'CommentForm',
2026-01-25T08:57:21.6316652Z +    "Form",
2026-01-25T08:57:21.6316937Z +    "StringField",
2026-01-25T08:57:21.6317284Z +    "PasswordField",
2026-01-25T08:57:21.6317679Z +    "TextAreaField",
2026-01-25T08:57:21.6318014Z +    "DataRequired",
2026-01-25T08:57:21.6318344Z +    "Length",
2026-01-25T08:57:21.6318669Z +    "EqualTo",
2026-01-25T08:57:21.6319129Z +    "PostForm",
2026-01-25T08:57:21.6319613Z +    "RegistrationForm",
2026-01-25T08:57:21.6320258Z +    "LoginForm",
2026-01-25T08:57:21.6320784Z +    "CommentForm",
2026-01-25T08:57:21.6321511Z      # TODO: Валидаторы-заглушки (требуют реализации)
2026-01-25T08:57:21.6322193Z -    'Email',
2026-01-25T08:57:21.6322675Z -    'Username', 
2026-01-25T08:57:21.6323353Z -    'PasswordStrength',
2026-01-25T08:57:21.6323958Z -    'UniqueUsername',
2026-01-25T08:57:21.6324498Z -    'Slug',
2026-01-25T08:57:21.6324900Z -    'NumberRange',
2026-01-25T08:57:21.6325427Z -    'URL'
2026-01-25T08:57:21.6329404Z +    "Email",
2026-01-25T08:57:21.6330035Z +    "Username",
2026-01-25T08:57:21.6330594Z +    "PasswordStrength",
2026-01-25T08:57:21.6347267Z +    "UniqueUsername",
2026-01-25T08:57:21.6347625Z +    "Slug",
2026-01-25T08:57:21.6348233Z +    "NumberRange",
2026-01-25T08:57:21.6348582Z +    "URL",
2026-01-25T08:57:21.6349122Z      # TODO: 'Regexp' - будет добавлен при реализации
2026-01-25T08:57:21.6349596Z  ]
2026-01-25T08:57:21.6350115Z would reformat /home/runner/work/flask_blog/flask_blog/app/forms/__init__.py
2026-01-25T08:57:21.6350915Z would reformat /home/runner/work/flask_blog/flask_blog/app/auth/utils.py
2026-01-25T08:57:21.6351816Z --- /home/runner/work/flask_blog/flask_blog/app/auth/utils.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.6352869Z +++ /home/runner/work/flask_blog/flask_blog/app/auth/utils.py	2026-01-25 08:57:21.628215+00:00
2026-01-25T08:57:21.6354248Z @@ -1,6 +1,7 @@
2026-01-25T08:57:21.6354835Z  """Утилиты для авторизации: хэширование паролей, декораторы."""
2026-01-25T08:57:21.6355339Z +
2026-01-25T08:57:21.6355666Z  import functools
2026-01-25T08:57:21.6356046Z  import secrets
2026-01-25T08:57:21.6356394Z  from typing import Optional
2026-01-25T08:57:21.6356789Z  
2026-01-25T08:57:21.6357167Z  from flask import flash, g, redirect, url_for
2026-01-25T08:57:21.6357655Z @@ -10,86 +11,86 @@
2026-01-25T08:57:21.6358012Z  MAX_DISCRIMINATOR = 9999
2026-01-25T08:57:21.6358361Z  
2026-01-25T08:57:21.6358637Z  
2026-01-25T08:57:21.6359117Z  def hash_password(password: str, salt: bytes = None) -> tuple[str, bytes]:
2026-01-25T08:57:21.6359950Z      """Хэширует пароль с использованием werkzeug.security.
2026-01-25T08:57:21.6360440Z -    
2026-01-25T08:57:21.6360717Z +
2026-01-25T08:57:21.6360984Z      Args:
2026-01-25T08:57:21.6361410Z          password: Пароль для хэширования
2026-01-25T08:57:21.6362140Z          salt: Опциональная соль (16 байт). Если не предоставлена, генерируется случайно.
2026-01-25T08:57:21.6362729Z -    
2026-01-25T08:57:21.6363191Z +
2026-01-25T08:57:21.6363454Z      Returns:
2026-01-25T08:57:21.6363912Z          tuple[str, bytes]: (хэш пароля, соль)
2026-01-25T08:57:21.6364686Z      """
2026-01-25T08:57:21.6364995Z      if salt is None:
2026-01-25T08:57:21.6365468Z          # Генерируем случайную соль
2026-01-25T08:57:21.6365920Z          salt = secrets.token_bytes(16)
2026-01-25T08:57:21.6366404Z -    
2026-01-25T08:57:21.6366681Z +
2026-01-25T08:57:21.6367107Z      # Конвертируем соль в hex для хранения в хэше
2026-01-25T08:57:21.6367641Z      salt_hex = salt.hex()
2026-01-25T08:57:21.6368012Z -    
2026-01-25T08:57:21.6368296Z +
2026-01-25T08:57:21.6368726Z      # Используем PBKDF2 хэширование с нашей солью
2026-01-25T08:57:21.6369190Z      import hashlib
2026-01-25T08:57:21.6369517Z      import hmac
2026-01-25T08:57:21.6369850Z -    
2026-01-25T08:57:21.6370138Z +
2026-01-25T08:57:21.6370496Z      # PBKDF2 хэширование
2026-01-25T08:57:21.6371071Z -    hashed = hashlib.pbkdf2_hmac('sha256', password.encode(), salt, 100000)
2026-01-25T08:57:21.6371923Z +    hashed = hashlib.pbkdf2_hmac("sha256", password.encode(), salt, 100000)
2026-01-25T08:57:21.6372588Z      hashed_hex = hashed.hex()
2026-01-25T08:57:21.6373156Z -    
2026-01-25T08:57:21.6373738Z -    return f'pbkdf2_sha256${salt_hex}${hashed_hex}', salt
2026-01-25T08:57:21.6374215Z +
2026-01-25T08:57:21.6374611Z +    return f"pbkdf2_sha256${salt_hex}${hashed_hex}", salt
2026-01-25T08:57:21.6375114Z  
2026-01-25T08:57:21.6375374Z  
2026-01-25T08:57:21.6375909Z  def verify_password(stored_password: str, provided_password: str, salt: bytes) -> bool:
2026-01-25T08:57:21.6376700Z      """Проверяет пароль.
2026-01-25T08:57:21.6377037Z -    
2026-01-25T08:57:21.6377327Z +
2026-01-25T08:57:21.6377599Z      Args:
2026-01-25T08:57:21.6378041Z          stored_password: Хэш из базы данных
2026-01-25T08:57:21.6378621Z          provided_password: Предоставленный пароль
2026-01-25T08:57:21.6379267Z          salt: Соль, которая использовалась при хэшировании
2026-01-25T08:57:21.6379736Z -    
2026-01-25T08:57:21.6380005Z +
2026-01-25T08:57:21.6380275Z      Returns:
2026-01-25T08:57:21.6380694Z          bool: True если пароль верный
2026-01-25T08:57:21.6381115Z      """
2026-01-25T08:57:21.6381417Z      try:
2026-01-25T08:57:21.6381995Z          import hashlib
2026-01-25T08:57:21.6382383Z          import hmac
2026-01-25T08:57:21.6382725Z -        
2026-01-25T08:57:21.6383279Z +
2026-01-25T08:57:21.6383672Z          # Разбираем сохраненный хэш
2026-01-25T08:57:21.6384177Z -        parts = stored_password.split('$')
2026-01-25T08:57:21.6384733Z -        if len(parts) != 3 or parts[0] != 'pbkdf2_sha256':
2026-01-25T08:57:21.6385310Z +        parts = stored_password.split("$")
2026-01-25T08:57:21.6385858Z +        if len(parts) != 3 or parts[0] != "pbkdf2_sha256":
2026-01-25T08:57:21.6386448Z              return False
2026-01-25T08:57:21.6386821Z -        
2026-01-25T08:57:21.6387138Z +
2026-01-25T08:57:21.6387481Z          stored_salt_hex = parts[1]
2026-01-25T08:57:21.6387918Z          stored_hash_hex = parts[2]
2026-01-25T08:57:21.6388302Z -        
2026-01-25T08:57:21.6388582Z +
2026-01-25T08:57:21.6389088Z          # Проверяем, что соль в хэше совпадает с переданной
2026-01-25T08:57:21.6389614Z          if salt.hex() != stored_salt_hex:
2026-01-25T08:57:21.6390069Z              return False
2026-01-25T08:57:21.6390439Z -        
2026-01-25T08:57:21.6390712Z +
2026-01-25T08:57:21.6391088Z          # Вычисляем хэш с той же солью
2026-01-25T08:57:21.6391783Z -        hashed = hashlib.pbkdf2_hmac('sha256', provided_password.encode(), salt, 100000)
2026-01-25T08:57:21.6392717Z +        hashed = hashlib.pbkdf2_hmac("sha256", provided_password.encode(), salt, 100000)
2026-01-25T08:57:21.6393639Z          computed_hash_hex = hashed.hex()
2026-01-25T08:57:21.6394092Z -        
2026-01-25T08:57:21.6394384Z +
2026-01-25T08:57:21.6394779Z          # Сравниваем хэши
2026-01-25T08:57:21.6395310Z          return hmac.compare_digest(computed_hash_hex, stored_hash_hex)
2026-01-25T08:57:21.6395931Z      except Exception:
2026-01-25T08:57:21.6396324Z          return False
2026-01-25T08:57:21.6396664Z  
2026-01-25T08:57:21.6396923Z  
2026-01-25T08:57:21.6397651Z  def generate_discriminator(db_conn, username: str) -> Optional[int]:
2026-01-25T08:57:21.6398256Z      """
2026-01-25T08:57:21.6398825Z      Генерирует уникальный случайный дискриминатор (тег) для пользователя.
2026-01-25T08:57:21.6399425Z -    
2026-01-25T08:57:21.6399737Z +
2026-01-25T08:57:21.6400248Z      Позволяет существовать нескольким пользователям с одинаковым именем,
2026-01-25T08:57:21.6400960Z      но разными тегами (например, User#0001 и User#0002).
2026-01-25T08:57:21.6401424Z      """
2026-01-25T08:57:21.6401983Z      # Получаем список всех занятых тегов для данного имени пользователя
2026-01-25T08:57:21.6402517Z      rows = db_conn.execute(
2026-01-25T08:57:21.6403269Z -        'SELECT discriminator FROM user WHERE username = ?', (username,)
2026-01-25T08:57:21.6404074Z +        "SELECT discriminator FROM user WHERE username = ?", (username,)
2026-01-25T08:57:21.6404661Z      ).fetchall()
2026-01-25T08:57:21.6404984Z  
2026-01-25T08:57:21.6405429Z -    taken_discriminators = {row['discriminator'] for row in rows}
2026-01-25T08:57:21.6406197Z +    taken_discriminators = {row["discriminator"] for row in rows}
2026-01-25T08:57:21.6406831Z  
2026-01-25T08:57:21.6407394Z      # Создаем множество всех возможных тегов (от 1 до 9999)
2026-01-25T08:57:21.6407984Z      all_possible = set(range(1, MAX_DISCRIMINATOR + 1))
2026-01-25T08:57:21.6408602Z      # Определяем, какие теги еще свободны
2026-01-25T08:57:21.6409154Z      available = list(all_possible - taken_discriminators)
2026-01-25T08:57:21.6409671Z @@ -102,14 +103,15 @@
2026-01-25T08:57:21.6410046Z      return secrets.choice(available)
2026-01-25T08:57:21.6410455Z  
2026-01-25T08:57:21.6410721Z  
2026-01-25T08:57:21.6411017Z  def login_required(view):
2026-01-25T08:57:21.6411649Z      """Декоратор для защиты маршрутов."""
2026-01-25T08:57:21.6412086Z +
2026-01-25T08:57:21.6412420Z      @functools.wraps(view)
2026-01-25T08:57:21.6412835Z      def wrapped_view(*args, **kwargs):
2026-01-25T08:57:21.6413535Z          if g.user is None:
2026-01-25T08:57:21.6414291Z -            flash('Для этого действия необходимо войти в систему.', 'warning')
2026-01-25T08:57:21.6415162Z -            return redirect(url_for('auth.login'))
2026-01-25T08:57:21.6415922Z +            flash("Для этого действия необходимо войти в систему.", "warning")
2026-01-25T08:57:21.6416531Z +            return redirect(url_for("auth.login"))
2026-01-25T08:57:21.6416985Z  
2026-01-25T08:57:21.6417316Z          return view(*args, **kwargs)
2026-01-25T08:57:21.6417726Z  
2026-01-25T08:57:21.6418033Z      return wrapped_view
2026-01-25T08:57:21.6545457Z --- /home/runner/work/flask_blog/flask_blog/app/forms/comment.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.6548300Z +++ /home/runner/work/flask_blog/flask_blog/app/forms/comment.py	2026-01-25 08:57:21.653631+00:00
2026-01-25T08:57:21.6549043Z @@ -1,14 +1,17 @@
2026-01-25T08:57:21.6549724Z  """Формы для работы с комментариями."""
2026-01-25T08:57:21.6550194Z +
2026-01-25T08:57:21.6550662Z  from . import Form, TextAreaField, DataRequired, Length
2026-01-25T08:57:21.6551908Z  
2026-01-25T08:57:21.6552250Z  
2026-01-25T08:57:21.6552584Z  class CommentForm(Form):
2026-01-25T08:57:21.6553447Z      """Форма для добавления комментария к посту."""
2026-01-25T08:57:21.6553976Z -    
2026-01-25T08:57:21.6554302Z +
2026-01-25T08:57:21.6554623Z      content = TextAreaField(
2026-01-25T08:57:21.6555134Z -        'Комментарий',
2026-01-25T08:57:21.6555567Z +        "Комментарий",
2026-01-25T08:57:21.6555951Z          validators=[
2026-01-25T08:57:21.6556597Z -            DataRequired(message='Текст комментария обязателен'),
2026-01-25T08:57:21.6557579Z -            Length(min=3, max=1000, message='Комментарий должен быть от 3 до 1000 символов')
2026-01-25T08:57:21.6558288Z -        ]
2026-01-25T08:57:21.6558900Z +            DataRequired(message="Текст комментария обязателен"),
2026-01-25T08:57:21.6559447Z +            Length(
2026-01-25T08:57:21.6560165Z +                min=3, max=1000, message="Комментарий должен быть от 3 до 1000 символов"
2026-01-25T08:57:21.6560825Z +            ),
2026-01-25T08:57:21.6561170Z +        ],
2026-01-25T08:57:21.6561468Z      )
2026-01-25T08:57:21.6572282Z would reformat /home/runner/work/flask_blog/flask_blog/app/forms/comment.py
2026-01-25T08:57:21.6729164Z --- /home/runner/work/flask_blog/flask_blog/app/forms/auth.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.6732022Z +++ /home/runner/work/flask_blog/flask_blog/app/forms/auth.py	2026-01-25 08:57:21.671568+00:00
2026-01-25T08:57:21.6732782Z @@ -1,53 +1,56 @@
2026-01-25T08:57:21.6733684Z  """Формы для аутентификации пользователей."""
2026-01-25T08:57:21.6734133Z +
2026-01-25T08:57:21.6734636Z  from . import Form, StringField, PasswordField, DataRequired, Length
2026-01-25T08:57:21.6735235Z +
2026-01-25T08:57:21.6735791Z  # TODO: Regexp будет реализован в будущем для валидации формата данных
2026-01-25T08:57:21.6736349Z  
2026-01-25T08:57:21.6736602Z  
2026-01-25T08:57:21.6736917Z  class RegistrationForm(Form):
2026-01-25T08:57:21.6737552Z      """Форма регистрации нового пользователя."""
2026-01-25T08:57:21.6738003Z -    
2026-01-25T08:57:21.6738288Z +
2026-01-25T08:57:21.6739114Z      username = StringField(
2026-01-25T08:57:21.6739669Z -        'Имя пользователя',
2026-01-25T08:57:21.6740171Z +        "Имя пользователя",
2026-01-25T08:57:21.6740644Z          validators=[
2026-01-25T08:57:21.6741248Z -            DataRequired(message='Имя пользователя обязательно'),
2026-01-25T08:57:21.6742210Z -            Length(min=3, max=20, message='Имя пользователя должно быть от 3 до 20 символов'),
2026-01-25T08:57:21.6743359Z +            DataRequired(message="Имя пользователя обязательно"),
2026-01-25T08:57:21.6743889Z +            Length(
2026-01-25T08:57:21.6744281Z +                min=3,
2026-01-25T08:57:21.6744625Z +                max=20,
2026-01-25T08:57:21.6745244Z +                message="Имя пользователя должно быть от 3 до 20 символов",
2026-01-25T08:57:21.6745769Z +            ),
2026-01-25T08:57:21.6746706Z              # TODO: Добавить Regexp(r'^[a-zA-Z0-9_]+$', message='Имя пользователя может содержать только буквы, цифры и подчёркивания')
2026-01-25T08:57:21.6747983Z              # TODO: Добавить Regexp(r'^(?!.*#).*$', message='Имя пользователя не должно содержать символ #')
2026-01-25T08:57:21.6748656Z -        ]
2026-01-25T08:57:21.6748933Z +        ],
2026-01-25T08:57:21.6749220Z      )
2026-01-25T08:57:21.6749494Z -    
2026-01-25T08:57:21.6749781Z +
2026-01-25T08:57:21.6750103Z      password = PasswordField(
2026-01-25T08:57:21.6750595Z -        'Пароль',
2026-01-25T08:57:21.6750957Z +        "Пароль",
2026-01-25T08:57:21.6751285Z          validators=[
2026-01-25T08:57:21.6751803Z -            DataRequired(message='Пароль обязателен'),
2026-01-25T08:57:21.6752613Z -            Length(min=4, max=128, message='Пароль должен быть от 4 до 128 символов')
2026-01-25T08:57:21.6753404Z -        ]
2026-01-25T08:57:21.6753911Z +            DataRequired(message="Пароль обязателен"),
2026-01-25T08:57:21.6754694Z +            Length(min=4, max=128, message="Пароль должен быть от 4 до 128 символов"),
2026-01-25T08:57:21.6755689Z +        ],
2026-01-25T08:57:21.6755986Z      )
2026-01-25T08:57:21.6756289Z  
2026-01-25T08:57:21.6756550Z  
2026-01-25T08:57:21.6756842Z  class LoginForm(Form):
2026-01-25T08:57:21.6757315Z      """Форма входа пользователя."""
2026-01-25T08:57:21.6757717Z -    
2026-01-25T08:57:21.6758000Z +
2026-01-25T08:57:21.6758325Z      username = StringField(
2026-01-25T08:57:21.6758801Z -        'Имя пользователя',
2026-01-25T08:57:21.6759264Z +        "Имя пользователя",
2026-01-25T08:57:21.6759632Z          validators=[
2026-01-25T08:57:21.6760197Z -            DataRequired(message='Имя пользователя обязательно'),
2026-01-25T08:57:21.6760980Z +            DataRequired(message="Имя пользователя обязательно"),
2026-01-25T08:57:21.6761851Z              # TODO: Добавить Regexp(r'^[a-zA-Z0-9_]+#\d{4}$', message='Формат: имя#0001')
2026-01-25T08:57:21.6762518Z -        ]
2026-01-25T08:57:21.6762856Z +        ],
2026-01-25T08:57:21.6763368Z      )
2026-01-25T08:57:21.6763642Z -    
2026-01-25T08:57:21.6763909Z +
2026-01-25T08:57:21.6764221Z      password = PasswordField(
2026-01-25T08:57:21.6764717Z -        'Пароль',
2026-01-25T08:57:21.6765049Z -        validators=[
2026-01-25T08:57:21.6765554Z -            DataRequired(message='Пароль обязателен')
2026-01-25T08:57:21.6766014Z -        ]
2026-01-25T08:57:21.6766540Z +        "Пароль", validators=[DataRequired(message="Пароль обязателен")]
2026-01-25T08:57:21.6767089Z      )
2026-01-25T08:57:21.6767362Z -    
2026-01-25T08:57:21.6767621Z +
2026-01-25T08:57:21.6767974Z      def __init__(self, formdata=None, **kwargs):
2026-01-25T08:57:21.6768536Z          super().__init__(formdata, **kwargs)
2026-01-25T08:57:21.6769257Z          # Если форма отправлена с login_username, используем его как username
2026-01-25T08:57:21.6769925Z -        if formdata and 'login_username' in formdata:
2026-01-25T08:57:21.6770520Z -            self.username.data = formdata['login_username']
2026-01-25T08:57:21.6771137Z +        if formdata and "login_username" in formdata:
2026-01-25T08:57:21.6771955Z +            self.username.data = formdata["login_username"]
2026-01-25T08:57:21.6772795Z          # Если форма отправлена с login_password, используем его как password
2026-01-25T08:57:21.6773614Z -        if formdata and 'login_password' in formdata:
2026-01-25T08:57:21.6774203Z -            self.password.data = formdata['login_password']
2026-01-25T08:57:21.6774815Z +        if formdata and "login_password" in formdata:
2026-01-25T08:57:21.6775443Z +            self.password.data = formdata["login_password"]
2026-01-25T08:57:21.6797362Z would reformat /home/runner/work/flask_blog/flask_blog/app/forms/auth.py
2026-01-25T08:57:21.6936539Z --- /home/runner/work/flask_blog/flask_blog/app/forms/csrf.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.6937705Z +++ /home/runner/work/flask_blog/flask_blog/app/forms/csrf.py	2026-01-25 08:57:21.692519+00:00
2026-01-25T08:57:21.6938519Z @@ -15,22 +15,22 @@
2026-01-25T08:57:21.6939559Z  
2026-01-25T08:57:21.6939848Z      Returns:
2026-01-25T08:57:21.6942656Z          str: подписанный CSRF-токен (hex).
2026-01-25T08:57:21.6943415Z      """
2026-01-25T08:57:21.6943774Z      from flask import has_request_context
2026-01-25T08:57:21.6944279Z -    
2026-01-25T08:57:21.6944571Z +
2026-01-25T08:57:21.6945119Z      # Для тестов вне контекста запроса используем простую строку
2026-01-25T08:57:21.6945698Z      if not has_request_context():
2026-01-25T08:57:21.6946192Z -        return 'test_csrf_token_for_testing'
2026-01-25T08:57:21.6946645Z -    
2026-01-25T08:57:21.6947013Z -    if '_csrf_token' not in session:
2026-01-25T08:57:21.6947504Z +        return "test_csrf_token_for_testing"
2026-01-25T08:57:21.6947975Z +
2026-01-25T08:57:21.6948308Z +    if "_csrf_token" not in session:
2026-01-25T08:57:21.6949020Z          # Случайное значение на сессию
2026-01-25T08:57:21.6949552Z -        session['_csrf_token'] = os.urandom(32).hex()
2026-01-25T08:57:21.6950222Z +        session["_csrf_token"] = os.urandom(32).hex()
2026-01-25T08:57:21.6950755Z  
2026-01-25T08:57:21.6951346Z      # Создаем подпись токена, чтобы его нельзя было подделать вне сервера
2026-01-25T08:57:21.6952002Z -    key = current_app.config['SECRET_KEY'].encode()
2026-01-25T08:57:21.6952571Z -    token = session['_csrf_token'].encode()
2026-01-25T08:57:21.6953383Z +    key = current_app.config["SECRET_KEY"].encode()
2026-01-25T08:57:21.6953938Z +    token = session["_csrf_token"].encode()
2026-01-25T08:57:21.6954512Z      return hmac.new(key, token, hashlib.sha256).hexdigest()
2026-01-25T08:57:21.6955163Z  
2026-01-25T08:57:21.6955493Z  
2026-01-25T08:57:21.6955807Z  def validate_csrf_token(token):
2026-01-25T08:57:21.6956485Z      """Проверяет CSRF-токен на совпадение с ожидаемым.
2026-01-25T08:57:21.6956996Z @@ -40,16 +40,16 @@
2026-01-25T08:57:21.6957319Z  
2026-01-25T08:57:21.6957609Z      Returns:
2026-01-25T08:57:21.6958046Z          bool: True если токен валиден.
2026-01-25T08:57:21.6958479Z      """
2026-01-25T08:57:21.6958869Z      from flask import has_request_context
2026-01-25T08:57:21.6959309Z -    
2026-01-25T08:57:21.6959593Z +
2026-01-25T08:57:21.6960364Z      # Для тестов вне контекста запроса
2026-01-25T08:57:21.6960856Z      if not has_request_context():
2026-01-25T08:57:21.6961358Z -        return token == 'test_csrf_token_for_testing'
2026-01-25T08:57:21.6961839Z -    
2026-01-25T08:57:21.6962298Z -    if not token or '_csrf_token' not in session:
2026-01-25T08:57:21.6963125Z +        return token == "test_csrf_token_for_testing"
2026-01-25T08:57:21.6963636Z +
2026-01-25T08:57:21.6964027Z +    if not token or "_csrf_token" not in session:
2026-01-25T08:57:21.6964530Z          return False
2026-01-25T08:57:21.6964900Z  
2026-01-25T08:57:21.6965265Z      expected_token = generate_csrf_token()
2026-01-25T08:57:21.6965949Z      # compare_digest защищает от тайминговых атак
2026-01-25T08:57:21.6966552Z      return hmac.compare_digest(expected_token, token)
2026-01-25T08:57:21.6967322Z would reformat /home/runner/work/flask_blog/flask_blog/app/forms/csrf.py
2026-01-25T08:57:21.7304005Z --- /home/runner/work/flask_blog/flask_blog/app/forms/post.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.7306534Z +++ /home/runner/work/flask_blog/flask_blog/app/forms/post.py	2026-01-25 08:57:21.729051+00:00
2026-01-25T08:57:21.7313563Z @@ -1,22 +1,29 @@
2026-01-25T08:57:21.7315000Z  """Формы для работы с постами блога."""
2026-01-25T08:57:21.7315416Z +
2026-01-25T08:57:21.7315824Z  from . import Form, StringField, TextAreaField, DataRequired, Length
2026-01-25T08:57:21.7316319Z  
2026-01-25T08:57:21.7316548Z  
2026-01-25T08:57:21.7316800Z  class PostForm(Form):
2026-01-25T08:57:21.7317226Z      """Форма для создания и редактирования поста."""
2026-01-25T08:57:21.7317617Z -    
2026-01-25T08:57:21.7317861Z +
2026-01-25T08:57:21.7318103Z      title = StringField(
2026-01-25T08:57:21.7318481Z -        'Заголовок',
2026-01-25T08:57:21.7318847Z +        "Заголовок",
2026-01-25T08:57:21.7319160Z          validators=[
2026-01-25T08:57:21.7320264Z -            DataRequired(message='Заголовок обязателен'),
2026-01-25T08:57:21.7321048Z -            Length(min=1, max=200, message='Заголовок должен быть от 1 до 200 символов')
2026-01-25T08:57:21.7321616Z -        ]
2026-01-25T08:57:21.7322063Z +            DataRequired(message="Заголовок обязателен"),
2026-01-25T08:57:21.7322539Z +            Length(
2026-01-25T08:57:21.7323323Z +                min=1, max=200, message="Заголовок должен быть от 1 до 200 символов"
2026-01-25T08:57:21.7323870Z +            ),
2026-01-25T08:57:21.7324179Z +        ],
2026-01-25T08:57:21.7324463Z      )
2026-01-25T08:57:21.7324747Z -    
2026-01-25T08:57:21.7325017Z +
2026-01-25T08:57:21.7325312Z      content = TextAreaField(
2026-01-25T08:57:21.7325781Z -        'Содержание',
2026-01-25T08:57:21.7326159Z +        "Содержание",
2026-01-25T08:57:21.7326491Z          validators=[
2026-01-25T08:57:21.7327008Z -            DataRequired(message='Содержание обязательно'),
2026-01-25T08:57:21.7327861Z -            Length(min=10, max=5000, message='Содержание должно быть от 10 до 5000 символов')
2026-01-25T08:57:21.7328534Z -        ]
2026-01-25T08:57:21.7329054Z +            DataRequired(message="Содержание обязательно"),
2026-01-25T08:57:21.7329542Z +            Length(
2026-01-25T08:57:21.7329852Z +                min=10,
2026-01-25T08:57:21.7330201Z +                max=5000,
2026-01-25T08:57:21.7330769Z +                message="Содержание должно быть от 10 до 5000 символов",
2026-01-25T08:57:21.7331285Z +            ),
2026-01-25T08:57:21.7331588Z +        ],
2026-01-25T08:57:21.7331870Z      )
2026-01-25T08:57:21.7332370Z would reformat /home/runner/work/flask_blog/flask_blog/app/forms/post.py
2026-01-25T08:57:21.7353518Z --- /home/runner/work/flask_blog/flask_blog/app/forms/base.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.7366391Z would reformat /home/runner/work/flask_blog/flask_blog/app/forms/base.py
2026-01-25T08:57:21.7367316Z +++ /home/runner/work/flask_blog/flask_blog/app/forms/base.py	2026-01-25 08:57:21.733372+00:00
2026-01-25T08:57:21.7368124Z @@ -35,11 +35,11 @@
2026-01-25T08:57:21.7368908Z                  setattr(self, name, instance_field)
2026-01-25T08:57:21.7369492Z                  self._fields[name] = instance_field
2026-01-25T08:57:21.7369886Z  
2026-01-25T08:57:21.7370539Z          # Автоматическое получение данных из запроса Flask, если form_data не передали явно.
2026-01-25T08:57:21.7371159Z          if form_data is None and has_request_context():
2026-01-25T08:57:21.7371714Z -            if request.method in ('POST', 'PUT', 'PATCH'):
2026-01-25T08:57:21.7372280Z +            if request.method in ("POST", "PUT", "PATCH"):
2026-01-25T08:57:21.7372804Z                  form_data = request.form
2026-01-25T08:57:21.7373550Z  
2026-01-25T08:57:21.7373919Z          # Заполнение полей данными
2026-01-25T08:57:21.7374334Z          if form_data is not None:
2026-01-25T08:57:21.7374758Z              self.process(form_data)
2026-01-25T08:57:21.7375171Z @@ -47,47 +47,47 @@
2026-01-25T08:57:21.7375543Z      def process(self, form_data):
2026-01-25T08:57:21.7376174Z          """Заполняет поля формы данными из form_data (dict/MultiDict)."""
2026-01-25T08:57:21.7376906Z          # Заполняем данные для каждого зарегистрированного поля
2026-01-25T08:57:21.7377428Z          for name, field in self._fields.items():
2026-01-25T08:57:21.7378116Z              # Работаем как с MultiDict (Flask), так и с обычным dict
2026-01-25T08:57:21.7378677Z -            if hasattr(form_data, 'get'):
2026-01-25T08:57:21.7379149Z +            if hasattr(form_data, "get"):
2026-01-25T08:57:21.7379642Z                  field.data = form_data.get(name)
2026-01-25T08:57:21.7380095Z  
2026-01-25T08:57:21.7380499Z          # Извлекаем CSRF токен для валидации
2026-01-25T08:57:21.7381125Z -        self._csrf_token_data = getattr(form_data, 'get', lambda k: None)('csrf_token')
2026-01-25T08:57:21.7381986Z +        self._csrf_token_data = getattr(form_data, "get", lambda k: None)("csrf_token")
2026-01-25T08:57:21.7382588Z  
2026-01-25T08:57:21.7383495Z      def validate(self):
2026-01-25T08:57:21.7384098Z          """Валидирует форму: CSRF + валидаторы каждого поля.
2026-01-25T08:57:21.7384607Z  
2026-01-25T08:57:21.7384902Z          Returns:
2026-01-25T08:57:21.7385502Z              bool: True если форма валидна, иначе False (ошибки в self.errors).
2026-01-25T08:57:21.7386039Z          """
2026-01-25T08:57:21.7386389Z          from flask import current_app
2026-01-25T08:57:21.7386805Z -        
2026-01-25T08:57:21.7387108Z +
2026-01-25T08:57:21.7387414Z          self._csrf_error = None
2026-01-25T08:57:21.7387808Z          is_valid = True
2026-01-25T08:57:21.7388157Z  
2026-01-25T08:57:21.7388626Z          # В TESTING режиме отключаем CSRF для конкретных тестов
2026-01-25T08:57:21.7389140Z          if current_app.testing:
2026-01-25T08:57:21.7389804Z              # Если WTF_CSRF_ENABLED выключен, пропускаем CSRF проверку
2026-01-25T08:57:21.7390494Z -            if not current_app.config.get('WTF_CSRF_ENABLED', True):
2026-01-25T08:57:21.7391180Z +            if not current_app.config.get("WTF_CSRF_ENABLED", True):
2026-01-25T08:57:21.7391966Z                  return True  # CSRF отключен, считаем валидацию успешной
2026-01-25T08:57:21.7392467Z -            
2026-01-25T08:57:21.7392738Z +
2026-01-25T08:57:21.7393379Z              # Специальный тестовый токен всегда принимается
2026-01-25T08:57:21.7393987Z -            if self._csrf_token_data == 'test_csrf_token_for_testing':
2026-01-25T08:57:21.7394625Z +            if self._csrf_token_data == "test_csrf_token_for_testing":
2026-01-25T08:57:21.7395342Z                  return True  # Тестовый токен для обычных тестов
2026-01-25T08:57:21.7395803Z -            
2026-01-25T08:57:21.7396104Z +
2026-01-25T08:57:21.7396570Z              # Для тестов безопасности принимаем только валидные токены
2026-01-25T08:57:21.7397253Z              # Проверяем, что это не очевидно тестовый токен безопасности
2026-01-25T08:57:21.7397891Z -            if self._csrf_token_data not in ['wrong_token', 'invalid_token', '']:
2026-01-25T08:57:21.7398720Z +            if self._csrf_token_data not in ["wrong_token", "invalid_token", ""]:
2026-01-25T08:57:21.7399779Z                  # Для всех остальных токенов в тестах, включая правильные,
2026-01-25T08:57:21.7400461Z                  # используем нормальную валидацию CSRF
2026-01-25T08:57:21.7401066Z                  pass  # Продолжаем к обычной валидации ниже
2026-01-25T08:57:21.7401481Z              else:
2026-01-25T08:57:21.7401789Z                  # Явно неверные токены должны провалить валидацию
2026-01-25T08:57:21.7402188Z                  pass  # Продолжаем к обычной валидации, которая провалится
2026-01-25T08:57:21.7402481Z -        
2026-01-25T08:57:21.7402640Z +
2026-01-25T08:57:21.7403158Z          # В обычном режиме или в тестах с CSRF, проверяем токен
2026-01-25T08:57:21.7403759Z          if not validate_csrf_token(self._csrf_token_data):
2026-01-25T08:57:21.7404574Z              self._csrf_error = "Неверный или отсутствующий CSRF-токен."
2026-01-25T08:57:21.7405444Z              is_valid = False
2026-01-25T08:57:21.7405851Z  
2026-01-25T08:57:21.7406147Z @@ -109,11 +109,11 @@
2026-01-25T08:57:21.7406542Z          Returns:
2026-01-25T08:57:21.7407056Z              dict[str, list[str]]: ошибки по полям.
2026-01-25T08:57:21.7407506Z          """
2026-01-25T08:57:21.7407795Z          all_errors = {}
2026-01-25T08:57:21.7408158Z          if self._csrf_error:
2026-01-25T08:57:21.7408621Z -            all_errors['csrf'] = [self._csrf_error]
2026-01-25T08:57:21.7409154Z +            all_errors["csrf"] = [self._csrf_error]
2026-01-25T08:57:21.7409591Z  
2026-01-25T08:57:21.7409921Z          for name, field in self._fields.items():
2026-01-25T08:57:21.7411908Z              if field.errors:
2026-01-25T08:57:21.7412428Z                  all_errors[name] = field.errors
2026-01-25T08:57:21.7413174Z          return all_errors
2026-01-25T08:57:21.7413844Z would reformat /home/runner/work/flask_blog/flask_blog/app/forms/fields.py
2026-01-25T08:57:21.7414804Z --- /home/runner/work/flask_blog/flask_blog/app/forms/fields.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.7415842Z +++ /home/runner/work/flask_blog/flask_blog/app/forms/fields.py	2026-01-25 08:57:21.737391+00:00
2026-01-25T08:57:21.7416514Z @@ -63,16 +63,19 @@
2026-01-25T08:57:21.7416838Z          return is_valid
2026-01-25T08:57:21.7417183Z  
2026-01-25T08:57:21.7417443Z  
2026-01-25T08:57:21.7417707Z  class StringField(Field):
2026-01-25T08:57:21.7418383Z      """Текстовое поле (пока без специфики, тип нужен для читабельности/расширения)."""
2026-01-25T08:57:21.7418890Z +
2026-01-25T08:57:21.7419154Z      pass
2026-01-25T08:57:21.7419434Z  
2026-01-25T08:57:21.7419698Z  
2026-01-25T08:57:21.7420016Z  class PasswordField(Field):
2026-01-25T08:57:21.7420695Z      """Поле пароля (тип нужен для семантики; отображение контролируется шаблоном)."""
2026-01-25T08:57:21.7421247Z +
2026-01-25T08:57:21.7421523Z      pass
2026-01-25T08:57:21.7421807Z  
2026-01-25T08:57:21.7422060Z  
2026-01-25T08:57:21.7422377Z  class TextAreaField(Field):
2026-01-25T08:57:21.7423157Z      """Многострочное текстовое поле."""
2026-01-25T08:57:21.7423596Z +
2026-01-25T08:57:21.7423876Z      pass
2026-01-25T08:57:21.7484871Z --- /home/runner/work/flask_blog/flask_blog/app/main/__init__.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.7489687Z +++ /home/runner/work/flask_blog/flask_blog/app/main/__init__.py	2026-01-25 08:57:21.747312+00:00
2026-01-25T08:57:21.7490911Z @@ -1,7 +1,7 @@
2026-01-25T08:57:21.7493955Z  """Blueprint главных маршрутов."""
2026-01-25T08:57:21.7494412Z  
2026-01-25T08:57:21.7494731Z  from flask import Blueprint
2026-01-25T08:57:21.7495110Z  
2026-01-25T08:57:21.7495495Z -bp = Blueprint('main', __name__)
2026-01-25T08:57:21.7495955Z +bp = Blueprint("main", __name__)
2026-01-25T08:57:21.7496339Z  
2026-01-25T08:57:21.7496660Z  from app.main import routes  # noqa
2026-01-25T08:57:21.7506111Z would reformat /home/runner/work/flask_blog/flask_blog/app/main/__init__.py
2026-01-25T08:57:21.7583091Z --- /home/runner/work/flask_blog/flask_blog/app/models/__init__.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.7588626Z +++ /home/runner/work/flask_blog/flask_blog/app/models/__init__.py	2026-01-25 08:57:21.757523+00:00
2026-01-25T08:57:21.7592072Z @@ -1,5 +1,6 @@
2026-01-25T08:57:21.7594077Z  """Модели данных приложения."""
2026-01-25T08:57:21.7594896Z +
2026-01-25T08:57:21.7595196Z  from .post import Post
2026-01-25T08:57:21.7595591Z  from .comment import Comment
2026-01-25T08:57:21.7595961Z  
2026-01-25T08:57:21.7596272Z -__all__ = ['Post', 'Comment']
2026-01-25T08:57:21.7596674Z +__all__ = ["Post", "Comment"]
2026-01-25T08:57:21.7601760Z would reformat /home/runner/work/flask_blog/flask_blog/app/models/__init__.py
2026-01-25T08:57:21.8027312Z --- /home/runner/work/flask_blog/flask_blog/app/forms/validators.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.8034063Z +++ /home/runner/work/flask_blog/flask_blog/app/forms/validators.py	2026-01-25 08:57:21.800192+00:00
2026-01-25T08:57:21.8035198Z would reformat /home/runner/work/flask_blog/flask_blog/app/forms/validators.py
2026-01-25T08:57:21.8036580Z @@ -2,19 +2,20 @@
2026-01-25T08:57:21.8037040Z  # ==============================================================================
2026-01-25T08:57:21.8037979Z  # Временные заглушки валидаторов для будущего развития
2026-01-25T08:57:21.8038895Z  # Все валидации кроме CSRF отключены и заменены заглушками
2026-01-25T08:57:21.8039603Z  # ==============================================================================
2026-01-25T08:57:21.8040158Z  
2026-01-25T08:57:21.8040502Z +
2026-01-25T08:57:21.8040809Z  class Validator:
2026-01-25T08:57:21.8041380Z      """Базовый класс валидатора.
2026-01-25T08:57:21.8041776Z -    
2026-01-25T08:57:21.8042448Z +
2026-01-25T08:57:21.8043079Z      TODO: Реализовать полную систему валидации
2026-01-25T08:57:21.8043659Z      - Базовая логика валидации
2026-01-25T08:57:21.8044118Z      - Обработка ошибок
2026-01-25T08:57:21.8044561Z      - Сообщения об ошибках
2026-01-25T08:57:21.8044921Z      """
2026-01-25T08:57:21.8045238Z -    
2026-01-25T08:57:21.8045502Z +
2026-01-25T08:57:21.8045839Z      def __init__(self, message=None):
2026-01-25T08:57:21.8046311Z          self.message = message
2026-01-25T08:57:21.8046689Z  
2026-01-25T08:57:21.8047029Z      def __call__(self, value):
2026-01-25T08:57:21.8047551Z          # TODO: Реализовать логику валидации
2026-01-25T08:57:21.8048137Z @@ -22,93 +23,104 @@
2026-01-25T08:57:21.8065213Z  
2026-01-25T08:57:21.8073488Z  
2026-01-25T08:57:21.8074443Z  # TODO: Заглушки вместо реальных валидаторов
2026-01-25T08:57:21.8075124Z  # Все валидации кроме CSRF отключены для будущего развития
2026-01-25T08:57:21.8075608Z  
2026-01-25T08:57:21.8076072Z +
2026-01-25T08:57:21.8076481Z  class DataRequired(Validator):
2026-01-25T08:57:21.8077025Z      """TODO: Проверка обязательного поля.
2026-01-25T08:57:21.8077452Z -    
2026-01-25T08:57:21.8077926Z +
2026-01-25T08:57:21.8078523Z      ЗАГЛУШКА: Всегда возвращает True для будущего развития
2026-01-25T08:57:21.8078994Z      """
2026-01-25T08:57:21.8079295Z +
2026-01-25T08:57:21.8079635Z      def __call__(self, value):
2026-01-25T08:57:21.8080015Z          return True, None
2026-01-25T08:57:21.8080713Z  
2026-01-25T08:57:21.8081006Z  
2026-01-25T08:57:21.8081295Z  class Length(Validator):
2026-01-25T08:57:21.8081814Z      """TODO: Проверка длины значения.
2026-01-25T08:57:21.8082251Z -    
2026-01-25T08:57:21.8082520Z +
2026-01-25T08:57:21.8083175Z      ЗАГЛУШКА: Всегда возвращает True для будущего развития
2026-01-25T08:57:21.8083657Z      """
2026-01-25T08:57:21.8083959Z +
2026-01-25T08:57:21.8084348Z      def __init__(self, min=-1, max=-1, message=None):
2026-01-25T08:57:21.8085562Z          super().__init__(message)
2026-01-25T08:57:21.8086047Z          self.min = min
2026-01-25T08:57:21.8086405Z          self.max = max
2026-01-25T08:57:21.8086743Z -    
2026-01-25T08:57:21.8087022Z +
2026-01-25T08:57:21.8087338Z      def __call__(self, value):
2026-01-25T08:57:21.8087741Z          return True, None
2026-01-25T08:57:21.8088094Z  
2026-01-25T08:57:21.8088629Z  
2026-01-25T08:57:21.8088919Z  class EqualTo(Validator):
2026-01-25T08:57:21.8089446Z      """TODO: Проверка совпадения полей.
2026-01-25T08:57:21.8089858Z -    
2026-01-25T08:57:21.8090203Z +
2026-01-25T08:57:21.8090665Z      ЗАГЛУШКА: Всегда возвращает True для будущего развития
2026-01-25T08:57:21.8091143Z      """
2026-01-25T08:57:21.8091417Z +
2026-01-25T08:57:21.8091959Z      def __init__(self, field_name, message="Поля должны совпадать"):
2026-01-25T08:57:21.8092560Z          super().__init__(message)
2026-01-25T08:57:21.8093182Z          self.field_name = field_name
2026-01-25T08:57:21.8093585Z -    
2026-01-25T08:57:21.8093870Z +
2026-01-25T08:57:21.8094181Z      def __call__(self, value, form=None):
2026-01-25T08:57:21.8094631Z          return True, None
2026-01-25T08:57:21.8094971Z  
2026-01-25T08:57:21.8095235Z  
2026-01-25T08:57:21.8095643Z  # TODO: Заглушки для будущих валидаторов
2026-01-25T08:57:21.8096077Z  class Email(Validator):
2026-01-25T08:57:21.8096557Z      """TODO: Валидация email адреса."""
2026-01-25T08:57:21.8097001Z +
2026-01-25T08:57:21.8097290Z      def __call__(self, value):
2026-01-25T08:57:21.8097708Z          return True, None
2026-01-25T08:57:21.8098059Z  
2026-01-25T08:57:21.8098319Z  
2026-01-25T08:57:21.8098619Z  class Username(Validator):
2026-01-25T08:57:21.8099133Z      """TODO: Валидация имени пользователя."""
2026-01-25T08:57:21.8099557Z +
2026-01-25T08:57:21.8099896Z      def __call__(self, value):
2026-01-25T08:57:21.8100309Z          return True, None
2026-01-25T08:57:21.8100660Z  
2026-01-25T08:57:21.8100918Z  
2026-01-25T08:57:21.8101267Z  class PasswordStrength(Validator):
2026-01-25T08:57:21.8101826Z      """TODO: Проверка сложности пароля."""
2026-01-25T08:57:21.8102240Z +
2026-01-25T08:57:21.8102540Z      def __call__(self, value):
2026-01-25T08:57:21.8103134Z          return True, None
2026-01-25T08:57:21.8103476Z  
2026-01-25T08:57:21.8103736Z  
2026-01-25T08:57:21.8104066Z  class UniqueUsername(Validator):
2026-01-25T08:57:21.8104718Z      """TODO: Проверка уникальности имени пользователя."""
2026-01-25T08:57:21.8105196Z +
2026-01-25T08:57:21.8105759Z      def __call__(self, value, form=None):
2026-01-25T08:57:21.8106264Z          return True, None
2026-01-25T08:57:21.8106619Z  
2026-01-25T08:57:21.8106887Z  
2026-01-25T08:57:21.8107168Z  class Slug(Validator):
2026-01-25T08:57:21.8107668Z      """TODO: Валидация slug для URL."""
2026-01-25T08:57:21.8108081Z +
2026-01-25T08:57:21.8108364Z      def __call__(self, value):
2026-01-25T08:57:21.8108764Z          return True, None
2026-01-25T08:57:21.8109133Z  
2026-01-25T08:57:21.8109385Z  
2026-01-25T08:57:21.8109688Z  class NumberRange(Validator):
2026-01-25T08:57:21.8110211Z      """TODO: Проверка числового диапазона."""
2026-01-25T08:57:21.8110633Z +
2026-01-25T08:57:21.8110920Z      def __call__(self, value):
2026-01-25T08:57:21.8111312Z          return True, None
2026-01-25T08:57:21.8111662Z  
2026-01-25T08:57:21.8111905Z  
2026-01-25T08:57:21.8112269Z  class URL(Validator):
2026-01-25T08:57:21.8112777Z      """TODO: Валидация URL."""
2026-01-25T08:57:21.8113304Z +
2026-01-25T08:57:21.8113612Z      def __call__(self, value):
2026-01-25T08:57:21.8114028Z          return True, None
2026-01-25T08:57:21.8114371Z  
2026-01-25T08:57:21.8114632Z  
2026-01-25T08:57:21.8115007Z  # TODO: Реализовать в будущем
2026-01-25T08:57:21.8115414Z  # class Regexp(Validator):
2026-01-25T08:57:21.8115915Z  #     """TODO: Проверка регулярным выражением.
2026-01-25T08:57:21.8116355Z -#     
2026-01-25T08:57:21.8116645Z +#
2026-01-25T08:57:21.8117088Z  #     Будущая реализация:
2026-01-25T08:57:21.8117578Z  #     - Самописная регулярная валидация
2026-01-25T08:57:21.8118072Z  #     - Валидация форматов данных
2026-01-25T08:57:21.8118545Z  #     - Кэширование компиляции
2026-01-25T08:57:21.8118907Z  #     """
2026-01-25T08:57:21.8350350Z --- /home/runner/work/flask_blog/flask_blog/app/models/comment.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.8351459Z +++ /home/runner/work/flask_blog/flask_blog/app/models/comment.py	2026-01-25 08:57:21.833409+00:00
2026-01-25T08:57:21.8352680Z @@ -1,84 +1,85 @@
2026-01-25T08:57:21.8353567Z  """Модель комментария к посту блога."""
2026-01-25T08:57:21.8354875Z +
2026-01-25T08:57:21.8355826Z  from datetime import datetime
2026-01-25T08:57:21.8356777Z  from typing import Optional, Dict, Any
2026-01-25T08:57:21.8357661Z  
2026-01-25T08:57:21.8358571Z  
2026-01-25T08:57:21.8359710Z  class Comment:
2026-01-25T08:57:21.8370973Z would reformat /home/runner/work/flask_blog/flask_blog/app/models/comment.py
2026-01-25T08:57:21.8371844Z      """Модель комментария к посту блога.
2026-01-25T08:57:21.8372765Z -    
2026-01-25T08:57:21.8373393Z +
2026-01-25T08:57:21.8374077Z      Содержит только данные и базовую бизнес-логику.
2026-01-25T08:57:21.8374900Z      Вся логика работы с БД вынесена в CommentService.
2026-01-25T08:57:21.8375506Z      """
2026-01-25T08:57:21.8375943Z -    
2026-01-25T08:57:21.8376359Z +
2026-01-25T08:57:21.8376792Z      def __init__(
2026-01-25T08:57:21.8377250Z          self,
2026-01-25T08:57:21.8377825Z          id: Optional[int] = None,
2026-01-25T08:57:21.8378462Z          author_id: Optional[int] = None,
2026-01-25T08:57:21.8379108Z          post_id: Optional[int] = None,
2026-01-25T08:57:21.8379751Z -        content: str = '',
2026-01-25T08:57:21.8380322Z +        content: str = "",
2026-01-25T08:57:21.8380875Z          created: Optional[datetime] = None,
2026-01-25T08:57:21.8381483Z -        author_username: str = '',
2026-01-25T08:57:21.8382101Z -        author_discriminator: int = 0
2026-01-25T08:57:21.8382740Z +        author_username: str = "",
2026-01-25T08:57:21.8383569Z +        author_discriminator: int = 0,
2026-01-25T08:57:21.8384134Z      ):
2026-01-25T08:57:21.8384564Z          self.id = id
2026-01-25T08:57:21.8385083Z          self.author_id = author_id
2026-01-25T08:57:21.8385646Z          self.post_id = post_id
2026-01-25T08:57:21.8386218Z          self.content = content
2026-01-25T08:57:21.8386776Z          self.created = created
2026-01-25T08:57:21.8387509Z          self.author_username = author_username
2026-01-25T08:57:21.8388216Z          self.author_discriminator = author_discriminator
2026-01-25T08:57:21.8389195Z -    
2026-01-25T08:57:21.8389670Z +
2026-01-25T08:57:21.8390083Z      @property
2026-01-25T08:57:21.8390601Z      def author_display_name(self) -> str:
2026-01-25T08:57:21.8391467Z          """Возвращает отображаемое имя автора с дискриминатором."""
2026-01-25T08:57:21.8392349Z          return f"{self.author_username}#{self.author_discriminator:04d}"
2026-01-25T08:57:21.8393290Z -    
2026-01-25T08:57:21.8393742Z +
2026-01-25T08:57:21.8395220Z      def is_author(self, user_id: int) -> bool:
2026-01-25T08:57:21.8396169Z          """Проверяет, является ли пользователь автором комментария.
2026-01-25T08:57:21.8397503Z -        
2026-01-25T08:57:21.8398014Z +
2026-01-25T08:57:21.8398423Z          Args:
2026-01-25T08:57:21.8400167Z              user_id: ID пользователя
2026-01-25T08:57:21.8402168Z -            
2026-01-25T08:57:21.8402496Z +
2026-01-25T08:57:21.8402751Z          Returns:
2026-01-25T08:57:21.8403484Z              bool: True если пользователь автор комментария
2026-01-25T08:57:21.8403978Z          """
2026-01-25T08:57:21.8404320Z          return self.author_id == user_id
2026-01-25T08:57:21.8404777Z -    
2026-01-25T08:57:21.8405063Z +
2026-01-25T08:57:21.8405418Z      def to_dict(self) -> Dict[str, Any]:
2026-01-25T08:57:21.8406095Z          """Преобразует комментарий в словарь для шаблонов.
2026-01-25T08:57:21.8406597Z -        
2026-01-25T08:57:21.8406934Z +
2026-01-25T08:57:21.8407209Z          Returns:
2026-01-25T08:57:21.8407756Z              Dict[str, Any]: словарь с данными комментария
2026-01-25T08:57:21.8408249Z          """
2026-01-25T08:57:21.8408556Z          return {
2026-01-25T08:57:21.8408907Z -            'id': self.id,
2026-01-25T08:57:21.8409329Z -            'author_id': self.author_id,
2026-01-25T08:57:21.8409807Z -            'post_id': self.post_id,
2026-01-25T08:57:21.8410264Z -            'content': self.content,
2026-01-25T08:57:21.8411139Z -            'created': self.created,
2026-01-25T08:57:21.8411669Z -            'author_username': self.author_username,
2026-01-25T08:57:21.8412371Z -            'author_discriminator': self.author_discriminator,
2026-01-25T08:57:21.8413203Z -            'author_display_name': self.author_display_name
2026-01-25T08:57:21.8413762Z +            "id": self.id,
2026-01-25T08:57:21.8414169Z +            "author_id": self.author_id,
2026-01-25T08:57:21.8414652Z +            "post_id": self.post_id,
2026-01-25T08:57:21.8415107Z +            "content": self.content,
2026-01-25T08:57:21.8415575Z +            "created": self.created,
2026-01-25T08:57:21.8416067Z +            "author_username": self.author_username,
2026-01-25T08:57:21.8416668Z +            "author_discriminator": self.author_discriminator,
2026-01-25T08:57:21.8417308Z +            "author_display_name": self.author_display_name,
2026-01-25T08:57:21.8417816Z          }
2026-01-25T08:57:21.8418116Z -    
2026-01-25T08:57:21.8418412Z +
2026-01-25T08:57:21.8418688Z      @classmethod
2026-01-25T08:57:21.8419145Z -    def from_dict(cls, data: Dict[str, Any]) -> 'Comment':
2026-01-25T08:57:21.8419785Z +    def from_dict(cls, data: Dict[str, Any]) -> "Comment":
2026-01-25T08:57:21.8420505Z          """Создаёт экземпляр Comment из словаря.
2026-01-25T08:57:21.8420972Z -        
2026-01-25T08:57:21.8421278Z +
2026-01-25T08:57:21.8421561Z          Args:
2026-01-25T08:57:21.8422036Z              data: Словарь с данными комментария
2026-01-25T08:57:21.8422489Z -            
2026-01-25T08:57:21.8422800Z +
2026-01-25T08:57:21.8423303Z          Returns:
2026-01-25T08:57:21.8423818Z              Comment: созданный экземпляр
2026-01-25T08:57:21.8424257Z          """
2026-01-25T08:57:21.8424578Z          return cls(**data)
2026-01-25T08:57:21.8424968Z -    
2026-01-25T08:57:21.8425256Z +
2026-01-25T08:57:21.8425562Z      def __repr__(self) -> str:
2026-01-25T08:57:21.8426142Z          """Строковое представление для отладки."""
2026-01-25T08:57:21.8426932Z          return f"<Comment(id={self.id}, post_id={self.post_id}, author_id={self.author_id})>"
2026-01-25T08:57:21.8427672Z -    
2026-01-25T08:57:21.8428390Z +
2026-01-25T08:57:21.8428740Z      def __eq__(self, other) -> bool:
2026-01-25T08:57:21.8429327Z          """Сравнение комментариев по ID."""
2026-01-25T08:57:21.8429847Z          if not isinstance(other, Comment):
2026-01-25T08:57:21.8430380Z              return False
2026-01-25T08:57:21.8430783Z          return self.id == other.id
2026-01-25T08:57:21.8494341Z would reformat /home/runner/work/flask_blog/flask_blog/app/services/__init__.py
2026-01-25T08:57:21.8495500Z --- /home/runner/work/flask_blog/flask_blog/app/services/__init__.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.8496890Z +++ /home/runner/work/flask_blog/flask_blog/app/services/__init__.py	2026-01-25 08:57:21.846959+00:00
2026-01-25T08:57:21.8497730Z @@ -1,5 +1,6 @@
2026-01-25T08:57:21.8498365Z  """Сервисный слой приложения."""
2026-01-25T08:57:21.8498949Z +
2026-01-25T08:57:21.8515086Z  from .post_service import PostService
2026-01-25T08:57:21.8515714Z  from .comment_service import CommentService
2026-01-25T08:57:21.8516240Z  
2026-01-25T08:57:21.8516602Z -__all__ = ['PostService', 'CommentService']
2026-01-25T08:57:21.8517149Z +__all__ = ["PostService", "CommentService"]
2026-01-25T08:57:21.8544077Z would reformat /home/runner/work/flask_blog/flask_blog/app/auth/routes.py
2026-01-25T08:57:21.8545119Z --- /home/runner/work/flask_blog/flask_blog/app/auth/routes.py	2026-01-25 08:57:06.650994+00:00
2026-01-25T08:57:21.8547105Z +++ /home/runner/work/flask_blog/flask_blog/app/auth/routes.py	2026-01-25 08:57:21.844579+00:00
2026-01-25T08:57:21.8548185Z @@ -15,263 +15,276 @@
2026-01-25T08:57:21.8548739Z  """
2026-01-25T08:57:21.8549231Z  
2026-01-25T08:57:21.8549761Z  import sqlite3
2026-01-25T08:57:21.8550346Z  from typing import Optional, Tuple
2026-01-25T08:57:21.8550990Z  
2026-01-25T08:57:21.8551906Z -from flask import flash, g, redirect, render_template, request, session, url_for, current_app, make_response
2026-01-25T08:57:21.8553708Z +from flask import (
2026-01-25T08:57:21.8554275Z +    flash,
2026-01-25T08:57:21.8554785Z +    g,
2026-01-25T08:57:21.8555284Z +    redirect,
2026-01-25T08:57:21.8555872Z +    render_template,
2026-01-25T08:57:21.8556469Z +    request,
2026-01-25T08:57:21.8556975Z +    session,
2026-01-25T08:57:21.8557475Z +    url_for,
2026-01-25T08:57:21.8558035Z +    current_app,
2026-01-25T08:57:21.8558564Z +    make_response,
2026-01-25T08:57:21.8559149Z +)
2026-01-25T08:57:21.8559630Z  
2026-01-25T08:57:21.8560146Z  from app.auth import bp
2026-01-25T08:57:21.8561094Z  from app.auth.utils import generate_discriminator, hash_password, verify_password
2026-01-25T08:57:21.8562119Z  from app.db import get_db
2026-01-25T08:57:21.8562815Z  from app.forms import RegistrationForm, LoginForm
2026-01-25T08:57:21.8563819Z  
2026-01-25T08:57:21.8564706Z  # Константы для управления cookie
2026-01-25T08:57:21.8565397Z  COOKIE_DAYS = 30
2026-01-25T08:57:21.8565963Z  COOKIE_OPTIONS = {
2026-01-25T08:57:21.8566508Z -    'max_age': COOKIE_DAYS * 24 * 60 * 60,
2026-01-25T08:57:21.8567150Z -    'httponly': True,
2026-01-25T08:57:21.8567691Z -    'secure': True,
2026-01-25T08:57:21.8568279Z -    'samesite': 'Strict'
2026-01-25T08:57:21.8568937Z +    "max_age": COOKIE_DAYS * 24 * 60 * 60,
2026-01-25T08:57:21.8569523Z +    "httponly": True,
2026-01-25T08:57:21.8570027Z +    "secure": True,
2026-01-25T08:57:21.8570706Z +    "samesite": "Strict",
2026-01-25T08:57:21.8571294Z  }
2026-01-25T08:57:21.8571763Z  
2026-01-25T08:57:21.8572343Z  # Константы для валидации
2026-01-25T08:57:21.8573376Z -ADMIN_USERNAME = 'admin'
2026-01-25T08:57:21.8574064Z -DISCRIMINATOR_FORMAT = '{:04d}'
2026-01-25T08:57:21.8574655Z +ADMIN_USERNAME = "admin"
2026-01-25T08:57:21.8575241Z +DISCRIMINATOR_FORMAT = "{:04d}"
2026-01-25T08:57:21.8575926Z  
2026-01-25T08:57:21.8576350Z  
2026-01-25T08:57:21.8576899Z  def set_auth_cookie(response, username: str) -> None:
2026-01-25T08:57:21.8578100Z      """Устанавливает HttpOnly cookie с логином пользователя для автозаполнения.
2026-01-25T08:57:21.8581848Z -    
2026-01-25T08:57:21.8582150Z +
2026-01-25T08:57:21.8582709Z      Args:
2026-01-25T08:57:21.8583432Z          response: Flask response объект
2026-01-25T08:57:21.8584120Z          username: Полный логин пользователя (с дискриминатором или admin)
2026-01-25T08:57:21.8584598Z      """
2026-01-25T08:57:21.8585135Z -    response.set_cookie('last_username', username, **COOKIE_OPTIONS)
2026-01-25T08:57:21.8585899Z +    response.set_cookie("last_username", username, **COOKIE_OPTIONS)
2026-01-25T08:57:21.8586448Z  
2026-01-25T08:57:21.8586729Z  
2026-01-25T08:57:21.8587054Z  def create_user_session(user_id: int) -> None:
2026-01-25T08:57:21.8587697Z      """Создаёт безопасную сессию для пользователя.
2026-01-25T08:57:21.8588150Z -    
2026-01-25T08:57:21.8588436Z +
2026-01-25T08:57:21.8589009Z      Очищает предыдущие данные сессии и устанавливает новые.
2026-01-25T08:57:21.8589520Z -    
2026-01-25T08:57:21.8590135Z +
2026-01-25T08:57:21.8590470Z      Args:
2026-01-25T08:57:21.8590921Z          user_id: ID пользователя из базы данных
2026-01-25T08:57:21.8591389Z      """
2026-01-25T08:57:21.8591697Z      session.clear()
2026-01-25T08:57:21.8592056Z -    session['user_id'] = user_id
2026-01-25T08:57:21.8592469Z +    session["user_id"] = user_id
2026-01-25T08:57:21.8593142Z      session.permanent = True
2026-01-25T08:57:21.8593534Z  
2026-01-25T08:57:21.8593787Z  
2026-01-25T08:57:21.8594238Z  def format_full_username(username: str, discriminator: int) -> str:
2026-01-25T08:57:21.8594980Z      """Форматирует полный логин с дискриминатором.
2026-01-25T08:57:21.8595446Z -    
2026-01-25T08:57:21.8595766Z +
2026-01-25T08:57:21.8596041Z      Args:
2026-01-25T08:57:21.8596451Z          username: Базовое имя пользователя
2026-01-25T08:57:21.8597085Z          discriminator: Числовой дискриминатор (0 для admin)
2026-01-25T08:57:21.8597591Z -        
2026-01-25T08:57:21.8597886Z +
2026-01-25T08:57:21.8598185Z      Returns:
2026-01-25T08:57:21.8598779Z          Полный логин в формате username#0000 или просто username для admin
2026-01-25T08:57:21.8599365Z      """
2026-01-25T08:57:21.8600117Z -    return f"{username}#{DISCRIMINATOR_FORMAT.format(discriminator)}" if discriminator > 0 else username
2026-01-25T08:57:21.8600920Z +    return (
2026-01-25T08:57:21.8601360Z +        f"{username}#{DISCRIMINATOR_FORMAT.format(discriminator)}"
2026-01-25T08:57:21.8601934Z +        if discriminator > 0
2026-01-25T08:57:21.8602318Z +        else username
2026-01-25T08:57:21.8602628Z +    )
2026-01-25T08:57:21.8603090Z  
2026-01-25T08:57:21.8603337Z  
2026-01-25T08:57:21.8603704Z  def get_prefilled_usernames() -> Tuple[str, str]:
2026-01-25T08:57:21.8604385Z      """Извлекает логины из cookie для автозаполнения формы.
2026-01-25T08:57:21.8604831Z -    
2026-01-25T08:57:21.8605120Z +
2026-01-25T08:57:21.8605565Z      Возвращает кортеж из двух значений:
2026-01-25T08:57:21.8606111Z      - Полный логин (user#1234) для скрытого поля
2026-01-25T08:57:21.8606735Z      - Базовый логин (user) для видимого поля ввода
2026-01-25T08:57:21.8607171Z -    
2026-01-25T08:57:21.8607444Z +
2026-01-25T08:57:21.8607999Z      Returns:
2026-01-25T08:57:21.8608572Z          Tuple[full_username, base_username]: Полный и базовый логины
2026-01-25T08:57:21.8609128Z      """
2026-01-25T08:57:21.8609625Z -    prefilled_username = request.cookies.get('last_username', '')
2026-01-25T08:57:21.8610552Z -    prefilled_base_username = prefilled_username.split('#')[0] if prefilled_username else ''
2026-01-25T08:57:21.8611475Z +    prefilled_username = request.cookies.get("last_username", "")
2026-01-25T08:57:21.8612076Z +    prefilled_base_username = (
2026-01-25T08:57:21.8612733Z +        prefilled_username.split("#")[0] if prefilled_username else ""
2026-01-25T08:57:21.8613543Z +    )
2026-01-25T08:57:21.8613934Z      return prefilled_username, prefilled_base_username
2026-01-25T08:57:21.8614431Z  
2026-01-25T08:57:21.8614713Z  
2026-01-25T08:57:21.8615243Z  def authenticate_admin(password: str) -> Tuple[Optional[dict], Optional[str]]:
2026-01-25T08:57:21.8616069Z      """Аутентифицирует admin пользователя.
2026-01-25T08:57:21.8616525Z -    
2026-01-25T08:57:21.8616855Z +
2026-01-25T08:57:21.8617182Z      Особенности:
2026-01-25T08:57:21.8617683Z      - Admin может входить без дискриминатора
2026-01-25T08:57:21.8618305Z      - Если admin отсутствует в БД, создаётся автоматически
2026-01-25T08:57:21.8618983Z      - Пароль проверяется через конфигурацию приложения
2026-01-25T08:57:21.8619430Z -    
2026-01-25T08:57:21.8619734Z +
2026-01-25T08:57:21.8619995Z      Args:
2026-01-25T08:57:21.8620418Z          password: Пароль для проверки
2026-01-25T08:57:21.8620828Z -        
2026-01-25T08:57:21.8621096Z +
2026-01-25T08:57:21.8621380Z      Returns:
2026-01-25T08:57:21.8622114Z          Tuple[user_dict, error_message]: Данные пользователя или None, сообщение об ошибке или None
2026-01-25T08:57:21.8622793Z      """
2026-01-25T08:57:21.8623438Z -    if password != current_app.config['ADMIN_PASSWORD']:
2026-01-25T08:57:21.8624361Z -        return None, 'Неверный пароль для admin'
2026-01-25T08:57:21.8624790Z -    
2026-01-25T08:57:21.8625186Z +    if password != current_app.config["ADMIN_PASSWORD"]:
2026-01-25T08:57:21.8625820Z +        return None, "Неверный пароль для admin"
2026-01-25T08:57:21.8626250Z +
2026-01-25T08:57:21.8626529Z      db = get_db()
2026-01-25T08:57:21.8626879Z      admin_user = db.execute(
2026-01-25T08:57:21.8627377Z -        'SELECT * FROM user WHERE username = ?', (ADMIN_USERNAME,)
2026-01-25T08:57:21.8628036Z +        "SELECT * FROM user WHERE username = ?", (ADMIN_USERNAME,)
2026-01-25T08:57:21.8628562Z      ).fetchone()
2026-01-25T08:57:21.8628839Z -    
2026-01-25T08:57:21.8629071Z +
2026-01-25T08:57:21.8629418Z      # Создаём admin пользователя если его нет
2026-01-25T08:57:21.8629851Z      if admin_user is None:
2026-01-25T08:57:21.8630281Z          hashed_pw, salt = hash_password(password)
2026-01-25T08:57:21.8630768Z          cursor = db.execute(
2026-01-25T08:57:21.8631441Z              "INSERT INTO user (username, password, discriminator, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:21.8632162Z              (ADMIN_USERNAME, hashed_pw, 0, salt),
2026-01-25T08:57:21.8632603Z          )
2026-01-25T08:57:21.8633120Z          db.commit()
2026-01-25T08:57:21.8633506Z          admin_user = db.execute(
2026-01-25T08:57:21.8634077Z -            'SELECT * FROM user WHERE username = ?', (ADMIN_USERNAME,)
2026-01-25T08:57:21.8634782Z +            "SELECT * FROM user WHERE username = ?", (ADMIN_USERNAME,)
2026-01-25T08:57:21.8635333Z          ).fetchone()
2026-01-25T08:57:21.8635662Z -    
2026-01-25T08:57:21.8635933Z +
2026-01-25T08:57:21.8636306Z      return admin_user, None
2026-01-25T08:57:21.8636682Z  
2026-01-25T08:57:21.8636965Z  
2026-01-25T08:57:21.8637613Z -def authenticate_user(username_to_check: str, password: str) -> Tuple[Optional[dict], Optional[str]]:
2026-01-25T08:57:21.8638457Z +def authenticate_user(
2026-01-25T08:57:21.8638863Z +    username_to_check: str, password: str
2026-01-25T08:57:21.8639370Z +) -> Tuple[Optional[dict], Optional[str]]:
2026-01-25T08:57:21.8640293Z      """Аутентифицирует обычного пользователя по логину с дискриминатором.
2026-01-25T08:57:21.8640838Z -    
2026-01-25T08:57:21.8641122Z +
2026-01-25T08:57:21.8641676Z      Проверяет формат логина username#0000 и ищет соответствующую запись в БД.
2026-01-25T08:57:21.8642222Z -    
2026-01-25T08:57:21.8642491Z +
2026-01-25T08:57:21.8642763Z      Args:
2026-01-25T08:57:21.8643435Z          username_to_check: Логин в формате username#0000
2026-01-25T08:57:21.8644079Z          password: Пароль для проверки
2026-01-25T08:57:21.8644535Z -        
2026-01-25T08:57:21.8644818Z +
2026-01-25T08:57:21.8645092Z      Returns:
2026-01-25T08:57:21.8645816Z          Tuple[user_dict, error_message]: Данные пользователя или None, сообщение об ошибке или None
2026-01-25T08:57:21.8646492Z      """
2026-01-25T08:57:21.8646819Z      if "#" not in username_to_check:
2026-01-25T08:57:21.8647375Z -        return None, 'Неверный формат логина'
2026-01-25T08:57:21.8647849Z -    
2026-01-25T08:57:21.8648282Z +        return None, "Неверный формат логина"
2026-01-25T08:57:21.8648737Z +
2026-01-25T08:57:21.8649044Z      try:
2026-01-25T08:57:21.8649478Z          username, tag_str = username_to_check.rsplit("#", 1)
2026-01-25T08:57:21.8650009Z          tag = int(tag_str)
2026-01-25T08:57:21.8650437Z      except (ValueError, IndexError):
2026-01-25T08:57:21.8651013Z -        return None, 'Неверный формат логина'
2026-01-25T08:57:21.8651445Z -    
2026-01-25T08:57:21.8651891Z +        return None, "Неверный формат логина"
2026-01-25T08:57:21.8652317Z +
2026-01-25T08:57:21.8652604Z      db = get_db()
2026-01-25T08:57:21.8653150Z      user = db.execute(
2026-01-25T08:57:21.8653644Z -        'SELECT * FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:21.8654186Z -        (username, tag)
2026-01-25T08:57:21.8654751Z +        "SELECT * FROM user WHERE username = ? AND discriminator = ?", (username, tag)
2026-01-25T08:57:21.8655617Z      ).fetchone()
2026-01-25T08:57:21.8655928Z -    
2026-01-25T08:57:21.8656197Z +
2026-01-25T08:57:21.8656477Z      if user is None:
2026-01-25T08:57:21.8656994Z -        return None, 'Неверный логин или пароль'
2026-01-25T08:57:21.8657428Z -    
2026-01-25T08:57:21.8657912Z -    if not verify_password(user['password'], password, user['salt']):
2026-01-25T08:57:21.8658652Z -        return None, 'Неверный логин или пароль'
2026-01-25T08:57:21.8659109Z -    
2026-01-25T08:57:21.8659525Z +        return None, "Неверный логин или пароль"
2026-01-25T08:57:21.8659963Z +
2026-01-25T08:57:21.8660412Z +    if not verify_password(user["password"], password, user["salt"]):
2026-01-25T08:57:21.8661145Z +        return None, "Неверный логин или пароль"
2026-01-25T08:57:21.8661586Z +
2026-01-25T08:57:21.8661978Z      return user, None
2026-01-25T08:57:21.8662344Z  
2026-01-25T08:57:21.8662653Z  
2026-01-25T08:57:21.8663232Z -@bp.route('/register', methods=('GET', 'POST'))
2026-01-25T08:57:21.8663805Z +@bp.route("/register", methods=("GET", "POST"))
2026-01-25T08:57:21.8664347Z  def register():
2026-01-25T08:57:21.8664985Z      """Регистрация нового пользователя с автоматической генерацией дискриминатора.
2026-01-25T08:57:21.8665554Z -    
2026-01-25T08:57:21.8665834Z +
2026-01-25T08:57:21.8666190Z      Процесс регистрации:
2026-01-25T08:57:21.8666669Z      1. Валидация формы (username, пароль)
2026-01-25T08:57:21.8667210Z      2. Проверка зарезервированных имён
2026-01-25T08:57:21.8667749Z      3. Генерация уникального дискриминатора
2026-01-25T08:57:21.8668304Z      4. Создание записи в БД с хэшированным паролем
2026-01-25T08:57:21.8668917Z      5. Автоматический вход и перенаправление
2026-01-25T08:57:21.8669389Z -    
2026-01-25T08:57:21.8669679Z +
2026-01-25T08:57:21.8669942Z      Returns:
2026-01-25T08:57:21.8670457Z          HTML страница регистрации или перенаправление на главную
2026-01-25T08:57:21.8670949Z      """
2026-01-25T08:57:21.8671282Z      form = RegistrationForm(request.form)
2026-01-25T08:57:21.8671767Z -    
2026-01-25T08:57:21.8672151Z -    if request.method == 'POST' and form.validate():
2026-01-25T08:57:21.8672630Z +
2026-01-25T08:57:21.8673438Z +    if request.method == "POST" and form.validate():
2026-01-25T08:57:21.8674144Z          username, password, validation_error = _extract_form_data(form)
2026-01-25T08:57:21.8674752Z -        
2026-01-25T08:57:21.8675089Z +
2026-01-25T08:57:21.8675478Z          if validation_error:
2026-01-25T08:57:21.8675911Z -            flash(validation_error, 'danger')
2026-01-25T08:57:21.8676500Z -            return render_template('auth/register.html', form=form)
2026-01-25T08:57:21.8677031Z -        
2026-01-25T08:57:21.8677369Z +            flash(validation_error, "danger")
2026-01-25T08:57:21.8677969Z +            return render_template("auth/register.html", form=form)
2026-01-25T08:57:21.8678472Z +
2026-01-25T08:57:21.8678936Z          registration_result = _process_registration(username, password)
2026-01-25T08:57:21.8679518Z -        
2026-01-25T08:57:21.8680138Z -        if 'error' in registration_result:
2026-01-25T08:57:21.8680651Z -            flash(registration_result['error'], 'danger')
2026-01-25T08:57:21.8681138Z +
2026-01-25T08:57:21.8681434Z +        if "error" in registration_result:
2026-01-25T08:57:21.8681934Z +            flash(registration_result["error"], "danger")
2026-01-25T08:57:21.8682409Z          else:
2026-01-25T08:57:21.8683049Z              # Успешная регистрация с автоматическим входом
2026-01-25T08:57:21.8683579Z -            return registration_result['response']
2026-01-25T08:57:21.8684041Z -    
2026-01-25T08:57:21.8684399Z +            return registration_result["response"]
2026-01-25T08:57:21.8684853Z +
2026-01-25T08:57:21.8685250Z      # Отображение ошибок валидации формы
2026-01-25T08:57:21.8685700Z -    elif request.method == 'POST':
2026-01-25T08:57:21.8686150Z +    elif request.method == "POST":
2026-01-25T08:57:21.8686589Z          _display_form_errors(form)
2026-01-25T08:57:21.8686977Z -    
2026-01-25T08:57:21.8687413Z -    return render_template('auth/register.html', form=form)
2026-01-25T08:57:21.8687933Z +
2026-01-25T08:57:21.8688348Z +    return render_template("auth/register.html", form=form)
2026-01-25T08:57:21.8688853Z  
2026-01-25T08:57:21.8689122Z  
2026-01-25T08:57:21.8689646Z  def _extract_form_data(form: RegistrationForm) -> Tuple[str, str, Optional[str]]:
2026-01-25T08:57:21.8690500Z      """Извлекает и валидирует данные из формы регистрации.
2026-01-25T08:57:21.8690963Z -    
2026-01-25T08:57:21.8691237Z +
2026-01-25T08:57:21.8691508Z      Args:
2026-01-25T08:57:21.8691905Z          form: Объект формы регистрации
2026-01-25T08:57:21.8692311Z -        
2026-01-25T08:57:21.8692588Z +
2026-01-25T08:57:21.8692854Z      Returns:
2026-01-25T08:57:21.8693686Z          Tuple[username, password, error]: Данные формы и ошибка валидации
2026-01-25T08:57:21.8694255Z      """
2026-01-25T08:57:21.8694601Z      username = form.username.data.strip()
2026-01-25T08:57:21.8695084Z      password = form.password.data
2026-01-25T08:57:21.8695647Z -    
2026-01-25T08:57:21.8695924Z +
2026-01-25T08:57:21.8696312Z      # Проверка зарезервированного имени
2026-01-25T08:57:21.8696987Z      if username.lower() == ADMIN_USERNAME:
2026-01-25T08:57:21.8697812Z -        return username, password, f'Имя {ADMIN_USERNAME} зарезервировано системой'
2026-01-25T08:57:21.8698441Z -    
2026-01-25T08:57:21.8699096Z +        return username, password, f"Имя {ADMIN_USERNAME} зарезервировано системой"
2026-01-25T08:57:21.8699713Z +
2026-01-25T08:57:21.8700020Z      return username, password, None
2026-01-25T08:57:21.8700454Z  
2026-01-25T08:57:21.8700717Z  
2026-01-25T08:57:21.8701159Z  def _process_registration(username: str, password: str) -> dict:
2026-01-25T08:57:21.8701873Z      """Обрабатывает процесс регистрации пользователя.
2026-01-25T08:57:21.8702321Z -    
2026-01-25T08:57:21.8702597Z +
2026-01-25T08:57:21.8702866Z      Args:
2026-01-25T08:57:21.8703440Z          username: Имя пользователя
2026-01-25T08:57:21.8703946Z          password: Пароль
2026-01-25T08:57:21.8704334Z -        
2026-01-25T08:57:21.8704609Z +
2026-01-25T08:57:21.8704875Z      Returns:
2026-01-25T08:57:21.8705365Z          dict: Результат регистрации с error или response
2026-01-25T08:57:21.8705836Z      """
2026-01-25T08:57:21.8706122Z      db = get_db()
2026-01-25T08:57:21.8706431Z -    
2026-01-25T08:57:21.8706692Z +
2026-01-25T08:57:21.8707075Z      # Генерация уникального дискриминатора
2026-01-25T08:57:21.8707630Z      new_discriminator = generate_discriminator(db, username)
2026-01-25T08:57:21.8708144Z -    
2026-01-25T08:57:21.8708416Z +
2026-01-25T08:57:21.8708715Z      if new_discriminator is None:
2026-01-25T08:57:21.8709133Z -        return {
2026-01-25T08:57:21.8709803Z -            'error': f"К сожалению, имя {username} перегружено. Попробуйте другое."
2026-01-25T08:57:21.8710366Z -        }
2026-01-25T08:57:21.8710655Z -    
2026-01-25T08:57:21.8711242Z +        return {"error": f"К сожалению, имя {username} перегружено. Попробуйте другое."}
2026-01-25T08:57:21.8712067Z +
2026-01-25T08:57:21.8712411Z      try:
2026-01-25T08:57:21.8712808Z          # Создание пользователя в БД
2026-01-25T08:57:21.8713607Z          user_id = _create_user_in_db(db, username, password, new_discriminator)
2026-01-25T08:57:21.8714222Z -        
2026-01-25T08:57:21.8714503Z +
2026-01-25T08:57:21.8714873Z          # Автоматический вход
2026-01-25T08:57:21.8715273Z          create_user_session(user_id)
2026-01-25T08:57:21.8715669Z -        
2026-01-25T08:57:21.8715942Z +
2026-01-25T08:57:21.8716359Z          # Создание ответа с cookie для автозаполнения
2026-01-25T08:57:21.8716937Z          response = make_response(redirect(url_for("main.index")))
2026-01-25T08:57:21.8717666Z          full_username = format_full_username(username, new_discriminator)
2026-01-25T08:57:21.8718319Z          set_auth_cookie(response, full_username)
2026-01-25T08:57:21.8718786Z -        
2026-01-25T08:57:21.8719323Z -        flash(f'Добро пожаловать {full_username}!', 'success')
2026-01-25T08:57:21.8719816Z -        
2026-01-25T08:57:21.8720160Z -        return {'response': response}
2026-01-25T08:57:21.8720568Z -        
2026-01-25T08:57:21.8720846Z +
2026-01-25T08:57:21.8721364Z +        flash(f"Добро пожаловать {full_username}!", "success")
2026-01-25T08:57:21.8721839Z +
2026-01-25T08:57:21.8722141Z +        return {"response": response}
2026-01-25T08:57:21.8722548Z +
2026-01-25T08:57:21.8722865Z      except sqlite3.IntegrityError:
2026-01-25T08:57:21.8723466Z -        return {
2026-01-25T08:57:21.8724011Z -            'error': "Ошибка при регистрации. Возможно, имя занято."
2026-01-25T08:57:21.8724507Z -        }
2026-01-25T08:57:21.8725063Z +        return {"error": "Ошибка при регистрации. Возможно, имя занято."}
2026-01-25T08:57:21.8725576Z  
2026-01-25T08:57:21.8725829Z  
2026-01-25T08:57:21.8726340Z  def _create_user_in_db(db, username: str, password: str, discriminator: int) -> int:
2026-01-25T08:57:21.8727137Z      """Создаёт запись пользователя в базе данных.
2026-01-25T08:57:21.8727550Z -    
2026-01-25T08:57:21.8727827Z +
2026-01-25T08:57:21.8728082Z      Args:
2026-01-25T08:57:21.8728429Z          db: Объект подключения к БД
2026-01-25T08:57:21.8729108Z          username: Имя пользователя
2026-01-25T08:57:21.8729621Z          password: Пароль
2026-01-25T08:57:21.8730069Z          discriminator: Дискриминатор
2026-01-25T08:57:21.8730605Z -        
2026-01-25T08:57:21.8730936Z +
2026-01-25T08:57:21.8731195Z      Returns:
2026-01-25T08:57:21.8731569Z          int: ID созданного пользователя
2026-01-25T08:57:21.8731967Z      """
2026-01-25T08:57:21.8732293Z      hashed_pw, salt = hash_password(password)
2026-01-25T08:57:21.8732729Z      cursor = db.execute(
2026-01-25T08:57:21.8733381Z @@ -282,170 +295,180 @@
2026-01-25T08:57:21.8733704Z      return cursor.lastrowid
2026-01-25T08:57:21.8734036Z  
2026-01-25T08:57:21.8734287Z  
2026-01-25T08:57:21.8734696Z  def _display_form_errors(form: RegistrationForm) -> None:
2026-01-25T08:57:21.8735401Z      """Отображает ошибки валидации формы.
2026-01-25T08:57:21.8736129Z -    
2026-01-25T08:57:21.8736437Z +
2026-01-25T08:57:21.8736712Z      Args:
2026-01-25T08:57:21.8737121Z          form: Объект формы с ошибками
2026-01-25T08:57:21.8737712Z      """
2026-01-25T08:57:21.8738117Z      for field_name, field_errors in form.errors.items():
2026-01-25T08:57:21.8738667Z          for error in field_errors:
2026-01-25T08:57:21.8739106Z -            flash(error, 'danger')
2026-01-25T08:57:21.8739507Z -
2026-01-25T08:57:21.8739771Z -
2026-01-25T08:57:21.8740144Z -@bp.route('/login', methods=('GET', 'POST'))
2026-01-25T08:57:21.8740637Z +            flash(error, "danger")
2026-01-25T08:57:21.8741028Z +
2026-01-25T08:57:21.8741297Z +
2026-01-25T08:57:21.8741642Z +@bp.route("/login", methods=("GET", "POST"))
2026-01-25T08:57:21.8742130Z  def login():
2026-01-25T08:57:21.8742657Z      """Вход пользователя с поддержкой дискриминаторов.
2026-01-25T08:57:21.8743389Z -    
2026-01-25T08:57:21.8743679Z +
2026-01-25T08:57:21.8744027Z      Форматы входа:
2026-01-25T08:57:21.8744504Z      - Username#0000: для обычных пользователей
2026-01-25T08:57:21.8745176Z      - admin: для администратора (без дискриминатора)
2026-01-25T08:57:21.8745659Z -    
2026-01-25T08:57:21.8745941Z +
2026-01-25T08:57:21.8746279Z      Особенности:
2026-01-25T08:57:21.8746669Z      - Автозаполнение из cookie
2026-01-25T08:57:21.8747169Z      - Приоритет скрытого поля с полным логином
2026-01-25T08:57:21.8747779Z      - Сохранение последнего успешного логина в cookie
2026-01-25T08:57:21.8748261Z -    
2026-01-25T08:57:21.8748536Z +
2026-01-25T08:57:21.8748810Z      Returns:
2026-01-25T08:57:21.8749311Z          HTML страница входа или перенаправление на главную
2026-01-25T08:57:21.8749789Z      """
2026-01-25T08:57:21.8750327Z      prefilled_username, prefilled_base_username = get_prefilled_usernames()
2026-01-25T08:57:21.8751027Z      form = LoginForm(request.form)
2026-01-25T08:57:21.8751426Z -    
2026-01-25T08:57:21.8751811Z -    if request.method == 'POST' and form.validate():
2026-01-25T08:57:21.8752299Z +
2026-01-25T08:57:21.8752699Z +    if request.method == "POST" and form.validate():
2026-01-25T08:57:21.8753447Z          login_result = _process_login_attempt()
2026-01-25T08:57:21.8754167Z -        
2026-01-25T08:57:21.8754500Z -        if login_result['success']:
2026-01-25T08:57:21.8754967Z -            return login_result['response']
2026-01-25T08:57:21.8755408Z +
2026-01-25T08:57:21.8755724Z +        if login_result["success"]:
2026-01-25T08:57:21.8756190Z +            return login_result["response"]
2026-01-25T08:57:21.8756631Z          else:
2026-01-25T08:57:21.8756995Z -            flash(login_result['error'], 'danger')
2026-01-25T08:57:21.8757448Z -    
2026-01-25T08:57:21.8757796Z +            flash(login_result["error"], "danger")
2026-01-25T08:57:21.8758227Z +
2026-01-25T08:57:21.8758636Z      # Отображение ошибок валидации формы
2026-01-25T08:57:21.8759100Z -    elif request.method == 'POST':
2026-01-25T08:57:21.8759549Z +    elif request.method == "POST":
2026-01-25T08:57:21.8759974Z          _display_form_errors(form)
2026-01-25T08:57:21.8760392Z -    
2026-01-25T08:57:21.8760677Z +
2026-01-25T08:57:21.8760969Z      return render_template(
2026-01-25T08:57:21.8761392Z -        'auth/login.html', 
2026-01-25T08:57:21.8761782Z -        form=form, 
2026-01-25T08:57:21.8762179Z -        prefilled_username=prefilled_username, 
2026-01-25T08:57:21.8762749Z -        prefilled_base_username=prefilled_base_username
2026-01-25T08:57:21.8763513Z +        "auth/login.html",
2026-01-25T08:57:21.8763918Z +        form=form,
2026-01-25T08:57:21.8764298Z +        prefilled_username=prefilled_username,
2026-01-25T08:57:21.8764918Z +        prefilled_base_username=prefilled_base_username,
2026-01-25T08:57:21.8765451Z      )
2026-01-25T08:57:21.8765752Z  
2026-01-25T08:57:21.8766059Z  
2026-01-25T08:57:21.8766385Z  def _process_login_attempt() -> dict:
2026-01-25T08:57:21.8766970Z      """Обрабатывает попытку входа пользователя.
2026-01-25T08:57:21.8767407Z -    
2026-01-25T08:57:21.8767683Z +
2026-01-25T08:57:21.8767954Z      Returns:
2026-01-25T08:57:21.8768715Z          dict: Результат входа с success/response или error
2026-01-25T08:57:21.8769205Z      """
2026-01-25T08:57:21.8769586Z      # Извлечение данных формы
2026-01-25T08:57:21.8770081Z -    raw_username = request.form.get('username', '').strip()
2026-01-25T08:57:21.8770816Z -    full_username_hidden = request.form.get('full_username', '').strip()
2026-01-25T08:57:21.8771501Z -    password = request.form.get('password', '')
2026-01-25T08:57:21.8771978Z -    
2026-01-25T08:57:21.8772381Z +    raw_username = request.form.get("username", "").strip()
2026-01-25T08:57:21.8773267Z +    full_username_hidden = request.form.get("full_username", "").strip()
2026-01-25T08:57:21.8773946Z +    password = request.form.get("password", "")
2026-01-25T08:57:21.8774410Z +
2026-01-25T08:57:21.8774906Z      # Определение логина для проверки (приоритет скрытому полю)
2026-01-25T08:57:21.8775679Z -    username_to_check = _determine_username_for_check(raw_username, full_username_hidden)
2026-01-25T08:57:21.8776394Z -    
2026-01-25T08:57:21.8776775Z +    username_to_check = _determine_username_for_check(
2026-01-25T08:57:21.8777319Z +        raw_username, full_username_hidden
2026-01-25T08:57:21.8777750Z +    )
2026-01-25T08:57:21.8778024Z +
2026-01-25T08:57:21.8778403Z      # Обработка входа admin
2026-01-25T08:57:21.8778871Z      if username_to_check.lower() == ADMIN_USERNAME:
2026-01-25T08:57:21.8779411Z          return _handle_admin_login(password)
2026-01-25T08:57:21.8779848Z -    
2026-01-25T08:57:21.8780121Z +
2026-01-25T08:57:21.8780526Z      # Обработка входа обычного пользователя
2026-01-25T08:57:21.8781073Z      return _handle_user_login(username_to_check, password)
2026-01-25T08:57:21.8781570Z  
2026-01-25T08:57:21.8781832Z  
2026-01-25T08:57:21.8782388Z  def _determine_username_for_check(raw_username: str, full_username_hidden: str) -> str:
2026-01-25T08:57:21.8783476Z      """Определяет какой логин использовать для аутентификации.
2026-01-25T08:57:21.8783960Z -    
2026-01-25T08:57:21.8784258Z +
2026-01-25T08:57:21.8784706Z      Приоритет: скрытое поле с полным логином > видимое поле
2026-01-25T08:57:21.8785176Z -    
2026-01-25T08:57:21.8785677Z +
2026-01-25T08:57:21.8785989Z      Args:
2026-01-25T08:57:21.8786432Z          raw_username: Логин из видимого поля
2026-01-25T08:57:21.8787041Z          full_username_hidden: Логин из скрытого поля
2026-01-25T08:57:21.8787511Z -        
2026-01-25T08:57:21.8787790Z +
2026-01-25T08:57:21.8788059Z      Returns:
2026-01-25T08:57:21.8788460Z          str: Логин для проверки
2026-01-25T08:57:21.8788858Z      """
2026-01-25T08:57:21.8789522Z -    return full_username_hidden if full_username_hidden and '#' in full_username_hidden else raw_username
2026-01-25T08:57:21.8790314Z +    return (
2026-01-25T08:57:21.8790637Z +        full_username_hidden
2026-01-25T08:57:21.8791138Z +        if full_username_hidden and "#" in full_username_hidden
2026-01-25T08:57:21.8791681Z +        else raw_username
2026-01-25T08:57:21.8792035Z +    )
2026-01-25T08:57:21.8792318Z  
2026-01-25T08:57:21.8792594Z  
2026-01-25T08:57:21.8793123Z  def _handle_admin_login(password: str) -> dict:
2026-01-25T08:57:21.8793759Z      """Обрабатывает вход admin пользователя.
2026-01-25T08:57:21.8794177Z -    
2026-01-25T08:57:21.8794446Z +
2026-01-25T08:57:21.8794711Z      Args:
2026-01-25T08:57:21.8795116Z          password: Пароль для проверки
2026-01-25T08:57:21.8795533Z -        
2026-01-25T08:57:21.8795810Z +
2026-01-25T08:57:21.8796082Z      Returns:
2026-01-25T08:57:21.8796483Z          dict: Результат входа
2026-01-25T08:57:21.8796847Z      """
2026-01-25T08:57:21.8797236Z      admin_user, error = authenticate_admin(password)
2026-01-25T08:57:21.8797711Z -    
2026-01-25T08:57:21.8797983Z +
2026-01-25T08:57:21.8798260Z      if admin_user:
2026-01-25T08:57:21.8798681Z -        create_user_session(admin_user['id'])
2026-01-25T08:57:21.8799132Z -        
2026-01-25T08:57:21.8799567Z -        response = make_response(redirect(url_for('main.index')))
2026-01-25T08:57:21.8800170Z +        create_user_session(admin_user["id"])
2026-01-25T08:57:21.8800886Z +
2026-01-25T08:57:21.8801336Z +        response = make_response(redirect(url_for("main.index")))
2026-01-25T08:57:21.8802022Z          set_auth_cookie(response, ADMIN_USERNAME)
2026-01-25T08:57:21.8802693Z -        flash('Добро пожаловать, admin!', 'success')
2026-01-25T08:57:21.8803396Z -        
2026-01-25T08:57:21.8803776Z -        return {'success': True, 'response': response}
2026-01-25T08:57:21.8804254Z -    
2026-01-25T08:57:21.8804584Z -    return {'success': False, 'error': error}
2026-01-25T08:57:21.8805212Z +        flash("Добро пожаловать, admin!", "success")
2026-01-25T08:57:21.8805665Z +
2026-01-25T08:57:21.8806016Z +        return {"success": True, "response": response}
2026-01-25T08:57:21.8806491Z +
2026-01-25T08:57:21.8806823Z +    return {"success": False, "error": error}
2026-01-25T08:57:21.8807260Z  
2026-01-25T08:57:21.8807519Z  
2026-01-25T08:57:21.8807951Z  def _handle_user_login(username: str, password: str) -> dict:
2026-01-25T08:57:21.8808666Z      """Обрабатывает вход обычного пользователя.
2026-01-25T08:57:21.8809105Z -    
2026-01-25T08:57:21.8809402Z +
2026-01-25T08:57:21.8809688Z      Args:
2026-01-25T08:57:21.8810090Z          username: Логин с дискриминатором
2026-01-25T08:57:21.8810599Z          password: Пароль
2026-01-25T08:57:21.8810953Z -        
2026-01-25T08:57:21.8811230Z +
2026-01-25T08:57:21.8811520Z      Returns:
2026-01-25T08:57:21.8811927Z          dict: Результат входа
2026-01-25T08:57:21.8812372Z      """
2026-01-25T08:57:21.8812780Z      user, error = authenticate_user(username, password)
2026-01-25T08:57:21.8813479Z -    
2026-01-25T08:57:21.8813756Z +
2026-01-25T08:57:21.8814040Z      if user:
2026-01-25T08:57:21.8814388Z -        create_user_session(user['id'])
2026-01-25T08:57:21.8814799Z -        
2026-01-25T08:57:21.8815349Z -        full_username = format_full_username(user['username'], user['discriminator'])
2026-01-25T08:57:21.8815628Z -        response = make_response(redirect(url_for('main.index')))
2026-01-25T08:57:21.8815811Z +        create_user_session(user["id"])
2026-01-25T08:57:21.8815958Z +
2026-01-25T08:57:21.8816542Z +        full_username = format_full_username(user["username"], user["discriminator"])
2026-01-25T08:57:21.8816820Z +        response = make_response(redirect(url_for("main.index")))
2026-01-25T08:57:21.8817011Z          set_auth_cookie(response, full_username)
2026-01-25T08:57:21.8817137Z -        
2026-01-25T08:57:21.8817344Z -        return {'success': True, 'response': response}
2026-01-25T08:57:21.8817459Z -    
2026-01-25T08:57:21.8817668Z -    return {'success': False, 'error': error}
2026-01-25T08:57:21.8817791Z +
2026-01-25T08:57:21.8818002Z +        return {"success": True, "response": response}
2026-01-25T08:57:21.8818117Z +
2026-01-25T08:57:21.8818291Z +    return {"success": False, "error": error}
2026-01-25T08:57:21.8818410Z  
2026-01-25T08:57:21.8818522Z  
2026-01-25T08:57:21.8818670Z  @bp.before_app_request
2026-01-25T08:57:21.8818819Z  def load_logged_in_user():
2026-01-25T08:57:21.8819148Z      """Загружает текущего пользователя в контекст запроса.
2026-01-25T08:57:21.8819265Z -    
2026-01-25T08:57:21.8819396Z +
2026-01-25T08:57:21.8819670Z      Выполняется перед каждым запросом к приложению.
2026-01-25T08:57:21.8820086Z      g.user доступен во view-функциях и шаблонах в рамках одного запроса.
2026-01-25T08:57:21.8820226Z -    
2026-01-25T08:57:21.8820337Z +
2026-01-25T08:57:21.8820466Z      Returns:
2026-01-25T08:57:21.8820584Z          None
2026-01-25T08:57:21.8820699Z      """
2026-01-25T08:57:21.8820870Z -    user_id = session.get('user_id')
2026-01-25T08:57:21.8820985Z -    
2026-01-25T08:57:21.8821142Z +    user_id = session.get("user_id")
2026-01-25T08:57:21.8821261Z +
2026-01-25T08:57:21.8821400Z      if user_id is None:
2026-01-25T08:57:21.8821532Z          g.user = None
2026-01-25T08:57:21.8821663Z      else:
2026-01-25T08:57:21.8822048Z          # Используем sqlite3.Row для доступа к полям как к словарю
2026-01-25T08:57:21.8822213Z -        g.user = get_db().execute(
2026-01-25T08:57:21.8822774Z -            'SELECT id, username, discriminator FROM user WHERE id = ?', (user_id,)
2026-01-25T08:57:21.8823112Z -        ).fetchone()
2026-01-25T08:57:21.8823260Z -
2026-01-25T08:57:21.8823377Z -
2026-01-25T08:57:21.8823515Z -@bp.route('/logout')
2026-01-25T08:57:21.8823652Z +        g.user = (
2026-01-25T08:57:21.8823779Z +            get_db()
2026-01-25T08:57:21.8823916Z +            .execute(
2026-01-25T08:57:21.8824261Z +                "SELECT id, username, discriminator FROM user WHERE id = ?", (user_id,)
2026-01-25T08:57:21.8824386Z +            )
2026-01-25T08:57:21.8824517Z +            .fetchone()
2026-01-25T08:57:21.8824644Z +        )
2026-01-25T08:57:21.8824757Z +
2026-01-25T08:57:21.8824878Z +
2026-01-25T08:57:21.8825017Z +@bp.route("/logout")
2026-01-25T08:57:21.8825146Z  def logout():
2026-01-25T08:57:21.8825402Z      """Выход пользователя из системы.
2026-01-25T08:57:21.8825519Z -    
2026-01-25T08:57:21.8825634Z +
2026-01-25T08:57:21.8826012Z      Очищает сессию пользователя и перенаправляет на главную страницу.
2026-01-25T08:57:21.8826133Z -    
2026-01-25T08:57:21.8826248Z +
2026-01-25T08:57:21.8826396Z      Returns:
2026-01-25T08:57:21.8826630Z          Redirect на главную страницу
2026-01-25T08:57:21.8826748Z      """
2026-01-25T08:57:21.8826890Z      session.clear()
2026-01-25T08:57:21.8827129Z -    flash('Вы вышли из системы.', 'info')
2026-01-25T08:57:21.8827320Z -    return redirect(url_for('main.index'))
2026-01-25T08:57:21.8827465Z \ No newline at end of file
2026-01-25T08:57:21.8827698Z +    flash("Вы вышли из системы.", "info")
2026-01-25T08:57:21.8827878Z +    return redirect(url_for("main.index"))
2026-01-25T08:57:21.9149516Z --- /home/runner/work/flask_blog/flask_blog/app/models/post.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.9151301Z +++ /home/runner/work/flask_blog/flask_blog/app/models/post.py	2026-01-25 08:57:21.913130+00:00
2026-01-25T08:57:21.9152654Z @@ -1,87 +1,88 @@
2026-01-25T08:57:21.9154309Z  """Модель поста блога."""
2026-01-25T08:57:21.9155704Z +
2026-01-25T08:57:21.9156992Z  from datetime import datetime
2026-01-25T08:57:21.9158777Z  from typing import Optional, Dict, Any
2026-01-25T08:57:21.9159809Z  
2026-01-25T08:57:21.9160087Z  
2026-01-25T08:57:21.9160221Z  class Post:
2026-01-25T08:57:21.9160457Z      """Модель поста блога.
2026-01-25T08:57:21.9160578Z -    
2026-01-25T08:57:21.9160684Z +
2026-01-25T08:57:21.9161001Z      Содержит только данные и базовую бизнес-логику.
2026-01-25T08:57:21.9161271Z      Вся логика работы с БД вынесена в PostService.
2026-01-25T08:57:21.9161388Z      """
2026-01-25T08:57:21.9161510Z -    
2026-01-25T08:57:21.9161643Z +
2026-01-25T08:57:21.9161825Z      def __init__(
2026-01-25T08:57:21.9161993Z          self,
2026-01-25T08:57:21.9162147Z          id: Optional[int] = None,
2026-01-25T08:57:21.9162345Z          author_id: Optional[int] = None,
2026-01-25T08:57:21.9162509Z -        title: str = '',
2026-01-25T08:57:21.9162656Z -        content: str = '',
2026-01-25T08:57:21.9163323Z +        title: str = "",
2026-01-25T08:57:21.9163474Z +        content: str = "",
2026-01-25T08:57:21.9163664Z          created: Optional[datetime] = None,
2026-01-25T08:57:21.9163806Z -        author_username: str = '',
2026-01-25T08:57:21.9163945Z +        author_username: str = "",
2026-01-25T08:57:21.9164092Z          author_discriminator: int = 0,
2026-01-25T08:57:21.9164233Z -        comment_count: int = 0
2026-01-25T08:57:21.9164360Z +        comment_count: int = 0,
2026-01-25T08:57:21.9164466Z      ):
2026-01-25T08:57:21.9164593Z          self.id = id
2026-01-25T08:57:21.9164750Z          self.author_id = author_id
2026-01-25T08:57:21.9164914Z          self.title = title
2026-01-25T08:57:21.9165061Z          self.content = content
2026-01-25T08:57:21.9165184Z          self.created = created
2026-01-25T08:57:21.9165360Z          self.author_username = author_username
2026-01-25T08:57:21.9165584Z          self.author_discriminator = author_discriminator
2026-01-25T08:57:21.9165767Z          self.comment_count = comment_count
2026-01-25T08:57:21.9165900Z -    
2026-01-25T08:57:21.9166003Z +
2026-01-25T08:57:21.9166123Z      @property
2026-01-25T08:57:21.9166290Z      def author_display_name(self) -> str:
2026-01-25T08:57:21.9166660Z          """Возвращает отображаемое имя автора с дискриминатором."""
2026-01-25T08:57:21.9166956Z          return f"{self.author_username}#{self.author_discriminator:04d}"
2026-01-25T08:57:21.9167064Z -    
2026-01-25T08:57:21.9167169Z +
2026-01-25T08:57:21.9167356Z      def is_author(self, user_id: int) -> bool:
2026-01-25T08:57:21.9167658Z          """Проверяет, является ли пользователь автором поста.
2026-01-25T08:57:21.9167781Z -        
2026-01-25T08:57:21.9167906Z +
2026-01-25T08:57:21.9168022Z          Args:
2026-01-25T08:57:21.9168257Z              user_id: ID пользователя
2026-01-25T08:57:21.9168374Z -            
2026-01-25T08:57:21.9168494Z +
2026-01-25T08:57:21.9168647Z          Returns:
2026-01-25T08:57:21.9169015Z              bool: True если пользователь автор поста
2026-01-25T08:57:21.9169169Z          """
2026-01-25T08:57:21.9169369Z          return self.author_id == user_id
2026-01-25T08:57:21.9169753Z -    
2026-01-25T08:57:21.9169895Z +
2026-01-25T08:57:21.9170091Z      def to_dict(self) -> Dict[str, Any]:
2026-01-25T08:57:21.9170397Z          """Преобразует пост в словарь для шаблонов.
2026-01-25T08:57:21.9170521Z -        
2026-01-25T08:57:21.9170646Z +
2026-01-25T08:57:21.9170775Z          Returns:
2026-01-25T08:57:21.9171080Z              Dict[str, Any]: словарь с данными поста
2026-01-25T08:57:21.9171207Z          """
2026-01-25T08:57:21.9171349Z          return {
2026-01-25T08:57:21.9171508Z -            'id': self.id,
2026-01-25T08:57:21.9171711Z -            'author_id': self.author_id,
2026-01-25T08:57:21.9171861Z -            'title': self.title,
2026-01-25T08:57:21.9172025Z -            'content': self.content,
2026-01-25T08:57:21.9172183Z -            'created': self.created,
2026-01-25T08:57:21.9172424Z -            'author_username': self.author_username,
2026-01-25T08:57:21.9172706Z -            'author_discriminator': self.author_discriminator,
2026-01-25T08:57:21.9173172Z -            'author_display_name': self.author_display_name,
2026-01-25T08:57:21.9173375Z -            'comment_count': self.comment_count
2026-01-25T08:57:21.9173517Z +            "id": self.id,
2026-01-25T08:57:21.9173681Z +            "author_id": self.author_id,
2026-01-25T08:57:21.9173838Z +            "title": self.title,
2026-01-25T08:57:21.9173994Z +            "content": self.content,
2026-01-25T08:57:21.9174148Z +            "created": self.created,
2026-01-25T08:57:21.9174354Z +            "author_username": self.author_username,
2026-01-25T08:57:21.9174614Z +            "author_discriminator": self.author_discriminator,
2026-01-25T08:57:21.9174849Z +            "author_display_name": self.author_display_name,
2026-01-25T08:57:21.9175042Z +            "comment_count": self.comment_count,
2026-01-25T08:57:21.9175164Z          }
2026-01-25T08:57:21.9175534Z -    
2026-01-25T08:57:21.9175650Z +
2026-01-25T08:57:21.9175787Z      @classmethod
2026-01-25T08:57:21.9176046Z -    def from_dict(cls, data: Dict[str, Any]) -> 'Post':
2026-01-25T08:57:21.9176273Z +    def from_dict(cls, data: Dict[str, Any]) -> "Post":
2026-01-25T08:57:21.9176587Z          """Создаёт экземпляр Post из словаря.
2026-01-25T08:57:21.9176724Z -        
2026-01-25T08:57:21.9176841Z +
2026-01-25T08:57:21.9176969Z          Args:
2026-01-25T08:57:21.9177224Z              data: Словарь с данными поста
2026-01-25T08:57:21.9177353Z -            
2026-01-25T08:57:21.9177481Z +
2026-01-25T08:57:21.9177611Z          Returns:
2026-01-25T08:57:21.9177859Z              Post: созданный экземпляр
2026-01-25T08:57:21.9178038Z          """
2026-01-25T08:57:21.9178202Z          return cls(**data)
2026-01-25T08:57:21.9178328Z -    
2026-01-25T08:57:21.9178456Z +
2026-01-25T08:57:21.9178614Z      def __repr__(self) -> str:
2026-01-25T08:57:21.9178898Z          """Строковое представление для отладки."""
2026-01-25T08:57:21.9179334Z          return f"<Post(id={self.id}, title='{self.title}', author_id={self.author_id})>"
2026-01-25T08:57:21.9179460Z -    
2026-01-25T08:57:21.9179604Z +
2026-01-25T08:57:21.9179795Z      def __eq__(self, other) -> bool:
2026-01-25T08:57:21.9180043Z          """Сравнение постов по ID."""
2026-01-25T08:57:21.9180224Z          if not isinstance(other, Post):
2026-01-25T08:57:21.9180370Z              return False
2026-01-25T08:57:21.9180523Z          return self.id == other.id
2026-01-25T08:57:21.9188118Z would reformat /home/runner/work/flask_blog/flask_blog/app/models/post.py
2026-01-25T08:57:21.9398097Z --- /home/runner/work/flask_blog/flask_blog/app/main/routes.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.9403836Z would reformat /home/runner/work/flask_blog/flask_blog/app/main/routes.py
2026-01-25T08:57:21.9404262Z +++ /home/runner/work/flask_blog/flask_blog/app/main/routes.py	2026-01-25 08:57:21.936621+00:00
2026-01-25T08:57:21.9407436Z @@ -1,161 +1,169 @@
2026-01-25T08:57:21.9407886Z  """Главные маршруты приложения."""
2026-01-25T08:57:21.9408747Z -from flask import Blueprint, render_template, request, flash, redirect, url_for, abort, g
2026-01-25T08:57:21.9408891Z +
2026-01-25T08:57:21.9409055Z +from flask import (
2026-01-25T08:57:21.9409188Z +    Blueprint,
2026-01-25T08:57:21.9409322Z +    render_template,
2026-01-25T08:57:21.9409448Z +    request,
2026-01-25T08:57:21.9409577Z +    flash,
2026-01-25T08:57:21.9409695Z +    redirect,
2026-01-25T08:57:21.9409821Z +    url_for,
2026-01-25T08:57:21.9409942Z +    abort,
2026-01-25T08:57:21.9410061Z +    g,
2026-01-25T08:57:21.9410173Z +)
2026-01-25T08:57:21.9410293Z  
2026-01-25T08:57:21.9410483Z  from app.auth.utils import login_required
2026-01-25T08:57:21.9410741Z  from app.services import PostService, CommentService
2026-01-25T08:57:21.9410902Z  from app.models import Post
2026-01-25T08:57:21.9411098Z  from app.forms import PostForm, CommentForm
2026-01-25T08:57:21.9411220Z  
2026-01-25T08:57:21.9411380Z -bp = Blueprint('main', __name__)
2026-01-25T08:57:21.9411542Z +bp = Blueprint("main", __name__)
2026-01-25T08:57:21.9411666Z  
2026-01-25T08:57:21.9411777Z  
2026-01-25T08:57:21.9411912Z -@bp.route('/')
2026-01-25T08:57:21.9412047Z +@bp.route("/")
2026-01-25T08:57:21.9412170Z  def index():
2026-01-25T08:57:21.9412620Z      """Главная страница блога - список всех постов."""
2026-01-25T08:57:21.9412802Z      posts = PostService.get_all()
2026-01-25T08:57:21.9413245Z -    return render_template('main/index.html', posts=posts)
2026-01-25T08:57:21.9413511Z +    return render_template("main/index.html", posts=posts)
2026-01-25T08:57:21.9413658Z  
2026-01-25T08:57:21.9413768Z  
2026-01-25T08:57:21.9413987Z -@bp.route('/post/create', methods=['GET', 'POST'])
2026-01-25T08:57:21.9414195Z +@bp.route("/post/create", methods=["GET", "POST"])
2026-01-25T08:57:21.9414322Z  @login_required
2026-01-25T08:57:21.9414463Z  def create_post():
2026-01-25T08:57:21.9414693Z      """Создание нового поста."""
2026-01-25T08:57:21.9414874Z      form = PostForm(request.form)
2026-01-25T08:57:21.9415306Z -    
2026-01-25T08:57:21.9415540Z -    if request.method == 'POST' and form.validate():
2026-01-25T08:57:21.9415689Z +
2026-01-25T08:57:21.9415911Z +    if request.method == "POST" and form.validate():
2026-01-25T08:57:21.9416074Z          post = PostService.create(
2026-01-25T08:57:21.9416228Z -            author_id=g.user['id'],
2026-01-25T08:57:21.9416367Z -            title=form.title.data,
2026-01-25T08:57:21.9416530Z -            content=form.content.data
2026-01-25T08:57:21.9416884Z +            author_id=g.user["id"], title=form.title.data, content=form.content.data
2026-01-25T08:57:21.9417007Z          )
2026-01-25T08:57:21.9417275Z -        flash('Пост успешно создан!', 'success')
2026-01-25T08:57:21.9417564Z -        return redirect(url_for('main.view_post', post_id=post.id))
2026-01-25T08:57:21.9417677Z -    
2026-01-25T08:57:21.9417939Z +        flash("Пост успешно создан!", "success")
2026-01-25T08:57:21.9418228Z +        return redirect(url_for("main.view_post", post_id=post.id))
2026-01-25T08:57:21.9418358Z +
2026-01-25T08:57:21.9418613Z      # Если форма не валидна, показываем ошибки
2026-01-25T08:57:21.9418788Z -    elif request.method == 'POST':
2026-01-25T08:57:21.9418943Z +    elif request.method == "POST":
2026-01-25T08:57:21.9419190Z          for field_name, field_errors in form.errors.items():
2026-01-25T08:57:21.9419347Z              for error in field_errors:
2026-01-25T08:57:21.9419499Z -                flash(error, 'danger')
2026-01-25T08:57:21.9419631Z -    
2026-01-25T08:57:21.9419903Z -    return render_template('main/create_post.html', form=form)
2026-01-25T08:57:21.9420059Z +                flash(error, "danger")
2026-01-25T08:57:21.9420174Z +
2026-01-25T08:57:21.9420426Z +    return render_template("main/create_post.html", form=form)
2026-01-25T08:57:21.9420560Z  
2026-01-25T08:57:21.9420673Z  
2026-01-25T08:57:21.9420840Z -@bp.route('/post/<int:post_id>')
2026-01-25T08:57:21.9421031Z +@bp.route("/post/<int:post_id>")
2026-01-25T08:57:21.9421229Z  def view_post(post_id):
2026-01-25T08:57:21.9421456Z      """Просмотр отдельного поста."""
2026-01-25T08:57:21.9421890Z      post = PostService.find_by_id(post_id)
2026-01-25T08:57:21.9422024Z      if post is None:
2026-01-25T08:57:21.9422299Z          abort(404, description="Пост не найден")
2026-01-25T08:57:21.9422415Z -    
2026-01-25T08:57:21.9422529Z +
2026-01-25T08:57:21.9422749Z      # Получаем комментарии к посту
2026-01-25T08:57:21.9423172Z      comments = CommentService.get_by_post_id(post_id)
2026-01-25T08:57:21.9423329Z      comment_form = CommentForm()
2026-01-25T08:57:21.9423448Z -    
2026-01-25T08:57:21.9423973Z -    return render_template('main/view_post.html', post=post, comments=comments, comment_form=comment_form)
2026-01-25T08:57:21.9424093Z +
2026-01-25T08:57:21.9424250Z +    return render_template(
2026-01-25T08:57:21.9424616Z +        "main/view_post.html", post=post, comments=comments, comment_form=comment_form
2026-01-25T08:57:21.9424740Z +    )
2026-01-25T08:57:21.9424877Z  
2026-01-25T08:57:21.9424987Z  
2026-01-25T08:57:21.9425254Z -@bp.route('/post/<int:post_id>/edit', methods=['GET', 'POST'])
2026-01-25T08:57:21.9425536Z +@bp.route("/post/<int:post_id>/edit", methods=["GET", "POST"])
2026-01-25T08:57:21.9425665Z  @login_required
2026-01-25T08:57:21.9425816Z  def edit_post(post_id):
2026-01-25T08:57:21.9426106Z      """Редактирование поста (только для автора)."""
2026-01-25T08:57:21.9426287Z      post = PostService.find_by_id(post_id)
2026-01-25T08:57:21.9426431Z      if post is None:
2026-01-25T08:57:21.9426701Z          abort(404, description="Пост не найден")
2026-01-25T08:57:21.9426825Z -    
2026-01-25T08:57:21.9426993Z -    if not post.is_author(g.user['id']):
2026-01-25T08:57:21.9427103Z +
2026-01-25T08:57:21.9427272Z +    if not post.is_author(g.user["id"]):
2026-01-25T08:57:21.9427687Z          abort(403, description="Вы можете редактировать только свои посты")
2026-01-25T08:57:21.9427800Z -    
2026-01-25T08:57:21.9427920Z +
2026-01-25T08:57:21.9428349Z      form = PostForm(request.form)
2026-01-25T08:57:21.9428468Z -    
2026-01-25T08:57:21.9428708Z -    if request.method == 'POST' and form.validate():
2026-01-25T08:57:21.9428826Z +
2026-01-25T08:57:21.9429037Z +    if request.method == "POST" and form.validate():
2026-01-25T08:57:21.9429375Z          PostService.update(post_id, form.title.data, form.content.data)
2026-01-25T08:57:21.9429668Z -        flash('Пост успешно обновлён!', 'success')
2026-01-25T08:57:21.9429956Z -        return redirect(url_for('main.view_post', post_id=post_id))
2026-01-25T08:57:21.9430110Z -    elif request.method == 'GET':
2026-01-25T08:57:21.9430380Z +        flash("Пост успешно обновлён!", "success")
2026-01-25T08:57:21.9430666Z +        return redirect(url_for("main.view_post", post_id=post_id))
2026-01-25T08:57:21.9430816Z +    elif request.method == "GET":
2026-01-25T08:57:21.9431133Z          # Заполняем форму текущими данными поста
2026-01-25T08:57:21.9431303Z          form.title.data = post.title
2026-01-25T08:57:21.9431488Z          form.content.data = post.content
2026-01-25T08:57:21.9431608Z -    
2026-01-25T08:57:21.9431718Z +
2026-01-25T08:57:21.9432037Z      # Если форма не валидна при POST, показываем ошибки
2026-01-25T08:57:21.9432207Z -    elif request.method == 'POST':
2026-01-25T08:57:21.9432355Z +    elif request.method == "POST":
2026-01-25T08:57:21.9432595Z          for field_name, field_errors in form.errors.items():
2026-01-25T08:57:21.9432756Z              for error in field_errors:
2026-01-25T08:57:21.9433095Z -                flash(error, 'danger')
2026-01-25T08:57:21.9433223Z -    
2026-01-25T08:57:21.9433542Z -    return render_template('main/edit_post.html', form=form, post=post)
2026-01-25T08:57:21.9433693Z +                flash(error, "danger")
2026-01-25T08:57:21.9433806Z +
2026-01-25T08:57:21.9434116Z +    return render_template("main/edit_post.html", form=form, post=post)
2026-01-25T08:57:21.9434229Z  
2026-01-25T08:57:21.9434350Z  
2026-01-25T08:57:21.9434585Z -@bp.route('/post/<int:post_id>/delete', methods=['POST'])
2026-01-25T08:57:21.9434834Z +@bp.route("/post/<int:post_id>/delete", methods=["POST"])
2026-01-25T08:57:21.9435175Z  @login_required
2026-01-25T08:57:21.9435337Z  def delete_post(post_id):
2026-01-25T08:57:21.9435615Z      """Удаление поста (только для автора)."""
2026-01-25T08:57:21.9435801Z      post = PostService.find_by_id(post_id)
2026-01-25T08:57:21.9435947Z      if post is None:
2026-01-25T08:57:21.9436241Z          abort(404, description="Пост не найден")
2026-01-25T08:57:21.9436358Z -    
2026-01-25T08:57:21.9436527Z -    if not post.is_author(g.user['id']):
2026-01-25T08:57:21.9436645Z +
2026-01-25T08:57:21.9436805Z +    if not post.is_author(g.user["id"]):
2026-01-25T08:57:21.9437180Z          abort(403, description="Вы можете удалять только свои посты")
2026-01-25T08:57:21.9437319Z -    
2026-01-25T08:57:21.9437433Z +
2026-01-25T08:57:21.9437672Z      # Проверяем CSRF токен
2026-01-25T08:57:21.9437834Z      form = PostForm(request.form)
2026-01-25T08:57:21.9437981Z      if not form.validate():
2026-01-25T08:57:21.9438226Z          for field_name, field_errors in form.errors.items():
2026-01-25T08:57:21.9438400Z              for error in field_errors:
2026-01-25T08:57:21.9438551Z -                flash(error, 'danger')
2026-01-25T08:57:21.9438835Z -        return redirect(url_for('main.view_post', post_id=post_id))
2026-01-25T08:57:21.9438949Z -    
2026-01-25T08:57:21.9439096Z +                flash(error, "danger")
2026-01-25T08:57:21.9439386Z +        return redirect(url_for("main.view_post", post_id=post_id))
2026-01-25T08:57:21.9439502Z +
2026-01-25T08:57:21.9439680Z      PostService.delete(post_id)
2026-01-25T08:57:21.9439961Z -    flash('Пост успешно удалён!', 'success')
2026-01-25T08:57:21.9440135Z -    return redirect(url_for('main.index'))
2026-01-25T08:57:21.9440381Z +    flash("Пост успешно удалён!", "success")
2026-01-25T08:57:21.9440565Z +    return redirect(url_for("main.index"))
2026-01-25T08:57:21.9440679Z  
2026-01-25T08:57:21.9440800Z  
2026-01-25T08:57:21.9441283Z -@bp.route('/post/<int:post_id>/comment', methods=['POST'])
2026-01-25T08:57:21.9441541Z +@bp.route("/post/<int:post_id>/comment", methods=["POST"])
2026-01-25T08:57:21.9441680Z  @login_required
2026-01-25T08:57:21.9441827Z  def add_comment(post_id):
2026-01-25T08:57:21.9442088Z      """Добавление комментария к посту."""
2026-01-25T08:57:21.9442273Z      post = PostService.find_by_id(post_id)
2026-01-25T08:57:21.9442412Z      if post is None:
2026-01-25T08:57:21.9442686Z          abort(404, description="Пост не найден")
2026-01-25T08:57:21.9442820Z -    
2026-01-25T08:57:21.9443122Z +
2026-01-25T08:57:21.9443297Z      form = CommentForm(request.form)
2026-01-25T08:57:21.9443411Z -    
2026-01-25T08:57:21.9443522Z +
2026-01-25T08:57:21.9443670Z      if form.validate():
2026-01-25T08:57:21.9443841Z          comment = CommentService.create(
2026-01-25T08:57:21.9443990Z -            author_id=g.user['id'],
2026-01-25T08:57:21.9444144Z -            post_id=post_id,
2026-01-25T08:57:21.9444308Z -            content=form.content.data
2026-01-25T08:57:21.9444695Z +            author_id=g.user["id"], post_id=post_id, content=form.content.data
2026-01-25T08:57:21.9444940Z          )
2026-01-25T08:57:21.9445321Z -        flash('Комментарий успешно добавлен!', 'success')
2026-01-25T08:57:21.9445754Z +        flash("Комментарий успешно добавлен!", "success")
2026-01-25T08:57:21.9445925Z      else:
2026-01-25T08:57:21.9446418Z          # Показываем ошибки валидации
2026-01-25T08:57:21.9446762Z          for field_name, field_errors in form.errors.items():
2026-01-25T08:57:21.9447034Z              for error in field_errors:
2026-01-25T08:57:21.9447234Z -                flash(error, 'danger')
2026-01-25T08:57:21.9447455Z -    
2026-01-25T08:57:21.9470080Z -    return redirect(url_for('main.view_post', post_id=post_id))
2026-01-25T08:57:21.9470310Z +                flash(error, "danger")
2026-01-25T08:57:21.9470428Z +
2026-01-25T08:57:21.9470738Z +    return redirect(url_for("main.view_post", post_id=post_id))
2026-01-25T08:57:21.9470883Z  
2026-01-25T08:57:21.9470998Z  
2026-01-25T08:57:21.9471295Z -@bp.route('/comment/<int:comment_id>/delete', methods=['POST'])
2026-01-25T08:57:21.9471851Z +@bp.route("/comment/<int:comment_id>/delete", methods=["POST"])
2026-01-25T08:57:21.9472004Z  @login_required
2026-01-25T08:57:21.9472177Z  def delete_comment(comment_id):
2026-01-25T08:57:21.9472532Z      """Удаление комментария (только для автора)."""
2026-01-25T08:57:21.9472769Z      # Проверяем существование комментария
2026-01-25T08:57:21.9473211Z      comment = CommentService.find_by_id(comment_id)
2026-01-25T08:57:21.9473359Z      if comment is None:
2026-01-25T08:57:21.9473702Z          abort(404, description="Комментарий не найден")
2026-01-25T08:57:21.9473824Z -    
2026-01-25T08:57:21.9473938Z +
2026-01-25T08:57:21.9474198Z      # Проверяем CSRF токен через пустую форму
2026-01-25T08:57:21.9474375Z      form = CommentForm(request.form)
2026-01-25T08:57:21.9474529Z      if not form.validate():
2026-01-25T08:57:21.9474786Z          for field_name, field_errors in form.errors.items():
2026-01-25T08:57:21.9475273Z              for error in field_errors:
2026-01-25T08:57:21.9475461Z -                flash(error, 'danger')
2026-01-25T08:57:21.9475805Z -        return redirect(url_for('main.view_post', post_id=comment.post_id))
2026-01-25T08:57:21.9475924Z -    
2026-01-25T08:57:21.9476088Z +                flash(error, "danger")
2026-01-25T08:57:21.9476408Z +        return redirect(url_for("main.view_post", post_id=comment.post_id))
2026-01-25T08:57:21.9476528Z +
2026-01-25T08:57:21.9476848Z      # Удаляем комментарий (проверка прав внутри сервиса)
2026-01-25T08:57:21.9477102Z -    if CommentService.delete(comment_id, g.user['id']):
2026-01-25T08:57:21.9477430Z -        flash('Комментарий успешно удалён!', 'success')
2026-01-25T08:57:21.9477671Z +    if CommentService.delete(comment_id, g.user["id"]):
2026-01-25T08:57:21.9477944Z +        flash("Комментарий успешно удалён!", "success")
2026-01-25T08:57:21.9478073Z      else:
2026-01-25T08:57:21.9478435Z -        flash('Вы можете удалять только свои комментарии', 'danger')
2026-01-25T08:57:21.9478556Z -    
2026-01-25T08:57:21.9478900Z -    return redirect(url_for('main.view_post', post_id=comment.post_id))
2026-01-25T08:57:21.9479254Z +        flash("Вы можете удалять только свои комментарии", "danger")
2026-01-25T08:57:21.9479372Z +
2026-01-25T08:57:21.9479690Z +    return redirect(url_for("main.view_post", post_id=comment.post_id))
2026-01-25T08:57:21.9604498Z would reformat /home/runner/work/flask_blog/flask_blog/app/services/post_service.py
2026-01-25T08:57:21.9605085Z --- /home/runner/work/flask_blog/flask_blog/app/services/post_service.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.9614347Z +++ /home/runner/work/flask_blog/flask_blog/app/services/post_service.py	2026-01-25 08:57:21.955030+00:00
2026-01-25T08:57:21.9614570Z @@ -1,158 +1,159 @@
2026-01-25T08:57:21.9615065Z  """Сервис для работы с постами блога."""
2026-01-25T08:57:21.9615181Z +
2026-01-25T08:57:21.9615367Z  from datetime import datetime
2026-01-25T08:57:21.9615628Z  from typing import Optional, List
2026-01-25T08:57:21.9615774Z  
2026-01-25T08:57:21.9616331Z  from app.db.db import get_db
2026-01-25T08:57:21.9616518Z  from app.models.post import Post
2026-01-25T08:57:21.9616637Z  
2026-01-25T08:57:21.9616764Z  
2026-01-25T08:57:21.9616912Z  class PostService:
2026-01-25T08:57:21.9617182Z      """Сервисный слой для работы с постами.
2026-01-25T08:57:21.9617314Z -    
2026-01-25T08:57:21.9617428Z +
2026-01-25T08:57:21.9617750Z      Вся логика работы с базой данных инкапсулирована здесь.
2026-01-25T08:57:21.9618123Z      Модель Post содержит только данные и базовую бизнес-логику.
2026-01-25T08:57:21.9618245Z      """
2026-01-25T08:57:21.9618358Z -    
2026-01-25T08:57:21.9618479Z +
2026-01-25T08:57:21.9618610Z      @staticmethod
2026-01-25T08:57:21.9618907Z      def create(author_id: int, title: str, content: str) -> Post:
2026-01-25T08:57:21.9619132Z          """Создаёт новый пост.
2026-01-25T08:57:21.9619254Z -        
2026-01-25T08:57:21.9619404Z +
2026-01-25T08:57:21.9619526Z          Args:
2026-01-25T08:57:21.9619749Z              author_id: ID автора
2026-01-25T08:57:21.9620014Z              title: Заголовок поста
2026-01-25T08:57:21.9620241Z              content: Содержание поста
2026-01-25T08:57:21.9620363Z -            
2026-01-25T08:57:21.9620483Z +
2026-01-25T08:57:21.9620604Z          Returns:
2026-01-25T08:57:21.9621022Z              Post: созданный пост с полной информацией
2026-01-25T08:57:21.9621161Z          """
2026-01-25T08:57:21.9621308Z          db = get_db()
2026-01-25T08:57:21.9621456Z          cursor = db.execute(
2026-01-25T08:57:21.9621769Z -            'INSERT INTO post (author_id, title, content) VALUES (?, ?, ?)',
2026-01-25T08:57:21.9621936Z -            (author_id, title, content)
2026-01-25T08:57:21.9622271Z +            "INSERT INTO post (author_id, title, content) VALUES (?, ?, ?)",
2026-01-25T08:57:21.9622431Z +            (author_id, title, content),
2026-01-25T08:57:21.9622548Z          )
2026-01-25T08:57:21.9623254Z          db.commit()
2026-01-25T08:57:21.9623381Z -        
2026-01-25T08:57:21.9623502Z +
2026-01-25T08:57:21.9624028Z          # Получаем созданный пост с информацией об авторе
2026-01-25T08:57:21.9624306Z          return PostService.find_by_id(cursor.lastrowid)
2026-01-25T08:57:21.9624427Z -    
2026-01-25T08:57:21.9624567Z +
2026-01-25T08:57:21.9624723Z      @staticmethod
2026-01-25T08:57:21.9624941Z      def find_by_id(post_id: int) -> Optional[Post]:
2026-01-25T08:57:21.9625232Z          """Находит пост по ID с информацией об авторе.
2026-01-25T08:57:21.9625354Z -        
2026-01-25T08:57:21.9625470Z +
2026-01-25T08:57:21.9625655Z          Args:
2026-01-25T08:57:21.9625873Z              post_id: ID поста
2026-01-25T08:57:21.9625993Z -            
2026-01-25T08:57:21.9626119Z +
2026-01-25T08:57:21.9626245Z          Returns:
2026-01-25T08:57:21.9626483Z              Post или None если не найден
2026-01-25T08:57:21.9626617Z          """
2026-01-25T08:57:21.9626752Z          db = get_db()
2026-01-25T08:57:21.9626918Z          row = db.execute(
2026-01-25T08:57:21.9627262Z -            '''SELECT p.id, p.author_id, p.title, p.content, p.created,
2026-01-25T08:57:21.9627552Z +            """SELECT p.id, p.author_id, p.title, p.content, p.created,
2026-01-25T08:57:21.9627759Z                        u.username, u.discriminator
2026-01-25T08:57:21.9627916Z                 FROM post p
2026-01-25T08:57:21.9628093Z                 JOIN user u ON p.author_id = u.id
2026-01-25T08:57:21.9628265Z -               WHERE p.id = ?''',
2026-01-25T08:57:21.9628416Z -            (post_id,)
2026-01-25T08:57:21.9628604Z +               WHERE p.id = ?""",
2026-01-25T08:57:21.9628764Z +            (post_id,),
2026-01-25T08:57:21.9628933Z          ).fetchone()
2026-01-25T08:57:21.9629070Z -        
2026-01-25T08:57:21.9629196Z +
2026-01-25T08:57:21.9629353Z          if row is None:
2026-01-25T08:57:21.9629494Z              return None
2026-01-25T08:57:21.9629631Z -            
2026-01-25T08:57:21.9629753Z +
2026-01-25T08:57:21.9629927Z          return Post(
2026-01-25T08:57:21.9630064Z -            id=row['id'],
2026-01-25T08:57:21.9630524Z -            author_id=row['author_id'],
2026-01-25T08:57:21.9630712Z -            title=row['title'],
2026-01-25T08:57:21.9630931Z -            content=row['content'],
2026-01-25T08:57:21.9631250Z -            created=row['created'] if row['created'] else None,
2026-01-25T08:57:21.9631452Z -            author_username=row['username'],
2026-01-25T08:57:21.9631669Z -            author_discriminator=row['discriminator'],
2026-01-25T08:57:21.9632257Z -            comment_count=0  # Для单个 поста не считаем комментарии для производительности
2026-01-25T08:57:21.9632430Z +            id=row["id"],
2026-01-25T08:57:21.9632594Z +            author_id=row["author_id"],
2026-01-25T08:57:21.9632719Z +            title=row["title"],
2026-01-25T08:57:21.9632873Z +            content=row["content"],
2026-01-25T08:57:21.9633277Z +            created=row["created"] if row["created"] else None,
2026-01-25T08:57:21.9633484Z +            author_username=row["username"],
2026-01-25T08:57:21.9633670Z +            author_discriminator=row["discriminator"],
2026-01-25T08:57:21.9634052Z +            comment_count=0,  # Для单个 поста не считаем комментарии для производительности
2026-01-25T08:57:21.9634159Z          )
2026-01-25T08:57:21.9634299Z -    
2026-01-25T08:57:21.9634402Z +
2026-01-25T08:57:21.9634520Z      @staticmethod
2026-01-25T08:57:21.9634655Z      def get_all() -> List[Post]:
2026-01-25T08:57:21.9635143Z          """Возвращает список всех постов с информацией об авторах и количеством комментариев.
2026-01-25T08:57:21.9635243Z -        
2026-01-25T08:57:21.9635340Z +
2026-01-25T08:57:21.9635447Z          Returns:
2026-01-25T08:57:21.9635775Z              List[Post]: список постов, отсортированных по дате создания (новые первые)
2026-01-25T08:57:21.9635875Z          """
2026-01-25T08:57:21.9635993Z          db = get_db()
2026-01-25T08:57:21.9636114Z -        rows = db.execute(
2026-01-25T08:57:21.9636688Z -            '''SELECT p.id, p.author_id, p.title, p.content, p.created,
2026-01-25T08:57:21.9636990Z +        rows = db.execute("""SELECT p.id, p.author_id, p.title, p.content, p.created,
2026-01-25T08:57:21.9637142Z                        u.username, u.discriminator,
2026-01-25T08:57:21.9637358Z                        COALESCE(c.comment_count, 0) as comment_count
2026-01-25T08:57:21.9637473Z                 FROM post p
2026-01-25T08:57:21.9637629Z                 JOIN user u ON p.author_id = u.id
2026-01-25T08:57:21.9637745Z                 LEFT JOIN (
2026-01-25T08:57:21.9637925Z                     SELECT post_id, COUNT(*) as comment_count 
2026-01-25T08:57:21.9638046Z                     FROM comment 
2026-01-25T08:57:21.9638174Z                     GROUP BY post_id
2026-01-25T08:57:21.9638299Z                 ) c ON p.id = c.post_id
2026-01-25T08:57:21.9638440Z -               ORDER BY p.created DESC'''
2026-01-25T08:57:21.9638545Z -        ).fetchall()
2026-01-25T08:57:21.9638643Z -        
2026-01-25T08:57:21.9638818Z +               ORDER BY p.created DESC""").fetchall()
2026-01-25T08:57:21.9638913Z +
2026-01-25T08:57:21.9639055Z          posts = []
2026-01-25T08:57:21.9639200Z          for row in rows:
2026-01-25T08:57:21.9639331Z -            posts.append(Post(
2026-01-25T08:57:21.9639443Z -                id=row['id'],
2026-01-25T08:57:21.9639586Z -                author_id=row['author_id'],
2026-01-25T08:57:21.9639710Z -                title=row['title'],
2026-01-25T08:57:21.9639844Z -                content=row['content'],
2026-01-25T08:57:21.9640050Z -                created=row['created'] if row['created'] else None,
2026-01-25T08:57:21.9640202Z -                author_username=row['username'],
2026-01-25T08:57:21.9640406Z -                author_discriminator=row['discriminator'],
2026-01-25T08:57:21.9640554Z -                comment_count=row['comment_count']
2026-01-25T08:57:21.9640656Z -            ))
2026-01-25T08:57:21.9640765Z -        
2026-01-25T08:57:21.9640886Z +            posts.append(
2026-01-25T08:57:21.9641032Z +                Post(
2026-01-25T08:57:21.9641191Z +                    id=row["id"],
2026-01-25T08:57:21.9641498Z +                    author_id=row["author_id"],
2026-01-25T08:57:21.9641633Z +                    title=row["title"],
2026-01-25T08:57:21.9641761Z +                    content=row["content"],
2026-01-25T08:57:21.9641964Z +                    created=row["created"] if row["created"] else None,
2026-01-25T08:57:21.9642125Z +                    author_username=row["username"],
2026-01-25T08:57:21.9642423Z +                    author_discriminator=row["discriminator"],
2026-01-25T08:57:21.9642602Z +                    comment_count=row["comment_count"],
2026-01-25T08:57:21.9642709Z +                )
2026-01-25T08:57:21.9642807Z +            )
2026-01-25T08:57:21.9673214Z +
2026-01-25T08:57:21.9673422Z          return posts
2026-01-25T08:57:21.9673521Z -    
2026-01-25T08:57:21.9673625Z +
2026-01-25T08:57:21.9673729Z      @staticmethod
2026-01-25T08:57:21.9673974Z      def update(post_id: int, title: str, content: str) -> bool:
2026-01-25T08:57:21.9674317Z          """Обновляет заголовок и содержание поста.
2026-01-25T08:57:21.9674430Z -        
2026-01-25T08:57:21.9674539Z +
2026-01-25T08:57:21.9674661Z          Args:
2026-01-25T08:57:21.9674865Z              post_id: ID поста
2026-01-25T08:57:21.9675072Z              title: Новый заголовок
2026-01-25T08:57:21.9675308Z              content: Новое содержание
2026-01-25T08:57:21.9675434Z -            
2026-01-25T08:57:21.9675550Z +
2026-01-25T08:57:21.9675697Z          Returns:
2026-01-25T08:57:21.9675969Z              bool: True если обновление успешно
2026-01-25T08:57:21.9676107Z          """
2026-01-25T08:57:21.9676249Z          db = get_db()
2026-01-25T08:57:21.9676397Z          cursor = db.execute(
2026-01-25T08:57:21.9676663Z -            'UPDATE post SET title = ?, content = ? WHERE id = ?',
2026-01-25T08:57:21.9676825Z -            (title, content, post_id)
2026-01-25T08:57:21.9677073Z +            "UPDATE post SET title = ?, content = ? WHERE id = ?",
2026-01-25T08:57:21.9677589Z +            (title, content, post_id),
2026-01-25T08:57:21.9677727Z          )
2026-01-25T08:57:21.9677858Z          db.commit()
2026-01-25T08:57:21.9677981Z -        
2026-01-25T08:57:21.9678095Z +
2026-01-25T08:57:21.9678265Z          return cursor.rowcount > 0
2026-01-25T08:57:21.9678385Z -    
2026-01-25T08:57:21.9678497Z +
2026-01-25T08:57:21.9678637Z      @staticmethod
2026-01-25T08:57:21.9678810Z      def delete(post_id: int) -> bool:
2026-01-25T08:57:21.9679042Z          """Удаляет пост.
2026-01-25T08:57:21.9679173Z -        
2026-01-25T08:57:21.9679285Z +
2026-01-25T08:57:21.9679409Z          Args:
2026-01-25T08:57:21.9679643Z              post_id: ID поста
2026-01-25T08:57:21.9679769Z -            
2026-01-25T08:57:21.9679884Z +
2026-01-25T08:57:21.9680014Z          Returns:
2026-01-25T08:57:21.9680263Z              bool: True если удаление успешно
2026-01-25T08:57:21.9680390Z          """
2026-01-25T08:57:21.9680537Z          db = get_db()
2026-01-25T08:57:21.9680876Z -        cursor = db.execute('DELETE FROM post WHERE id = ?', (post_id,))
2026-01-25T08:57:21.9681196Z +        cursor = db.execute("DELETE FROM post WHERE id = ?", (post_id,))
2026-01-25T08:57:21.9681348Z          db.commit()
2026-01-25T08:57:21.9681464Z -        
2026-01-25T08:57:21.9681588Z +
2026-01-25T08:57:21.9681750Z          return cursor.rowcount > 0
2026-01-25T08:57:21.9681866Z -    
2026-01-25T08:57:21.9681989Z +
2026-01-25T08:57:21.9682132Z      @staticmethod
2026-01-25T08:57:21.9682299Z      def exists(post_id: int) -> bool:
2026-01-25T08:57:21.9682700Z          """Проверяет существование поста.
2026-01-25T08:57:21.9682819Z -        
2026-01-25T08:57:21.9683172Z +
2026-01-25T08:57:21.9683317Z          Args:
2026-01-25T08:57:21.9683572Z              post_id: ID поста
2026-01-25T08:57:21.9683715Z -            
2026-01-25T08:57:21.9683833Z +
2026-01-25T08:57:21.9683956Z          Returns:
2026-01-25T08:57:21.9684217Z              bool: True если пост существует
2026-01-25T08:57:21.9684355Z          """
2026-01-25T08:57:21.9684513Z          db = get_db()
2026-01-25T08:57:21.9685124Z -        row = db.execute('SELECT 1 FROM post WHERE id = ?', (post_id,)).fetchone()
2026-01-25T08:57:21.9685485Z +        row = db.execute("SELECT 1 FROM post WHERE id = ?", (post_id,)).fetchone()
2026-01-25T08:57:21.9685646Z          return row is not None
2026-01-25T08:57:21.9810385Z --- /home/runner/work/flask_blog/flask_blog/app/services/comment_service.py	2026-01-25 08:57:06.651994+00:00
2026-01-25T08:57:21.9811340Z +++ /home/runner/work/flask_blog/flask_blog/app/services/comment_service.py	2026-01-25 08:57:21.978049+00:00
2026-01-25T08:57:21.9811623Z @@ -1,185 +1,189 @@
2026-01-25T08:57:21.9812168Z  """Сервис для работы с комментариями к постам блога."""
2026-01-25T08:57:21.9812461Z +
2026-01-25T08:57:21.9812847Z  from datetime import datetime
2026-01-25T08:57:21.9813553Z  from typing import Optional, List
2026-01-25T08:57:21.9813817Z  
2026-01-25T08:57:21.9814199Z  from app.db.db import get_db
2026-01-25T08:57:21.9815154Z  from app.models.comment import Comment
2026-01-25T08:57:21.9815452Z  
2026-01-25T08:57:21.9815716Z  
2026-01-25T08:57:21.9815982Z  class CommentService:
2026-01-25T08:57:21.9816424Z      """Сервисный слой для работы с комментариями.
2026-01-25T08:57:21.9816766Z -    
2026-01-25T08:57:21.9817079Z +
2026-01-25T08:57:21.9817522Z      Вся логика работы с базой данных инкапсулирована здесь.
2026-01-25T08:57:21.9818109Z      Модель Comment содержит только данные и базовую бизнес-логику.
2026-01-25T08:57:21.9818459Z      """
2026-01-25T08:57:21.9818837Z -    
2026-01-25T08:57:21.9819063Z +
2026-01-25T08:57:21.9819325Z      @staticmethod
2026-01-25T08:57:21.9819793Z      def create(author_id: int, post_id: int, content: str) -> Comment:
2026-01-25T08:57:21.9820238Z          """Создаёт новый комментарий.
2026-01-25T08:57:21.9820486Z -        
2026-01-25T08:57:21.9820727Z +
2026-01-25T08:57:21.9820955Z          Args:
2026-01-25T08:57:21.9821318Z              author_id: ID автора
2026-01-25T08:57:21.9821757Z              post_id: ID поста
2026-01-25T08:57:21.9822159Z              content: Текст комментария
2026-01-25T08:57:21.9822616Z -            
2026-01-25T08:57:21.9823199Z +
2026-01-25T08:57:21.9823487Z          Returns:
2026-01-25T08:57:21.9824022Z              Comment: созданный комментарий с полной информацией
2026-01-25T08:57:21.9824359Z          """
2026-01-25T08:57:21.9824647Z          db = get_db()
2026-01-25T08:57:21.9824897Z          cursor = db.execute(
2026-01-25T08:57:21.9825425Z -            'INSERT INTO comment (author_id, post_id, content) VALUES (?, ?, ?)',
2026-01-25T08:57:21.9825832Z -            (author_id, post_id, content)
2026-01-25T08:57:21.9826360Z +            "INSERT INTO comment (author_id, post_id, content) VALUES (?, ?, ?)",
2026-01-25T08:57:21.9826679Z +            (author_id, post_id, content),
2026-01-25T08:57:21.9826924Z          )
2026-01-25T08:57:21.9827280Z          db.commit()
2026-01-25T08:57:21.9827607Z -        
2026-01-25T08:57:21.9827849Z +
2026-01-25T08:57:21.9828351Z          # Получаем созданный комментарий с информацией об авторе
2026-01-25T08:57:21.9829173Z          return CommentService.find_by_id(cursor.lastrowid)
2026-01-25T08:57:21.9829506Z -    
2026-01-25T08:57:21.9829731Z +
2026-01-25T08:57:21.9829962Z      @staticmethod
2026-01-25T08:57:21.9830334Z      def find_by_id(comment_id: int) -> Optional[Comment]:
2026-01-25T08:57:21.9830777Z          """Находит комментарий по ID с информацией об авторе.
2026-01-25T08:57:21.9835485Z -        
2026-01-25T08:57:21.9835609Z +
2026-01-25T08:57:21.9835761Z          Args:
2026-01-25T08:57:21.9836061Z              comment_id: ID комментария
2026-01-25T08:57:21.9836181Z -            
2026-01-25T08:57:21.9836294Z +
2026-01-25T08:57:21.9836430Z          Returns:
2026-01-25T08:57:21.9836699Z              Comment или None если не найден
2026-01-25T08:57:21.9836821Z          """
2026-01-25T08:57:21.9836961Z          db = get_db()
2026-01-25T08:57:21.9837106Z          row = db.execute(
2026-01-25T08:57:21.9837452Z -            '''SELECT c.id, c.author_id, c.post_id, c.content, c.created,
2026-01-25T08:57:21.9837751Z +            """SELECT c.id, c.author_id, c.post_id, c.content, c.created,
2026-01-25T08:57:21.9838126Z                        u.username as author_username, u.discriminator as author_discriminator
2026-01-25T08:57:21.9838285Z                 FROM comment c
2026-01-25T08:57:21.9838478Z                 JOIN user u ON c.author_id = u.id
2026-01-25T08:57:21.9838627Z -               WHERE c.id = ?''',
2026-01-25T08:57:21.9838775Z -            (comment_id,)
2026-01-25T08:57:21.9838913Z +               WHERE c.id = ?""",
2026-01-25T08:57:21.9839051Z +            (comment_id,),
2026-01-25T08:57:21.9839185Z          ).fetchone()
2026-01-25T08:57:21.9839299Z -        
2026-01-25T08:57:21.9839416Z +
2026-01-25T08:57:21.9839558Z          if row is None:
2026-01-25T08:57:21.9839695Z              return None
2026-01-25T08:57:21.9839826Z -            
2026-01-25T08:57:21.9839939Z +
2026-01-25T08:57:21.9840386Z          return Comment(
2026-01-25T08:57:21.9840539Z -            id=row['id'],
2026-01-25T08:57:21.9840716Z -            author_id=row['author_id'],
2026-01-25T08:57:21.9840877Z -            post_id=row['post_id'],
2026-01-25T08:57:21.9841034Z -            content=row['content'],
2026-01-25T08:57:21.9841575Z -            created=datetime.fromisoformat(row['created']) if isinstance(row['created'], str) else row['created'],
2026-01-25T08:57:21.9841775Z -            author_username=row['author_username'],
2026-01-25T08:57:21.9842023Z -            author_discriminator=row['author_discriminator']
2026-01-25T08:57:21.9842164Z +            id=row["id"],
2026-01-25T08:57:21.9842330Z +            author_id=row["author_id"],
2026-01-25T08:57:21.9842483Z +            post_id=row["post_id"],
2026-01-25T08:57:21.9842628Z +            content=row["content"],
2026-01-25T08:57:21.9842761Z +            created=(
2026-01-25T08:57:21.9843178Z +                datetime.fromisoformat(row["created"])
2026-01-25T08:57:21.9843379Z +                if isinstance(row["created"], str)
2026-01-25T08:57:21.9843540Z +                else row["created"]
2026-01-25T08:57:21.9843666Z +            ),
2026-01-25T08:57:21.9843893Z +            author_username=row["author_username"],
2026-01-25T08:57:21.9844138Z +            author_discriminator=row["author_discriminator"],
2026-01-25T08:57:21.9844271Z          )
2026-01-25T08:57:21.9844394Z -    
2026-01-25T08:57:21.9844510Z +
2026-01-25T08:57:21.9844639Z      @staticmethod
2026-01-25T08:57:21.9844872Z      def get_by_post_id(post_id: int) -> List[Comment]:
2026-01-25T08:57:21.9845251Z          """Получает все комментарии к посту с информацией об авторах.
2026-01-25T08:57:21.9845377Z -        
2026-01-25T08:57:21.9845499Z +
2026-01-25T08:57:21.9845624Z          Args:
2026-01-25T08:57:21.9845838Z              post_id: ID поста
2026-01-25T08:57:21.9845965Z -            
2026-01-25T08:57:21.9846081Z +
2026-01-25T08:57:21.9846204Z          Returns:
2026-01-25T08:57:21.9846637Z              List[Comment]: список комментариев, отсортированных по времени создания
2026-01-25T08:57:21.9846780Z          """
2026-01-25T08:57:21.9847150Z          db = get_db()
2026-01-25T08:57:21.9847306Z          rows = db.execute(
2026-01-25T08:57:21.9847598Z -            '''SELECT c.id, c.author_id, c.post_id, c.content, c.created,
2026-01-25T08:57:21.9847882Z +            """SELECT c.id, c.author_id, c.post_id, c.content, c.created,
2026-01-25T08:57:21.9848261Z                        u.username as author_username, u.discriminator as author_discriminator
2026-01-25T08:57:21.9848409Z                 FROM comment c
2026-01-25T08:57:21.9848592Z                 JOIN user u ON c.author_id = u.id
2026-01-25T08:57:21.9848743Z                 WHERE c.post_id = ?
2026-01-25T08:57:21.9848915Z -               ORDER BY c.created ASC''',
2026-01-25T08:57:21.9849047Z -            (post_id,)
2026-01-25T08:57:21.9849214Z +               ORDER BY c.created ASC""",
2026-01-25T08:57:21.9849358Z +            (post_id,),
2026-01-25T08:57:21.9849506Z          ).fetchall()
2026-01-25T08:57:21.9849623Z -        
2026-01-25T08:57:21.9849741Z +
2026-01-25T08:57:21.9849884Z          comments = []
2026-01-25T08:57:21.9850019Z          for row in rows:
2026-01-25T08:57:21.9850192Z -            comments.append(Comment(
2026-01-25T08:57:21.9850341Z -                id=row['id'],
2026-01-25T08:57:21.9850506Z -                author_id=row['author_id'],
2026-01-25T08:57:21.9850673Z -                post_id=row['post_id'],
2026-01-25T08:57:21.9850822Z -                content=row['content'],
2026-01-25T08:57:21.9851373Z -                created=datetime.fromisoformat(row['created']) if isinstance(row['created'], str) else row['created'],
2026-01-25T08:57:21.9851580Z -                author_username=row['author_username'],
2026-01-25T08:57:21.9851825Z -                author_discriminator=row['author_discriminator']
2026-01-25T08:57:21.9851956Z -            ))
2026-01-25T08:57:21.9852078Z -        
2026-01-25T08:57:21.9852231Z +            comments.append(
2026-01-25T08:57:21.9852580Z +                Comment(
2026-01-25T08:57:21.9852725Z +                    id=row["id"],
2026-01-25T08:57:21.9853113Z +                    author_id=row["author_id"],
2026-01-25T08:57:21.9853285Z +                    post_id=row["post_id"],
2026-01-25T08:57:21.9853444Z +                    content=row["content"],
2026-01-25T08:57:21.9853586Z +                    created=(
2026-01-25T08:57:21.9853812Z +                        datetime.fromisoformat(row["created"])
2026-01-25T08:57:21.9854009Z +                        if isinstance(row["created"], str)
2026-01-25T08:57:21.9854177Z +                        else row["created"]
2026-01-25T08:57:21.9854322Z +                    ),
2026-01-25T08:57:21.9854536Z +                    author_username=row["author_username"],
2026-01-25T08:57:21.9854798Z +                    author_discriminator=row["author_discriminator"],
2026-01-25T08:57:21.9854919Z +                )
2026-01-25T08:57:21.9855042Z +            )
2026-01-25T08:57:21.9855165Z +
2026-01-25T08:57:21.9855303Z          return comments
2026-01-25T08:57:21.9855427Z -    
2026-01-25T08:57:21.9855568Z +
2026-01-25T08:57:21.9855702Z      @staticmethod
2026-01-25T08:57:21.9855930Z      def delete(comment_id: int, user_id: int) -> bool:
2026-01-25T08:57:21.9856321Z          """Удаляет комментарий (только если пользователь является автором).
2026-01-25T08:57:21.9856446Z -        
2026-01-25T08:57:21.9856568Z +
2026-01-25T08:57:21.9856693Z          Args:
2026-01-25T08:57:21.9856955Z              comment_id: ID комментария
2026-01-25T08:57:21.9857390Z              user_id: ID пользователя, который пытается удалить
2026-01-25T08:57:21.9857511Z -            
2026-01-25T08:57:21.9857635Z +
2026-01-25T08:57:21.9857758Z          Returns:
2026-01-25T08:57:21.9858164Z              bool: True если комментарий удалён, False если нет прав или не найден
2026-01-25T08:57:21.9858295Z          """
2026-01-25T08:57:21.9858429Z          db = get_db()
2026-01-25T08:57:21.9858544Z -        
2026-01-25T08:57:21.9858700Z +
2026-01-25T08:57:21.9859025Z          # Проверяем, что пользователь является автором комментария
2026-01-25T08:57:21.9859383Z          comment = db.execute(
2026-01-25T08:57:21.9859624Z -            'SELECT author_id FROM comment WHERE id = ?',
2026-01-25T08:57:21.9859828Z -            (comment_id,)
2026-01-25T08:57:21.9860148Z +            "SELECT author_id FROM comment WHERE id = ?", (comment_id,)
2026-01-25T08:57:21.9860285Z          ).fetchone()
2026-01-25T08:57:21.9860405Z -        
2026-01-25T08:57:21.9860655Z -        if comment is None or comment['author_id'] != user_id:
2026-01-25T08:57:21.9860772Z +
2026-01-25T08:57:21.9861001Z +        if comment is None or comment["author_id"] != user_id:
2026-01-25T08:57:21.9861143Z              return False
2026-01-25T08:57:21.9861255Z -        
2026-01-25T08:57:21.9861366Z +
2026-01-25T08:57:21.9861598Z          # Удаляем комментарий
2026-01-25T08:57:21.9861739Z -        cursor = db.execute(
2026-01-25T08:57:21.9861927Z -            'DELETE FROM comment WHERE id = ?',
2026-01-25T08:57:21.9862080Z -            (comment_id,)
2026-01-25T08:57:21.9862197Z -        )
2026-01-25T08:57:21.9862541Z +        cursor = db.execute("DELETE FROM comment WHERE id = ?", (comment_id,))
2026-01-25T08:57:21.9862676Z          db.commit()
2026-01-25T08:57:21.9862789Z -        
2026-01-25T08:57:21.9863096Z +
2026-01-25T08:57:21.9863264Z          return cursor.rowcount > 0
2026-01-25T08:57:21.9863382Z -    
2026-01-25T08:57:21.9863503Z +
2026-01-25T08:57:21.9863631Z      @staticmethod
2026-01-25T08:57:21.9863838Z      def get_count_by_post_id(post_id: int) -> int:
2026-01-25T08:57:21.9864147Z          """Получает количество комментариев к посту.
2026-01-25T08:57:21.9864265Z -        
2026-01-25T08:57:21.9864388Z +
2026-01-25T08:57:21.9864507Z          Args:
2026-01-25T08:57:21.9864723Z              post_id: ID поста
2026-01-25T08:57:21.9864851Z -            
2026-01-25T08:57:21.9864964Z +
2026-01-25T08:57:21.9865087Z          Returns:
2026-01-25T08:57:21.9865551Z              int: количество комментариев
2026-01-25T08:57:21.9865675Z          """
2026-01-25T08:57:21.9865811Z          db = get_db()
2026-01-25T08:57:21.9865973Z          row = db.execute(
2026-01-25T08:57:21.9866255Z -            'SELECT COUNT(*) as count FROM comment WHERE post_id = ?',
2026-01-25T08:57:21.9866421Z -            (post_id,)
2026-01-25T08:57:21.9866750Z +            "SELECT COUNT(*) as count FROM comment WHERE post_id = ?", (post_id,)
2026-01-25T08:57:21.9866896Z          ).fetchone()
2026-01-25T08:57:21.9867033Z -        
2026-01-25T08:57:21.9867209Z -        return row['count'] if row else 0
2026-01-25T08:57:21.9867324Z -    
2026-01-25T08:57:21.9867460Z +
2026-01-25T08:57:21.9867643Z +        return row["count"] if row else 0
2026-01-25T08:57:21.9867773Z +
2026-01-25T08:57:21.9867958Z      @staticmethod
2026-01-25T08:57:21.9868260Z      def update(comment_id: int, user_id: int, content: str) -> bool:
2026-01-25T08:57:21.9868707Z          """Обновляет текст комментария (только если пользователь является автором).
2026-01-25T08:57:21.9868872Z -        
2026-01-25T08:57:21.9869006Z +
2026-01-25T08:57:21.9869149Z          Args:
2026-01-25T08:57:21.9869434Z              comment_id: ID комментария
2026-01-25T08:57:21.9869822Z              user_id: ID пользователя, который пытается обновить
2026-01-25T08:57:21.9870097Z              content: Новый текст комментария
2026-01-25T08:57:21.9870231Z -            
2026-01-25T08:57:21.9870361Z +
2026-01-25T08:57:21.9870488Z          Returns:
2026-01-25T08:57:21.9870926Z              bool: True если комментарий обновлён, False если нет прав или не найден
2026-01-25T08:57:21.9871061Z          """
2026-01-25T08:57:21.9871216Z          db = get_db()
2026-01-25T08:57:21.9871333Z -        
2026-01-25T08:57:21.9871461Z +
2026-01-25T08:57:21.9871860Z          # Проверяем, что пользователь является автором комментария
2026-01-25T08:57:21.9872058Z          comment = db.execute(
2026-01-25T08:57:21.9872292Z -            'SELECT author_id FROM comment WHERE id = ?',
2026-01-25T08:57:21.9872471Z -            (comment_id,)
2026-01-25T08:57:21.9873287Z +            "SELECT author_id FROM comment WHERE id = ?", (comment_id,)
2026-01-25T08:57:21.9873468Z          ).fetchone()
2026-01-25T08:57:21.9873603Z -        
2026-01-25T08:57:21.9873876Z -        if comment is None or comment['author_id'] != user_id:
2026-01-25T08:57:21.9874004Z +
2026-01-25T08:57:21.9874240Z +        if comment is None or comment["author_id"] != user_id:
2026-01-25T08:57:21.9874441Z              return False
2026-01-25T08:57:21.9874608Z -        
2026-01-25T08:57:21.9874744Z +
2026-01-25T08:57:21.9875001Z          # Обновляем комментарий
2026-01-25T08:57:21.9875188Z          cursor = db.execute(
2026-01-25T08:57:21.9875418Z -            'UPDATE comment SET content = ? WHERE id = ?',
2026-01-25T08:57:21.9875600Z -            (content, comment_id)
2026-01-25T08:57:21.9875996Z +            "UPDATE comment SET content = ? WHERE id = ?", (content, comment_id)
2026-01-25T08:57:21.9876125Z          )
2026-01-25T08:57:21.9876511Z          db.commit()
2026-01-25T08:57:21.9876628Z -        
2026-01-25T08:57:21.9876757Z +
2026-01-25T08:57:21.9876997Z          return cursor.rowcount > 0
2026-01-25T08:57:21.9910676Z would reformat /home/runner/work/flask_blog/flask_blog/app/services/comment_service.py
2026-01-25T08:57:22.0881577Z would reformat /home/runner/work/flask_blog/flask_blog/tests/base.py
2026-01-25T08:57:22.0882603Z --- /home/runner/work/flask_blog/flask_blog/tests/base.py	2026-01-25 08:57:06.653994+00:00
2026-01-25T08:57:22.0883799Z +++ /home/runner/work/flask_blog/flask_blog/tests/base.py	2026-01-25 08:57:22.084527+00:00
2026-01-25T08:57:22.0884478Z @@ -6,210 +6,228 @@
2026-01-25T08:57:22.0884847Z  from app.auth import hash_password
2026-01-25T08:57:22.0885275Z  
2026-01-25T08:57:22.0885620Z  
2026-01-25T08:57:22.0885916Z  class BaseTestCase:
2026-01-25T08:57:22.0886710Z      """Базовый класс с общими методами для всех тестов."""
2026-01-25T08:57:22.0887270Z -    
2026-01-25T08:57:22.0887568Z +
2026-01-25T08:57:22.0888132Z      def assert_csrf_validation(self, token, expected=True):
2026-01-25T08:57:22.0888860Z          """Унифицированная проверка CSRF валидации.
2026-01-25T08:57:22.0889313Z -        
2026-01-25T08:57:22.0889600Z +
2026-01-25T08:57:22.0889869Z          Args:
2026-01-25T08:57:22.0890326Z              token: CSRF токен для проверки
2026-01-25T08:57:22.0890962Z              expected: Ожидаемый результат (True/False)
2026-01-25T08:57:22.0891419Z          """
2026-01-25T08:57:22.0891756Z          result = validate_csrf_token(token)
2026-01-25T08:57:22.0892529Z -        assert result is expected, f"CSRF validation failed: expected {expected}, got {result}"
2026-01-25T08:57:22.0893538Z -    
2026-01-25T08:57:22.0893843Z +        assert (
2026-01-25T08:57:22.0894182Z +            result is expected
2026-01-25T08:57:22.0894851Z +        ), f"CSRF validation failed: expected {expected}, got {result}"
2026-01-25T08:57:22.0895421Z +
2026-01-25T08:57:22.0895737Z      def assert_csrf_token_generation(self):
2026-01-25T08:57:22.0896361Z          """Проверка генерации CSRF токена."""
2026-01-25T08:57:22.0896833Z          token = generate_csrf_token()
2026-01-25T08:57:22.0897697Z          assert token is not None
2026-01-25T08:57:22.0898173Z          assert len(token) > 0
2026-01-25T08:57:22.0898617Z          assert len(token) == 64  # SHA256 hex
2026-01-25T08:57:22.0899065Z          return token
2026-01-25T08:57:22.0899396Z -    
2026-01-25T08:57:22.0901138Z -    def create_test_user_data(self, username="test_user", discriminator=1234, ***):
2026-01-25T08:57:22.0901864Z +
2026-01-25T08:57:22.0902174Z +    def create_test_user_data(
2026-01-25T08:57:22.0902823Z +        self, username="test_user", discriminator=1234, ***
2026-01-25T08:57:22.0903677Z +    ):
2026-01-25T08:57:22.0904186Z          """Создание данных для тестового пользователя.
2026-01-25T08:57:22.0904650Z -        
2026-01-25T08:57:22.0904941Z +
2026-01-25T08:57:22.0905212Z          Returns:
2026-01-25T08:57:22.0905711Z              dict: Данные пользователя с хэшированным паролем
2026-01-25T08:57:22.0906223Z          """
2026-01-25T08:57:22.0906606Z          hashed_pw, salt = hash_password(password)
2026-01-25T08:57:22.0907109Z          return {
2026-01-25T08:57:22.0907485Z -            'username': username,
2026-01-25T08:57:22.0907968Z -            'discriminator': discriminator,
2026-01-25T08:57:22.0908451Z -            'password': password,
2026-01-25T08:57:22.0908897Z -            'hashed_password': hashed_pw,
2026-01-25T08:57:22.0909349Z -            'salt': salt
2026-01-25T08:57:22.0909755Z +            "username": username,
2026-01-25T08:57:22.0910210Z +            "discriminator": discriminator,
2026-01-25T08:57:22.0910702Z +            "password": password,
2026-01-25T08:57:22.0911139Z +            "hashed_password": hashed_pw,
2026-01-25T08:57:22.0911578Z +            "salt": salt,
2026-01-25T08:57:22.0911940Z          }
2026-01-25T08:57:22.0912230Z -    
2026-01-25T08:57:22.0912503Z +
2026-01-25T08:57:22.0913179Z      def assert_form_validation_error(self, response, error_keywords=None):
2026-01-25T08:57:22.0914505Z          """Проверка наличия ошибок валидации в ответе.
2026-01-25T08:57:22.0914991Z -        
2026-01-25T08:57:22.0915280Z +
2026-01-25T08:57:22.0915564Z          Args:
2026-01-25T08:57:22.0916018Z              response: Response объект
2026-01-25T08:57:22.0916687Z              error_keywords: Список ключевых слов для поиска в ошибке
2026-01-25T08:57:22.0917238Z          """
2026-01-25T08:57:22.0917631Z          assert response.status_code == 200
2026-01-25T08:57:22.0918213Z -        response_text = response.data.decode('utf-8').lower()
2026-01-25T08:57:22.0918770Z -        
2026-01-25T08:57:22.0919197Z +        response_text = response.data.decode("utf-8").lower()
2026-01-25T08:57:22.0919724Z +
2026-01-25T08:57:22.0920113Z          # Стандартные проверки ошибок
2026-01-25T08:57:22.0921013Z -        error_indicators = ['alert-danger', 'ошибка', 'обязательно', 'должно быть', 'формат', 'неверный']
2026-01-25T08:57:22.0921974Z -        assert any(indicator in response_text for indicator in error_indicators), \
2026-01-25T08:57:22.0923160Z -            f"No validation error found in response: {response_text[:200]}"
2026-01-25T08:57:22.0923842Z -        
2026-01-25T08:57:22.0924178Z +        error_indicators = [
2026-01-25T08:57:22.0924583Z +            "alert-danger",
2026-01-25T08:57:22.0925039Z +            "ошибка",
2026-01-25T08:57:22.0925456Z +            "обязательно",
2026-01-25T08:57:22.0925892Z +            "должно быть",
2026-01-25T08:57:22.0926390Z +            "формат",
2026-01-25T08:57:22.0926789Z +            "неверный",
2026-01-25T08:57:22.0927127Z +        ]
2026-01-25T08:57:22.0927415Z +        assert any(
2026-01-25T08:57:22.0927909Z +            indicator in response_text for indicator in error_indicators
2026-01-25T08:57:22.0928651Z +        ), f"No validation error found in response: {response_text[:200]}"
2026-01-25T08:57:22.0929224Z +
2026-01-25T08:57:22.0929708Z          # Дополнительные проверки по ключевым словам
2026-01-25T08:57:22.0930199Z          if error_keywords:
2026-01-25T08:57:22.0930610Z              for keyword in error_keywords:
2026-01-25T08:57:22.0931466Z -                assert keyword.lower() in response_text, \
2026-01-25T08:57:22.0932140Z -                    f"Keyword '{keyword}' not found in error message"
2026-01-25T08:57:22.0932864Z -    
2026-01-25T08:57:22.0963806Z +                assert (
2026-01-25T08:57:22.0964292Z +                    keyword.lower() in response_text
2026-01-25T08:57:22.0964906Z +                ), f"Keyword '{keyword}' not found in error message"
2026-01-25T08:57:22.0965433Z +
2026-01-25T08:57:22.0965881Z      def assert_success_response(self, response, status_codes=None):
2026-01-25T08:57:22.0966758Z          """Проверка успешного ответа.
2026-01-25T08:57:22.0967222Z -        
2026-01-25T08:57:22.0967569Z +
2026-01-25T08:57:22.0967893Z          Args:
2026-01-25T08:57:22.0968310Z              response: Response объект
2026-01-25T08:57:22.0968920Z              status_codes: Разрешенные коды успешного ответа
2026-01-25T08:57:22.0969457Z          """
2026-01-25T08:57:22.0969786Z          if status_codes is None:
2026-01-25T08:57:22.0970467Z              status_codes = [200, 302]  # OK или Redirect
2026-01-25T08:57:22.0970932Z -        
2026-01-25T08:57:22.0971270Z -        assert response.status_code in status_codes, \
2026-01-25T08:57:22.0971987Z -            f"Expected success status {status_codes}, got {response.status_code}"
2026-01-25T08:57:22.0972613Z -    
2026-01-25T08:57:22.0973379Z -    def setup_csrf_in_session(self, client, token_base='test_token_base'):
2026-01-25T08:57:22.0973980Z +
2026-01-25T08:57:22.0974247Z +        assert (
2026-01-25T08:57:22.0974629Z +            response.status_code in status_codes
2026-01-25T08:57:22.0975283Z +        ), f"Expected success status {status_codes}, got {response.status_code}"
2026-01-25T08:57:22.0975883Z +
2026-01-25T08:57:22.0976339Z +    def setup_csrf_in_session(self, client, token_base="test_token_base"):
2026-01-25T08:57:22.0977566Z          """Установка CSRF токена в сессии клиента.
2026-01-25T08:57:22.0978036Z -        
2026-01-25T08:57:22.0978310Z +
2026-01-25T08:57:22.0978617Z          Args:
2026-01-25T08:57:22.0979187Z              client: Test клиент
2026-01-25T08:57:22.0979715Z              token_base: База для генерации токена
2026-01-25T08:57:22.0980148Z -            
2026-01-25T08:57:22.0980438Z +
2026-01-25T08:57:22.0980702Z          Returns:
2026-01-25T08:57:22.0981142Z              str: Сгенерированный токен
2026-01-25T08:57:22.0981566Z          """
2026-01-25T08:57:22.0981926Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.0982489Z -            sess['_csrf_token'] = token_base
2026-01-25T08:57:22.0983343Z +            sess["_csrf_token"] = token_base
2026-01-25T08:57:22.0983823Z          return generate_csrf_token()
2026-01-25T08:57:22.0984283Z  
2026-01-25T08:57:22.0984571Z  
2026-01-25T08:57:22.0984897Z  class DatabaseTestHelper:
2026-01-25T08:57:22.0985542Z      """Хелпер для операций с базой данных в тестах."""
2026-01-25T08:57:22.0986041Z -    
2026-01-25T08:57:22.0986340Z +
2026-01-25T08:57:22.0986608Z      @staticmethod
2026-01-25T08:57:22.0987214Z      def create_user_with_password(db, username, discriminator, password):
2026-01-25T08:57:22.0988025Z          """Создание пользователя с хэшированным паролем.
2026-01-25T08:57:22.0988486Z -        
2026-01-25T08:57:22.0988807Z +
2026-01-25T08:57:22.0989108Z          Args:
2026-01-25T08:57:22.0989577Z              db: Объект базы данных
2026-01-25T08:57:22.0990139Z              username: Имя пользователя
2026-01-25T08:57:22.0990662Z              discriminator: Дискриминатор
2026-01-25T08:57:22.0991218Z              password: Пароль
2026-01-25T08:57:22.0991586Z -            
2026-01-25T08:57:22.0991878Z +
2026-01-25T08:57:22.0992165Z          Returns:
2026-01-25T08:57:22.0992534Z              tuple: (hashed_password, salt)
2026-01-25T08:57:22.1023339Z          """
2026-01-25T08:57:22.1023887Z          hashed_pw, salt = hash_password(password)
2026-01-25T08:57:22.1024448Z          db.execute(
2026-01-25T08:57:22.1025568Z -            'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.1026411Z -            (username, discriminator, hashed_pw, salt)
2026-01-25T08:57:22.1027181Z +            "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.1027999Z +            (username, discriminator, hashed_pw, salt),
2026-01-25T08:57:22.1028505Z          )
2026-01-25T08:57:22.1028850Z          return hashed_pw, salt
2026-01-25T08:57:22.1029280Z -    
2026-01-25T08:57:22.1029597Z -    @staticmethod
2026-01-25T08:57:22.1030273Z -    def create_user_with_post(db, username, discriminator, password, post_title, post_content):
2026-01-25T08:57:22.1031034Z +
2026-01-25T08:57:22.1031291Z +    @staticmethod
2026-01-25T08:57:22.1031615Z +    def create_user_with_post(
2026-01-25T08:57:22.1032229Z +        db, username, discriminator, password, post_title, post_content
2026-01-25T08:57:22.1032828Z +    ):
2026-01-25T08:57:22.1033666Z          """Создание пользователя с постом для тестов.
2026-01-25T08:57:22.1034175Z -        
2026-01-25T08:57:22.1034611Z +
2026-01-25T08:57:22.1034987Z          Args:
2026-01-25T08:57:22.1035427Z              db: Объект базы данных
2026-01-25T08:57:22.1035985Z              username: Имя пользователя
2026-01-25T08:57:22.1036557Z              discriminator: Дискриминатор
2026-01-25T08:57:22.1037109Z              password: Пароль
2026-01-25T08:57:22.1037649Z              post_title: Заголовок поста
2026-01-25T08:57:22.1038292Z              post_content: Содержание поста
2026-01-25T08:57:22.1038738Z -            
2026-01-25T08:57:22.1039043Z +
2026-01-25T08:57:22.1039334Z          Returns:
2026-01-25T08:57:22.1039719Z              tuple: (user_id, post_id)
2026-01-25T08:57:22.1040167Z          """
2026-01-25T08:57:22.1040597Z          # Создаем пользователя
2026-01-25T08:57:22.1041071Z          hashed_pw, salt = hash_password(password)
2026-01-25T08:57:22.1041892Z          db.execute(
2026-01-25T08:57:22.1042572Z -            'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.1043655Z -            (username, discriminator, hashed_pw, salt)
2026-01-25T08:57:22.1044436Z +            "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.1045228Z +            (username, discriminator, hashed_pw, salt),
2026-01-25T08:57:22.1045721Z          )
2026-01-25T08:57:22.1046056Z          db.commit()
2026-01-25T08:57:22.1046443Z -        
2026-01-25T08:57:22.1046740Z +
2026-01-25T08:57:22.1047206Z          # Получаем ID пользователя
2026-01-25T08:57:22.1047659Z          user = db.execute(
2026-01-25T08:57:22.1048212Z -            'SELECT id FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.1048859Z -            (username, discriminator)
2026-01-25T08:57:22.1049484Z +            "SELECT id FROM user WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.1050145Z +            (username, discriminator),
2026-01-25T08:57:22.1050607Z          ).fetchone()
2026-01-25T08:57:22.1050993Z -        
2026-01-25T08:57:22.1051386Z -        user_id = user['id'] if user else None
2026-01-25T08:57:22.1051853Z -        
2026-01-25T08:57:22.1052168Z +
2026-01-25T08:57:22.1052568Z +        user_id = user["id"] if user else None
2026-01-25T08:57:22.1083554Z +
2026-01-25T08:57:22.1084015Z          if user_id:
2026-01-25T08:57:22.1084661Z              # Создаем пост
2026-01-25T08:57:22.1085153Z              db.execute(
2026-01-25T08:57:22.1085890Z -                'INSERT INTO post (title, content, author_id) VALUES (?, ?, ?)',
2026-01-25T08:57:22.1086691Z -                (post_title, post_content, user_id)
2026-01-25T08:57:22.1087446Z +                "INSERT INTO post (title, content, author_id) VALUES (?, ?, ?)",
2026-01-25T08:57:22.1088356Z +                (post_title, post_content, user_id),
2026-01-25T08:57:22.1088887Z              )
2026-01-25T08:57:22.1089402Z              db.commit()
2026-01-25T08:57:22.1089841Z -            
2026-01-25T08:57:22.1090225Z +
2026-01-25T08:57:22.1091141Z              # Получаем ID поста
2026-01-25T08:57:22.1091674Z              post = db.execute(
2026-01-25T08:57:22.1092312Z -                'SELECT id FROM post WHERE title = ? AND author_id = ?',
2026-01-25T08:57:22.1093400Z -                (post_title, user_id)
2026-01-25T08:57:22.1094171Z +                "SELECT id FROM post WHERE title = ? AND author_id = ?",
2026-01-25T08:57:22.1094826Z +                (post_title, user_id),
2026-01-25T08:57:22.1095427Z              ).fetchone()
2026-01-25T08:57:22.1095890Z -            
2026-01-25T08:57:22.1096356Z -            post_id = post['id'] if post else None
2026-01-25T08:57:22.1096834Z +
2026-01-25T08:57:22.1097218Z +            post_id = post["id"] if post else None
2026-01-25T08:57:22.1097794Z              return user_id, post_id
2026-01-25T08:57:22.1098276Z -        
2026-01-25T08:57:22.1098578Z +
2026-01-25T08:57:22.1098974Z          return user_id, None
2026-01-25T08:57:22.1099405Z -    
2026-01-25T08:57:22.1099699Z +
2026-01-25T08:57:22.1099994Z      @staticmethod
2026-01-25T08:57:22.1100619Z      def cleanup_test_data(db, usernames=None, user_ids=None):
2026-01-25T08:57:22.1101357Z          """Очистка тестовых данных.
2026-01-25T08:57:22.1101805Z -        
2026-01-25T08:57:22.1102106Z +
2026-01-25T08:57:22.1102386Z          Args:
2026-01-25T08:57:22.1102825Z              db: Объект базы данных
2026-01-25T08:57:22.1103913Z              usernames: Список имён пользователей для удаления
2026-01-25T08:57:22.1104731Z              user_ids: Список ID пользователей для удаления
2026-01-25T08:57:22.1105299Z          """
2026-01-25T08:57:22.1105634Z          if usernames:
2026-01-25T08:57:22.1106115Z -            placeholders = ','.join('?' for _ in usernames)
2026-01-25T08:57:22.1106902Z -            db.execute(f'DELETE FROM user WHERE username IN ({placeholders})', usernames)
2026-01-25T08:57:22.1107589Z -        
2026-01-25T08:57:22.1108379Z +            placeholders = ",".join("?" for _ in usernames)
2026-01-25T08:57:22.1108915Z +            db.execute(
2026-01-25T08:57:22.1109523Z +                f"DELETE FROM user WHERE username IN ({placeholders})", usernames
2026-01-25T08:57:22.1110172Z +            )
2026-01-25T08:57:22.1110478Z +
2026-01-25T08:57:22.1110773Z          if user_ids:
2026-01-25T08:57:22.1111226Z -            placeholders = ','.join('?' for _ in user_ids)
2026-01-25T08:57:22.1111956Z -            db.execute(f'DELETE FROM user WHERE id IN ({placeholders})', user_ids)
2026-01-25T08:57:22.1112652Z -        
2026-01-25T08:57:22.1143602Z +            placeholders = ",".join("?" for _ in user_ids)
2026-01-25T08:57:22.1144406Z +            db.execute(f"DELETE FROM user WHERE id IN ({placeholders})", user_ids)
2026-01-25T08:57:22.1145055Z +
2026-01-25T08:57:22.1145361Z          db.commit()
2026-01-25T08:57:22.1145702Z  
2026-01-25T08:57:22.1145968Z  
2026-01-25T08:57:22.1146285Z  class FormTestHelper:
2026-01-25T08:57:22.1146875Z      """Хелпер для тестирования форм."""
2026-01-25T08:57:22.1147299Z -    
2026-01-25T08:57:22.1147591Z +
2026-01-25T08:57:22.1147900Z      @staticmethod
2026-01-25T08:57:22.1148394Z      def create_form_data_with_csrf(client, **kwargs):
2026-01-25T08:57:22.1149073Z          """Создание данных формы с CSRF токеном.
2026-01-25T08:57:22.1149578Z -        
2026-01-25T08:57:22.1149884Z +
2026-01-25T08:57:22.1150182Z          Args:
2026-01-25T08:57:22.1150672Z              client: Test клиент
2026-01-25T08:57:22.1151237Z              **kwargs: Дополнительные поля формы
2026-01-25T08:57:22.1151789Z -            
2026-01-25T08:57:22.1152104Z +
2026-01-25T08:57:22.1152391Z          Returns:
2026-01-25T08:57:22.1152865Z              dict: Данные формы с CSRF токеном
2026-01-25T08:57:22.1153542Z          """
2026-01-25T08:57:22.1154090Z          # В тестах используем фиксированный токен
2026-01-25T08:57:22.1154641Z -        token = 'test_csrf_token_for_testing'
2026-01-25T08:57:22.1155159Z -        form_data = {'csrf_token': token}
2026-01-25T08:57:22.1155687Z +        token = "test_csrf_token_for_testing"
2026-01-25T08:57:22.1156570Z +        form_data = {"csrf_token": token}
2026-01-25T08:57:22.1157107Z          form_data.update(kwargs)
2026-01-25T08:57:22.1157560Z          return form_data
2026-01-25T08:57:22.1157960Z -    
2026-01-25T08:57:22.1158244Z +
2026-01-25T08:57:22.1158540Z      @staticmethod
2026-01-25T08:57:22.1158999Z      def assert_form_fields_exist(form, *field_names):
2026-01-25T08:57:22.1159711Z          """Проверка наличия полей в форме.
2026-01-25T08:57:22.1160202Z -        
2026-01-25T08:57:22.1160534Z +
2026-01-25T08:57:22.1160824Z          Args:
2026-01-25T08:57:22.1161289Z              form: Объект формы
2026-01-25T08:57:22.1161877Z              *field_names: Имена полей для проверки
2026-01-25T08:57:22.1162346Z          """
2026-01-25T08:57:22.1162694Z          for field_name in field_names:
2026-01-25T08:57:22.1163773Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_comment_counts.py
2026-01-25T08:57:22.1165224Z --- /home/runner/work/flask_blog/flask_blog/tests/test_comment_counts.py	2026-01-25 08:57:06.653994+00:00
2026-01-25T08:57:22.1166449Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_comment_counts.py	2026-01-25 08:57:22.096886+00:00
2026-01-25T08:57:22.1167324Z @@ -1,85 +1,97 @@
2026-01-25T08:57:22.1167953Z  """Тесты для проверки счетчиков комментариев на главной странице."""
2026-01-25T08:57:22.1168508Z +
2026-01-25T08:57:22.1168795Z  import pytest
2026-01-25T08:57:22.1169237Z  from app.services.post_service import PostService
2026-01-25T08:57:22.1169900Z  from app.services.comment_service import CommentService
2026-01-25T08:57:22.1170447Z  
2026-01-25T08:57:22.1170754Z  
2026-01-25T08:57:22.1171074Z  class TestCommentCounts:
2026-01-25T08:57:22.1171622Z      """Тестирование счетчиков комментариев."""
2026-01-25T08:57:22.1172075Z -    
2026-01-25T08:57:22.1172383Z +
2026-01-25T08:57:22.1172845Z      def test_post_service_get_all_includes_comment_count(self, app):
2026-01-25T08:57:22.1204362Z          """Проверяет, что PostService.get_all() возвращает посты с количеством комментариев."""
2026-01-25T08:57:22.1205148Z          with app.app_context():
2026-01-25T08:57:22.1205637Z              posts = PostService.get_all()
2026-01-25T08:57:22.1206080Z -            
2026-01-25T08:57:22.1206389Z +
2026-01-25T08:57:22.1206869Z              # Проверяем, что у всех постов есть поле comment_count
2026-01-25T08:57:22.1207371Z              for post in posts:
2026-01-25T08:57:22.1208135Z -                assert hasattr(post, 'comment_count'), f"У поста {post.id} нет поля comment_count"
2026-01-25T08:57:22.1209350Z -                assert isinstance(post.comment_count, int), f"comment_count должен быть int, а не {type(post.comment_count)}"
2026-01-25T08:57:22.1210590Z -                assert post.comment_count >= 0, f"comment_count не может быть отрицательным: {post.comment_count}"
2026-01-25T08:57:22.1211230Z -    
2026-01-25T08:57:22.1211483Z +                assert hasattr(
2026-01-25T08:57:22.1211858Z +                    post, "comment_count"
2026-01-25T08:57:22.1212621Z +                ), f"У поста {post.id} нет поля comment_count"
2026-01-25T08:57:22.1213184Z +                assert isinstance(
2026-01-25T08:57:22.1213531Z +                    post.comment_count, int
2026-01-25T08:57:22.1214153Z +                ), f"comment_count должен быть int, а не {type(post.comment_count)}"
2026-01-25T08:57:22.1214605Z +                assert (
2026-01-25T08:57:22.1214954Z +                    post.comment_count >= 0
2026-01-25T08:57:22.1215678Z +                ), f"comment_count не может быть отрицательным: {post.comment_count}"
2026-01-25T08:57:22.1216254Z +
2026-01-25T08:57:22.1216693Z      def test_comment_count_matches_database(self, app):
2026-01-25T08:57:22.1217508Z          """Проверяет, что счетчики комментариев соответствуют данным в БД."""
2026-01-25T08:57:22.1218101Z          with app.app_context():
2026-01-25T08:57:22.1218592Z              posts = PostService.get_all()
2026-01-25T08:57:22.1219088Z -            
2026-01-25T08:57:22.1219425Z +
2026-01-25T08:57:22.1219778Z              for post in posts:
2026-01-25T08:57:22.1220476Z                  # Получаем количество комментариев напрямую из БД
2026-01-25T08:57:22.1221162Z                  actual_count = CommentService.get_count_by_post_id(post.id)
2026-01-25T08:57:22.1221747Z -                
2026-01-25T08:57:22.1222070Z +
2026-01-25T08:57:22.1222562Z                  # Сравниваем со значением из PostService
2026-01-25T08:57:22.1223345Z                  assert post.comment_count == actual_count, (
2026-01-25T08:57:22.1224072Z                      f"Несоответствие для поста {post.id}: "
2026-01-25T08:57:22.1224772Z                      f"PostService вернул {post.comment_count}, "
2026-01-25T08:57:22.1225474Z                      f"в БД фактически {actual_count}"
2026-01-25T08:57:22.1225921Z                  )
2026-01-25T08:57:22.1226249Z -    
2026-01-25T08:57:22.1226538Z +
2026-01-25T08:57:22.1226942Z      def test_index_page_renders_comment_counts(self, client):
2026-01-25T08:57:22.1228181Z          """Проверяет, что главная страница корректно отображает счетчики комментариев."""
2026-01-25T08:57:22.1228839Z -        response = client.get('/')
2026-01-25T08:57:22.1229328Z +        response = client.get("/")
2026-01-25T08:57:22.1229857Z          assert response.status_code == 200
2026-01-25T08:57:22.1230350Z -        
2026-01-25T08:57:22.1230636Z +
2026-01-25T08:57:22.1230980Z          html = response.get_data(as_text=True)
2026-01-25T08:57:22.1231451Z -        
2026-01-25T08:57:22.1231761Z +
2026-01-25T08:57:22.1232313Z          # Получаем посты для проверки
2026-01-25T08:57:22.1232821Z          with client.application.app_context():
2026-01-25T08:57:22.1263711Z              posts = PostService.get_all()
2026-01-25T08:57:22.1264177Z -            
2026-01-25T08:57:22.1264500Z +
2026-01-25T08:57:22.1265169Z              # Проверяем, что каждый пост отображает правильное количество комментариев
2026-01-25T08:57:22.1265797Z              for post in posts:
2026-01-25T08:57:22.1266540Z                  # Ищем в HTML количество комментариев для этого поста
2026-01-25T08:57:22.1267111Z                  import re
2026-01-25T08:57:22.1267472Z +
2026-01-25T08:57:22.1268019Z                  # Ищем ссылку на пост и следующий за ней блок с комментариями
2026-01-25T08:57:22.1268878Z                  post_pattern = f'href="/post/{post.id}"[^>]*>.*?fa-comment[^>]*>.*?<span[^>]*>(\d+)</span>'
2026-01-25T08:57:22.1269747Z                  matches = re.findall(post_pattern, html, re.DOTALL)
2026-01-25T08:57:22.1270295Z -                
2026-01-25T08:57:22.1270628Z +
2026-01-25T08:57:22.1270932Z                  if matches:
2026-01-25T08:57:22.1271378Z                      displayed_count = int(matches[0])
2026-01-25T08:57:22.1271980Z                      assert displayed_count == post.comment_count, (
2026-01-25T08:57:22.1272810Z                          f"Для поста {post.id} отображается {displayed_count}, "
2026-01-25T08:57:22.1273798Z                          f"а должно быть {post.comment_count}"
2026-01-25T08:57:22.1274337Z                      )
2026-01-25T08:57:22.1274682Z -    
2026-01-25T08:57:22.1275289Z +
2026-01-25T08:57:22.1275801Z      def test_comment_count_zero_for_posts_without_comments(self, app):
2026-01-25T08:57:22.1276677Z          """Проверяет, что у постов без комментариев счетчик равен 0."""
2026-01-25T08:57:22.1277256Z          with app.app_context():
2026-01-25T08:57:22.1277717Z              posts = PostService.get_all()
2026-01-25T08:57:22.1278175Z -            
2026-01-25T08:57:22.1278481Z +
2026-01-25T08:57:22.1278791Z              for post in posts:
2026-01-25T08:57:22.1279372Z                  actual_count = CommentService.get_count_by_post_id(post.id)
2026-01-25T08:57:22.1280027Z                  if actual_count == 0:
2026-01-25T08:57:22.1280985Z -                    assert post.comment_count == 0, f"У поста {post.id} без комментариев счетчик должен быть 0"
2026-01-25T08:57:22.1281723Z -    
2026-01-25T08:57:22.1282070Z +                    assert (
2026-01-25T08:57:22.1282518Z +                        post.comment_count == 0
2026-01-25T08:57:22.1283543Z +                    ), f"У поста {post.id} без комментариев счетчик должен быть 0"
2026-01-25T08:57:22.1284110Z +
2026-01-25T08:57:22.1284610Z      def test_comment_count_positive_for_posts_with_comments(self, app):
2026-01-25T08:57:22.1285544Z          """Проверяет, что у постов с комментариями счетчик больше 0."""
2026-01-25T08:57:22.1286148Z          with app.app_context():
2026-01-25T08:57:22.1286656Z              posts = PostService.get_all()
2026-01-25T08:57:22.1287100Z -            
2026-01-25T08:57:22.1287423Z +
2026-01-25T08:57:22.1287741Z              for post in posts:
2026-01-25T08:57:22.1288329Z                  actual_count = CommentService.get_count_by_post_id(post.id)
2026-01-25T08:57:22.1288955Z                  if actual_count > 0:
2026-01-25T08:57:22.1289897Z -                    assert post.comment_count > 0, f"У поста {post.id} с комментариями счетчик должен быть > 0"
2026-01-25T08:57:22.1290967Z +                    assert (
2026-01-25T08:57:22.1291428Z +                        post.comment_count > 0
2026-01-25T08:57:22.1292196Z +                    ), f"У поста {post.id} с комментариями счетчик должен быть > 0"
2026-01-25T08:57:22.1292873Z                      assert post.comment_count == actual_count, (
2026-01-25T08:57:22.1324081Z                          f"У поста {post.id} счетчик {post.comment_count}, "
2026-01-25T08:57:22.1324912Z                          f"а в БД {actual_count}"
2026-01-25T08:57:22.1325408Z                      )
2026-01-25T08:57:22.2290606Z --- /home/runner/work/flask_blog/flask_blog/tests/conftest.py	2026-01-25 08:57:06.653994+00:00
2026-01-25T08:57:22.2298162Z would reformat /home/runner/work/flask_blog/flask_blog/tests/conftest.py
2026-01-25T08:57:22.2299127Z +++ /home/runner/work/flask_blog/flask_blog/tests/conftest.py	2026-01-25 08:57:22.224819+00:00
2026-01-25T08:57:22.2301253Z @@ -10,104 +10,110 @@
2026-01-25T08:57:22.2301864Z  from typing import Dict, Any
2026-01-25T08:57:22.2302369Z  
2026-01-25T08:57:22.2303836Z  # Полное подавление предупреждений о временных метках
2026-01-25T08:57:22.2307652Z  if not sys.warnoptions:
2026-01-25T08:57:22.2308091Z      warnings.simplefilter("ignore")
2026-01-25T08:57:22.2308967Z -    warnings.filterwarnings("ignore", category=DeprecationWarning, message=".*default timestamp converter.*")
2026-01-25T08:57:22.2309891Z +    warnings.filterwarnings(
2026-01-25T08:57:22.2310579Z +        "ignore", category=DeprecationWarning, message=".*default timestamp converter.*"
2026-01-25T08:57:22.2311273Z +    )
2026-01-25T08:57:22.2311559Z  
2026-01-25T08:57:22.2311870Z  from app import create_app
2026-01-25T08:57:22.2312284Z  from app.db.db import get_db, init_db
2026-01-25T08:57:22.2312746Z  
2026-01-25T08:57:22.2313244Z  
2026-01-25T08:57:22.2313696Z  def _create_test_app(config: Dict[str, Any]) -> Any:
2026-01-25T08:57:22.2314475Z      """Вспомогательная функция для создания тестового приложения."""
2026-01-25T08:57:22.2315083Z      db_fd, db_path = tempfile.mkstemp()
2026-01-25T08:57:22.2315516Z -    
2026-01-25T08:57:22.2315791Z +
2026-01-25T08:57:22.2316092Z      app_config = {
2026-01-25T08:57:22.2316447Z -        'TESTING': True,
2026-01-25T08:57:22.2316826Z -        'DATABASE': db_path,
2026-01-25T08:57:22.2317308Z -        'SECRET_KEY': 'test-secret-key-for-testing',
2026-01-25T08:57:22.2317873Z -        'ADMIN_PASSWORD': 'test_admin_password',
2026-01-25T08:57:22.2318331Z -        **config
2026-01-25T08:57:22.2318668Z +        "TESTING": True,
2026-01-25T08:57:22.2319058Z +        "DATABASE": db_path,
2026-01-25T08:57:22.2319521Z +        "SECRET_KEY": "test-secret-key-for-testing",
2026-01-25T08:57:22.2320075Z +        "ADMIN_PASSWORD": "test_admin_password",
2026-01-25T08:57:22.2320542Z +        **config,
2026-01-25T08:57:22.2320849Z      }
2026-01-25T08:57:22.2321117Z -    
2026-01-25T08:57:22.2321387Z +
2026-01-25T08:57:22.2321683Z      app = create_app(app_config)
2026-01-25T08:57:22.2322416Z -    
2026-01-25T08:57:22.2322746Z +
2026-01-25T08:57:22.2323592Z      with app.app_context():
2026-01-25T08:57:22.2324318Z          init_db()
2026-01-25T08:57:22.2324838Z          _create_test_data()
2026-01-25T08:57:22.2325397Z -    
2026-01-25T08:57:22.2344960Z +
2026-01-25T08:57:22.2345465Z      return app, db_fd, db_path
2026-01-25T08:57:22.2346009Z  
2026-01-25T08:57:22.2346353Z  
2026-01-25T08:57:22.2346689Z  def _create_test_data():
2026-01-25T08:57:22.2347461Z      """Создает тестовые данные в базе."""
2026-01-25T08:57:22.2348029Z      db = get_db()
2026-01-25T08:57:22.2348482Z      from app.auth import hash_password
2026-01-25T08:57:22.2349093Z -    
2026-01-25T08:57:22.2349562Z +
2026-01-25T08:57:22.2350025Z      # Создаем тестового пользователя
2026-01-25T08:57:22.2350677Z -    hashed_pw, salt = hash_password('test_pass')
2026-01-25T08:57:22.2351303Z +    hashed_pw, salt = hash_password("test_pass")
2026-01-25T08:57:22.2351860Z      db.execute(
2026-01-25T08:57:22.2352512Z -        'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.2353599Z -        ('test_user', 1234, hashed_pw, salt),
2026-01-25T08:57:22.2354508Z +        "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.2355406Z +        ("test_user", 1234, hashed_pw, salt),
2026-01-25T08:57:22.2355919Z      )
2026-01-25T08:57:22.2356284Z      db.commit()
2026-01-25T08:57:22.2356639Z -    
2026-01-25T08:57:22.2356925Z +
2026-01-25T08:57:22.2357366Z      # Создаем тестовые посты
2026-01-25T08:57:22.2358035Z      user_id = 1  # ID первого созданного пользователя
2026-01-25T08:57:22.2358578Z      test_posts = [
2026-01-25T08:57:22.2359236Z -        ('Тестовый пост 1', 'Содержание первого тестового поста', user_id),
2026-01-25T08:57:22.2360058Z -        ('Тестовый пост 2', 'Содержание второго тестового поста', user_id),
2026-01-25T08:57:22.2360946Z -        ('Пост для просмотра', 'Этот пост используется для тестирования просмотра', user_id),
2026-01-25T08:57:22.2361874Z -        ('Новый пост', 'Содержание нового поста для тестов', user_id),
2026-01-25T08:57:22.2363159Z +        ("Тестовый пост 1", "Содержание первого тестового поста", user_id),
2026-01-25T08:57:22.2364032Z +        ("Тестовый пост 2", "Содержание второго тестового поста", user_id),
2026-01-25T08:57:22.2364571Z +        (
2026-01-25T08:57:22.2364873Z +            "Пост для просмотра",
2026-01-25T08:57:22.2365197Z +            "Этот пост используется для тестирования просмотра",
2026-01-25T08:57:22.2365334Z +            user_id,
2026-01-25T08:57:22.2365456Z +        ),
2026-01-25T08:57:22.2365781Z +        ("Новый пост", "Содержание нового поста для тестов", user_id),
2026-01-25T08:57:22.2365885Z      ]
2026-01-25T08:57:22.2365992Z -    
2026-01-25T08:57:22.2366085Z +
2026-01-25T08:57:22.2366255Z      for title, content, author_id in test_posts:
2026-01-25T08:57:22.2366364Z          db.execute(
2026-01-25T08:57:22.2366752Z              'INSERT INTO post (title, content, author_id, created) VALUES (?, ?, ?, datetime("now"))',
2026-01-25T08:57:22.2366971Z -            (title, content, author_id)
2026-01-25T08:57:22.2367127Z +            (title, content, author_id),
2026-01-25T08:57:22.2367235Z          )
2026-01-25T08:57:22.2367344Z      db.commit()
2026-01-25T08:57:22.2367461Z -    
2026-01-25T08:57:22.2367572Z +
2026-01-25T08:57:22.2367815Z      # Создаем тестовые комментарии для некоторых постов
2026-01-25T08:57:22.2367932Z      test_comments = [
2026-01-25T08:57:22.2368262Z -        (1, user_id, 'Комментарий к первому посту'),  # Комментарий к посту 1
2026-01-25T08:57:22.2368702Z -        (1, user_id, 'Второй комментарий к первому посту'),  # Еще один комментарий к посту 1
2026-01-25T08:57:22.2369083Z -        (2, user_id, 'Комментарий ко второму посту'),  # Комментарий к посту 2
2026-01-25T08:57:22.2369465Z -        (3, user_id, 'Комментарий к третьему посту'),  # Комментарий к посту 3
2026-01-25T08:57:22.2369782Z +        (1, user_id, "Комментарий к первому посту"),  # Комментарий к посту 1
2026-01-25T08:57:22.2370160Z +        (
2026-01-25T08:57:22.2370274Z +            1,
2026-01-25T08:57:22.2370405Z +            user_id,
2026-01-25T08:57:22.2370756Z +            "Второй комментарий к первому посту",
2026-01-25T08:57:22.2371043Z +        ),  # Еще один комментарий к посту 1
2026-01-25T08:57:22.2371478Z +        (2, user_id, "Комментарий ко второму посту"),  # Комментарий к посту 2
2026-01-25T08:57:22.2371987Z +        (3, user_id, "Комментарий к третьему посту"),  # Комментарий к посту 3
2026-01-25T08:57:22.2372120Z      ]
2026-01-25T08:57:22.2372250Z -    
2026-01-25T08:57:22.2372372Z +
2026-01-25T08:57:22.2372596Z      for post_id, author_id, content in test_comments:
2026-01-25T08:57:22.2372739Z          db.execute(
2026-01-25T08:57:22.2373406Z              'INSERT INTO comment (post_id, author_id, content, created) VALUES (?, ?, ?, datetime("now"))',
2026-01-25T08:57:22.2373583Z -            (post_id, author_id, content)
2026-01-25T08:57:22.2373751Z +            (post_id, author_id, content),
2026-01-25T08:57:22.2373893Z          )
2026-01-25T08:57:22.2374018Z      db.commit()
2026-01-25T08:57:22.2374143Z  
2026-01-25T08:57:22.2374284Z  
2026-01-25T08:57:22.2374416Z  @pytest.fixture
2026-01-25T08:57:22.2374544Z  def app():
2026-01-25T08:57:22.2374920Z      """Создает тестовое приложение без CSRF защиты для unit тестов."""
2026-01-25T08:57:22.2375107Z -    app, db_fd, db_path = _create_test_app({
2026-01-25T08:57:22.2375262Z -        'WTF_CSRF_ENABLED': False
2026-01-25T08:57:22.2375382Z -    })
2026-01-25T08:57:22.2375508Z -    
2026-01-25T08:57:22.2375790Z +    app, db_fd, db_path = _create_test_app({"WTF_CSRF_ENABLED": False})
2026-01-25T08:57:22.2375905Z +
2026-01-25T08:57:22.2376036Z      yield app
2026-01-25T08:57:22.2376154Z -    
2026-01-25T08:57:22.2376267Z +
2026-01-25T08:57:22.2376409Z      os.close(db_fd)
2026-01-25T08:57:22.2376547Z      os.unlink(db_path)
2026-01-25T08:57:22.2376662Z  
2026-01-25T08:57:22.2376788Z  
2026-01-25T08:57:22.2376963Z  @pytest.fixture
2026-01-25T08:57:22.2377129Z  def app_with_csrf():
2026-01-25T08:57:22.2377525Z      """Приложение с включенной CSRF защитой для интеграционных тестов."""
2026-01-25T08:57:22.2377917Z -    app, db_fd, db_path = _create_test_app({
2026-01-25T08:57:22.2378091Z -        'WTF_CSRF_ENABLED': True
2026-01-25T08:57:22.2378212Z -    })
2026-01-25T08:57:22.2378334Z -    
2026-01-25T08:57:22.2378631Z +    app, db_fd, db_path = _create_test_app({"WTF_CSRF_ENABLED": True})
2026-01-25T08:57:22.2378748Z +
2026-01-25T08:57:22.2378887Z      yield app
2026-01-25T08:57:22.2379013Z -    
2026-01-25T08:57:22.2379128Z +
2026-01-25T08:57:22.2379266Z      os.close(db_fd)
2026-01-25T08:57:22.2379420Z      os.unlink(db_path)
2026-01-25T08:57:22.2379534Z  
2026-01-25T08:57:22.2379655Z  
2026-01-25T08:57:22.2379785Z  @pytest.fixture
2026-01-25T08:57:22.2379906Z @@ -135,17 +141,16 @@
2026-01-25T08:57:22.2380026Z  
2026-01-25T08:57:22.2380138Z  
2026-01-25T08:57:22.2380269Z  @pytest.fixture
2026-01-25T08:57:22.2380416Z  def security_app():
2026-01-25T08:57:22.2380999Z      """Приложение для тестов безопасности (CSRF включен)."""
2026-01-25T08:57:22.2381231Z -    app, db_fd, db_path = _create_test_app({
2026-01-25T08:57:22.2381392Z -        'WTF_CSRF_ENABLED': True,
2026-01-25T08:57:22.2381557Z -        'SECRET_KEY': 'security-test-key'
2026-01-25T08:57:22.2381680Z -    })
2026-01-25T08:57:22.2381809Z -    
2026-01-25T08:57:22.2381985Z +    app, db_fd, db_path = _create_test_app(
2026-01-25T08:57:22.2382273Z +        {"WTF_CSRF_ENABLED": True, "SECRET_KEY": "security-test-key"}
2026-01-25T08:57:22.2382402Z +    )
2026-01-25T08:57:22.2382515Z +
2026-01-25T08:57:22.2382648Z      yield app
2026-01-25T08:57:22.2382792Z -    
2026-01-25T08:57:22.2383110Z +
2026-01-25T08:57:22.2383277Z      os.close(db_fd)
2026-01-25T08:57:22.2383414Z      os.unlink(db_path)
2026-01-25T08:57:22.2383526Z  
2026-01-25T08:57:22.2383649Z  
2026-01-25T08:57:22.2383812Z  @pytest.fixture
2026-01-25T08:57:22.2383939Z @@ -158,134 +163,149 @@
2026-01-25T08:57:22.2384129Z  def security_auth(security_client):
2026-01-25T08:57:22.2384421Z      """Аутентификация для тестов безопасности."""
2026-01-25T08:57:22.2384602Z      return AuthActions(security_client)
2026-01-25T08:57:22.2384730Z  
2026-01-25T08:57:22.2384866Z  
2026-01-25T08:57:22.2385021Z -
2026-01-25T08:57:22.2385167Z -
2026-01-25T08:57:22.2385278Z -
2026-01-25T08:57:22.2385395Z -
2026-01-25T08:57:22.2385528Z  @pytest.fixture
2026-01-25T08:57:22.2385659Z  def runner(app):
2026-01-25T08:57:22.2385924Z      """CLI runner для тестирования команд."""
2026-01-25T08:57:22.2386089Z      return app.test_cli_runner()
2026-01-25T08:57:22.2386199Z  
2026-01-25T08:57:22.2386318Z  
2026-01-25T08:57:22.2386451Z -
2026-01-25T08:57:22.2386558Z -
2026-01-25T08:57:22.2386698Z  class AuthActions:
2026-01-25T08:57:22.2387054Z      """Вспомогательный класс для действий аутентификации в тестах."""
2026-01-25T08:57:22.2387187Z  
2026-01-25T08:57:22.2387353Z      def __init__(self, client):
2026-01-25T08:57:22.2387499Z          self._client = client
2026-01-25T08:57:22.2387643Z  
2026-01-25T08:57:22.2387873Z      def _get_full_username(self, username: str) -> str:
2026-01-25T08:57:22.2388407Z          """Получить полное имя пользователя с дискриминатором."""
2026-01-25T08:57:22.2388577Z -        if '#' in username:
2026-01-25T08:57:22.2388719Z +        if "#" in username:
2026-01-25T08:57:22.2388859Z              return username
2026-01-25T08:57:22.2388989Z -            
2026-01-25T08:57:22.2389106Z +
2026-01-25T08:57:22.2389359Z          # Ищем пользователя в базе данных
2026-01-25T08:57:22.2389546Z          app = self._client.application
2026-01-25T08:57:22.2389704Z          with app.app_context():
2026-01-25T08:57:22.2389901Z              from app.db.db import get_db
2026-01-25T08:57:22.2390017Z +
2026-01-25T08:57:22.2390147Z              db = get_db()
2026-01-25T08:57:22.2390301Z              cursor = db.execute(
2026-01-25T08:57:22.2390620Z -                'SELECT username, discriminator FROM user WHERE username = ?',
2026-01-25T08:57:22.2390758Z -                (username,)
2026-01-25T08:57:22.2391080Z +                "SELECT username, discriminator FROM user WHERE username = ?",
2026-01-25T08:57:22.2391231Z +                (username,),
2026-01-25T08:57:22.2391351Z              )
2026-01-25T08:57:22.2391513Z              row = cursor.fetchone()
2026-01-25T08:57:22.2391638Z              if row:
2026-01-25T08:57:22.2391808Z                  return f"{row[0]}#{row[1]:04d}"
2026-01-25T08:57:22.2392105Z          return username  # fallback, если не найден
2026-01-25T08:57:22.2392221Z  
2026-01-25T08:57:22.2392781Z -    def login(self, username: str = 'test_user#1234', password: str = 'test_pass', follow_redirects: bool = False):
2026-01-25T08:57:22.2393092Z +    def login(
2026-01-25T08:57:22.2393218Z +        self,
2026-01-25T08:57:22.2393411Z +        username: str = "test_user#1234",
2026-01-25T08:57:22.2393574Z +        password: str = "test_pass",
2026-01-25T08:57:22.2393732Z +        follow_redirects: bool = False,
2026-01-25T08:57:22.2393864Z +    ):
2026-01-25T08:57:22.2394461Z          """Выполнение входа пользователя."""
2026-01-25T08:57:22.2394838Z          # Если username без дискриминатора, пытаемся найти его
2026-01-25T08:57:22.2395074Z          full_username = self._get_full_username(username)
2026-01-25T08:57:22.2395238Z -        
2026-01-25T08:57:22.2395369Z +
2026-01-25T08:57:22.2395610Z          # Получаем CSRF токен если он нужен
2026-01-25T08:57:22.2395908Z -        login_data = {'username': full_username, 'password': password}
2026-01-25T08:57:22.2396037Z -        
2026-01-25T08:57:22.2396361Z +        login_data = {"username": full_username, "password": password}
2026-01-25T08:57:22.2396478Z +
2026-01-25T08:57:22.2396742Z          # Проверяем, включена ли CSRF защита
2026-01-25T08:57:22.2396910Z          app = self._client.application
2026-01-25T08:57:22.2397124Z -        if app.config.get('WTF_CSRF_ENABLED', False):
2026-01-25T08:57:22.2397324Z +        if app.config.get("WTF_CSRF_ENABLED", False):
2026-01-25T08:57:22.2397656Z              # Получаем страницу входа чтобы получить CSRF токен
2026-01-25T08:57:22.2397903Z -            login_page = self._client.get('/auth/login')
2026-01-25T08:57:22.2398114Z +            login_page = self._client.get("/auth/login")
2026-01-25T08:57:22.2398341Z              page_content = login_page.get_data(as_text=True)
2026-01-25T08:57:22.2398593Z              # Ищем CSRF токен в странице
2026-01-25T08:57:22.2399025Z -            csrf_match = re.search(r'name="csrf_token"[^>]*value="([^"]+)"', page_content, re.DOTALL)
2026-01-25T08:57:22.2399191Z +            csrf_match = re.search(
2026-01-25T08:57:22.2399480Z +                r'name="csrf_token"[^>]*value="([^"]+)"', page_content, re.DOTALL
2026-01-25T08:57:22.2399600Z +            )
2026-01-25T08:57:22.2399751Z              if csrf_match:
2026-01-25T08:57:22.2400000Z -                login_data['csrf_token'] = csrf_match.group(1).strip()
2026-01-25T08:57:22.2400121Z -        
2026-01-25T08:57:22.2400394Z +                login_data["csrf_token"] = csrf_match.group(1).strip()
2026-01-25T08:57:22.2400574Z +
2026-01-25T08:57:22.2400778Z          return self._client.post(
2026-01-25T08:57:22.2401098Z -            '/auth/login',
2026-01-25T08:57:22.2401254Z -            data=login_data,
2026-01-25T08:57:22.2401443Z -            follow_redirects=follow_redirects
2026-01-25T08:57:22.2401743Z +            "/auth/login", data=login_data, follow_redirects=follow_redirects
2026-01-25T08:57:22.2401861Z          )
2026-01-25T08:57:22.2401978Z  
2026-01-25T08:57:22.2402125Z      def logout(self):
2026-01-25T08:57:22.2402412Z          """Выполнение выхода пользователя."""
2026-01-25T08:57:22.2402632Z -        return self._client.get('/auth/logout')
2026-01-25T08:57:22.2402750Z -
2026-01-25T08:57:22.2403472Z -    def register(self, username: str = 'new_user', password: str = 'new_pass123', follow_redirects: bool = False):
2026-01-25T08:57:22.2403660Z +        return self._client.get("/auth/logout")
2026-01-25T08:57:22.2403793Z +
2026-01-25T08:57:22.2403942Z +    def register(
2026-01-25T08:57:22.2404094Z +        self,
2026-01-25T08:57:22.2404242Z +        username: str = "new_user",
2026-01-25T08:57:22.2404457Z +        password: str = "new_pass123",
2026-01-25T08:57:22.2404630Z +        follow_redirects: bool = False,
2026-01-25T08:57:22.2404748Z +    ):
2026-01-25T08:57:22.2405058Z          """Регистрация нового пользователя."""
2026-01-25T08:57:22.2405491Z -        register_data = {'username': username, 'password': password, 'password2': password}
2026-01-25T08:57:22.2405615Z -        
2026-01-25T08:57:22.2405750Z +        register_data = {
2026-01-25T08:57:22.2405892Z +            "username": username,
2026-01-25T08:57:22.2406041Z +            "password": password,
2026-01-25T08:57:22.2406187Z +            "password2": password,
2026-01-25T08:57:22.2406304Z +        }
2026-01-25T08:57:22.2406427Z +
2026-01-25T08:57:22.2406700Z          # Проверяем, включена ли CSRF защита
2026-01-25T08:57:22.2406885Z          app = self._client.application
2026-01-25T08:57:22.2407104Z -        if app.config.get('WTF_CSRF_ENABLED', False):
2026-01-25T08:57:22.2407547Z +        if app.config.get("WTF_CSRF_ENABLED", False):
2026-01-25T08:57:22.2407971Z              # Получаем страницу регистрации чтобы получить CSRF токен
2026-01-25T08:57:22.2408228Z -            register_page = self._client.get('/auth/register')
2026-01-25T08:57:22.2408467Z +            register_page = self._client.get("/auth/register")
2026-01-25T08:57:22.2408728Z              # Ищем CSRF токен в странице
2026-01-25T08:57:22.2409256Z -            csrf_match = re.search(r'name="csrf_token"[^>]*value="([^"]+)"', register_page.get_data(as_text=True), re.DOTALL)
2026-01-25T08:57:22.2409406Z +            csrf_match = re.search(
2026-01-25T08:57:22.2409612Z +                r'name="csrf_token"[^>]*value="([^"]+)"',
2026-01-25T08:57:22.2409800Z +                register_page.get_data(as_text=True),
2026-01-25T08:57:22.2409943Z +                re.DOTALL,
2026-01-25T08:57:22.2410055Z +            )
2026-01-25T08:57:22.2410189Z              if csrf_match:
2026-01-25T08:57:22.2410514Z -                register_data['csrf_token'] = csrf_match.group(1).strip()
2026-01-25T08:57:22.2410645Z -        
2026-01-25T08:57:22.2410924Z +                register_data["csrf_token"] = csrf_match.group(1).strip()
2026-01-25T08:57:22.2411046Z +
2026-01-25T08:57:22.2411208Z          response = self._client.post(
2026-01-25T08:57:22.2411352Z -            '/auth/register',
2026-01-25T08:57:22.2411509Z -            data=register_data,
2026-01-25T08:57:22.2411684Z -            follow_redirects=follow_redirects
2026-01-25T08:57:22.2412033Z +            "/auth/register", data=register_data, follow_redirects=follow_redirects
2026-01-25T08:57:22.2412151Z          )
2026-01-25T08:57:22.2412291Z          return response
2026-01-25T08:57:22.2412411Z  
2026-01-25T08:57:22.2412538Z  
2026-01-25T08:57:22.2412669Z  @pytest.fixture
2026-01-25T08:57:22.2412817Z  def sample_user_data():
2026-01-25T08:57:22.2413239Z      """Данные для тестового пользователя."""
2026-01-25T08:57:22.2413447Z      return {
2026-01-25T08:57:22.2413614Z -        'username': 'sample_user',
2026-01-25T08:57:22.2413982Z -        'password': 'sample_password',
2026-01-25T08:57:22.2414160Z -        'discriminator': 9999
2026-01-25T08:57:22.2414322Z +        "username": "sample_user",
2026-01-25T08:57:22.2414486Z +        "password": "sample_password",
2026-01-25T08:57:22.2414640Z +        "discriminator": 9999,
2026-01-25T08:57:22.2414755Z      }
2026-01-25T08:57:22.2414865Z  
2026-01-25T08:57:22.2414986Z  
2026-01-25T08:57:22.2415118Z  @pytest.fixture
2026-01-25T08:57:22.2415263Z  def sample_post_data():
2026-01-25T08:57:22.2415521Z      """Данные для тестового поста."""
2026-01-25T08:57:22.2415638Z      return {
2026-01-25T08:57:22.2415785Z -        'title': 'Test Post Title',
2026-01-25T08:57:22.2416080Z -        'content': 'This is a test post content for testing purposes.'
2026-01-25T08:57:22.2416224Z +        "title": "Test Post Title",
2026-01-25T08:57:22.2416521Z +        "content": "This is a test post content for testing purposes.",
2026-01-25T08:57:22.2416650Z      }
2026-01-25T08:57:22.2416765Z  
2026-01-25T08:57:22.2416877Z  
2026-01-25T08:57:22.2417017Z  @pytest.fixture
2026-01-25T08:57:22.2417154Z  def mock_csrf_token():
2026-01-25T08:57:22.2417391Z      """Мок CSRF токена для тестов."""
2026-01-25T08:57:22.2417611Z -    return 'test-csrf-token-12345'
2026-01-25T08:57:22.2417782Z +    return "test-csrf-token-12345"
2026-01-25T08:57:22.2418010Z  
2026-01-25T08:57:22.2418162Z  
2026-01-25T08:57:22.2418291Z  @pytest.fixture
2026-01-25T08:57:22.2418454Z  def setup_csrf_token(client):
2026-01-25T08:57:22.2418744Z      """Устанавливает CSRF токен в сессии для тестов."""
2026-01-25T08:57:22.2418855Z +
2026-01-25T08:57:22.2419006Z      def _setup_token():
2026-01-25T08:57:22.2419300Z          # Получаем страницу входа чтобы извлечь CSRF токен
2026-01-25T08:57:22.2419498Z -        login_page = client.get('/auth/login')
2026-01-25T08:57:22.2419672Z +        login_page = client.get("/auth/login")
2026-01-25T08:57:22.2420104Z          page_content = login_page.get_data(as_text=True)
2026-01-25T08:57:22.2420538Z -        csrf_match = re.search(r'name="csrf_token"[^>]*value="([^"]+)"', page_content, re.DOTALL)
2026-01-25T08:57:22.2420691Z +        csrf_match = re.search(
2026-01-25T08:57:22.2420964Z +            r'name="csrf_token"[^>]*value="([^"]+)"', page_content, re.DOTALL
2026-01-25T08:57:22.2421095Z +        )
2026-01-25T08:57:22.2421229Z          if csrf_match:
2026-01-25T08:57:22.2421415Z              return csrf_match.group(1).strip()
2026-01-25T08:57:22.2421634Z -        return 'test_csrf_token_for_testing'  # fallback
2026-01-25T08:57:22.2421840Z +        return "test_csrf_token_for_testing"  # fallback
2026-01-25T08:57:22.2421962Z +
2026-01-25T08:57:22.2422103Z      return _setup_token
2026-01-25T08:57:22.2422216Z  
2026-01-25T08:57:22.2422338Z  
2026-01-25T08:57:22.2422566Z  # Маркеры для разных типов тестов
2026-01-25T08:57:22.2422737Z  pytest.mark.unit = pytest.mark.unit
2026-01-25T08:57:22.2748118Z --- /home/runner/work/flask_blog/flask_blog/tests/test_auth.py	2026-01-25 08:57:06.653994+00:00
2026-01-25T08:57:22.2748691Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_auth.py	2026-01-25 08:57:22.270500+00:00
2026-01-25T08:57:22.2748990Z @@ -7,145 +7,137 @@
2026-01-25T08:57:22.2750263Z  class TestPasswordHashing:
2026-01-25T08:57:22.2751658Z      """Тесты для функций хэширования паролей."""
2026-01-25T08:57:22.2752361Z  
2026-01-25T08:57:22.2761664Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_auth.py
2026-01-25T08:57:22.2765053Z      def test_hash_password_returns_hex_string(self):
2026-01-25T08:57:22.2765679Z          """Хэш пароля должен быть строкой."""
2026-01-25T08:57:22.2766774Z -        hashed, salt = hash_password('password123')
2026-01-25T08:57:22.2767015Z +        hashed, salt = hash_password("password123")
2026-01-25T08:57:22.2767186Z          assert isinstance(hashed, str)
2026-01-25T08:57:22.2767616Z          # Проверяем, что это строка (werkzeug возвращает строку с префиксом метода)
2026-01-25T08:57:22.2767812Z          assert len(hashed) > 0
2026-01-25T08:57:22.2767929Z  
2026-01-25T08:57:22.2768529Z      def test_hash_password_creates_salt(self):
2026-01-25T08:57:22.2768882Z          """Функция должна создавать соль, если она не передана."""
2026-01-25T08:57:22.2769106Z -        hashed, salt = hash_password('password123')
2026-01-25T08:57:22.2769323Z +        hashed, salt = hash_password("password123")
2026-01-25T08:57:22.2769474Z          assert salt is not None
2026-01-25T08:57:22.2769620Z          assert len(salt) == 16
2026-01-25T08:57:22.2769750Z  
2026-01-25T08:57:22.2769963Z      def test_hash_password_uses_provided_salt(self):
2026-01-25T08:57:22.2770270Z          """Функция должна использовать переданную соль."""
2026-01-25T08:57:22.2770427Z -        custom_salt = b'1234567890123456'
2026-01-25T08:57:22.2770676Z -        hashed1, _ = hash_password('password123', custom_salt)
2026-01-25T08:57:22.2770931Z -        hashed2, _ = hash_password('password123', custom_salt)
2026-01-25T08:57:22.2771312Z +        custom_salt = b"1234567890123456"
2026-01-25T08:57:22.2771568Z +        hashed1, _ = hash_password("password123", custom_salt)
2026-01-25T08:57:22.2771815Z +        hashed2, _ = hash_password("password123", custom_salt)
2026-01-25T08:57:22.2771969Z          assert hashed1 == hashed2
2026-01-25T08:57:22.2772084Z  
2026-01-25T08:57:22.2772328Z      def test_different_passwords_different_hashes(self):
2026-01-25T08:57:22.2772639Z          """Разные пароли должны давать разные хэши."""
2026-01-25T08:57:22.2772853Z -        hashed1, salt = hash_password('password123')
2026-01-25T08:57:22.2773317Z -        hashed2, _ = hash_password('password456', salt)
2026-01-25T08:57:22.2773553Z +        hashed1, salt = hash_password("password123")
2026-01-25T08:57:22.2773786Z +        hashed2, _ = hash_password("password456", salt)
2026-01-25T08:57:22.2773937Z          assert hashed1 != hashed2
2026-01-25T08:57:22.2774050Z  
2026-01-25T08:57:22.2774234Z      def test_verify_password_correct(self):
2026-01-25T08:57:22.2774495Z          """Проверка правильного пароля."""
2026-01-25T08:57:22.2774724Z -        hashed, salt = hash_password('mypassword')
2026-01-25T08:57:22.2775013Z -        assert verify_password(hashed, 'mypassword', salt) is True
2026-01-25T08:57:22.2775291Z +        hashed, salt = hash_password("mypassword")
2026-01-25T08:57:22.2775564Z +        assert verify_password(hashed, "mypassword", salt) is True
2026-01-25T08:57:22.2775678Z  
2026-01-25T08:57:22.2775863Z      def test_verify_password_incorrect(self):
2026-01-25T08:57:22.2776120Z          """Проверка неправильного пароля."""
2026-01-25T08:57:22.2776319Z -        hashed, salt = hash_password('mypassword')
2026-01-25T08:57:22.2776626Z -        assert verify_password(hashed, 'wrong_password', salt) is False
2026-01-25T08:57:22.2776820Z +        hashed, salt = hash_password("mypassword")
2026-01-25T08:57:22.2777111Z +        assert verify_password(hashed, "wrong_password", salt) is False
2026-01-25T08:57:22.2777234Z  
2026-01-25T08:57:22.2777362Z  
2026-01-25T08:57:22.2777539Z  class TestGenerateDiscriminator:
2026-01-25T08:57:22.2778042Z      """Тесты для генерации дискриминатора."""
2026-01-25T08:57:22.2778169Z  
2026-01-25T08:57:22.2778440Z      def test_generate_discriminator_new_user(self, app):
2026-01-25T08:57:22.2778806Z          """Генерация дискриминатора для нового username."""
2026-01-25T08:57:22.2778978Z          with app.app_context():
2026-01-25T08:57:22.2779119Z              db = get_db()
2026-01-25T08:57:22.2779397Z -            discriminator = generate_discriminator(db, 'new_user')
2026-01-25T08:57:22.2779648Z +            discriminator = generate_discriminator(db, "new_user")
2026-01-25T08:57:22.2779828Z              assert discriminator is not None
2026-01-25T08:57:22.2780001Z              assert 1 <= discriminator <= 9999
2026-01-25T08:57:22.2780116Z  
2026-01-25T08:57:22.2780385Z      def test_generate_discriminator_existing_user(self, app):
2026-01-25T08:57:22.2780727Z          """Генерация дискриминатора для существующего username."""
2026-01-25T08:57:22.2780897Z          with app.app_context():
2026-01-25T08:57:22.2781037Z              db = get_db()
2026-01-25T08:57:22.2781385Z              # test_user#1234 уже существует (создан в conftest.py)
2026-01-25T08:57:22.2781774Z              # Проверяем многократно, что никогда не вернётся занятый дискриминатор
2026-01-25T08:57:22.2781923Z              for _ in range(100):
2026-01-25T08:57:22.2782194Z -                discriminator = generate_discriminator(db, 'test_user')
2026-01-25T08:57:22.2782463Z +                discriminator = generate_discriminator(db, "test_user")
2026-01-25T08:57:22.2782643Z                  assert discriminator is not None
2026-01-25T08:57:22.2783237Z                  assert discriminator != 1234  # Не должен совпадать с существующим
2026-01-25T08:57:22.2783427Z                  assert 1 <= discriminator <= 9999
2026-01-25T08:57:22.2783540Z  
2026-01-25T08:57:22.2783663Z  
2026-01-25T08:57:22.2783827Z  class TestRegister:
2026-01-25T08:57:22.2784286Z      """Тесты для регистрации."""
2026-01-25T08:57:22.2784425Z  
2026-01-25T08:57:22.2784633Z      def test_register_page_loads(self, client):
2026-01-25T08:57:22.2784921Z          """Страница регистрации должна загружаться."""
2026-01-25T08:57:22.2785141Z -        response = client.get('/auth/register')
2026-01-25T08:57:22.2785311Z -        assert response.status_code == 200
2026-01-25T08:57:22.2785636Z -        assert 'Регистрация'.encode('utf-8') in response.data
2026-01-25T08:57:22.2785822Z +        response = client.get("/auth/register")
2026-01-25T08:57:22.2785990Z +        assert response.status_code == 200
2026-01-25T08:57:22.2786312Z +        assert "Регистрация".encode("utf-8") in response.data
2026-01-25T08:57:22.2786425Z  
2026-01-25T08:57:22.2786715Z      def test_register_success(self, client, app, setup_csrf_token):
2026-01-25T08:57:22.2786998Z          """Успешная регистрация нового пользователя."""
2026-01-25T08:57:22.2787158Z          csrf_token = setup_csrf_token()
2026-01-25T08:57:22.2787334Z          response = client.post(
2026-01-25T08:57:22.2787484Z -            '/auth/register',
2026-01-25T08:57:22.2787626Z -            data={
2026-01-25T08:57:22.2787800Z -                'username': 'new_user', 
2026-01-25T08:57:22.2787964Z -                'password': 'new_pass',
2026-01-25T08:57:22.2788118Z -                'csrf_token': csrf_token
2026-01-25T08:57:22.2788246Z -            },
2026-01-25T08:57:22.2788397Z -            follow_redirects=True
2026-01-25T08:57:22.2788532Z +            "/auth/register",
2026-01-25T08:57:22.2788658Z +            data={
2026-01-25T08:57:22.2788807Z +                "username": "new_user",
2026-01-25T08:57:22.2788945Z +                "password": "new_pass",
2026-01-25T08:57:22.2789095Z +                "csrf_token": csrf_token,
2026-01-25T08:57:22.2789207Z +            },
2026-01-25T08:57:22.2789345Z +            follow_redirects=True,
2026-01-25T08:57:22.2789470Z          )
2026-01-25T08:57:22.2789639Z          assert response.status_code == 200
2026-01-25T08:57:22.2790107Z          # Проверяем наличие сообщения об успешной регистрации (без учета кодировки)
2026-01-25T08:57:22.2790621Z -        response_text = response.data.decode('utf-8').lower()
2026-01-25T08:57:22.2791245Z -        assert 'успешна' in response_text or 'success' in response_text or 'welcome' in response_text
2026-01-25T08:57:22.2791558Z +        response_text = response.data.decode("utf-8").lower()
2026-01-25T08:57:22.2791696Z +        assert (
2026-01-25T08:57:22.2791977Z +            "успешна" in response_text
2026-01-25T08:57:22.2792164Z +            or "success" in response_text
2026-01-25T08:57:22.2792327Z +            or "welcome" in response_text
2026-01-25T08:57:22.2792460Z +        )
2026-01-25T08:57:22.2792586Z  
2026-01-25T08:57:22.2793105Z          # Проверяем, что пользователь создан в БД
2026-01-25T08:57:22.2793361Z          with app.app_context():
2026-01-25T08:57:22.2793486Z              db = get_db()
2026-01-25T08:57:22.2793613Z              user = db.execute(
2026-01-25T08:57:22.2793906Z -                'SELECT * FROM user WHERE username = ?', ('new_user',)
2026-01-25T08:57:22.2794148Z +                "SELECT * FROM user WHERE username = ?", ("new_user",)
2026-01-25T08:57:22.2794289Z              ).fetchone()
2026-01-25T08:57:22.2794441Z              assert user is not None
2026-01-25T08:57:22.2794557Z  
2026-01-25T08:57:22.2794886Z      def test_register_empty_username(self, client, setup_csrf_token):
2026-01-25T08:57:22.2795191Z          """Регистрация с пустым логином."""
2026-01-25T08:57:22.2795367Z          csrf_token = setup_csrf_token()
2026-01-25T08:57:22.2795541Z          response = client.post(
2026-01-25T08:57:22.2795693Z -            '/auth/register',
2026-01-25T08:57:22.2795834Z -            data={
2026-01-25T08:57:22.2795999Z -                'username': '', 
2026-01-25T08:57:22.2796185Z -                'password': 'password123',
2026-01-25T08:57:22.2796349Z -                'csrf_token': csrf_token
2026-01-25T08:57:22.2796481Z -            }
2026-01-25T08:57:22.2796974Z +            "/auth/register",
2026-01-25T08:57:22.2797359Z +            data={"username": "", "password": "password123", "csrf_token": csrf_token},
2026-01-25T08:57:22.2797496Z          )
2026-01-25T08:57:22.2797951Z          # TODO: С заглушками валидации форма всегда валидна, происходит редирект
2026-01-25T08:57:22.2798362Z          # Когда валидаторы будут реализованы, здесь должно быть 200 и ошибки
2026-01-25T08:57:22.2798884Z          assert response.status_code == 302  # Редирект после успешной регистрации
2026-01-25T08:57:22.2799299Z          # TODO: После реализации валидаторов проверить наличие ошибок валидации
2026-01-25T08:57:22.2799437Z  
2026-01-25T08:57:22.2799752Z      def test_register_empty_password(self, client, setup_csrf_token):
2026-01-25T08:57:22.2800055Z          """Регистрация с пустым паролем."""
2026-01-25T08:57:22.2800222Z          csrf_token = setup_csrf_token()
2026-01-25T08:57:22.2800403Z          response = client.post(
2026-01-25T08:57:22.2800575Z -            '/auth/register',
2026-01-25T08:57:22.2800734Z -            data={
2026-01-25T08:57:22.2800899Z -                'username': 'some_user', 
2026-01-25T08:57:22.2801082Z -                'password': '',
2026-01-25T08:57:22.2801251Z -                'csrf_token': csrf_token
2026-01-25T08:57:22.2801381Z -            }
2026-01-25T08:57:22.2801556Z +            "/auth/register",
2026-01-25T08:57:22.2801897Z +            data={"username": "some_user", "password": "", "csrf_token": csrf_token},
2026-01-25T08:57:22.2802034Z          )
2026-01-25T08:57:22.2802470Z          # TODO: С заглушками валидации форма всегда валидна, происходит редирект
2026-01-25T08:57:22.2802852Z          # Когда валидаторы будут реализованы, здесь должно быть 200 и ошибки
2026-01-25T08:57:22.2803556Z          assert response.status_code == 302  # Редирект после успешной регистрации
2026-01-25T08:57:22.2803995Z          # TODO: После реализации валидаторов проверить наличие ошибок валидation
2026-01-25T08:57:22.2804126Z  
2026-01-25T08:57:22.2804511Z      def test_register_short_password(self, client, setup_csrf_token):
2026-01-25T08:57:22.2805048Z          """Регистрация со слишком коротким паролем."""
2026-01-25T08:57:22.2805248Z          csrf_token = setup_csrf_token()
2026-01-25T08:57:22.2805446Z          response = client.post(
2026-01-25T08:57:22.2805592Z -            '/auth/register',
2026-01-25T08:57:22.2805724Z -            data={
2026-01-25T08:57:22.2805879Z -                'username': 'some_user', 
2026-01-25T08:57:22.2806035Z -                'password': '123',
2026-01-25T08:57:22.2806201Z -                'csrf_token': csrf_token
2026-01-25T08:57:22.2806332Z -            }
2026-01-25T08:57:22.2806470Z +            "/auth/register",
2026-01-25T08:57:22.2806819Z +            data={"username": "some_user", "password": "123", "csrf_token": csrf_token},
2026-01-25T08:57:22.2806937Z          )
2026-01-25T08:57:22.2807343Z          # TODO: С заглушками валидации форма всегда валидна, происходит редирект
2026-01-25T08:57:22.2807947Z          # Когда валидаторы будут реализованы, здесь должно быть 200 и ошибки
2026-01-25T08:57:22.2808410Z          assert response.status_code == 302  # Редирект после успешной регистрации
2026-01-25T08:57:22.2808781Z          # TODO: После реализации валидаторов проверить наличие ошибок валидации
2026-01-25T08:57:22.2808920Z @@ -154,106 +146,114 @@
2026-01-25T08:57:22.2809044Z  class TestLogin:
2026-01-25T08:57:22.2809265Z      """Тесты для входа в систему."""
2026-01-25T08:57:22.2809380Z  
2026-01-25T08:57:22.2809573Z      def test_login_page_loads(self, client):
2026-01-25T08:57:22.2809837Z          """Страница входа должна загружаться."""
2026-01-25T08:57:22.2810010Z -        response = client.get('/auth/login')
2026-01-25T08:57:22.2810179Z -        assert response.status_code == 200
2026-01-25T08:57:22.2810499Z -        assert 'Вход'.encode('utf-8') in response.data
2026-01-25T08:57:22.2810678Z +        response = client.get("/auth/login")
2026-01-25T08:57:22.2810851Z +        assert response.status_code == 200
2026-01-25T08:57:22.2811225Z +        assert "Вход".encode("utf-8") in response.data
2026-01-25T08:57:22.2811352Z  
2026-01-25T08:57:22.2811584Z      def test_login_success(self, client, auth):
2026-01-25T08:57:22.2811810Z          """Успешный вход."""
2026-01-25T08:57:22.2811978Z          response = auth.login()
2026-01-25T08:57:22.2812339Z          assert response.status_code == 302  # Редирект
2026-01-25T08:57:22.2812468Z  
2026-01-25T08:57:22.2812738Z          # Проверяем, что сессия установлена
2026-01-25T08:57:22.2813225Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.2813466Z -            assert 'user_id' in sess
2026-01-25T08:57:22.2813632Z +            assert "user_id" in sess
2026-01-25T08:57:22.2813759Z  
2026-01-25T08:57:22.2814022Z      def test_login_success_redirect(self, client, auth):
2026-01-25T08:57:22.2814407Z          """После входа должен быть редирект на главную."""
2026-01-25T08:57:22.2814638Z          response = auth.login(follow_redirects=False)
2026-01-25T08:57:22.2814852Z          assert response.status_code == 302
2026-01-25T08:57:22.2815087Z -        assert response.headers['Location'] == '/'
2026-01-25T08:57:22.2815527Z +        assert response.headers["Location"] == "/"
2026-01-25T08:57:22.2815666Z  
2026-01-25T08:57:22.2816021Z      def test_login_invalid_format_no_hash(self, client, setup_csrf_token):
2026-01-25T08:57:22.2816347Z          """Вход с неверным форматом (без #)."""
2026-01-25T08:57:22.2816533Z          csrf_token = setup_csrf_token()
2026-01-25T08:57:22.2816701Z          response = client.post(
2026-01-25T08:57:22.2816846Z -            '/auth/login',
2026-01-25T08:57:22.2816983Z -            data={
2026-01-25T08:57:22.2817173Z -                'username': 'test_user1234', 
2026-01-25T08:57:22.2817380Z -                'password': 'test_pass',
2026-01-25T08:57:22.2817562Z -                'csrf_token': csrf_token
2026-01-25T08:57:22.2817687Z -            }
2026-01-25T08:57:22.2817817Z -        )
2026-01-25T08:57:22.2818002Z -        assert response.status_code == 200
2026-01-25T08:57:22.2818286Z -        response_text = response.data.decode('utf-8').lower()
2026-01-25T08:57:22.2818523Z -        assert ('alert-danger' in response_text or 
2026-01-25T08:57:22.2818831Z -                'ошибка' in response_text or 
2026-01-25T08:57:22.2819114Z -                'обязательно' in response_text or
2026-01-25T08:57:22.2819397Z -                'должно быть' in response_text or
2026-01-25T08:57:22.2819643Z -                'формат' in response_text)
2026-01-25T08:57:22.2819801Z +            "/auth/login",
2026-01-25T08:57:22.2819994Z +            data={
2026-01-25T08:57:22.2820193Z +                "username": "test_user1234",
2026-01-25T08:57:22.2820355Z +                "password": "test_pass",
2026-01-25T08:57:22.2820519Z +                "csrf_token": csrf_token,
2026-01-25T08:57:22.2820657Z +            },
2026-01-25T08:57:22.2820787Z +        )
2026-01-25T08:57:22.2820983Z +        assert response.status_code == 200
2026-01-25T08:57:22.2821601Z +        response_text = response.data.decode("utf-8").lower()
2026-01-25T08:57:22.2821750Z +        assert (
2026-01-25T08:57:22.2821945Z +            "alert-danger" in response_text
2026-01-25T08:57:22.2822261Z +            or "ошибка" in response_text
2026-01-25T08:57:22.2822564Z +            or "обязательно" in response_text
2026-01-25T08:57:22.2822817Z +            or "должно быть" in response_text
2026-01-25T08:57:22.2823322Z +            or "формат" in response_text
2026-01-25T08:57:22.2823463Z +        )
2026-01-25T08:57:22.2823583Z  
2026-01-25T08:57:22.2823986Z      def test_login_invalid_format_bad_discriminator(self, client, setup_csrf_token):
2026-01-25T08:57:22.2824307Z          """Вход с неверным дискриминатором (не число)."""
2026-01-25T08:57:22.2824494Z          csrf_token = setup_csrf_token()
2026-01-25T08:57:22.2824666Z          response = client.post(
2026-01-25T08:57:22.2824820Z -            '/auth/login',
2026-01-25T08:57:22.2824951Z -            data={
2026-01-25T08:57:22.2825162Z -                'username': 'test_user#abcd', 
2026-01-25T08:57:22.2825360Z -                'password': 'test_pass',
2026-01-25T08:57:22.2825529Z -                'csrf_token': csrf_token
2026-01-25T08:57:22.2825667Z -            }
2026-01-25T08:57:22.2825786Z -        )
2026-01-25T08:57:22.2825974Z -        assert response.status_code == 200
2026-01-25T08:57:22.2826237Z -        response_text = response.data.decode('utf-8').lower()
2026-01-25T08:57:22.2826463Z -        assert ('alert-danger' in response_text or 
2026-01-25T08:57:22.2826771Z -                'ошибка' in response_text or 
2026-01-25T08:57:22.2827072Z -                'обязательно' in response_text or
2026-01-25T08:57:22.2827365Z -                'должно быть' in response_text or
2026-01-25T08:57:22.2827628Z -                'формат' in response_text)
2026-01-25T08:57:22.2827771Z +            "/auth/login",
2026-01-25T08:57:22.2827904Z +            data={
2026-01-25T08:57:22.2828084Z +                "username": "test_user#abcd",
2026-01-25T08:57:22.2828266Z +                "password": "test_pass",
2026-01-25T08:57:22.2828452Z +                "csrf_token": csrf_token,
2026-01-25T08:57:22.2828803Z +            },
2026-01-25T08:57:22.2828956Z +        )
2026-01-25T08:57:22.2829189Z +        assert response.status_code == 200
2026-01-25T08:57:22.2829456Z +        response_text = response.data.decode("utf-8").lower()
2026-01-25T08:57:22.2829588Z +        assert (
2026-01-25T08:57:22.2829776Z +            "alert-danger" in response_text
2026-01-25T08:57:22.2830050Z +            or "ошибка" in response_text
2026-01-25T08:57:22.2830305Z +            or "обязательно" in response_text
2026-01-25T08:57:22.2830643Z +            or "должно быть" in response_text
2026-01-25T08:57:22.2830880Z +            or "формат" in response_text
2026-01-25T08:57:22.2831004Z +        )
2026-01-25T08:57:22.2831115Z  
2026-01-25T08:57:22.2831398Z      def test_login_wrong_password(self, client, setup_csrf_token):
2026-01-25T08:57:22.2831662Z          """Вход с неверным паролем."""
2026-01-25T08:57:22.2831846Z          csrf_token = setup_csrf_token()
2026-01-25T08:57:22.2832005Z          response = client.post(
2026-01-25T08:57:22.2832168Z -            '/auth/login',
2026-01-25T08:57:22.2832296Z -            data={
2026-01-25T08:57:22.2832474Z -                'username': 'test_user#1234', 
2026-01-25T08:57:22.2832647Z -                'password': 'wrong_pass',
2026-01-25T08:57:22.2832795Z -                'csrf_token': csrf_token
2026-01-25T08:57:22.2834479Z -            }
2026-01-25T08:57:22.2834632Z -        )
2026-01-25T08:57:22.2863625Z -        assert response.status_code == 200
2026-01-25T08:57:22.2863999Z -        response_text = response.data.decode('utf-8').lower()
2026-01-25T08:57:22.2864232Z -        assert ('alert-danger' in response_text or 
2026-01-25T08:57:22.2864640Z -                'ошибка' in response_text or 
2026-01-25T08:57:22.2864938Z -                'обязательно' in response_text or
2026-01-25T08:57:22.2865218Z -                'должно быть' in response_text or
2026-01-25T08:57:22.2865927Z -                'формат' in response_text or
2026-01-25T08:57:22.2866233Z -                'неверный' in response_text)
2026-01-25T08:57:22.2866389Z +            "/auth/login",
2026-01-25T08:57:22.2866523Z +            data={
2026-01-25T08:57:22.2866742Z +                "username": "test_user#1234",
2026-01-25T08:57:22.2866943Z +                "password": "wrong_pass",
2026-01-25T08:57:22.2867124Z +                "csrf_token": csrf_token,
2026-01-25T08:57:22.2867250Z +            },
2026-01-25T08:57:22.2867373Z +        )
2026-01-25T08:57:22.2867560Z +        assert response.status_code == 200
2026-01-25T08:57:22.2867828Z +        response_text = response.data.decode("utf-8").lower()
2026-01-25T08:57:22.2867954Z +        assert (
2026-01-25T08:57:22.2868185Z +            "alert-danger" in response_text
2026-01-25T08:57:22.2868488Z +            or "ошибка" in response_text
2026-01-25T08:57:22.2868750Z +            or "обязательно" in response_text
2026-01-25T08:57:22.2869040Z +            or "должно быть" in response_text
2026-01-25T08:57:22.2869286Z +            or "формат" in response_text
2026-01-25T08:57:22.2869551Z +            or "неверный" in response_text
2026-01-25T08:57:22.2869681Z +        )
2026-01-25T08:57:22.2869810Z  
2026-01-25T08:57:22.2870140Z      def test_login_nonexistent_user(self, client, setup_csrf_token):
2026-01-25T08:57:22.2870437Z          """Вход с несуществующим пользователем."""
2026-01-25T08:57:22.2870657Z          csrf_token = setup_csrf_token()
2026-01-25T08:57:22.2870857Z          response = client.post(
2026-01-25T08:57:22.2871008Z -            '/auth/login',
2026-01-25T08:57:22.2871167Z -            data={
2026-01-25T08:57:22.2871342Z -                'username': 'no_user#0000', 
2026-01-25T08:57:22.2871509Z -                'password': 'any_pass',
2026-01-25T08:57:22.2871677Z -                'csrf_token': csrf_token
2026-01-25T08:57:22.2871838Z -            }
2026-01-25T08:57:22.2871969Z -        )
2026-01-25T08:57:22.2872208Z -        assert response.status_code == 200
2026-01-25T08:57:22.2872500Z -        response_text = response.data.decode('utf-8').lower()
2026-01-25T08:57:22.2873191Z -        assert ('alert-danger' in response_text or 
2026-01-25T08:57:22.2873539Z -                'ошибка' in response_text or 
2026-01-25T08:57:22.2873827Z -                'обязательно' in response_text or
2026-01-25T08:57:22.2874114Z -                'должно быть' in response_text or
2026-01-25T08:57:22.2874372Z -                'формат' in response_text or
2026-01-25T08:57:22.2874620Z -                'неверный' in response_text)
2026-01-25T08:57:22.2874777Z +            "/auth/login",
2026-01-25T08:57:22.2874913Z +            data={
2026-01-25T08:57:22.2875078Z +                "username": "no_user#0000",
2026-01-25T08:57:22.2875240Z +                "password": "any_pass",
2026-01-25T08:57:22.2875391Z +                "csrf_token": csrf_token,
2026-01-25T08:57:22.2875526Z +            },
2026-01-25T08:57:22.2875660Z +        )
2026-01-25T08:57:22.2875929Z +        assert response.status_code == 200
2026-01-25T08:57:22.2876197Z +        response_text = response.data.decode("utf-8").lower()
2026-01-25T08:57:22.2876343Z +        assert (
2026-01-25T08:57:22.2876523Z +            "alert-danger" in response_text
2026-01-25T08:57:22.2876801Z +            or "ошибка" in response_text
2026-01-25T08:57:22.2877059Z +            or "обязательно" in response_text
2026-01-25T08:57:22.2877312Z +            or "должно быть" in response_text
2026-01-25T08:57:22.2877561Z +            or "формат" in response_text
2026-01-25T08:57:22.2877805Z +            or "неверный" in response_text
2026-01-25T08:57:22.2877936Z +        )
2026-01-25T08:57:22.2878057Z  
2026-01-25T08:57:22.2878173Z  
2026-01-25T08:57:22.2878323Z  class TestLogout:
2026-01-25T08:57:22.2878564Z      """Тесты для выхода из системы."""
2026-01-25T08:57:22.2878683Z  
2026-01-25T08:57:22.2878823Z @@ -261,43 +261,45 @@
2026-01-25T08:57:22.2879083Z          """Выход из системы очищает сессию."""
2026-01-25T08:57:22.2879496Z          auth.login()
2026-01-25T08:57:22.2879630Z  
2026-01-25T08:57:22.2879884Z          # Проверяем, что залогинены
2026-01-25T08:57:22.2880118Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.2880286Z -            assert 'user_id' in sess
2026-01-25T08:57:22.2880437Z +            assert "user_id" in sess
2026-01-25T08:57:22.2880571Z  
2026-01-25T08:57:22.2880733Z          response = auth.logout()
2026-01-25T08:57:22.2880912Z          assert response.status_code == 302
2026-01-25T08:57:22.2881059Z  
2026-01-25T08:57:22.2881336Z          # Проверяем, что сессия очищена
2026-01-25T08:57:22.2881553Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.2881725Z -            assert 'user_id' not in sess
2026-01-25T08:57:22.2881900Z +            assert "user_id" not in sess
2026-01-25T08:57:22.2882021Z  
2026-01-25T08:57:22.2882146Z  
2026-01-25T08:57:22.2882318Z  class TestLoginRequired:
2026-01-25T08:57:22.2882621Z      """Тесты для декоратора login_required."""
2026-01-25T08:57:22.2882777Z  
2026-01-25T08:57:22.2883251Z      def test_load_logged_in_user(self, client, auth, app):
2026-01-25T08:57:22.2883599Z          """Загрузка залогиненного пользователя в g."""
2026-01-25T08:57:22.2883754Z          auth.login()
2026-01-25T08:57:22.2883868Z  
2026-01-25T08:57:22.2884014Z          with client:
2026-01-25T08:57:22.2884169Z -            client.get('/')
2026-01-25T08:57:22.2884312Z +            client.get("/")
2026-01-25T08:57:22.2884472Z              from flask import g
2026-01-25T08:57:22.2884589Z +
2026-01-25T08:57:22.2884755Z              assert g.user is not None
2026-01-25T08:57:22.2885087Z -            assert g.user['username'] == 'test_user'
2026-01-25T08:57:22.2885289Z +            assert g.user["username"] == "test_user"
2026-01-25T08:57:22.2885420Z  
2026-01-25T08:57:22.2885707Z      def test_load_logged_in_user_anonymous(self, client, app):
2026-01-25T08:57:22.2886058Z          """Для не залогиненного пользователя g.user = None."""
2026-01-25T08:57:22.2886231Z          with client:
2026-01-25T08:57:22.2886378Z -            client.get('/')
2026-01-25T08:57:22.2886821Z +            client.get("/")
2026-01-25T08:57:22.2887001Z              from flask import g
2026-01-25T08:57:22.2887121Z +
2026-01-25T08:57:22.2887272Z              assert g.user is None
2026-01-25T08:57:22.2887397Z  
2026-01-25T08:57:22.2887641Z      def test_login_required_decorator(self, client):
2026-01-25T08:57:22.2888033Z          """Проверка, что защищенные маршруты требуют логина."""
2026-01-25T08:57:22.2888420Z          # Предположим, у нас есть защищенный маршрут, например, создание поста
2026-01-25T08:57:22.2888778Z          # Если его нет, этот тест можно адаптировать под существующий
2026-01-25T08:57:22.2889145Z -        response = client.get('/post/create', follow_redirects=False)
2026-01-25T08:57:22.2889454Z +        response = client.get("/post/create", follow_redirects=False)
2026-01-25T08:57:22.2889859Z          # Если маршрут защищен login_required, он должен редиректить
2026-01-25T08:57:22.2890305Z          if response.status_code == 302:
2026-01-25T08:57:22.2890594Z -            assert '/auth/login' in response.headers['Location']
2026-01-25T08:57:22.2891007Z +            assert "/auth/login" in response.headers["Location"]
2026-01-25T08:57:22.3889152Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_discriminator.py
2026-01-25T08:57:22.3894548Z --- /home/runner/work/flask_blog/flask_blog/tests/test_discriminator.py	2026-01-25 08:57:06.654994+00:00
2026-01-25T08:57:22.3897394Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_discriminator.py	2026-01-25 08:57:22.385745+00:00
2026-01-25T08:57:22.3899502Z @@ -10,141 +10,149 @@
2026-01-25T08:57:22.3901573Z      """Тесты логики генерации дискриминаторов."""
2026-01-25T08:57:22.3903532Z  
2026-01-25T08:57:22.3905254Z      def test_random_discriminator_generation(self):
2026-01-25T08:57:22.3907393Z          """Проверка, что разные пользователи получают разные случайные дискриминаторы."""
2026-01-25T08:57:22.3909382Z          db_fd, db_path = tempfile.mkstemp()
2026-01-25T08:57:22.3911076Z -        
2026-01-25T08:57:22.3912776Z -        app = create_app({
2026-01-25T08:57:22.3914783Z -            'TESTING': True,
2026-01-25T08:57:22.3916448Z -            'DATABASE': db_path,
2026-01-25T08:57:22.3918245Z -            'SECRET_KEY': 'test-secret-key-for-testing',
2026-01-25T08:57:22.3920017Z -            'WTF_CSRF_ENABLED': False,
2026-01-25T08:57:22.3921716Z -        })
2026-01-25T08:57:22.3923680Z +
2026-01-25T08:57:22.3936817Z +        app = create_app(
2026-01-25T08:57:22.3937207Z +            {
2026-01-25T08:57:22.3937549Z +                "TESTING": True,
2026-01-25T08:57:22.3937959Z +                "DATABASE": db_path,
2026-01-25T08:57:22.3938488Z +                "SECRET_KEY": "test-secret-key-for-testing",
2026-01-25T08:57:22.3939038Z +                "WTF_CSRF_ENABLED": False,
2026-01-25T08:57:22.3939468Z +            }
2026-01-25T08:57:22.3939768Z +        )
2026-01-25T08:57:22.3940055Z  
2026-01-25T08:57:22.3940377Z          with app.app_context():
2026-01-25T08:57:22.3940843Z              from app.db.db import init_db, get_db
2026-01-25T08:57:22.3941849Z              from app.auth.utils import generate_discriminator
2026-01-25T08:57:22.3942430Z              from app.auth import hash_password
2026-01-25T08:57:22.3942877Z -            
2026-01-25T08:57:22.3943409Z +
2026-01-25T08:57:22.3943710Z              init_db()
2026-01-25T08:57:22.3944067Z              db = get_db()
2026-01-25T08:57:22.3944433Z -            
2026-01-25T08:57:22.3944720Z +
2026-01-25T08:57:22.3945282Z              # Создаем несколько пользователей с одинаковым именем
2026-01-25T08:57:22.3945817Z              discriminators = []
2026-01-25T08:57:22.3946220Z -            
2026-01-25T08:57:22.3946534Z +
2026-01-25T08:57:22.3946822Z              for i in range(5):
2026-01-25T08:57:22.3947307Z -                disc = generate_discriminator(db, 'testuser')
2026-01-25T08:57:22.3947901Z +                disc = generate_discriminator(db, "testuser")
2026-01-25T08:57:22.3948456Z                  assert disc is not None
2026-01-25T08:57:22.3948917Z                  assert 1 <= disc <= 9999
2026-01-25T08:57:22.3949408Z                  discriminators.append(disc)
2026-01-25T08:57:22.3949844Z -                
2026-01-25T08:57:22.3950170Z +
2026-01-25T08:57:22.3950587Z                  # Добавляем пользователя в БД
2026-01-25T08:57:22.3951121Z -                hashed_pw, salt = hash_password(f'pass{i}')
2026-01-25T08:57:22.3951740Z +                hashed_pw, salt = hash_password(f"pass{i}")
2026-01-25T08:57:22.3952265Z                  db.execute(
2026-01-25T08:57:22.3953092Z -                    'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.3953890Z -                    ('testuser', disc, hashed_pw, salt)
2026-01-25T08:57:22.3954685Z +                    "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.3955468Z +                    ("testuser", disc, hashed_pw, salt),
2026-01-25T08:57:22.3956250Z                  )
2026-01-25T08:57:22.3956596Z                  db.commit()
2026-01-25T08:57:22.3956979Z -            
2026-01-25T08:57:22.3957274Z +
2026-01-25T08:57:22.3957743Z              # Проверяем, что все дискриминаторы разные
2026-01-25T08:57:22.3958377Z              assert len(set(discriminators)) == len(discriminators)
2026-01-25T08:57:22.3959193Z              print(f"Сгенерированные дискриминаторы: {discriminators}")
2026-01-25T08:57:22.3959730Z  
2026-01-25T08:57:22.3960024Z          os.close(db_fd)
2026-01-25T08:57:22.3960456Z          os.unlink(db_path)
2026-01-25T08:57:22.3960805Z  
2026-01-25T08:57:22.3961148Z      def test_discriminator_exhaustion(self):
2026-01-25T08:57:22.3961875Z          """Проверка поведения при исчерпании всех дискриминаторов."""
2026-01-25T08:57:22.3962430Z          db_fd, db_path = tempfile.mkstemp()
2026-01-25T08:57:22.3962878Z -        
2026-01-25T08:57:22.3963420Z -        app = create_app({
2026-01-25T08:57:22.3963836Z -            'TESTING': True,
2026-01-25T08:57:22.3964249Z -            'DATABASE': db_path,
2026-01-25T08:57:22.3964757Z -            'SECRET_KEY': 'test-secret-key-for-testing',
2026-01-25T08:57:22.3965281Z -            'WTF_CSRF_ENABLED': False,
2026-01-25T08:57:22.3965693Z -        })
2026-01-25T08:57:22.3965974Z +
2026-01-25T08:57:22.3966265Z +        app = create_app(
2026-01-25T08:57:22.3966691Z +            {
2026-01-25T08:57:22.3967013Z +                "TESTING": True,
2026-01-25T08:57:22.3967430Z +                "DATABASE": db_path,
2026-01-25T08:57:22.3967939Z +                "SECRET_KEY": "test-secret-key-for-testing",
2026-01-25T08:57:22.3968471Z +                "WTF_CSRF_ENABLED": False,
2026-01-25T08:57:22.3968920Z +            }
2026-01-25T08:57:22.3969224Z +        )
2026-01-25T08:57:22.3969506Z  
2026-01-25T08:57:22.3969812Z          with app.app_context():
2026-01-25T08:57:22.3970259Z              from app.db.db import init_db, get_db
2026-01-25T08:57:22.3970973Z              from app.auth.utils import generate_discriminator, MAX_DISCRIMINATOR
2026-01-25T08:57:22.3971615Z -            
2026-01-25T08:57:22.3971914Z +
2026-01-25T08:57:22.3972489Z              init_db()
2026-01-25T08:57:22.3972863Z              db = get_db()
2026-01-25T08:57:22.3973397Z -            
2026-01-25T08:57:22.3973697Z +
2026-01-25T08:57:22.3974212Z              # Занимаем все дискриминаторы для имени 'testuser'
2026-01-25T08:57:22.3974978Z              for disc in range(1, 6):  # Для теста используем только первые 5
2026-01-25T08:57:22.3975598Z                  from app.auth import hash_password
2026-01-25T08:57:22.3976137Z -                hashed_pw, salt = hash_password('pass')
2026-01-25T08:57:22.3976621Z +
2026-01-25T08:57:22.3976959Z +                hashed_pw, salt = hash_password("pass")
2026-01-25T08:57:22.3977507Z                  db.execute(
2026-01-25T08:57:22.3978238Z -                    'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.3979117Z -                    ('testuser', disc, hashed_pw, salt)
2026-01-25T08:57:22.3979877Z +                    "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.3980643Z +                    ("testuser", disc, hashed_pw, salt),
2026-01-25T08:57:22.3981125Z                  )
2026-01-25T08:57:22.3981454Z              db.commit()
2026-01-25T08:57:22.3981807Z -            
2026-01-25T08:57:22.3982135Z +
2026-01-25T08:57:22.3982711Z              # Проверяем, что для новых пользователей есть свободные дискриминаторы (6-9999)
2026-01-25T08:57:22.3983568Z -            disc = generate_discriminator(db, 'testuser')
2026-01-25T08:57:22.3984180Z +            disc = generate_discriminator(db, "testuser")
2026-01-25T08:57:22.3984697Z              assert disc is not None
2026-01-25T08:57:22.3985309Z              assert disc >= 6  # Должен быть следующий свободный
2026-01-25T08:57:22.3985854Z -            
2026-01-25T08:57:22.3986157Z +
2026-01-25T08:57:22.3986639Z              # Но для другого имени должны быть свободные дискриминаторы
2026-01-25T08:57:22.3987509Z              from app.auth import hash_password
2026-01-25T08:57:22.3988088Z -            hashed_pw2, salt2 = hash_password('pass2')
2026-01-25T08:57:22.3988678Z -            disc2 = generate_discriminator(db, 'otheruser')
2026-01-25T08:57:22.3989181Z +
2026-01-25T08:57:22.3989552Z +            hashed_pw2, salt2 = hash_password("pass2")
2026-01-25T08:57:22.3990146Z +            disc2 = generate_discriminator(db, "otheruser")
2026-01-25T08:57:22.3990696Z              assert disc2 is not None
2026-01-25T08:57:22.3991140Z              assert 1 <= disc2 <= 9999
2026-01-25T08:57:22.3991538Z  
2026-01-25T08:57:22.3991826Z          os.close(db_fd)
2026-01-25T08:57:22.3992198Z          os.unlink(db_path)
2026-01-25T08:57:22.3992554Z  
2026-01-25T08:57:22.3993155Z      def test_different_usernames_independent_discriminators(self):
2026-01-25T08:57:22.3994112Z          """Проверка, что разные имена пользователей имеют независимые наборы дискриминаторов."""
2026-01-25T08:57:22.3994836Z          db_fd, db_path = tempfile.mkstemp()
2026-01-25T08:57:22.3995267Z -        
2026-01-25T08:57:22.3995588Z -        app = create_app({
2026-01-25T08:57:22.3995976Z -            'TESTING': True,
2026-01-25T08:57:22.3996377Z -            'DATABASE': db_path,
2026-01-25T08:57:22.3996873Z -            'SECRET_KEY': 'test-secret-key-for-testing',
2026-01-25T08:57:22.3997396Z -            'WTF_CSRF_ENABLED': False,
2026-01-25T08:57:22.3997818Z -        })
2026-01-25T08:57:22.3998095Z +
2026-01-25T08:57:22.3998390Z +        app = create_app(
2026-01-25T08:57:22.3998748Z +            {
2026-01-25T08:57:22.3999060Z +                "TESTING": True,
2026-01-25T08:57:22.3999490Z +                "DATABASE": db_path,
2026-01-25T08:57:22.4000001Z +                "SECRET_KEY": "test-secret-key-for-testing",
2026-01-25T08:57:22.4000518Z +                "WTF_CSRF_ENABLED": False,
2026-01-25T08:57:22.4000868Z +            }
2026-01-25T08:57:22.4001120Z +        )
2026-01-25T08:57:22.4001365Z  
2026-01-25T08:57:22.4001637Z          with app.app_context():
2026-01-25T08:57:22.4002236Z              from app.db.db import init_db, get_db
2026-01-25T08:57:22.4002725Z              from app.auth.utils import generate_discriminator
2026-01-25T08:57:22.4003369Z              from app.auth import hash_password
2026-01-25T08:57:22.4003737Z -            
2026-01-25T08:57:22.4003992Z +
2026-01-25T08:57:22.4004235Z              init_db()
2026-01-25T08:57:22.4004519Z              db = get_db()
2026-01-25T08:57:22.4004805Z -            
2026-01-25T08:57:22.4005039Z +
2026-01-25T08:57:22.4005432Z              # Создаем пользователя с именем 'alice'
2026-01-25T08:57:22.4005893Z -            disc1 = generate_discriminator(db, 'alice')
2026-01-25T08:57:22.4006342Z -            hashed_pw1, salt1 = hash_password('pass1')
2026-01-25T08:57:22.4006829Z +            disc1 = generate_discriminator(db, "alice")
2026-01-25T08:57:22.4007293Z +            hashed_pw1, salt1 = hash_password("pass1")
2026-01-25T08:57:22.4007717Z              db.execute(
2026-01-25T08:57:22.4008349Z -                'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.4008995Z -                ('alice', disc1, hashed_pw1, salt1)
2026-01-25T08:57:22.4009608Z +                "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.4010206Z +                ("alice", disc1, hashed_pw1, salt1),
2026-01-25T08:57:22.4010587Z              )
2026-01-25T08:57:22.4010947Z              db.commit()
2026-01-25T08:57:22.4011244Z -            
2026-01-25T08:57:22.4011499Z +
2026-01-25T08:57:22.4011923Z              # Создаем пользователя с таким же дискриминатором, но другим именем
2026-01-25T08:57:22.4012415Z -            disc2 = generate_discriminator(db, 'bob')
2026-01-25T08:57:22.4012861Z +            disc2 = generate_discriminator(db, "bob")
2026-01-25T08:57:22.4013598Z              # Дискриминатор может быть любым доступным, не обязательно таким же
2026-01-25T08:57:22.4014355Z              assert disc2 is not None
2026-01-25T08:57:22.4014730Z              assert 1 <= disc2 <= 9999
2026-01-25T08:57:22.4015093Z -            
2026-01-25T08:57:22.4015407Z -            hashed_pw2, salt2 = hash_password('pass2')
2026-01-25T08:57:22.4015800Z +
2026-01-25T08:57:22.4016104Z +            hashed_pw2, salt2 = hash_password("pass2")
2026-01-25T08:57:22.4016523Z              db.execute(
2026-01-25T08:57:22.4017069Z -                'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.4017698Z -                ('bob', disc2, hashed_pw2, salt2)
2026-01-25T08:57:22.4018303Z +                "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.4018944Z +                ("bob", disc2, hashed_pw2, salt2),
2026-01-25T08:57:22.4019342Z              )
2026-01-25T08:57:22.4019609Z              db.commit()
2026-01-25T08:57:22.4019896Z -            
2026-01-25T08:57:22.4020150Z +
2026-01-25T08:57:22.4020522Z              # Проверяем, что оба пользователя созданы
2026-01-25T08:57:22.4020956Z              users = db.execute(
2026-01-25T08:57:22.4021518Z -                'SELECT username, discriminator FROM user WHERE username IN (?, ?)',
2026-01-25T08:57:22.4022105Z -                ('alice', 'bob')
2026-01-25T08:57:22.4022664Z +                "SELECT username, discriminator FROM user WHERE username IN (?, ?)",
2026-01-25T08:57:22.4023429Z +                ("alice", "bob"),
2026-01-25T08:57:22.4023798Z              ).fetchall()
2026-01-25T08:57:22.4024112Z -            
2026-01-25T08:57:22.4024377Z +
2026-01-25T08:57:22.4024646Z              assert len(users) == 2
2026-01-25T08:57:22.4025205Z              # Дискриминаторы могут быть разными, это нормально
2026-01-25T08:57:22.4025746Z -            assert users[0]['username'] != users[1]['username']
2026-01-25T08:57:22.4026312Z +            assert users[0]["username"] != users[1]["username"]
2026-01-25T08:57:22.4026787Z  
2026-01-25T08:57:22.4027050Z          os.close(db_fd)
2026-01-25T08:57:22.4027392Z          os.unlink(db_path)
2026-01-25T08:57:22.4479526Z --- /home/runner/work/flask_blog/flask_blog/tests/test_comments.py	2026-01-25 08:57:06.653994+00:00
2026-01-25T08:57:22.4480814Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_comments.py	2026-01-25 08:57:22.442567+00:00
2026-01-25T08:57:22.4484716Z @@ -1,6 +1,7 @@
2026-01-25T08:57:22.4487457Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_comments.py
2026-01-25T08:57:22.4488601Z  """Тесты для функционала комментариев."""
2026-01-25T08:57:22.4489047Z +
2026-01-25T08:57:22.4489394Z  import pytest
2026-01-25T08:57:22.4489760Z  from flask import session
2026-01-25T08:57:22.4490129Z  
2026-01-25T08:57:22.4490448Z  from app.models import Comment
2026-01-25T08:57:22.4490908Z  from app.services import CommentService
2026-01-25T08:57:22.4491443Z @@ -12,27 +13,24 @@
2026-01-25T08:57:22.4491865Z      def test_create_comment(self, app, client, auth):
2026-01-25T08:57:22.4492635Z          """Создание комментария должно работать корректно."""
2026-01-25T08:57:22.4493568Z          # Сначала регистрируем, логинимся и создаём пост
2026-01-25T08:57:22.4494033Z          auth.register()
2026-01-25T08:57:22.4494402Z          auth.login()
2026-01-25T08:57:22.4494731Z -        
2026-01-25T08:57:22.4494998Z +
2026-01-25T08:57:22.4495295Z          with app.app_context():
2026-01-25T08:57:22.4495795Z              # Создаём пост для комментария
2026-01-25T08:57:22.4496273Z              from app.services import PostService
2026-01-25T08:57:22.4496761Z -            post = PostService.create(
2026-01-25T08:57:22.4497227Z -                author_id=1,
2026-01-25T08:57:22.4497737Z -                title="Тестовый пост",
2026-01-25T08:57:22.4498265Z -                content="Содержание поста"
2026-01-25T08:57:22.4498692Z -            )
2026-01-25T08:57:22.4499037Z -            
2026-01-25T08:57:22.4499322Z +
2026-01-25T08:57:22.4499625Z +            post = PostService.create(
2026-01-25T08:57:22.4500590Z +                author_id=1, title="Тестовый пост", content="Содержание поста"
2026-01-25T08:57:22.4501123Z +            )
2026-01-25T08:57:22.4501430Z +
2026-01-25T08:57:22.4501808Z              # Создаём комментарий
2026-01-25T08:57:22.4502254Z              comment = CommentService.create(
2026-01-25T08:57:22.4502725Z -                author_id=1,
2026-01-25T08:57:22.4503325Z -                post_id=post.id,
2026-01-25T08:57:22.4503849Z -                content="Это тестовый комментарий"
2026-01-25T08:57:22.4504289Z -            )
2026-01-25T08:57:22.4504585Z -            
2026-01-25T08:57:22.4505172Z +                author_id=1, post_id=post.id, content="Это тестовый комментарий"
2026-01-25T08:57:22.4505735Z +            )
2026-01-25T08:57:22.4506021Z +
2026-01-25T08:57:22.4506324Z              assert comment.id is not None
2026-01-25T08:57:22.4506957Z              assert comment.content == "Это тестовый комментарий"
2026-01-25T08:57:22.4507498Z              assert comment.author_id == 1
2026-01-25T08:57:22.4508009Z              assert comment.post_id == post.id
2026-01-25T08:57:22.4508775Z              assert comment.created is not None
2026-01-25T08:57:22.4509236Z @@ -41,158 +39,135 @@
2026-01-25T08:57:22.4509549Z  
2026-01-25T08:57:22.4509892Z      def test_find_comment_by_id(self, app, auth):
2026-01-25T08:57:22.4510528Z          """Поиск комментария по ID должен работать."""
2026-01-25T08:57:22.4511036Z          auth.register()
2026-01-25T08:57:22.4511424Z          auth.login()
2026-01-25T08:57:22.4511739Z -        
2026-01-25T08:57:22.4512088Z -        with app.app_context():
2026-01-25T08:57:22.4512550Z -            # Создаём пост
2026-01-25T08:57:22.4513157Z -            from app.services import PostService
2026-01-25T08:57:22.4513714Z -            post = PostService.create(
2026-01-25T08:57:22.4514257Z -                author_id=1,
2026-01-25T08:57:22.4514801Z -                title="Тестовый пост",
2026-01-25T08:57:22.4515375Z -                content="Содержание"
2026-01-25T08:57:22.4515839Z -            )
2026-01-25T08:57:22.4516144Z -            
2026-01-25T08:57:22.4516439Z +
2026-01-25T08:57:22.4516772Z +        with app.app_context():
2026-01-25T08:57:22.4517277Z +            # Создаём пост
2026-01-25T08:57:22.4517718Z +            from app.services import PostService
2026-01-25T08:57:22.4518193Z +
2026-01-25T08:57:22.4518524Z +            post = PostService.create(
2026-01-25T08:57:22.4519256Z +                author_id=1, title="Тестовый пост", content="Содержание"
2026-01-25T08:57:22.4519818Z +            )
2026-01-25T08:57:22.4520125Z +
2026-01-25T08:57:22.4520512Z              # Создаём комментарий
2026-01-25T08:57:22.4521023Z              created_comment = CommentService.create(
2026-01-25T08:57:22.4521552Z -                author_id=1,
2026-01-25T08:57:22.4521969Z -                post_id=post.id,
2026-01-25T08:57:22.4522541Z -                content="Тестовый комментарий"
2026-01-25T08:57:22.4523231Z -            )
2026-01-25T08:57:22.4523559Z -            
2026-01-25T08:57:22.4524676Z +                author_id=1, post_id=post.id, content="Тестовый комментарий"
2026-01-25T08:57:22.4525335Z +            )
2026-01-25T08:57:22.4525661Z +
2026-01-25T08:57:22.4526074Z              # Ищем комментарий по ID
2026-01-25T08:57:22.4526689Z              found_comment = CommentService.find_by_id(created_comment.id)
2026-01-25T08:57:22.4527301Z -            
2026-01-25T08:57:22.4527601Z +
2026-01-25T08:57:22.4527934Z              assert found_comment is not None
2026-01-25T08:57:22.4528510Z              assert found_comment.id == created_comment.id
2026-01-25T08:57:22.4529304Z              assert found_comment.content == "Тестовый комментарий"
2026-01-25T08:57:22.4529853Z  
2026-01-25T08:57:22.4530247Z      def test_get_comments_by_post_id(self, app, auth):
2026-01-25T08:57:22.4531043Z          """Получение комментариев к посту должно работать."""
2026-01-25T08:57:22.4531580Z          auth.register()
2026-01-25T08:57:22.4531975Z          auth.login()
2026-01-25T08:57:22.4532362Z -        
2026-01-25T08:57:22.4532688Z -        with app.app_context():
2026-01-25T08:57:22.4533399Z -            # Создаём пост
2026-01-25T08:57:22.4533877Z -            from app.services import PostService
2026-01-25T08:57:22.4534375Z -            post = PostService.create(
2026-01-25T08:57:22.4534792Z -                author_id=1,
2026-01-25T08:57:22.4535268Z -                title="Тестовый пост",
2026-01-25T08:57:22.4535822Z -                content="Содержание"
2026-01-25T08:57:22.4536246Z -            )
2026-01-25T08:57:22.4536540Z -            
2026-01-25T08:57:22.4536845Z +
2026-01-25T08:57:22.4537129Z +        with app.app_context():
2026-01-25T08:57:22.4537601Z +            # Создаём пост
2026-01-25T08:57:22.4538025Z +            from app.services import PostService
2026-01-25T08:57:22.4538465Z +
2026-01-25T08:57:22.4538784Z +            post = PostService.create(
2026-01-25T08:57:22.4539406Z +                author_id=1, title="Тестовый пост", content="Содержание"
2026-01-25T08:57:22.4539975Z +            )
2026-01-25T08:57:22.4540317Z +
2026-01-25T08:57:22.4540750Z              # Создаём несколько комментариев
2026-01-25T08:57:22.4541510Z              comment1 = CommentService.create(
2026-01-25T08:57:22.4542030Z -                author_id=1,
2026-01-25T08:57:22.4542449Z -                post_id=post.id,
2026-01-25T08:57:22.4543308Z -                content="Первый комментарий"
2026-01-25T08:57:22.4544073Z +                author_id=1, post_id=post.id, content="Первый комментарий"
2026-01-25T08:57:22.4544631Z              )
2026-01-25T08:57:22.4545005Z              comment2 = CommentService.create(
2026-01-25T08:57:22.4545471Z -                author_id=1,
2026-01-25T08:57:22.4545922Z -                post_id=post.id,
2026-01-25T08:57:22.4546496Z -                content="Второй комментарий"
2026-01-25T08:57:22.4546933Z -            )
2026-01-25T08:57:22.4547253Z -            
2026-01-25T08:57:22.4547890Z +                author_id=1, post_id=post.id, content="Второй комментарий"
2026-01-25T08:57:22.4548543Z +            )
2026-01-25T08:57:22.4548859Z +
2026-01-25T08:57:22.4549315Z              # Получаем комментарии к посту
2026-01-25T08:57:22.4549890Z              comments = CommentService.get_by_post_id(post.id)
2026-01-25T08:57:22.4550458Z -            
2026-01-25T08:57:22.4550783Z +
2026-01-25T08:57:22.4551094Z              assert len(comments) == 2
2026-01-25T08:57:22.4551935Z              assert comments[0].content in ["Первый комментарий", "Второй комментарий"]
2026-01-25T08:57:22.4553342Z              assert comments[1].content in ["Первый комментарий", "Второй комментарий"]
2026-01-25T08:57:22.4554144Z  
2026-01-25T08:57:22.4656482Z      def test_delete_own_comment(self, app, auth):
2026-01-25T08:57:22.4657356Z          """Удаление своего комментария должно работать."""
2026-01-25T08:57:22.4657840Z          auth.register()
2026-01-25T08:57:22.4658223Z          auth.login()
2026-01-25T08:57:22.4658606Z -        
2026-01-25T08:57:22.4658925Z -        with app.app_context():
2026-01-25T08:57:22.4659990Z -            # Создаём пост
2026-01-25T08:57:22.4660391Z -            from app.services import PostService
2026-01-25T08:57:22.4660918Z -            post = PostService.create(
2026-01-25T08:57:22.4661336Z -                author_id=1,
2026-01-25T08:57:22.4661858Z -                title="Тестовый пост",
2026-01-25T08:57:22.4662436Z -                content="Содержание"
2026-01-25T08:57:22.4662873Z -            )
2026-01-25T08:57:22.4663386Z -            
2026-01-25T08:57:22.4663761Z +
2026-01-25T08:57:22.4664126Z +        with app.app_context():
2026-01-25T08:57:22.4664695Z +            # Создаём пост
2026-01-25T08:57:22.4665167Z +            from app.services import PostService
2026-01-25T08:57:22.4665727Z +
2026-01-25T08:57:22.4666080Z +            post = PostService.create(
2026-01-25T08:57:22.4666853Z +                author_id=1, title="Тестовый пост", content="Содержание"
2026-01-25T08:57:22.4667441Z +            )
2026-01-25T08:57:22.4667765Z +
2026-01-25T08:57:22.4668158Z              # Создаём комментарий
2026-01-25T08:57:22.4668677Z              comment = CommentService.create(
2026-01-25T08:57:22.4669160Z -                author_id=1,
2026-01-25T08:57:22.4669615Z -                post_id=post.id,
2026-01-25T08:57:22.4670210Z -                content="Тестовый комментарий"
2026-01-25T08:57:22.4670664Z -            )
2026-01-25T08:57:22.4670956Z -            
2026-01-25T08:57:22.4671605Z +                author_id=1, post_id=post.id, content="Тестовый комментарий"
2026-01-25T08:57:22.4672194Z +            )
2026-01-25T08:57:22.4672494Z +
2026-01-25T08:57:22.4672872Z              # Удаляем свой комментарий
2026-01-25T08:57:22.4673632Z              result = CommentService.delete(comment.id, 1)
2026-01-25T08:57:22.4674116Z -            
2026-01-25T08:57:22.4674404Z +
2026-01-25T08:57:22.4674731Z              assert result is True
2026-01-25T08:57:22.4675164Z -            
2026-01-25T08:57:22.4675449Z +
2026-01-25T08:57:22.4675884Z              # Проверяем, что комментарий удалён
2026-01-25T08:57:22.4676485Z              deleted_comment = CommentService.find_by_id(comment.id)
2026-01-25T08:57:22.4677073Z              assert deleted_comment is None
2026-01-25T08:57:22.4677793Z  
2026-01-25T08:57:22.4678184Z      def test_delete_foreign_comment(self, app, auth):
2026-01-25T08:57:22.4678918Z          """Удаление чужого комментария не должно работать."""
2026-01-25T08:57:22.4679488Z          # Создаём двух пользователей
2026-01-25T08:57:22.4679944Z          auth.register(username="user1")
2026-01-25T08:57:22.4680412Z          auth.register(username="user2")
2026-01-25T08:57:22.4680864Z -        
2026-01-25T08:57:22.4681152Z +
2026-01-25T08:57:22.4681516Z          with app.app_context():
2026-01-25T08:57:22.4682092Z              # Создаём пост от первого пользователя
2026-01-25T08:57:22.4682679Z              from app.services import PostService
2026-01-25T08:57:22.4683397Z -            post = PostService.create(
2026-01-25T08:57:22.4683813Z -                author_id=1,
2026-01-25T08:57:22.4684360Z -                title="Тестовый пост",
2026-01-25T08:57:22.4684918Z -                content="Содержание"
2026-01-25T08:57:22.4685335Z -            )
2026-01-25T08:57:22.4685672Z -            
2026-01-25T08:57:22.4685990Z +
2026-01-25T08:57:22.4686330Z +            post = PostService.create(
2026-01-25T08:57:22.4687104Z +                author_id=1, title="Тестовый пост", content="Содержание"
2026-01-25T08:57:22.4687662Z +            )
2026-01-25T08:57:22.4687999Z +
2026-01-25T08:57:22.4688538Z              # Создаём комментарий от первого пользователя
2026-01-25T08:57:22.4689124Z              comment = CommentService.create(
2026-01-25T08:57:22.4689615Z -                author_id=1,
2026-01-25T08:57:22.4690044Z -                post_id=post.id,
2026-01-25T08:57:22.4690648Z -                content="Комментарий пользователя 1"
2026-01-25T08:57:22.4691152Z -            )
2026-01-25T08:57:22.4691485Z -            
2026-01-25T08:57:22.4692164Z +                author_id=1, post_id=post.id, content="Комментарий пользователя 1"
2026-01-25T08:57:22.4693458Z +            )
2026-01-25T08:57:22.4693818Z +
2026-01-25T08:57:22.4694384Z              # Пытаемся удалить комментарий от второго пользователя
2026-01-25T08:57:22.4695010Z              result = CommentService.delete(comment.id, 2)
2026-01-25T08:57:22.4695515Z -            
2026-01-25T08:57:22.4695833Z +
2026-01-25T08:57:22.4696151Z              assert result is False
2026-01-25T08:57:22.4696570Z -            
2026-01-25T08:57:22.4696905Z +
2026-01-25T08:57:22.4697379Z              # Проверяем, что комментарий не удалён
2026-01-25T08:57:22.4698009Z              existing_comment = CommentService.find_by_id(comment.id)
2026-01-25T08:57:22.4698641Z              assert existing_comment is not None
2026-01-25T08:57:22.4699107Z  
2026-01-25T08:57:22.4699499Z      def test_get_count_by_post_id(self, app, auth):
2026-01-25T08:57:22.4700213Z          """Подсчёт комментариев к посту должен работать."""
2026-01-25T08:57:22.4700733Z          auth.register()
2026-01-25T08:57:22.4701123Z          auth.login()
2026-01-25T08:57:22.4701508Z -        
2026-01-25T08:57:22.4701884Z -        with app.app_context():
2026-01-25T08:57:22.4702672Z -            # Создаём пост
2026-01-25T08:57:22.4703369Z -            from app.services import PostService
2026-01-25T08:57:22.4703900Z -            post = PostService.create(
2026-01-25T08:57:22.4704376Z -                author_id=1,
2026-01-25T08:57:22.4704960Z -                title="Тестовый пост",
2026-01-25T08:57:22.4705523Z -                content="Содержание"
2026-01-25T08:57:22.4705965Z -            )
2026-01-25T08:57:22.4706301Z -            
2026-01-25T08:57:22.4706629Z +
2026-01-25T08:57:22.4706944Z +        with app.app_context():
2026-01-25T08:57:22.4707466Z +            # Создаём пост
2026-01-25T08:57:22.4707954Z +            from app.services import PostService
2026-01-25T08:57:22.4708426Z +
2026-01-25T08:57:22.4708801Z +            post = PostService.create(
2026-01-25T08:57:22.4709547Z +                author_id=1, title="Тестовый пост", content="Содержание"
2026-01-25T08:57:22.4710128Z +            )
2026-01-25T08:57:22.4710442Z +
2026-01-25T08:57:22.4710979Z              # Проверяем количество комментариев (должно быть 0)
2026-01-25T08:57:22.4711623Z              count = CommentService.get_count_by_post_id(post.id)
2026-01-25T08:57:22.4712236Z              assert count == 0
2026-01-25T08:57:22.4712720Z -            
2026-01-25T08:57:22.4713414Z +
2026-01-25T08:57:22.4713882Z              # Создаём несколько комментариев
2026-01-25T08:57:22.4714515Z -            CommentService.create(
2026-01-25T08:57:22.4715020Z -                author_id=1,
2026-01-25T08:57:22.4715445Z -                post_id=post.id,
2026-01-25T08:57:22.4716047Z -                content="Комментарий 1"
2026-01-25T08:57:22.4716493Z -            )
2026-01-25T08:57:22.4716851Z -            CommentService.create(
2026-01-25T08:57:22.4717298Z -                author_id=1,
2026-01-25T08:57:22.4717708Z -                post_id=post.id,
2026-01-25T08:57:22.4718259Z -                content="Комментарий 2"
2026-01-25T08:57:22.4719057Z -            )
2026-01-25T08:57:22.4719392Z -            
2026-01-25T08:57:22.4720171Z +            CommentService.create(author_id=1, post_id=post.id, content="Комментарий 1")
2026-01-25T08:57:22.4721319Z +            CommentService.create(author_id=1, post_id=post.id, content="Комментарий 2")
2026-01-25T08:57:22.4722061Z +
2026-01-25T08:57:22.4722520Z              # Проверяем количество комментариев
2026-01-25T08:57:22.4723351Z              count = CommentService.get_count_by_post_id(post.id)
2026-01-25T08:57:22.4723933Z              assert count == 2
2026-01-25T08:57:22.4724321Z  
2026-01-25T08:57:22.4724607Z  
2026-01-25T08:57:22.4724937Z @@ -201,153 +176,137 @@
2026-01-25T08:57:22.4725277Z  
2026-01-25T08:57:22.4725676Z      def test_add_comment_as_logged_in_user(self, client, auth):
2026-01-25T08:57:22.4726473Z          """Добавление комментария авторизованным пользователем."""
2026-01-25T08:57:22.4727038Z          auth.register()
2026-01-25T08:57:22.4727449Z          auth.login()
2026-01-25T08:57:22.4727785Z -        
2026-01-25T08:57:22.4728072Z +
2026-01-25T08:57:22.4728468Z          # Создаём пост
2026-01-25T08:57:22.4728905Z          with client.application.app_context():
2026-01-25T08:57:22.4729448Z              from app.services import PostService
2026-01-25T08:57:22.4729964Z -            post = PostService.create(
2026-01-25T08:57:22.4730420Z -                author_id=1,
2026-01-25T08:57:22.4731012Z -                title="Тестовый пост",
2026-01-25T08:57:22.4731653Z -                content="Содержание поста"
2026-01-25T08:57:22.4732133Z -            )
2026-01-25T08:57:22.4732514Z -        
2026-01-25T08:57:22.4732831Z +
2026-01-25T08:57:22.4733490Z +            post = PostService.create(
2026-01-25T08:57:22.4734281Z +                author_id=1, title="Тестовый пост", content="Содержание поста"
2026-01-25T08:57:22.4734431Z +            )
2026-01-25T08:57:22.4734552Z +
2026-01-25T08:57:22.4734785Z          # Добавляем комментарий
2026-01-25T08:57:22.4735073Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.4735270Z -            sess['csrf_token'] = 'test-csrf-token'
2026-01-25T08:57:22.4735641Z -        
2026-01-25T08:57:22.4735861Z +            sess["csrf_token"] = "test-csrf-token"
2026-01-25T08:57:22.4735981Z +
2026-01-25T08:57:22.4736145Z          response = client.post(
2026-01-25T08:57:22.4736324Z -            f'/post/{post.id}/comment',
2026-01-25T08:57:22.4736461Z -            data={
2026-01-25T08:57:22.4736761Z -                'content': 'Новый комментарий',
2026-01-25T08:57:22.4736959Z -                'csrf_token': 'test-csrf-token'
2026-01-25T08:57:22.4737084Z -            },
2026-01-25T08:57:22.4737250Z -            follow_redirects=True
2026-01-25T08:57:22.4737417Z +            f"/post/{post.id}/comment",
2026-01-25T08:57:22.4737903Z +            data={"content": "Новый комментарий", "csrf_token": "test-csrf-token"},
2026-01-25T08:57:22.4738087Z +            follow_redirects=True,
2026-01-25T08:57:22.4738217Z          )
2026-01-25T08:57:22.4738366Z -        
2026-01-25T08:57:22.4738503Z +
2026-01-25T08:57:22.4738696Z          assert response.status_code == 200
2026-01-25T08:57:22.4739025Z          # Проверяем, что комментарий появился в ответе
2026-01-25T08:57:22.4739244Z -        content = response.data.decode('utf-8')
2026-01-25T08:57:22.4739509Z -        assert 'Новый комментарий' in content
2026-01-25T08:57:22.4739704Z +        content = response.data.decode("utf-8")
2026-01-25T08:57:22.4739960Z +        assert "Новый комментарий" in content
2026-01-25T08:57:22.4740090Z  
2026-01-25T08:57:22.4740373Z      def test_add_comment_as_anonymous_user(self, client, auth):
2026-01-25T08:57:22.4740782Z          """Добавление комментария анонимным пользователем должно быть запрещено."""
2026-01-25T08:57:22.4741064Z          # Создаём пост (нужно авторизоваться)
2026-01-25T08:57:22.4741299Z          auth.register()
2026-01-25T08:57:22.4741444Z          auth.login()
2026-01-25T08:57:22.4741583Z -        
2026-01-25T08:57:22.4742046Z +
2026-01-25T08:57:22.4742301Z          with client.application.app_context():
2026-01-25T08:57:22.4742543Z              from app.services import PostService
2026-01-25T08:57:22.4742723Z -            post = PostService.create(
2026-01-25T08:57:22.4742874Z -                author_id=1,
2026-01-25T08:57:22.4743426Z -                title="Тестовый пост",
2026-01-25T08:57:22.4743743Z -                content="Содержание поста"
2026-01-25T08:57:22.4743880Z -            )
2026-01-25T08:57:22.4744021Z -        
2026-01-25T08:57:22.4744138Z +
2026-01-25T08:57:22.4744355Z +            post = PostService.create(
2026-01-25T08:57:22.4744842Z +                author_id=1, title="Тестовый пост", content="Содержание поста"
2026-01-25T08:57:22.4745003Z +            )
2026-01-25T08:57:22.4745134Z +
2026-01-25T08:57:22.4745355Z          # Выходим из системы
2026-01-25T08:57:22.4745496Z          auth.logout()
2026-01-25T08:57:22.4745623Z -        
2026-01-25T08:57:22.4745741Z +
2026-01-25T08:57:22.4745984Z          # Пытаемся добавить комментарий
2026-01-25T08:57:22.4746174Z          response = client.post(
2026-01-25T08:57:22.4746367Z -            f'/post/{post.id}/comment',
2026-01-25T08:57:22.4746677Z -            data={'content': 'Новый комментарий'},
2026-01-25T08:57:22.4746903Z -            follow_redirects=True
2026-01-25T08:57:22.4747150Z +            f"/post/{post.id}/comment",
2026-01-25T08:57:22.4747429Z +            data={"content": "Новый комментарий"},
2026-01-25T08:57:22.4747615Z +            follow_redirects=True,
2026-01-25T08:57:22.4747738Z          )
2026-01-25T08:57:22.4747865Z -        
2026-01-25T08:57:22.4747985Z +
2026-01-25T08:57:22.4748270Z          # Должно перенаправить на страницу логина
2026-01-25T08:57:22.4748459Z          assert response.status_code == 200
2026-01-25T08:57:22.4748657Z -        assert b'login' in response.data.lower()
2026-01-25T08:57:22.4748849Z +        assert b"login" in response.data.lower()
2026-01-25T08:57:22.4748975Z  
2026-01-25T08:57:22.4749192Z      def test_delete_own_comment(self, client, auth):
2026-01-25T08:57:22.4749476Z          """Удаление своего комментария."""
2026-01-25T08:57:22.4749885Z          auth.register()
2026-01-25T08:57:22.4750044Z          auth.login()
2026-01-25T08:57:22.4750181Z -        
2026-01-25T08:57:22.4750308Z +
2026-01-25T08:57:22.4750513Z          with client.application.app_context():
2026-01-25T08:57:22.4750759Z              # Создаём пост
2026-01-25T08:57:22.4750952Z              from app.services import PostService
2026-01-25T08:57:22.4751126Z -            post = PostService.create(
2026-01-25T08:57:22.4751283Z -                author_id=1,
2026-01-25T08:57:22.4751531Z -                title="Тестовый пост",
2026-01-25T08:57:22.4751780Z -                content="Содержание поста"
2026-01-25T08:57:22.4751938Z -            )
2026-01-25T08:57:22.4752061Z -            
2026-01-25T08:57:22.4752190Z +
2026-01-25T08:57:22.4752360Z +            post = PostService.create(
2026-01-25T08:57:22.4752784Z +                author_id=1, title="Тестовый пост", content="Содержание поста"
2026-01-25T08:57:22.4753144Z +            )
2026-01-25T08:57:22.4753267Z +
2026-01-25T08:57:22.4753541Z              # Создаём комментарий
2026-01-25T08:57:22.4753747Z              comment = CommentService.create(
2026-01-25T08:57:22.4753887Z -                author_id=1,
2026-01-25T08:57:22.4754037Z -                post_id=post.id,
2026-01-25T08:57:22.4754309Z -                content="Тестовый комментарий"
2026-01-25T08:57:22.4754433Z -            )
2026-01-25T08:57:22.4754555Z -        
2026-01-25T08:57:22.4755009Z +                author_id=1, post_id=post.id, content="Тестовый комментарий"
2026-01-25T08:57:22.4755138Z +            )
2026-01-25T08:57:22.4755263Z +
2026-01-25T08:57:22.4755509Z          # Удаляем комментарий
2026-01-25T08:57:22.4755722Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.4755924Z -            sess['csrf_token'] = 'test-csrf-token'
2026-01-25T08:57:22.4756048Z -        
2026-01-25T08:57:22.4756232Z +            sess["csrf_token"] = "test-csrf-token"
2026-01-25T08:57:22.4756803Z +
2026-01-25T08:57:22.4756977Z          response = client.post(
2026-01-25T08:57:22.4757179Z -            f'/comment/{comment.id}/delete',
2026-01-25T08:57:22.4757332Z -            data={
2026-01-25T08:57:22.4757513Z -                'csrf_token': 'test-csrf-token'
2026-01-25T08:57:22.4757649Z -            },
2026-01-25T08:57:22.4757808Z -            follow_redirects=True
2026-01-25T08:57:22.4757982Z +            f"/comment/{comment.id}/delete",
2026-01-25T08:57:22.4758186Z +            data={"csrf_token": "test-csrf-token"},
2026-01-25T08:57:22.4758344Z +            follow_redirects=True,
2026-01-25T08:57:22.4758471Z          )
2026-01-25T08:57:22.4758623Z -        
2026-01-25T08:57:22.4758745Z +
2026-01-25T08:57:22.4758987Z          assert response.status_code == 200
2026-01-25T08:57:22.4759373Z          # Проверяем, что комментарий удалён (его нет в ответе)
2026-01-25T08:57:22.4759599Z -        content = response.data.decode('utf-8')
2026-01-25T08:57:22.4759944Z -        assert 'Тестовый комментарий' not in content
2026-01-25T08:57:22.4760143Z +        content = response.data.decode("utf-8")
2026-01-25T08:57:22.4760463Z +        assert "Тестовый комментарий" not in content
2026-01-25T08:57:22.4760597Z  
2026-01-25T08:57:22.4760843Z      def test_view_post_with_comments(self, client, auth):
2026-01-25T08:57:22.4761227Z          """Просмотр поста с комментариями."""
2026-01-25T08:57:22.4761380Z          auth.register()
2026-01-25T08:57:22.4761516Z          auth.login()
2026-01-25T08:57:22.4761651Z -        
2026-01-25T08:57:22.4761767Z +
2026-01-25T08:57:22.4761959Z          with client.application.app_context():
2026-01-25T08:57:22.4762190Z              # Создаём пост
2026-01-25T08:57:22.4762393Z              from app.services import PostService
2026-01-25T08:57:22.4762573Z -            post = PostService.create(
2026-01-25T08:57:22.4762715Z -                author_id=1,
2026-01-25T08:57:22.4763196Z -                title="Тестовый пост",
2026-01-25T08:57:22.4763491Z -                content="Содержание поста"
2026-01-25T08:57:22.4763618Z -            )
2026-01-25T08:57:22.4763758Z -            
2026-01-25T08:57:22.4764166Z +
2026-01-25T08:57:22.4764366Z +            post = PostService.create(
2026-01-25T08:57:22.4764804Z +                author_id=1, title="Тестовый пост", content="Содержание поста"
2026-01-25T08:57:22.4764940Z +            )
2026-01-25T08:57:22.4765057Z +
2026-01-25T08:57:22.4765299Z              # Создаём комментарий
2026-01-25T08:57:22.4765468Z              CommentService.create(
2026-01-25T08:57:22.4765607Z -                author_id=1,
2026-01-25T08:57:22.4765767Z -                post_id=post.id,
2026-01-25T08:57:22.4766065Z -                content="Тестовый комментарий"
2026-01-25T08:57:22.4766184Z -            )
2026-01-25T08:57:22.4766304Z -        
2026-01-25T08:57:22.4766710Z +                author_id=1, post_id=post.id, content="Тестовый комментарий"
2026-01-25T08:57:22.4766850Z +            )
2026-01-25T08:57:22.4767219Z +
2026-01-25T08:57:22.4767449Z          # Просматриваем пост
2026-01-25T08:57:22.4767687Z -        response = client.get(f'/post/{post.id}')
2026-01-25T08:57:22.4767839Z -        
2026-01-25T08:57:22.4768036Z +        response = client.get(f"/post/{post.id}")
2026-01-25T08:57:22.4768167Z +
2026-01-25T08:57:22.4768346Z          assert response.status_code == 200
2026-01-25T08:57:22.4768667Z          # Проверяем наличие поста и секции комментариев
2026-01-25T08:57:22.4768885Z -        content = response.data.decode('utf-8')
2026-01-25T08:57:22.4769202Z -        assert 'Тестовый пост' in content
2026-01-25T08:57:22.4769503Z -        assert 'Тестовый комментарий' in content
2026-01-25T08:57:22.4769712Z +        content = response.data.decode("utf-8")
2026-01-25T08:57:22.4769982Z +        assert "Тестовый пост" in content
2026-01-25T08:57:22.4770253Z +        assert "Тестовый комментарий" in content
2026-01-25T08:57:22.4770550Z          # Проверяем наличие слова "Комментарии" в HTML
2026-01-25T08:57:22.4770798Z -        assert 'Комментарии' in content
2026-01-25T08:57:22.4771109Z +        assert "Комментарии" in content
2026-01-25T08:57:22.4771252Z  
2026-01-25T08:57:22.4771390Z  
2026-01-25T08:57:22.4771570Z  class TestCommentModelMethods:
2026-01-25T08:57:22.4771839Z      """Тесты для методов модели Comment."""
2026-01-25T08:57:22.4771968Z  
2026-01-25T08:57:22.4772144Z      def test_author_display_name(self):
2026-01-25T08:57:22.4772492Z          """Проверка отображаемого имени автора."""
2026-01-25T08:57:22.4772643Z -        comment = Comment(
2026-01-25T08:57:22.4772813Z -            author_username="testuser",
2026-01-25T08:57:22.4773164Z -            author_discriminator=42
2026-01-25T08:57:22.4773297Z -        )
2026-01-25T08:57:22.4773436Z -        
2026-01-25T08:57:22.4773814Z +        comment = Comment(author_username="testuser", author_discriminator=42)
2026-01-25T08:57:22.4773943Z +
2026-01-25T08:57:22.4774215Z          assert comment.author_display_name == "testuser#0042"
2026-01-25T08:57:22.4774362Z  
2026-01-25T08:57:22.4774551Z      def test_is_author(self):
2026-01-25T08:57:22.4774830Z          """Проверка метода is_author."""
2026-01-25T08:57:22.4775259Z          comment = Comment(author_id=123)
2026-01-25T08:57:22.4775406Z -        
2026-01-25T08:57:22.4775524Z +
2026-01-25T08:57:22.4775775Z          assert comment.is_author(123) is True
2026-01-25T08:57:22.4775964Z          assert comment.is_author(456) is False
2026-01-25T08:57:22.4776082Z  
2026-01-25T08:57:22.4776241Z      def test_to_dict(self):
2026-01-25T08:57:22.4776528Z          """Проверка преобразования в словарь."""
2026-01-25T08:57:22.4776674Z @@ -355,33 +314,33 @@
2026-01-25T08:57:22.4776807Z              id=1,
2026-01-25T08:57:22.4776951Z              author_id=123,
2026-01-25T08:57:22.4777092Z              post_id=456,
2026-01-25T08:57:22.4777322Z              content="Тест",
2026-01-25T08:57:22.4777486Z              author_username="user",
2026-01-25T08:57:22.4777686Z -            author_discriminator=1
2026-01-25T08:57:22.4777852Z +            author_discriminator=1,
2026-01-25T08:57:22.4777997Z          )
2026-01-25T08:57:22.4778135Z -        
2026-01-25T08:57:22.4778272Z +
2026-01-25T08:57:22.4778440Z          data = comment.to_dict()
2026-01-25T08:57:22.4778586Z -        
2026-01-25T08:57:22.4778737Z -        assert data['id'] == 1
2026-01-25T08:57:22.4778905Z -        assert data['author_id'] == 123
2026-01-25T08:57:22.4779078Z -        assert data['post_id'] == 456
2026-01-25T08:57:22.4779426Z -        assert data['content'] == "Тест"
2026-01-25T08:57:22.4779668Z -        assert data['author_display_name'] == "user#0001"
2026-01-25T08:57:22.4779801Z +
2026-01-25T08:57:22.4779969Z +        assert data["id"] == 1
2026-01-25T08:57:22.4780136Z +        assert data["author_id"] == 123
2026-01-25T08:57:22.4780316Z +        assert data["post_id"] == 456
2026-01-25T08:57:22.4780584Z +        assert data["content"] == "Тест"
2026-01-25T08:57:22.4780826Z +        assert data["author_display_name"] == "user#0001"
2026-01-25T08:57:22.4780947Z  
2026-01-25T08:57:22.4781348Z      def test_from_dict(self):
2026-01-25T08:57:22.4781640Z          """Проверка создания из словаря."""
2026-01-25T08:57:22.4781789Z          data = {
2026-01-25T08:57:22.4781966Z -            'id': 1,
2026-01-25T08:57:22.4782123Z -            'author_id': 123,
2026-01-25T08:57:22.4782263Z -            'post_id': 456,
2026-01-25T08:57:22.4782504Z -            'content': "Тест",
2026-01-25T08:57:22.4782680Z -            'author_username': "user",
2026-01-25T08:57:22.4782849Z -            'author_discriminator': 1
2026-01-25T08:57:22.4783172Z +            "id": 1,
2026-01-25T08:57:22.4783317Z +            "author_id": 123,
2026-01-25T08:57:22.4783457Z +            "post_id": 456,
2026-01-25T08:57:22.4783704Z +            "content": "Тест",
2026-01-25T08:57:22.4783867Z +            "author_username": "user",
2026-01-25T08:57:22.4784050Z +            "author_discriminator": 1,
2026-01-25T08:57:22.4784219Z          }
2026-01-25T08:57:22.4784342Z -        
2026-01-25T08:57:22.4784482Z +
2026-01-25T08:57:22.4784663Z          comment = Comment.from_dict(data)
2026-01-25T08:57:22.4784785Z -        
2026-01-25T08:57:22.4784919Z +
2026-01-25T08:57:22.4785087Z          assert comment.id == 1
2026-01-25T08:57:22.4785312Z          assert comment.author_id == 123
2026-01-25T08:57:22.4785539Z          assert comment.post_id == 456
2026-01-25T08:57:22.4785844Z          assert comment.content == "Тест"
2026-01-25T08:57:22.4939681Z --- /home/runner/work/flask_blog/flask_blog/tests/test_database.py	2026-01-25 08:57:06.654994+00:00
2026-01-25T08:57:22.4943885Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_database.py	2026-01-25 08:57:22.486749+00:00
2026-01-25T08:57:22.4944018Z @@ -12,25 +12,25 @@
2026-01-25T08:57:22.4944169Z  
2026-01-25T08:57:22.4944357Z      def test_database_initialization(self, app):
2026-01-25T08:57:22.4944839Z          """Инициализация базы данных."""
2026-01-25T08:57:22.4944988Z          with app.app_context():
2026-01-25T08:57:22.4945171Z              from app.db.db import init_db, get_db
2026-01-25T08:57:22.4945335Z -            
2026-01-25T08:57:22.4945441Z +
2026-01-25T08:57:22.4946100Z              # Инициализация БД
2026-01-25T08:57:22.4946267Z              init_db()
2026-01-25T08:57:22.4946478Z -            
2026-01-25T08:57:22.4946603Z +
2026-01-25T08:57:22.4946840Z              # Проверка подключения
2026-01-25T08:57:22.4946970Z              db = get_db()
2026-01-25T08:57:22.4947116Z              assert db is not None
2026-01-25T08:57:22.4947235Z  
2026-01-25T08:57:22.4947413Z      def test_user_table_structure(self, app):
2026-01-25T08:57:22.4947695Z          """Проверка структуры таблицы пользователей."""
2026-01-25T08:57:22.4947846Z          with app.app_context():
2026-01-25T08:57:22.4948016Z              from app.db.db import get_db
2026-01-25T08:57:22.4948139Z -            
2026-01-25T08:57:22.4948267Z -            db = get_db()
2026-01-25T08:57:22.4948384Z -            
2026-01-25T08:57:22.4948503Z +
2026-01-25T08:57:22.4948631Z +            db = get_db()
2026-01-25T08:57:22.4948767Z +
2026-01-25T08:57:22.4949036Z              # Проверка существования таблицы
2026-01-25T08:57:22.4949154Z              try:
2026-01-25T08:57:22.4949315Z                  result = db.execute(
2026-01-25T08:57:22.4949668Z                      "SELECT name FROM sqlite_master WHERE type='table' AND name='user'"
2026-01-25T08:57:22.4949810Z                  ).fetchone()
2026-01-25T08:57:22.4950276Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_database.py
2026-01-25T08:57:22.4950397Z @@ -40,13 +40,13 @@
2026-01-25T08:57:22.4950505Z  
2026-01-25T08:57:22.4950693Z      def test_post_table_structure(self, app):
2026-01-25T08:57:22.4950949Z          """Проверка структуры таблицы постов."""
2026-01-25T08:57:22.4951104Z          with app.app_context():
2026-01-25T08:57:22.4951258Z              from app.db.db import get_db
2026-01-25T08:57:22.4951369Z -            
2026-01-25T08:57:22.4951501Z -            db = get_db()
2026-01-25T08:57:22.4951609Z -            
2026-01-25T08:57:22.4951994Z +
2026-01-25T08:57:22.4952135Z +            db = get_db()
2026-01-25T08:57:22.4952244Z +
2026-01-25T08:57:22.4952521Z              # Проверка существования таблицы
2026-01-25T08:57:22.4952655Z              try:
2026-01-25T08:57:22.4952881Z                  result = db.execute(
2026-01-25T08:57:22.4953562Z                      "SELECT name FROM sqlite_master WHERE type='table' AND name='post'"
2026-01-25T08:57:22.4953709Z                  ).fetchone()
2026-01-25T08:57:22.4953845Z @@ -56,13 +56,13 @@
2026-01-25T08:57:22.4953979Z  
2026-01-25T08:57:22.4954188Z      def test_comment_table_structure(self, app):
2026-01-25T08:57:22.4954497Z          """Проверка структуры таблицы комментариев."""
2026-01-25T08:57:22.4954662Z          with app.app_context():
2026-01-25T08:57:22.4954829Z              from app.db.db import get_db
2026-01-25T08:57:22.4954944Z -            
2026-01-25T08:57:22.4955087Z -            db = get_db()
2026-01-25T08:57:22.4955205Z -            
2026-01-25T08:57:22.4955319Z +
2026-01-25T08:57:22.4955479Z +            db = get_db()
2026-01-25T08:57:22.4955591Z +
2026-01-25T08:57:22.4955882Z              # Проверка существования таблицы
2026-01-25T08:57:22.4956008Z              try:
2026-01-25T08:57:22.4956165Z                  result = db.execute(
2026-01-25T08:57:22.4956520Z                      "SELECT name FROM sqlite_master WHERE type='table' AND name='comment'"
2026-01-25T08:57:22.4956662Z                  ).fetchone()
2026-01-25T08:57:22.4956792Z @@ -76,191 +76,173 @@
2026-01-25T08:57:22.4956909Z  
2026-01-25T08:57:22.4957109Z      def test_user_crud_operations(self, app):
2026-01-25T08:57:22.4957415Z          """CRUD операции для пользователей."""
2026-01-25T08:57:22.4957627Z          with app.app_context():
2026-01-25T08:57:22.4957797Z              from app.db.db import get_db
2026-01-25T08:57:22.4957925Z -            
2026-01-25T08:57:22.4958061Z -            db = get_db()
2026-01-25T08:57:22.4958179Z -            
2026-01-25T08:57:22.4958297Z +
2026-01-25T08:57:22.4958447Z +            db = get_db()
2026-01-25T08:57:22.4958560Z +
2026-01-25T08:57:22.4958825Z              # CREATE с использованием хелпера
2026-01-25T08:57:22.4959490Z              hashed_pw, salt = DatabaseTestHelper.create_user_with_password(
2026-01-25T08:57:22.4959755Z -                db, 'test_user_crud', 8888, 'test_password'
2026-01-25T08:57:22.4959904Z -            )
2026-01-25T08:57:22.4960056Z -            db.commit()
2026-01-25T08:57:22.4960177Z -            
2026-01-25T08:57:22.4960401Z +                db, "test_user_crud", 8888, "test_password"
2026-01-25T08:57:22.4960529Z +            )
2026-01-25T08:57:22.4960675Z +            db.commit()
2026-01-25T08:57:22.4960794Z +
2026-01-25T08:57:22.4960922Z              # READ
2026-01-25T08:57:22.4961076Z              user = db.execute(
2026-01-25T08:57:22.4961384Z -                'SELECT * FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.4961553Z -                ('test_user_crud', 8888)
2026-01-25T08:57:22.4961863Z +                "SELECT * FROM user WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.4962038Z +                ("test_user_crud", 8888),
2026-01-25T08:57:22.4962195Z              ).fetchone()
2026-01-25T08:57:22.4962355Z              assert user is not None
2026-01-25T08:57:22.4962570Z -            assert user['username'] == 'test_user_crud'
2026-01-25T08:57:22.4962780Z -            assert user['discriminator'] == 8888
2026-01-25T08:57:22.4963150Z -            
2026-01-25T08:57:22.4963384Z +            assert user["username"] == "test_user_crud"
2026-01-25T08:57:22.4963579Z +            assert user["discriminator"] == 8888
2026-01-25T08:57:22.4963700Z +
2026-01-25T08:57:22.4963843Z              # UPDATE
2026-01-25T08:57:22.4964044Z              db.execute(
2026-01-25T08:57:22.4964476Z -                'UPDATE user SET username = ? WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.4964719Z -                ('updated_user', 'test_user_crud', 8888)
2026-01-25T08:57:22.4964868Z -            )
2026-01-25T08:57:22.4965252Z -            db.commit()
2026-01-25T08:57:22.4965387Z -            
2026-01-25T08:57:22.4965761Z +                "UPDATE user SET username = ? WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.4965973Z +                ("updated_user", "test_user_crud", 8888),
2026-01-25T08:57:22.4966112Z +            )
2026-01-25T08:57:22.4966254Z +            db.commit()
2026-01-25T08:57:22.4966377Z +
2026-01-25T08:57:22.4966549Z              updated_user = db.execute(
2026-01-25T08:57:22.4966757Z -                'SELECT * FROM user WHERE username = ?',
2026-01-25T08:57:22.4966924Z -                ('updated_user',)
2026-01-25T08:57:22.4967208Z +                "SELECT * FROM user WHERE username = ?", ("updated_user",)
2026-01-25T08:57:22.4967361Z              ).fetchone()
2026-01-25T08:57:22.4967547Z              assert updated_user is not None
2026-01-25T08:57:22.4967786Z -            assert updated_user['username'] == 'updated_user'
2026-01-25T08:57:22.4967915Z -            
2026-01-25T08:57:22.4968164Z +            assert updated_user["username"] == "updated_user"
2026-01-25T08:57:22.4968286Z +
2026-01-25T08:57:22.4968421Z              # DELETE
2026-01-25T08:57:22.4968852Z -            DatabaseTestHelper.cleanup_test_data(db, usernames=['updated_user'])
2026-01-25T08:57:22.4969026Z -            
2026-01-25T08:57:22.4969416Z +            DatabaseTestHelper.cleanup_test_data(db, usernames=["updated_user"])
2026-01-25T08:57:22.4969541Z +
2026-01-25T08:57:22.4969808Z              # Проверка удаления
2026-01-25T08:57:22.4970011Z              deleted_user = db.execute(
2026-01-25T08:57:22.4970225Z -                'SELECT * FROM user WHERE username = ?',
2026-01-25T08:57:22.4970379Z -                ('updated_user',)
2026-01-25T08:57:22.4970671Z +                "SELECT * FROM user WHERE username = ?", ("updated_user",)
2026-01-25T08:57:22.4970818Z              ).fetchone()
2026-01-25T08:57:22.4970985Z              assert deleted_user is None
2026-01-25T08:57:22.4971116Z  
2026-01-25T08:57:22.4971337Z      def test_post_crud_operations(self, app):
2026-01-25T08:57:22.4971611Z          """CRUD операции для постов."""
2026-01-25T08:57:22.4972091Z          with app.app_context():
2026-01-25T08:57:22.4972284Z              from app.db.db import get_db
2026-01-25T08:57:22.4972415Z -            
2026-01-25T08:57:22.4972555Z -            db = get_db()
2026-01-25T08:57:22.4972693Z -            
2026-01-25T08:57:22.4972820Z +
2026-01-25T08:57:22.4974493Z +            db = get_db()
2026-01-25T08:57:22.4975381Z +
2026-01-25T08:57:22.4976398Z              # Создаем пользователя с постом через хелпер
2026-01-25T08:57:22.4976726Z              user_id, post_id = DatabaseTestHelper.create_user_with_post(
2026-01-25T08:57:22.4976960Z -                db, 'post_test_user', 7777, 'test_password',
2026-01-25T08:57:22.4977135Z -                'Test Post', 'Test content'
2026-01-25T08:57:22.4977269Z -            )
2026-01-25T08:57:22.4977403Z -            
2026-01-25T08:57:22.4977740Z +                db, "post_test_user", 7777, "test_password", "Test Post", "Test content"
2026-01-25T08:57:22.4977893Z +            )
2026-01-25T08:57:22.4978026Z +
2026-01-25T08:57:22.4978201Z              if user_id and post_id:
2026-01-25T08:57:22.4978339Z                  # READ
2026-01-25T08:57:22.4978500Z                  post = db.execute(
2026-01-25T08:57:22.4978706Z -                    'SELECT * FROM post WHERE id = ?',
2026-01-25T08:57:22.4978860Z -                    (post_id,)
2026-01-25T08:57:22.4979090Z +                    "SELECT * FROM post WHERE id = ?", (post_id,)
2026-01-25T08:57:22.4979235Z                  ).fetchone()
2026-01-25T08:57:22.4979422Z                  assert post is not None
2026-01-25T08:57:22.4979618Z -                assert post['title'] == 'Test Post'
2026-01-25T08:57:22.4979819Z -                assert post['content'] == 'Test content'
2026-01-25T08:57:22.4979953Z -                
2026-01-25T08:57:22.4980148Z +                assert post["title"] == "Test Post"
2026-01-25T08:57:22.4980353Z +                assert post["content"] == "Test content"
2026-01-25T08:57:22.4980729Z +
2026-01-25T08:57:22.4980880Z                  # UPDATE
2026-01-25T08:57:22.4981058Z                  db.execute(
2026-01-25T08:57:22.4981337Z -                    'UPDATE post SET title = ?, content = ? WHERE id = ?',
2026-01-25T08:57:22.4981574Z -                    ('Updated Post', 'Updated content', post_id)
2026-01-25T08:57:22.4981713Z -                )
2026-01-25T08:57:22.4981853Z -                db.commit()
2026-01-25T08:57:22.4981980Z -                
2026-01-25T08:57:22.4982259Z +                    "UPDATE post SET title = ?, content = ? WHERE id = ?",
2026-01-25T08:57:22.4982503Z +                    ("Updated Post", "Updated content", post_id),
2026-01-25T08:57:22.4982637Z +                )
2026-01-25T08:57:22.4982787Z +                db.commit()
2026-01-25T08:57:22.4983114Z +
2026-01-25T08:57:22.4983316Z                  updated_post = db.execute(
2026-01-25T08:57:22.4983520Z -                    'SELECT * FROM post WHERE id = ?',
2026-01-25T08:57:22.4983680Z -                    (post_id,)
2026-01-25T08:57:22.4983829Z -                ).fetchone()
2026-01-25T08:57:22.4984074Z -                assert updated_post['title'] == 'Updated Post'
2026-01-25T08:57:22.4984327Z -                assert updated_post['content'] == 'Updated content'
2026-01-25T08:57:22.4984461Z -                
2026-01-25T08:57:22.4984690Z +                    "SELECT * FROM post WHERE id = ?", (post_id,)
2026-01-25T08:57:22.4984831Z +                ).fetchone()
2026-01-25T08:57:22.4985095Z +                assert updated_post["title"] == "Updated Post"
2026-01-25T08:57:22.4985341Z +                assert updated_post["content"] == "Updated content"
2026-01-25T08:57:22.4985474Z +
2026-01-25T08:57:22.4985613Z                  # DELETE
2026-01-25T08:57:22.4985753Z -                db.execute(
2026-01-25T08:57:22.4985958Z -                    'DELETE FROM post WHERE id = ?',
2026-01-25T08:57:22.4986099Z -                    (post_id,)
2026-01-25T08:57:22.4986232Z -                )
2026-01-25T08:57:22.4986383Z -                db.commit()
2026-01-25T08:57:22.4986504Z -                
2026-01-25T08:57:22.4987010Z +                db.execute("DELETE FROM post WHERE id = ?", (post_id,))
2026-01-25T08:57:22.4987196Z +                db.commit()
2026-01-25T08:57:22.4987326Z +
2026-01-25T08:57:22.4987512Z                  deleted_post = db.execute(
2026-01-25T08:57:22.4987711Z -                    'SELECT * FROM post WHERE id = ?',
2026-01-25T08:57:22.4987854Z -                    (post_id,)
2026-01-25T08:57:22.4988092Z +                    "SELECT * FROM post WHERE id = ?", (post_id,)
2026-01-25T08:57:22.4988239Z                  ).fetchone()
2026-01-25T08:57:22.4988418Z                  assert deleted_post is None
2026-01-25T08:57:22.4988551Z -            
2026-01-25T08:57:22.4988669Z +
2026-01-25T08:57:22.4988973Z              # Удаляем тестового пользователя
2026-01-25T08:57:22.4989378Z -            DatabaseTestHelper.cleanup_test_data(db, usernames=['post_test_user'])
2026-01-25T08:57:22.4989781Z +            DatabaseTestHelper.cleanup_test_data(db, usernames=["post_test_user"])
2026-01-25T08:57:22.4989929Z  
2026-01-25T08:57:22.4990136Z      def test_comment_crud_operations(self, app):
2026-01-25T08:57:22.4990425Z          """CRUD операции для комментариев."""
2026-01-25T08:57:22.4990601Z          with app.app_context():
2026-01-25T08:57:22.4990803Z              from app.db.db import get_db
2026-01-25T08:57:22.4990928Z -            
2026-01-25T08:57:22.4991079Z -            db = get_db()
2026-01-25T08:57:22.4991206Z -            
2026-01-25T08:57:22.4991324Z +
2026-01-25T08:57:22.4991469Z +            db = get_db()
2026-01-25T08:57:22.4991586Z +
2026-01-25T08:57:22.4991919Z              # Создаем тестового пользователя и пост
2026-01-25T08:57:22.4992106Z              from app.auth import hash_password
2026-01-25T08:57:22.4992348Z -            hashed_pw, salt = hash_password('test_password')
2026-01-25T08:57:22.4992503Z -            db.execute(
2026-01-25T08:57:22.4993991Z -                'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.4995638Z -                ('comment_test_user', 6666, hashed_pw, salt)
2026-01-25T08:57:22.4995814Z -            )
2026-01-25T08:57:22.4995963Z -            db.commit()
2026-01-25T08:57:22.4996088Z -            
2026-01-25T08:57:22.4996216Z +
2026-01-25T08:57:22.4996458Z +            hashed_pw, salt = hash_password("test_password")
2026-01-25T08:57:22.4996605Z +            db.execute(
2026-01-25T08:57:22.4997025Z +                "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.4997249Z +                ("comment_test_user", 6666, hashed_pw, salt),
2026-01-25T08:57:22.4997384Z +            )
2026-01-25T08:57:22.4997525Z +            db.commit()
2026-01-25T08:57:22.4997646Z +
2026-01-25T08:57:22.4997805Z              user = db.execute(
2026-01-25T08:57:22.4998120Z -                'SELECT id FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.4998304Z -                ('comment_test_user', 6666)
2026-01-25T08:57:22.4998457Z -            ).fetchone()
2026-01-25T08:57:22.4998585Z -            
2026-01-25T08:57:22.4998897Z +                "SELECT id FROM user WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.4999068Z +                ("comment_test_user", 6666),
2026-01-25T08:57:22.4999206Z +            ).fetchone()
2026-01-25T08:57:22.4999334Z +
2026-01-25T08:57:22.4999468Z              if user:
2026-01-25T08:57:22.4999612Z                  db.execute(
2026-01-25T08:57:22.4999940Z -                    'INSERT INTO post (title, content, author_id) VALUES (?, ?, ?)',
2026-01-25T08:57:22.5000251Z -                    ('Comment Test Post', 'Test content for comments', user['id'])
2026-01-25T08:57:22.5000387Z -                )
2026-01-25T08:57:22.5000530Z -                db.commit()
2026-01-25T08:57:22.5000654Z -                
2026-01-25T08:57:22.5000974Z +                    "INSERT INTO post (title, content, author_id) VALUES (?, ?, ?)",
2026-01-25T08:57:22.5001512Z +                    ("Comment Test Post", "Test content for comments", user["id"]),
2026-01-25T08:57:22.5001685Z +                )
2026-01-25T08:57:22.5001851Z +                db.commit()
2026-01-25T08:57:22.5001983Z +
2026-01-25T08:57:22.5002142Z                  post = db.execute(
2026-01-25T08:57:22.5002367Z -                    'SELECT id FROM post WHERE title = ?',
2026-01-25T08:57:22.5002542Z -                    ('Comment Test Post',)
2026-01-25T08:57:22.5002694Z -                ).fetchone()
2026-01-25T08:57:22.5002816Z -                
2026-01-25T08:57:22.5003392Z +                    "SELECT id FROM post WHERE title = ?", ("Comment Test Post",)
2026-01-25T08:57:22.5003566Z +                ).fetchone()
2026-01-25T08:57:22.5003685Z +
2026-01-25T08:57:22.5003832Z                  if post:
2026-01-25T08:57:22.5003977Z                      # CREATE
2026-01-25T08:57:22.5004127Z                      db.execute(
2026-01-25T08:57:22.5004505Z -                        'INSERT INTO comment (content, author_id, post_id) VALUES (?, ?, ?)',
2026-01-25T08:57:22.5004748Z -                        ('Test comment', user['id'], post['id'])
2026-01-25T08:57:22.5005102Z +                        "INSERT INTO comment (content, author_id, post_id) VALUES (?, ?, ?)",
2026-01-25T08:57:22.5005351Z +                        ("Test comment", user["id"], post["id"]),
2026-01-25T08:57:22.5005484Z                      )
2026-01-25T08:57:22.5005626Z                      db.commit()
2026-01-25T08:57:22.5005762Z -                    
2026-01-25T08:57:22.5005883Z +
2026-01-25T08:57:22.5006021Z                      # READ
2026-01-25T08:57:22.5006200Z                      comment = db.execute(
2026-01-25T08:57:22.5006432Z -                        'SELECT * FROM comment WHERE content = ?',
2026-01-25T08:57:22.5006593Z -                        ('Test comment',)
2026-01-25T08:57:22.5006896Z +                        "SELECT * FROM comment WHERE content = ?", ("Test comment",)
2026-01-25T08:57:22.5007280Z                      ).fetchone()
2026-01-25T08:57:22.5007470Z                      assert comment is not None
2026-01-25T08:57:22.5007700Z -                    assert comment['content'] == 'Test comment'
2026-01-25T08:57:22.5007830Z -                    
2026-01-25T08:57:22.5008045Z +                    assert comment["content"] == "Test comment"
2026-01-25T08:57:22.5008168Z +
2026-01-25T08:57:22.5008326Z                      # UPDATE
2026-01-25T08:57:22.5008482Z                      db.execute(
2026-01-25T08:57:22.5008729Z -                        'UPDATE comment SET content = ? WHERE id = ?',
2026-01-25T08:57:22.5008944Z -                        ('Updated comment', comment['id'])
2026-01-25T08:57:22.5009178Z +                        "UPDATE comment SET content = ? WHERE id = ?",
2026-01-25T08:57:22.5009393Z +                        ("Updated comment", comment["id"]),
2026-01-25T08:57:22.5009526Z                      )
2026-01-25T08:57:22.5009686Z                      db.commit()
2026-01-25T08:57:22.5009841Z -                    
2026-01-25T08:57:22.5009962Z +
2026-01-25T08:57:22.5010167Z                      updated_comment = db.execute(
2026-01-25T08:57:22.5010381Z -                        'SELECT * FROM comment WHERE id = ?',
2026-01-25T08:57:22.5010577Z -                        (comment['id'],)
2026-01-25T08:57:22.5010843Z +                        "SELECT * FROM comment WHERE id = ?", (comment["id"],)
2026-01-25T08:57:22.5010994Z                      ).fetchone()
2026-01-25T08:57:22.5011273Z -                    assert updated_comment['content'] == 'Updated comment'
2026-01-25T08:57:22.5011402Z -                    
2026-01-25T08:57:22.5011679Z +                    assert updated_comment["content"] == "Updated comment"
2026-01-25T08:57:22.5011794Z +
2026-01-25T08:57:22.5011930Z                      # DELETE
2026-01-25T08:57:22.5012094Z -                    db.execute(
2026-01-25T08:57:22.5012319Z -                        'DELETE FROM comment WHERE id = ?',
2026-01-25T08:57:22.5012493Z -                        (comment['id'],)
2026-01-25T08:57:22.5012619Z -                    )
2026-01-25T08:57:22.5013329Z +                    db.execute("DELETE FROM comment WHERE id = ?", (comment["id"],))
2026-01-25T08:57:22.5013507Z                      db.commit()
2026-01-25T08:57:22.5013650Z -                    
2026-01-25T08:57:22.5013775Z +
2026-01-25T08:57:22.5013975Z                      deleted_comment = db.execute(
2026-01-25T08:57:22.5014255Z -                        'SELECT * FROM comment WHERE id = ?',
2026-01-25T08:57:22.5014412Z -                        (comment['id'],)
2026-01-25T08:57:22.5014687Z +                        "SELECT * FROM comment WHERE id = ?", (comment["id"],)
2026-01-25T08:57:22.5014836Z                      ).fetchone()
2026-01-25T08:57:22.5015033Z                      assert deleted_comment is None
2026-01-25T08:57:22.5015157Z -                
2026-01-25T08:57:22.5015277Z +
2026-01-25T08:57:22.5015591Z                  # Удаляем тестовый пост
2026-01-25T08:57:22.5015774Z -                db.execute(
2026-01-25T08:57:22.5015972Z -                    'DELETE FROM post WHERE id = ?',
2026-01-25T08:57:22.5016146Z -                    (post['id'],)
2026-01-25T08:57:22.5016276Z -                )
2026-01-25T08:57:22.5016419Z -                db.commit()
2026-01-25T08:57:22.5016555Z -            
2026-01-25T08:57:22.5016858Z +                db.execute("DELETE FROM post WHERE id = ?", (post["id"],))
2026-01-25T08:57:22.5017007Z +                db.commit()
2026-01-25T08:57:22.5017130Z +
2026-01-25T08:57:22.5017407Z              # Удаляем тестового пользователя
2026-01-25T08:57:22.5017557Z              db.execute(
2026-01-25T08:57:22.5017865Z -                'DELETE FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.5018043Z -                ('comment_test_user', 6666)
2026-01-25T08:57:22.5018349Z +                "DELETE FROM user WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.5018522Z +                ("comment_test_user", 6666),
2026-01-25T08:57:22.5018891Z              )
2026-01-25T08:57:22.5019042Z              db.commit()
2026-01-25T08:57:22.5019163Z  
2026-01-25T08:57:22.5019302Z  
2026-01-25T08:57:22.5019492Z  class TestDatabaseConstraints:
2026-01-25T08:57:22.5019633Z @@ -269,52 +251,52 @@
2026-01-25T08:57:22.5019893Z      def test_unique_username_discriminator(self, app):
2026-01-25T08:57:22.5020258Z          """Уникальность пары username-discriminator."""
2026-01-25T08:57:22.5020437Z          with app.app_context():
2026-01-25T08:57:22.5020621Z              from app.db.db import get_db
2026-01-25T08:57:22.5020807Z              from app.auth import hash_password
2026-01-25T08:57:22.5020937Z -            
2026-01-25T08:57:22.5021120Z -            db = get_db()
2026-01-25T08:57:22.5021236Z -            
2026-01-25T08:57:22.5021363Z +
2026-01-25T08:57:22.5021501Z +            db = get_db()
2026-01-25T08:57:22.5021619Z +
2026-01-25T08:57:22.5021894Z              # Создаем первого пользователя
2026-01-25T08:57:22.5022139Z -            hashed_pw1, salt1 = hash_password('password1')
2026-01-25T08:57:22.5022299Z -            db.execute(
2026-01-25T08:57:22.5022749Z -                'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.5023176Z -                ('unique_test', 1111, hashed_pw1, salt1)
2026-01-25T08:57:22.5023326Z -            )
2026-01-25T08:57:22.5023480Z -            db.commit()
2026-01-25T08:57:22.5023620Z -            
2026-01-25T08:57:22.5023883Z +            hashed_pw1, salt1 = hash_password("password1")
2026-01-25T08:57:22.5024033Z +            db.execute(
2026-01-25T08:57:22.5024449Z +                "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.5025200Z +                ("unique_test", 1111, hashed_pw1, salt1),
2026-01-25T08:57:22.5025376Z +            )
2026-01-25T08:57:22.5025688Z +            db.commit()
2026-01-25T08:57:22.5025818Z +
2026-01-25T08:57:22.5026291Z              # Попытка создать второго пользователя с тем же username и discriminator
2026-01-25T08:57:22.5026438Z              try:
2026-01-25T08:57:22.5026944Z -                hashed_pw2, salt2 = hash_password('password2')
2026-01-25T08:57:22.5027123Z -                db.execute(
2026-01-25T08:57:22.5027572Z -                    'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.5027793Z -                    ('unique_test', 1111, hashed_pw2, salt2)
2026-01-25T08:57:22.5028031Z +                hashed_pw2, salt2 = hash_password("password2")
2026-01-25T08:57:22.5028179Z +                db.execute(
2026-01-25T08:57:22.5028603Z +                    "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.5028812Z +                    ("unique_test", 1111, hashed_pw2, salt2),
2026-01-25T08:57:22.5028954Z                  )
2026-01-25T08:57:22.5029092Z                  db.commit()
2026-01-25T08:57:22.5029380Z                  assert False, "Should have raised an integrity error"
2026-01-25T08:57:22.5029768Z              except Exception:
2026-01-25T08:57:22.5030209Z                  pass  # Ожидаемое поведение - нарушение уникальности
2026-01-25T08:57:22.5030346Z -            
2026-01-25T08:57:22.5030467Z +
2026-01-25T08:57:22.5030733Z              # Удаляем тестового пользователя
2026-01-25T08:57:22.5030880Z              db.execute(
2026-01-25T08:57:22.5031183Z -                'DELETE FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.5031343Z -                ('unique_test', 1111)
2026-01-25T08:57:22.5031643Z +                "DELETE FROM user WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.5031794Z +                ("unique_test", 1111),
2026-01-25T08:57:22.5031924Z              )
2026-01-25T08:57:22.5032061Z              db.commit()
2026-01-25T08:57:22.5032180Z  
2026-01-25T08:57:22.5032392Z      def test_foreign_key_constraints(self, app):
2026-01-25T08:57:22.5032650Z          """Проверка внешних ключей."""
2026-01-25T08:57:22.5032837Z          with app.app_context():
2026-01-25T08:57:22.5033355Z              from app.db.db import get_db
2026-01-25T08:57:22.5033505Z -            
2026-01-25T08:57:22.5033656Z -            db = get_db()
2026-01-25T08:57:22.5033790Z -            
2026-01-25T08:57:22.5033923Z +
2026-01-25T08:57:22.5034076Z +            db = get_db()
2026-01-25T08:57:22.5034198Z +
2026-01-25T08:57:22.5034544Z              # Попытка создать пост с несуществующим author_id
2026-01-25T08:57:22.5034685Z              try:
2026-01-25T08:57:22.5034831Z                  db.execute(
2026-01-25T08:57:22.5035157Z -                    'INSERT INTO post (title, content, author_id) VALUES (?, ?, ?)',
2026-01-25T08:57:22.5035391Z -                    ('Orphan Post', 'Orphan content', 99999)
2026-01-25T08:57:22.5035699Z +                    "INSERT INTO post (title, content, author_id) VALUES (?, ?, ?)",
2026-01-25T08:57:22.5035908Z +                    ("Orphan Post", "Orphan content", 99999),
2026-01-25T08:57:22.5036044Z                  )
2026-01-25T08:57:22.5036207Z                  db.commit()
2026-01-25T08:57:22.5036772Z                  assert False, "Should have raised a foreign key constraint error"
2026-01-25T08:57:22.5036953Z              except Exception:
2026-01-25T08:57:22.5037366Z                  pass  # Ожидаемое поведение - нарушение внешнего ключа
2026-01-25T08:57:22.5037522Z @@ -326,64 +308,64 @@
2026-01-25T08:57:22.5037723Z      def test_transaction_rollback(self, app):
2026-01-25T08:57:22.5037985Z          """Откат транзакции при ошибке."""
2026-01-25T08:57:22.5038160Z          with app.app_context():
2026-01-25T08:57:22.5038342Z              from app.db.db import get_db
2026-01-25T08:57:22.5038541Z              from app.auth import hash_password
2026-01-25T08:57:22.5038668Z -            
2026-01-25T08:57:22.5038805Z -            db = get_db()
2026-01-25T08:57:22.5038932Z -            
2026-01-25T08:57:22.5039049Z +
2026-01-25T08:57:22.5039187Z +            db = get_db()
2026-01-25T08:57:22.5039310Z +
2026-01-25T08:57:22.5039607Z              # Начинаем транзакцию
2026-01-25T08:57:22.5039752Z              try:
2026-01-25T08:57:22.5040020Z                  # Создаем пользователя
2026-01-25T08:57:22.5040279Z -                hashed_pw, salt = hash_password('test_password')
2026-01-25T08:57:22.5040426Z -                db.execute(
2026-01-25T08:57:22.5040871Z -                    'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.5041133Z -                    ('transaction_test', 5555, hashed_pw, salt)
2026-01-25T08:57:22.5041270Z -                )
2026-01-25T08:57:22.5041394Z -                
2026-01-25T08:57:22.5041639Z +                hashed_pw, salt = hash_password("test_password")
2026-01-25T08:57:22.5041784Z +                db.execute(
2026-01-25T08:57:22.5042216Z +                    "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.5042432Z +                    ("transaction_test", 5555, hashed_pw, salt),
2026-01-25T08:57:22.5042834Z +                )
2026-01-25T08:57:22.5043238Z +
2026-01-25T08:57:22.5043536Z                  # Вызываем ошибку
2026-01-25T08:57:22.5043739Z -                db.execute('INVALID SQL QUERY')
2026-01-25T08:57:22.5043880Z -                db.commit()
2026-01-25T08:57:22.5043988Z -                
2026-01-25T08:57:22.5044137Z +                db.execute("INVALID SQL QUERY")
2026-01-25T08:57:22.5044249Z +                db.commit()
2026-01-25T08:57:22.5044357Z +
2026-01-25T08:57:22.5044484Z              except Exception:
2026-01-25T08:57:22.5044696Z                  # Откатываем транзакцию
2026-01-25T08:57:22.5044837Z                  db.rollback()
2026-01-25T08:57:22.5044952Z -            
2026-01-25T08:57:22.5045062Z +
2026-01-25T08:57:22.5045331Z              # Проверяем, что пользователь не был создан
2026-01-25T08:57:22.5045469Z              user = db.execute(
2026-01-25T08:57:22.5045773Z -                'SELECT * FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.5045980Z -                ('transaction_test', 5555)
2026-01-25T08:57:22.5046283Z +                "SELECT * FROM user WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.5046456Z +                ("transaction_test", 5555),
2026-01-25T08:57:22.5046592Z              ).fetchone()
2026-01-25T08:57:22.5046742Z              assert user is None
2026-01-25T08:57:22.5046868Z  
2026-01-25T08:57:22.5047083Z      def test_transaction_commit(self, app):
2026-01-25T08:57:22.5047324Z          """Фиксация транзакции."""
2026-01-25T08:57:22.5047488Z          with app.app_context():
2026-01-25T08:57:22.5047660Z              from app.db.db import get_db
2026-01-25T08:57:22.5047857Z              from app.auth import hash_password
2026-01-25T08:57:22.5047981Z -            
2026-01-25T08:57:22.5048125Z -            db = get_db()
2026-01-25T08:57:22.5048256Z -            
2026-01-25T08:57:22.5048379Z +
2026-01-25T08:57:22.5048522Z +            db = get_db()
2026-01-25T08:57:22.5048647Z +
2026-01-25T08:57:22.5048955Z              # Создаем пользователя в транзакции
2026-01-25T08:57:22.5049203Z -            hashed_pw, salt = hash_password('test_password')
2026-01-25T08:57:22.5049585Z -            db.execute(
2026-01-25T08:57:22.5050052Z -                'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.5050262Z -                ('commit_test', 4444, hashed_pw, salt)
2026-01-25T08:57:22.5050388Z -            )
2026-01-25T08:57:22.5050523Z -            db.commit()
2026-01-25T08:57:22.5050649Z -            
2026-01-25T08:57:22.5050888Z +            hashed_pw, salt = hash_password("test_password")
2026-01-25T08:57:22.5051035Z +            db.execute(
2026-01-25T08:57:22.5051472Z +                "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.5051667Z +                ("commit_test", 4444, hashed_pw, salt),
2026-01-25T08:57:22.5051787Z +            )
2026-01-25T08:57:22.5051931Z +            db.commit()
2026-01-25T08:57:22.5052075Z +
2026-01-25T08:57:22.5052360Z              # Проверяем, что пользователь создан
2026-01-25T08:57:22.5052526Z              user = db.execute(
2026-01-25T08:57:22.5052826Z -                'SELECT * FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.5053286Z -                ('commit_test', 4444)
2026-01-25T08:57:22.5053625Z +                "SELECT * FROM user WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.5053784Z +                ("commit_test", 4444),
2026-01-25T08:57:22.5053931Z              ).fetchone()
2026-01-25T08:57:22.5054108Z              assert user is not None
2026-01-25T08:57:22.5054234Z -            
2026-01-25T08:57:22.5054361Z +
2026-01-25T08:57:22.5054641Z              # Удаляем тестового пользователя
2026-01-25T08:57:22.5054787Z              db.execute(
2026-01-25T08:57:22.5055143Z -                'DELETE FROM user WHERE username = ? AND discriminator = ?',
2026-01-25T08:57:22.5055298Z -                ('commit_test', 4444)
2026-01-25T08:57:22.5055845Z +                "DELETE FROM user WHERE username = ? AND discriminator = ?",
2026-01-25T08:57:22.5056020Z +                ("commit_test", 4444),
2026-01-25T08:57:22.5056147Z              )
2026-01-25T08:57:22.5056294Z              db.commit()
2026-01-25T08:57:22.5056415Z  
2026-01-25T08:57:22.5056528Z  
2026-01-25T08:57:22.5056766Z  class TestDatabasePerformance:
2026-01-25T08:57:22.5056898Z @@ -392,52 +374,50 @@
2026-01-25T08:57:22.5057099Z      def test_query_performance(self, app):
2026-01-25T08:57:22.5057374Z          """Производительность запросов."""
2026-01-25T08:57:22.5057544Z          with app.app_context():
2026-01-25T08:57:22.5057714Z              from app.db.db import get_db
2026-01-25T08:57:22.5057849Z              import time
2026-01-25T08:57:22.5057978Z -            
2026-01-25T08:57:22.5058118Z -            db = get_db()
2026-01-25T08:57:22.5058240Z -            
2026-01-25T08:57:22.5058369Z +
2026-01-25T08:57:22.5058502Z +            db = get_db()
2026-01-25T08:57:22.5058644Z +
2026-01-25T08:57:22.5058945Z              # Измеряем время простого запроса
2026-01-25T08:57:22.5059115Z              start_time = time.time()
2026-01-25T08:57:22.5059354Z -            result = db.execute('SELECT 1').fetchone()
2026-01-25T08:57:22.5059563Z +            result = db.execute("SELECT 1").fetchone()
2026-01-25T08:57:22.5059719Z              end_time = time.time()
2026-01-25T08:57:22.5059850Z -            
2026-01-25T08:57:22.5059988Z +
2026-01-25T08:57:22.5060148Z              assert result[0] == 1
2026-01-25T08:57:22.5060601Z              assert (end_time - start_time) < 0.1  # Менее 100мс
2026-01-25T08:57:22.5060743Z  
2026-01-25T08:57:22.5060969Z      def test_batch_insert_performance(self, app):
2026-01-25T08:57:22.5061313Z          """Производительность массовой вставки."""
2026-01-25T08:57:22.5061478Z          with app.app_context():
2026-01-25T08:57:22.5061659Z              from app.db.db import get_db
2026-01-25T08:57:22.5061847Z              from app.auth import hash_password
2026-01-25T08:57:22.5062009Z              import time
2026-01-25T08:57:22.5062147Z -            
2026-01-25T08:57:22.5062299Z -            db = get_db()
2026-01-25T08:57:22.5062673Z -            
2026-01-25T08:57:22.5062837Z +
2026-01-25T08:57:22.5063238Z +            db = get_db()
2026-01-25T08:57:22.5063402Z +
2026-01-25T08:57:22.5063851Z              # Массовая вставка пользователей (меньше пользователей для скорости)
2026-01-25T08:57:22.5064023Z              start_time = time.time()
2026-01-25T08:57:22.5064150Z -            
2026-01-25T08:57:22.5064277Z +
2026-01-25T08:57:22.5064429Z              users_to_insert = []
2026-01-25T08:57:22.5064819Z              for i in range(10):  # Уменьшили с 100 до 10
2026-01-25T08:57:22.5065029Z -                username = f'perf_test_{i}'
2026-01-25T08:57:22.5065211Z +                username = f"perf_test_{i}"
2026-01-25T08:57:22.5065408Z                  discriminator = 1000 + i
2026-01-25T08:57:22.5065773Z -                hashed_pw, salt = hash_password(f'password_{i}')
2026-01-25T08:57:22.5066075Z +                hashed_pw, salt = hash_password(f"password_{i}")
2026-01-25T08:57:22.5066453Z                  users_to_insert.append((username, discriminator, hashed_pw, salt))
2026-01-25T08:57:22.5066589Z -            
2026-01-25T08:57:22.5066721Z +
2026-01-25T08:57:22.5066901Z              for user_data in users_to_insert:
2026-01-25T08:57:22.5067073Z                  db.execute(
2026-01-25T08:57:22.5067546Z -                    'INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)',
2026-01-25T08:57:22.5067708Z -                    user_data
2026-01-25T08:57:22.5067837Z -                )
2026-01-25T08:57:22.5067965Z -            
2026-01-25T08:57:22.5068388Z +                    "INSERT INTO user (username, discriminator, password, salt) VALUES (?, ?, ?, ?)",
2026-01-25T08:57:22.5068539Z +                    user_data,
2026-01-25T08:57:22.5068683Z +                )
2026-01-25T08:57:22.5068805Z +
2026-01-25T08:57:22.5068962Z              db.commit()
2026-01-25T08:57:22.5069378Z              end_time = time.time()
2026-01-25T08:57:22.5069519Z -            
2026-01-25T08:57:22.5069654Z +
2026-01-25T08:57:22.5070044Z              # Должно выполняться менее 5 секунд (увеличили лимит)
2026-01-25T08:57:22.5070253Z              assert (end_time - start_time) < 5.0
2026-01-25T08:57:22.5070402Z -            
2026-01-25T08:57:22.5070521Z +
2026-01-25T08:57:22.5070789Z              # Удаляем тестовых пользователей
2026-01-25T08:57:22.5070971Z -            db.execute(
2026-01-25T08:57:22.5071249Z -                'DELETE FROM user WHERE username LIKE "perf_test_%"'
2026-01-25T08:57:22.5071388Z -            )
2026-01-25T08:57:22.5071571Z -            db.commit()
2026-01-25T08:57:22.5071940Z +            db.execute('DELETE FROM user WHERE username LIKE "perf_test_%"')
2026-01-25T08:57:22.5072141Z +            db.commit()
2026-01-25T08:57:22.5163870Z --- /home/runner/work/flask_blog/flask_blog/tests/test_forms.py	2026-01-25 08:57:06.654994+00:00
2026-01-25T08:57:22.5176283Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_forms.py
2026-01-25T08:57:22.5176774Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_forms.py	2026-01-25 08:57:22.513814+00:00
2026-01-25T08:57:22.5176938Z @@ -2,155 +2,169 @@
2026-01-25T08:57:22.5177320Z  """Тесты для системы форм."""
2026-01-25T08:57:22.5177451Z  
2026-01-25T08:57:22.5177589Z  import pytest
2026-01-25T08:57:22.5177739Z  from flask import Flask
2026-01-25T08:57:22.5177860Z  
2026-01-25T08:57:22.5178708Z -from app.forms import Form, StringField, PasswordField, DataRequired, Length, Email, Username, PasswordStrength, UniqueUsername, Slug, NumberRange, URL
2026-01-25T08:57:22.5178866Z +from app.forms import (
2026-01-25T08:57:22.5178999Z +    Form,
2026-01-25T08:57:22.5179127Z +    StringField,
2026-01-25T08:57:22.5179263Z +    PasswordField,
2026-01-25T08:57:22.5179390Z +    DataRequired,
2026-01-25T08:57:22.5179505Z +    Length,
2026-01-25T08:57:22.5179628Z +    Email,
2026-01-25T08:57:22.5179747Z +    Username,
2026-01-25T08:57:22.5179930Z +    PasswordStrength,
2026-01-25T08:57:22.5180070Z +    UniqueUsername,
2026-01-25T08:57:22.5180200Z +    Slug,
2026-01-25T08:57:22.5180703Z +    NumberRange,
2026-01-25T08:57:22.5180844Z +    URL,
2026-01-25T08:57:22.5180964Z +)
2026-01-25T08:57:22.5181078Z +
2026-01-25T08:57:22.5181358Z  # TODO: Regexp будет реализован в будущем
2026-01-25T08:57:22.5181678Z  from app.forms.csrf import generate_csrf_token, validate_csrf_token
2026-01-25T08:57:22.5181792Z  
2026-01-25T08:57:22.5181911Z  
2026-01-25T08:57:22.5182047Z  @pytest.fixture
2026-01-25T08:57:22.5182176Z  def app():
2026-01-25T08:57:22.5182359Z      app = Flask(__name__)
2026-01-25T08:57:22.5182570Z -    app.config['SECRET_KEY'] = 'test-key-12345'
2026-01-25T08:57:22.5182744Z -    app.config['TESTING'] = True
2026-01-25T08:57:22.5183173Z -    app.config['WTF_CSRF_ENABLED'] = False
2026-01-25T08:57:22.5183398Z +    app.config["SECRET_KEY"] = "test-key-12345"
2026-01-25T08:57:22.5183591Z +    app.config["TESTING"] = True
2026-01-25T08:57:22.5183792Z +    app.config["WTF_CSRF_ENABLED"] = False
2026-01-25T08:57:22.5183919Z      return app
2026-01-25T08:57:22.5184041Z  
2026-01-25T08:57:22.5184169Z  
2026-01-25T08:57:22.5184310Z  class MockForm(Form):
2026-01-25T08:57:22.5184681Z -    name = StringField('Name', validators=[DataRequired(), Length(min=3, max=10)])
2026-01-25T08:57:22.5185011Z -    password = PasswordField('Password', validators=[DataRequired()])
2026-01-25T08:57:22.5185375Z +    name = StringField("Name", validators=[DataRequired(), Length(min=3, max=10)])
2026-01-25T08:57:22.5185687Z +    password = PasswordField("Password", validators=[DataRequired()])
2026-01-25T08:57:22.5186057Z      # TODO: username с Regexp будет добавлен при реализации
2026-01-25T08:57:22.5186611Z -    username = StringField('Username', validators=[DataRequired()])  # TODO: + Regexp(r'^\w+$', message='Invalid')
2026-01-25T08:57:22.5186774Z +    username = StringField(
2026-01-25T08:57:22.5186965Z +        "Username", validators=[DataRequired()]
2026-01-25T08:57:22.5187558Z +    )  # TODO: + Regexp(r'^\w+$', message='Invalid')
2026-01-25T08:57:22.5187687Z  
2026-01-25T08:57:22.5187826Z  
2026-01-25T08:57:22.5188030Z  def test_form_validation_success(app):
2026-01-25T08:57:22.5188349Z      """Тест успешной валидации формы.
2026-01-25T08:57:22.5188488Z -    
2026-01-25T08:57:22.5188616Z +
2026-01-25T08:57:22.5189093Z      TODO: После реализации валидаторов этот тест должен проверять реальную валидацию.
2026-01-25T08:57:22.5189531Z      Сейчас все валидаторы - заглушки и всегда возвращают True.
2026-01-25T08:57:22.5189652Z      """
2026-01-25T08:57:22.5189887Z -    with app.test_request_context(method='POST'):
2026-01-25T08:57:22.5190096Z -        token = generate_csrf_token()
2026-01-25T08:57:22.5190220Z -        data = {
2026-01-25T08:57:22.5190364Z -            'name': 'Admin',
2026-01-25T08:57:22.5190540Z -            'password': 'secret_password',
2026-01-25T08:57:22.5190689Z -            'username': 'user_123',
2026-01-25T08:57:22.5190840Z -            'csrf_token': token
2026-01-25T08:57:22.5191068Z +    with app.test_request_context(method="POST"):
2026-01-25T08:57:22.5191244Z +        token = generate_csrf_token()
2026-01-25T08:57:22.5191371Z +        data = {
2026-01-25T08:57:22.5191506Z +            "name": "Admin",
2026-01-25T08:57:22.5191667Z +            "password": "secret_password",
2026-01-25T08:57:22.5191822Z +            "username": "user_123",
2026-01-25T08:57:22.5191962Z +            "csrf_token": token,
2026-01-25T08:57:22.5192087Z          }
2026-01-25T08:57:22.5192262Z          form = MockForm(data)
2026-01-25T08:57:22.5192721Z          # TODO: После реализации валидаторов ожидать True только для корректных данных
2026-01-25T08:57:22.5193148Z          assert form.validate() is True
2026-01-25T08:57:22.5193308Z          assert not form.errors
2026-01-25T08:57:22.5193421Z  
2026-01-25T08:57:22.5193568Z  
2026-01-25T08:57:22.5193763Z  def test_form_validation_placeholder(app):
2026-01-25T08:57:22.5194070Z      """Тест валидации формы с корректными данными."""
2026-01-25T08:57:22.5194308Z -    with app.test_request_context(method='POST'):
2026-01-25T08:57:22.5194726Z +    with app.test_request_context(method="POST"):
2026-01-25T08:57:22.5194910Z          token = generate_csrf_token()
2026-01-25T08:57:22.5195205Z          # Используем корректные данные для валидации
2026-01-25T08:57:22.5195327Z          data = {
2026-01-25T08:57:22.5195785Z -            'name': 'ValidName',  # Корректное имя (DataRequired, Length 3-10)
2026-01-25T08:57:22.5196221Z -            'password': 'valid_pass',  # Корректный пароль (DataRequired)
2026-01-25T08:57:22.5196810Z -            'username': 'validuser',  # Корректный username (DataRequired)  # TODO: + Length min=3, Regexp
2026-01-25T08:57:22.5196968Z -            'csrf_token': token
2026-01-25T08:57:22.5197375Z +            "name": "ValidName",  # Корректное имя (DataRequired, Length 3-10)
2026-01-25T08:57:22.5197776Z +            "password": "valid_pass",  # Корректный пароль (DataRequired)
2026-01-25T08:57:22.5198592Z +            "username": "validuser",  # Корректный username (DataRequired)  # TODO: + Length min=3, Regexp
2026-01-25T08:57:22.5198765Z +            "csrf_token": token,
2026-01-25T08:57:22.5198892Z          }
2026-01-25T08:57:22.5199035Z          form = MockForm(data)
2026-01-25T08:57:22.5199197Z          assert form.validate() is True
2026-01-25T08:57:22.5199357Z          assert not form.errors
2026-01-25T08:57:22.5199476Z  
2026-01-25T08:57:22.5199589Z  
2026-01-25T08:57:22.5199772Z  def test_form_data_population(app):
2026-01-25T08:57:22.5200076Z      """Проверка правильности заполнения данных в полях."""
2026-01-25T08:57:22.5200260Z      with app.app_context():
2026-01-25T08:57:22.5200467Z -        data = {'name': '  John  ', 'password': 'pass'}
2026-01-25T08:57:22.5200611Z -        form = MockForm(data)
2026-01-25T08:57:22.5200797Z -        assert form.name.data == '  John  '
2026-01-25T08:57:22.5200996Z -        assert form.password.data == 'pass'
2026-01-25T08:57:22.5201110Z -
2026-01-25T08:57:22.5201249Z -
2026-01-25T08:57:22.5201457Z +        data = {"name": "  John  ", "password": "pass"}
2026-01-25T08:57:22.5201630Z +        form = MockForm(data)
2026-01-25T08:57:22.5201803Z +        assert form.name.data == "  John  "
2026-01-25T08:57:22.5201977Z +        assert form.password.data == "pass"
2026-01-25T08:57:22.5202096Z  
2026-01-25T08:57:22.5202207Z  
2026-01-25T08:57:22.5202366Z  def test_form_field_access(app):
2026-01-25T08:57:22.5202606Z      """Тест доступа к полям формы."""
2026-01-25T08:57:22.5202775Z      with app.test_request_context():
2026-01-25T08:57:22.5203222Z          form = MockForm()
2026-01-25T08:57:22.5203362Z -        
2026-01-25T08:57:22.5203606Z +
2026-01-25T08:57:22.5203882Z          # Проверка существования полей
2026-01-25T08:57:22.5205304Z -        assert hasattr(form, 'name')
2026-01-25T08:57:22.5205510Z -        assert hasattr(form, 'password')
2026-01-25T08:57:22.5205682Z -        assert hasattr(form, 'username')
2026-01-25T08:57:22.5205813Z -        
2026-01-25T08:57:22.5206000Z +        assert hasattr(form, "name")
2026-01-25T08:57:22.5206181Z +        assert hasattr(form, "password")
2026-01-25T08:57:22.5206604Z +        assert hasattr(form, "username")
2026-01-25T08:57:22.5206735Z +
2026-01-25T08:57:22.5206990Z          # Проверка типов полей
2026-01-25T08:57:22.5207195Z          assert isinstance(form.name, StringField)
2026-01-25T08:57:22.5207442Z          assert isinstance(form.password, PasswordField)
2026-01-25T08:57:22.5207668Z          assert isinstance(form.username, StringField)
2026-01-25T08:57:22.5207781Z  
2026-01-25T08:57:22.5207892Z  
2026-01-25T08:57:22.5208065Z  def test_form_error_handling(app):
2026-01-25T08:57:22.5208382Z      """Тест обработки ошибок формы с заглушками валидаторов.
2026-01-25T08:57:22.5208504Z -    
2026-01-25T08:57:22.5208616Z +
2026-01-25T08:57:22.5209056Z      TODO: После реализации валидаторов этот тест должен проверять реальные ошибки.
2026-01-25T08:57:22.5209393Z      Сейчас все валидаторы - заглушки и всегда возвращают True.
2026-01-25T08:57:22.5209543Z      """
2026-01-25T08:57:22.5209714Z      with app.test_request_context():
2026-01-25T08:57:22.5209923Z          token = generate_csrf_token()
2026-01-25T08:57:22.5210041Z -        
2026-01-25T08:57:22.5210148Z +
2026-01-25T08:57:22.5210483Z          # Форма с данными, которые должны были бы вызывать ошибки
2026-01-25T08:57:22.5210604Z          data = {
2026-01-25T08:57:22.5210986Z -            'name': '',  # TODO: DataRequired error (когда будет реализовано)
2026-01-25T08:57:22.5211381Z -            'password': '12',  # TODO: Слишком короткий (меньше 3 символов)
2026-01-25T08:57:22.5211811Z -            'username': 'user!@#',  # TODO: Regexp error (когда будет реализовано)
2026-01-25T08:57:22.5211974Z -            'csrf_token': token
2026-01-25T08:57:22.5212096Z -        }
2026-01-25T08:57:22.5212240Z -        form = MockForm(data)
2026-01-25T08:57:22.5212369Z -        
2026-01-25T08:57:22.5212749Z +            "name": "",  # TODO: DataRequired error (когда будет реализовано)
2026-01-25T08:57:22.5213604Z +            "password": "12",  # TODO: Слишком короткий (меньше 3 символов)
2026-01-25T08:57:22.5214121Z +            "username": "user!@#",  # TODO: Regexp error (когда будет реализовано)
2026-01-25T08:57:22.5214282Z +            "csrf_token": token,
2026-01-25T08:57:22.5214406Z +        }
2026-01-25T08:57:22.5214564Z +        form = MockForm(data)
2026-01-25T08:57:22.5214678Z +
2026-01-25T08:57:22.5215047Z          # Сейчас все валидаторы - заглушки, поэтому форма всегда валидна
2026-01-25T08:57:22.5215220Z          assert form.validate() is True
2026-01-25T08:57:22.5215581Z          assert not form.errors  # Заглушки не генерируют ошибки
2026-01-25T08:57:22.5215708Z  
2026-01-25T08:57:22.5215816Z  
2026-01-25T08:57:22.5215983Z  def test_form_without_csrf(app):
2026-01-25T08:57:22.5216218Z      """Тест формы без CSRF токена."""
2026-01-25T08:57:22.5216404Z      with app.test_request_context():
2026-01-25T08:57:22.5216642Z          # Форма без CSRF токена
2026-01-25T08:57:22.5216795Z          data = {
2026-01-25T08:57:22.5216941Z -            'name': 'ValidName',
2026-01-25T08:57:22.5217141Z -            'password': 'validpassword',
2026-01-25T08:57:22.5217292Z -            'username': 'validuser'
2026-01-25T08:57:22.5217411Z -        }
2026-01-25T08:57:22.5217564Z -        form = MockForm(data)
2026-01-25T08:57:22.5217678Z -        
2026-01-25T08:57:22.5217820Z +            "name": "ValidName",
2026-01-25T08:57:22.5217993Z +            "password": "validpassword",
2026-01-25T08:57:22.5218147Z +            "username": "validuser",
2026-01-25T08:57:22.5218276Z +        }
2026-01-25T08:57:22.5218421Z +        form = MockForm(data)
2026-01-25T08:57:22.5218535Z +
2026-01-25T08:57:22.5218928Z          # В TESTING режиме CSRF отключен, поэтому валидация должна пройти
2026-01-25T08:57:22.5219087Z          assert form.validate() is True
2026-01-25T08:57:22.5219203Z  
2026-01-25T08:57:22.5219322Z  
2026-01-25T08:57:22.5219511Z  def test_form_with_extra_fields(app):
2026-01-25T08:57:22.5219786Z      """Тест формы с дополнительными полями."""
2026-01-25T08:57:22.5219963Z      with app.test_request_context():
2026-01-25T08:57:22.5220331Z          token = generate_csrf_token()
2026-01-25T08:57:22.5220480Z -        
2026-01-25T08:57:22.5220599Z +
2026-01-25T08:57:22.5220868Z          # Форма с дополнительными полями
2026-01-25T08:57:22.5221004Z          data = {
2026-01-25T08:57:22.5221150Z -            'name': 'ValidName',
2026-01-25T08:57:22.5221317Z -            'password': 'validpassword',
2026-01-25T08:57:22.5221484Z -            'username': 'validuser',
2026-01-25T08:57:22.5221624Z -            'csrf_token': token,
2026-01-25T08:57:22.5221965Z -            'extra_field': 'extra_value'  # Дополнительное поле
2026-01-25T08:57:22.5222102Z -        }
2026-01-25T08:57:22.5222256Z -        form = MockForm(data)
2026-01-25T08:57:22.5222378Z -        
2026-01-25T08:57:22.5222524Z +            "name": "ValidName",
2026-01-25T08:57:22.5222690Z +            "password": "validpassword",
2026-01-25T08:57:22.5222870Z +            "username": "validuser",
2026-01-25T08:57:22.5223286Z +            "csrf_token": token,
2026-01-25T08:57:22.5223689Z +            "extra_field": "extra_value",  # Дополнительное поле
2026-01-25T08:57:22.5223821Z +        }
2026-01-25T08:57:22.5223967Z +        form = MockForm(data)
2026-01-25T08:57:22.5224081Z +
2026-01-25T08:57:22.5224434Z          # Форма должна быть валидной (дополнительные поля игнорируются)
2026-01-25T08:57:22.5224601Z          assert form.validate() is True
2026-01-25T08:57:22.5224752Z          assert not form.errors
2026-01-25T08:57:22.5224876Z  
2026-01-25T08:57:22.5224987Z  
2026-01-25T08:57:22.5225158Z  def test_validators_standalone():
2026-01-25T08:57:22.5225463Z      """Тестирование отдельных валидаторов-заглушек.
2026-01-25T08:57:22.5225580Z -    
2026-01-25T08:57:22.5225697Z +
2026-01-25T08:57:22.5226106Z      TODO: После реализации валидаторов этот тест должен проверять реальную валидацию.
2026-01-25T08:57:22.5226464Z      Сейчас все валидаторы - заглушки и всегда возвращают (True, None).
2026-01-25T08:57:22.5226830Z      """
2026-01-25T08:57:22.5227178Z      # DataRequired - заглушка всегда возвращает True
2026-01-25T08:57:22.5227328Z      dr = DataRequired()
2026-01-25T08:57:22.5227462Z @@ -182,18 +196,21 @@
2026-01-25T08:57:22.5227594Z          Username(),
2026-01-25T08:57:22.5227755Z          PasswordStrength(),
2026-01-25T08:57:22.5227899Z          UniqueUsername(),
2026-01-25T08:57:22.5228017Z          Slug(),
2026-01-25T08:57:22.5228158Z          NumberRange(),
2026-01-25T08:57:22.5228277Z -        URL()
2026-01-25T08:57:22.5228397Z +        URL(),
2026-01-25T08:57:22.5228522Z      ]
2026-01-25T08:57:22.5228639Z -    
2026-01-25T08:57:22.5228933Z -    test_values = ['', 'test', None, 123, 'a' * 1000, 'invalid!@#', 'short']
2026-01-25T08:57:22.5229060Z -    
2026-01-25T08:57:22.5229175Z +
2026-01-25T08:57:22.5229456Z +    test_values = ["", "test", None, 123, "a" * 1000, "invalid!@#", "short"]
2026-01-25T08:57:22.5229586Z +
2026-01-25T08:57:22.5229782Z      for validator in validators_to_test:
2026-01-25T08:57:22.5229947Z          for value in test_values:
2026-01-25T08:57:22.5230089Z              try:
2026-01-25T08:57:22.5230263Z                  result = validator(value)
2026-01-25T08:57:22.5230396Z -                
2026-01-25T08:57:22.5230909Z -                assert result == (True, None), f"{validator.__class__.__name__}({value}) = {result}, expected (True, None)"
2026-01-25T08:57:22.5231027Z +
2026-01-25T08:57:22.5231184Z +                assert result == (
2026-01-25T08:57:22.5231311Z +                    True,
2026-01-25T08:57:22.5231432Z +                    None,
2026-01-25T08:57:22.5231803Z +                ), f"{validator.__class__.__name__}({value}) = {result}, expected (True, None)"
2026-01-25T08:57:22.5231958Z              except Exception as e:
2026-01-25T08:57:22.5232427Z                  pytest.fail(f"Ошибка в валидаторе {validator.__class__.__name__}: {e}")
2026-01-25T08:57:22.6222137Z --- /home/runner/work/flask_blog/flask_blog/tests/test_integration.py	2026-01-25 08:57:06.654994+00:00
2026-01-25T08:57:22.6224367Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_integration.py	2026-01-25 08:57:22.618225+00:00
2026-01-25T08:57:22.6225434Z @@ -6,85 +6,94 @@
2026-01-25T08:57:22.6225818Z  
2026-01-25T08:57:22.6231446Z  
2026-01-25T08:57:22.6231808Z  class TestUserWorkflows:
2026-01-25T08:57:22.6233469Z      """Тесты полных пользовательских сценариев."""
2026-01-25T08:57:22.6234607Z  
2026-01-25T08:57:22.6237288Z -    def test_complete_user_registration_and_login(self, client_with_csrf, auth_with_csrf, app_with_csrf):
2026-01-25T08:57:22.6238220Z +    def test_complete_user_registration_and_login(
2026-01-25T08:57:22.6264047Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_integration.py
2026-01-25T08:57:22.6264914Z +        self, client_with_csrf, auth_with_csrf, app_with_csrf
2026-01-25T08:57:22.6265732Z +    ):
2026-01-25T08:57:22.6266368Z          """Полный цикл: регистрация -> вход -> выход."""
2026-01-25T08:57:22.6267343Z          with app_with_csrf.app_context():
2026-01-25T08:57:22.6267904Z              # 1. Регистрация
2026-01-25T08:57:22.6268387Z              response = client_with_csrf.post(
2026-01-25T08:57:22.6268880Z -                '/auth/register',
2026-01-25T08:57:22.6269495Z -                data={'username': 'integration_user', 'password': 'test_pass123'},
2026-01-25T08:57:22.6270167Z -                follow_redirects=True
2026-01-25T08:57:22.6270625Z +                "/auth/register",
2026-01-25T08:57:22.6271200Z +                data={"username": "integration_user", "password": "test_pass123"},
2026-01-25T08:57:22.6271848Z +                follow_redirects=True,
2026-01-25T08:57:22.6272269Z              )
2026-01-25T08:57:22.6272560Z -            
2026-01-25T08:57:22.6272856Z +
2026-01-25T08:57:22.6273513Z              if response.status_code == 200:
2026-01-25T08:57:22.6288349Z                  # 2. Вход
2026-01-25T08:57:22.6288825Z                  response = client_with_csrf.post(
2026-01-25T08:57:22.6289349Z -                    '/auth/login',
2026-01-25T08:57:22.6289993Z -                    data={'username': 'integration_user#0001', 'password': 'test_pass123'},
2026-01-25T08:57:22.6290687Z -                    follow_redirects=False
2026-01-25T08:57:22.6291234Z +                    "/auth/login",
2026-01-25T08:57:22.6291634Z +                    data={
2026-01-25T08:57:22.6292073Z +                        "username": "integration_user#0001",
2026-01-25T08:57:22.6292612Z +                        "password": "test_pass123",
2026-01-25T08:57:22.6293274Z +                    },
2026-01-25T08:57:22.6293658Z +                    follow_redirects=False,
2026-01-25T08:57:22.6294105Z                  )
2026-01-25T08:57:22.6294439Z -                
2026-01-25T08:57:22.6294752Z +
2026-01-25T08:57:22.6295121Z                  if response.status_code == 302:
2026-01-25T08:57:22.6295717Z                      # 3. Проверка сессии
2026-01-25T08:57:22.6296295Z                      with client_with_csrf.session_transaction() as sess:
2026-01-25T08:57:22.6296898Z -                        assert 'user_id' in sess
2026-01-25T08:57:22.6297659Z -                    
2026-01-25T08:57:22.6298054Z +                        assert "user_id" in sess
2026-01-25T08:57:22.6298491Z +
2026-01-25T08:57:22.6298875Z                      # 4. Выход
2026-01-25T08:57:22.6299481Z -                    response = client_with_csrf.get('/auth/logout', follow_redirects=False)
2026-01-25T08:57:22.6300205Z +                    response = client_with_csrf.get(
2026-01-25T08:57:22.6300799Z +                        "/auth/logout", follow_redirects=False
2026-01-25T08:57:22.6301283Z +                    )
2026-01-25T08:57:22.6301680Z                      assert response.status_code == 302
2026-01-25T08:57:22.6302155Z -                    
2026-01-25T08:57:22.6302485Z +
2026-01-25T08:57:22.6303215Z                      # 5. Проверка очистки сессии
2026-01-25T08:57:22.6303793Z                      with client_with_csrf.session_transaction() as sess:
2026-01-25T08:57:22.6304413Z -                        assert 'user_id' not in sess
2026-01-25T08:57:22.6304856Z -
2026-01-25T08:57:22.6305443Z -    def test_create_post_workflow(self, client_with_csrf, auth_with_csrf, app_with_csrf):
2026-01-25T08:57:22.6306202Z +                        assert "user_id" not in sess
2026-01-25T08:57:22.6306649Z +
2026-01-25T08:57:22.6306945Z +    def test_create_post_workflow(
2026-01-25T08:57:22.6307477Z +        self, client_with_csrf, auth_with_csrf, app_with_csrf
2026-01-25T08:57:22.6308012Z +    ):
2026-01-25T08:57:22.6308435Z          """Сценарий создания поста."""
2026-01-25T08:57:22.6308906Z          with app_with_csrf.app_context():
2026-01-25T08:57:22.6309446Z              # 1. Вход
2026-01-25T08:57:22.6309799Z              auth_with_csrf.login()
2026-01-25T08:57:22.6310287Z -            
2026-01-25T08:57:22.6310586Z +
2026-01-25T08:57:22.6310948Z              # 2. Создание поста
2026-01-25T08:57:22.6311386Z              response = client_with_csrf.post(
2026-01-25T08:57:22.6312136Z -                '/main/create',
2026-01-25T08:57:22.6312582Z +                "/main/create",
2026-01-25T08:57:22.6313163Z                  data={
2026-01-25T08:57:22.6313679Z -                    'title': 'Интеграционный пост',
2026-01-25T08:57:22.6314412Z -                    'content': 'Это тестовый пост для интеграционных тестов.',
2026-01-25T08:57:22.6315114Z +                    "title": "Интеграционный пост",
2026-01-25T08:57:22.6315812Z +                    "content": "Это тестовый пост для интеграционных тестов.",
2026-01-25T08:57:22.6316354Z                  },
2026-01-25T08:57:22.6316704Z -                follow_redirects=True
2026-01-25T08:57:22.6317172Z +                follow_redirects=True,
2026-01-25T08:57:22.6317599Z              )
2026-01-25T08:57:22.6317903Z -            
2026-01-25T08:57:22.6318189Z +
2026-01-25T08:57:22.6318685Z              # 3. Проверка создания (если маршрут существует)
2026-01-25T08:57:22.6319220Z              if response.status_code == 200:
2026-01-25T08:57:22.6319683Z                  try:
2026-01-25T08:57:22.6320080Z                      from app.db.db import get_db
2026-01-25T08:57:22.6320573Z +
2026-01-25T08:57:22.6320875Z                      db = get_db()
2026-01-25T08:57:22.6321308Z                      post = db.execute(
2026-01-25T08:57:22.6321831Z -                        'SELECT * FROM post WHERE title = ?',
2026-01-25T08:57:22.6322479Z -                        ('Интеграционный пост',)
2026-01-25T08:57:22.6323435Z +                        "SELECT * FROM post WHERE title = ?", ("Интеграционный пост",)
2026-01-25T08:57:22.6324048Z                      ).fetchone()
2026-01-25T08:57:22.6324477Z                      assert post is not None
2026-01-25T08:57:22.6324956Z                  except Exception:
2026-01-25T08:57:22.6325433Z                      pass
2026-01-25T08:57:22.6325779Z  
2026-01-25T08:57:22.6326174Z      def test_comment_workflow(self, client, auth, app):
2026-01-25T08:57:22.6326819Z          """Сценарий добавления комментария."""
2026-01-25T08:57:22.6327328Z          with app.app_context():
2026-01-25T08:57:22.6327824Z              # 1. Вход
2026-01-25T08:57:22.6328476Z              auth.login()
2026-01-25T08:57:22.6328871Z -            
2026-01-25T08:57:22.6329186Z +
2026-01-25T08:57:22.6329638Z              # 2. Попытка добавить комментарий к посту
2026-01-25T08:57:22.6330142Z              response = client.post(
2026-01-25T08:57:22.6330598Z -                '/main/post/1/comment',
2026-01-25T08:57:22.6331046Z +                "/main/post/1/comment",
2026-01-25T08:57:22.6331483Z                  data={
2026-01-25T08:57:22.6332038Z -                    'content': 'Это тестовый комментарий.',
2026-01-25T08:57:22.6332663Z +                    "content": "Это тестовый комментарий.",
2026-01-25T08:57:22.6333314Z                  },
2026-01-25T08:57:22.6333694Z -                follow_redirects=True
2026-01-25T08:57:22.6334155Z +                follow_redirects=True,
2026-01-25T08:57:22.6334587Z              )
2026-01-25T08:57:22.6334916Z -            
2026-01-25T08:57:22.6335203Z +
2026-01-25T08:57:22.6335794Z              # Проверка, что запрос обработан (даже если маршрут не существует)
2026-01-25T08:57:22.6336443Z              assert response.status_code in [200, 302, 404, 405]
2026-01-25T08:57:22.6336982Z  
2026-01-25T08:57:22.6337299Z  
2026-01-25T08:57:22.6337606Z  class TestSecurityFeatures:
2026-01-25T08:57:22.6338042Z @@ -92,146 +101,148 @@
2026-01-25T08:57:22.6338382Z  
2026-01-25T08:57:22.6338736Z      def test_session_security(self, client, auth):
2026-01-25T08:57:22.6339330Z          """Безопасность сессий."""
2026-01-25T08:57:22.6339801Z          # 1. Вход
2026-01-25T08:57:22.6340122Z          auth.login()
2026-01-25T08:57:22.6340466Z -        
2026-01-25T08:57:22.6340742Z +
2026-01-25T08:57:22.6341163Z          # 2. Проверка, что сессия установлена
2026-01-25T08:57:22.6341735Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.6342272Z -            assert 'user_id' in sess
2026-01-25T08:57:22.6342749Z -            original_user_id = sess['user_id']
2026-01-25T08:57:22.6343762Z -        
2026-01-25T08:57:22.6344087Z +            assert "user_id" in sess
2026-01-25T08:57:22.6344572Z +            original_user_id = sess["user_id"]
2026-01-25T08:57:22.6345011Z +
2026-01-25T08:57:22.6345380Z          # 3. Выход
2026-01-25T08:57:22.6345741Z          auth.logout()
2026-01-25T08:57:22.6346150Z -        
2026-01-25T08:57:22.6346451Z +
2026-01-25T08:57:22.6346869Z          # 4. Проверка, что сессия очищена
2026-01-25T08:57:22.6347399Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.6348091Z -            assert 'user_id' not in sess or sess.get('user_id') != original_user_id
2026-01-25T08:57:22.6348753Z -
2026-01-25T08:57:22.6349264Z +            assert "user_id" not in sess or sess.get("user_id") != original_user_id
2026-01-25T08:57:22.6349981Z  
2026-01-25T08:57:22.6350316Z  
2026-01-25T08:57:22.6350607Z  class TestErrorHandling:
2026-01-25T08:57:22.6351121Z      """Тесты обработки ошибок."""
2026-01-25T08:57:22.6351519Z  
2026-01-25T08:57:22.6351892Z      def test_database_error_handling(self, client, app):
2026-01-25T08:57:22.6352567Z          """Обработка ошибок базы данных."""
2026-01-25T08:57:22.6353256Z          with app.app_context():
2026-01-25T08:57:22.6353673Z              try:
2026-01-25T08:57:22.6354049Z                  from app.db.db import get_db
2026-01-25T08:57:22.6354489Z +
2026-01-25T08:57:22.6354764Z                  db = get_db()
2026-01-25T08:57:22.6355136Z -                
2026-01-25T08:57:22.6355479Z +
2026-01-25T08:57:22.6356018Z                  # Попытка выполнить некорректный SQL
2026-01-25T08:57:22.6356458Z                  try:
2026-01-25T08:57:22.6356859Z -                    db.execute('INVALID SQL QUERY')
2026-01-25T08:57:22.6357357Z +                    db.execute("INVALID SQL QUERY")
2026-01-25T08:57:22.6357994Z                      assert False, "Should have raised an exception"
2026-01-25T08:57:22.6358537Z                  except Exception:
2026-01-25T08:57:22.6359206Z                      pass  # Ожидаемое поведение
2026-01-25T08:57:22.6359652Z -                
2026-01-25T08:57:22.6359970Z +
2026-01-25T08:57:22.6360573Z              except Exception:
2026-01-25T08:57:22.6361191Z                  pass  # БД может быть не настроена
2026-01-25T08:57:22.6361637Z  
2026-01-25T08:57:22.6361972Z      def test_form_error_handling(self, client):
2026-01-25T08:57:22.6362547Z          """Обработка ошибок форм."""
2026-01-25T08:57:22.6363385Z          # Попытка отправить форму с некорректными данными
2026-01-25T08:57:22.6363948Z          response = client.post(
2026-01-25T08:57:22.6364375Z -            '/auth/register',
2026-01-25T08:57:22.6364762Z +            "/auth/register",
2026-01-25T08:57:22.6365135Z              data={
2026-01-25T08:57:22.6365593Z -                'username': '',  # Пустой логин
2026-01-25T08:57:22.6366217Z -                'password': '123'  # Слишком короткий пароль
2026-01-25T08:57:22.6366700Z -            }
2026-01-25T08:57:22.6367157Z +                "username": "",  # Пустой логин
2026-01-25T08:57:22.6367800Z +                "password": "123",  # Слишком короткий пароль
2026-01-25T08:57:22.6368307Z +            },
2026-01-25T08:57:22.6368628Z          )
2026-01-25T08:57:22.6368907Z -        
2026-01-25T08:57:22.6369181Z +
2026-01-25T08:57:22.6369748Z          # TODO: С заглушками валидации форма всегда валидна, происходит редирект
2026-01-25T08:57:22.6370542Z          # Когда валидаторы будут реализованы, здесь должно быть 200 или 400
2026-01-25T08:57:22.6371458Z          assert response.status_code in [200, 400, 302]  # Включаем 302 для заглушек
2026-01-25T08:57:22.6372172Z  
2026-01-25T08:57:22.6372557Z      def test_authentication_error_handling(self, client):
2026-01-25T08:57:22.6373396Z          """Обработка ошибок аутентификации."""
2026-01-25T08:57:22.6373975Z          # Попытка входа с неверными данными
2026-01-25T08:57:22.6374439Z          response = client.post(
2026-01-25T08:57:22.6374856Z -            '/auth/login',
2026-01-25T08:57:22.6375479Z -            data={
2026-01-25T08:57:22.6375781Z -                'username': 'nonexistent#0000',
2026-01-25T08:57:22.6376225Z -                'password': 'wrong_password'
2026-01-25T08:57:22.6376600Z -            }
2026-01-25T08:57:22.6376860Z +            "/auth/login",
2026-01-25T08:57:22.6377340Z +            data={"username": "nonexistent#0000", "password": "wrong_password"},
2026-01-25T08:57:22.6377856Z          )
2026-01-25T08:57:22.6378092Z -        
2026-01-25T08:57:22.6378333Z +
2026-01-25T08:57:22.6378657Z          # Должна быть ошибка аутентификации
2026-01-25T08:57:22.6379091Z          assert response.status_code in [200, 400]
2026-01-25T08:57:22.6379669Z          # Проверяем наличие сообщения об ошибке
2026-01-25T08:57:22.6380477Z -        assert b'error' in response.data.lower() or b'nevernyi' in response.data.lower() or b'login' in response.data.lower()
2026-01-25T08:57:22.6381253Z +        assert (
2026-01-25T08:57:22.6381565Z +            b"error" in response.data.lower()
2026-01-25T08:57:22.6382028Z +            or b"nevernyi" in response.data.lower()
2026-01-25T08:57:22.6382530Z +            or b"login" in response.data.lower()
2026-01-25T08:57:22.6383097Z +        )
2026-01-25T08:57:22.6383342Z  
2026-01-25T08:57:22.6383563Z  
2026-01-25T08:57:22.6383848Z  class TestPerformance:
2026-01-25T08:57:22.6384250Z      """Базовые тесты производительности."""
2026-01-25T08:57:22.6384622Z  
2026-01-25T08:57:22.6384924Z      def test_page_load_times(self, client):
2026-01-25T08:57:22.6385447Z          """Проверка времени загрузки страниц."""
2026-01-25T08:57:22.6385807Z          import time
2026-01-25T08:57:22.6386079Z -        
2026-01-25T08:57:22.6386311Z +
2026-01-25T08:57:22.6386630Z          # Измеряем время загрузки главной страницы
2026-01-25T08:57:22.6387027Z          start_time = time.time()
2026-01-25T08:57:22.6387491Z -        response = client.get('/')
2026-01-25T08:57:22.6387872Z +        response = client.get("/")
2026-01-25T08:57:22.6388220Z          end_time = time.time()
2026-01-25T08:57:22.6388554Z -        
2026-01-25T08:57:22.6388791Z +
2026-01-25T08:57:22.6389054Z          assert response.status_code == 200
2026-01-25T08:57:22.6389858Z          # Страница должна загружаться менее 1 секунды
2026-01-25T08:57:22.6390311Z          assert (end_time - start_time) < 1.0
2026-01-25T08:57:22.6390671Z  
2026-01-25T08:57:22.6390975Z      def test_database_query_performance(self, app):
2026-01-25T08:57:22.6391548Z          """Проверка производительности запросов к БД."""
2026-01-25T08:57:22.6392067Z          with app.app_context():
2026-01-25T08:57:22.6392408Z              try:
2026-01-25T08:57:22.6392753Z                  from app.db.db import get_db
2026-01-25T08:57:22.6393340Z                  import time
2026-01-25T08:57:22.6393648Z -                
2026-01-25T08:57:22.6394008Z +
2026-01-25T08:57:22.6394264Z                  db = get_db()
2026-01-25T08:57:22.6394586Z -                
2026-01-25T08:57:22.6394877Z +
2026-01-25T08:57:22.6395379Z                  # Измеряем время простого запроса
2026-01-25T08:57:22.6396076Z                  start_time = time.time()
2026-01-25T08:57:22.6396564Z -                result = db.execute('SELECT 1').fetchone()
2026-01-25T08:57:22.6397044Z +                result = db.execute("SELECT 1").fetchone()
2026-01-25T08:57:22.6397481Z                  end_time = time.time()
2026-01-25T08:57:22.6397953Z -                
2026-01-25T08:57:22.6398376Z +
2026-01-25T08:57:22.6398687Z                  assert result[0] == 1
2026-01-25T08:57:22.6399289Z                  # Запрос должен выполняться менее 0.1 секунды
2026-01-25T08:57:22.6399792Z                  assert (end_time - start_time) < 0.1
2026-01-25T08:57:22.6400225Z -                
2026-01-25T08:57:22.6400491Z +
2026-01-25T08:57:22.6400770Z              except Exception:
2026-01-25T08:57:22.6401289Z                  pass  # БД может быть не настроена
2026-01-25T08:57:22.6401703Z  
2026-01-25T08:57:22.6401961Z  
2026-01-25T08:57:22.6402252Z  class TestEnvironmentVariables:
2026-01-25T08:57:22.6402752Z      """Тесты переменных окружения."""
2026-01-25T08:57:22.6403302Z  
2026-01-25T08:57:22.6403661Z      def test_secret_key_configuration(self):
2026-01-25T08:57:22.6404209Z          """Проверка конфигурации секретного ключа."""
2026-01-25T08:57:22.6404621Z          from config import Config
2026-01-25T08:57:22.6404978Z -        
2026-01-25T08:57:22.6405207Z +
2026-01-25T08:57:22.6405537Z          # SECRET_KEY должен быть настроен
2026-01-25T08:57:22.6405937Z          assert Config.SECRET_KEY is not None
2026-01-25T08:57:22.6406340Z          assert len(Config.SECRET_KEY) > 0
2026-01-25T08:57:22.6406672Z -        
2026-01-25T08:57:22.6406891Z +
2026-01-25T08:57:22.6407253Z          # В продакшене не должен использоваться ключ по умолчанию
2026-01-25T08:57:22.6407723Z -        if Config.SECRET_KEY == 'you-will-never-guess':
2026-01-25T08:57:22.6408180Z +        if Config.SECRET_KEY == "you-will-never-guess":
2026-01-25T08:57:22.6408563Z              import os
2026-01-25T08:57:22.6408830Z +
2026-01-25T08:57:22.6409323Z              # Это должно быть только в разработке
2026-01-25T08:57:22.6410290Z -            assert os.environ.get('FLASK_ENV') == 'development'
2026-01-25T08:57:22.6411159Z +            assert os.environ.get("FLASK_ENV") == "development"
2026-01-25T08:57:22.6411701Z  
2026-01-25T08:57:22.6412055Z      def test_database_path_configuration(self):
2026-01-25T08:57:22.6412781Z          """Проверка конфигурации пути к БД."""
2026-01-25T08:57:22.6413499Z          from config import Config
2026-01-25T08:57:22.6413906Z -        
2026-01-25T08:57:22.6414181Z +
2026-01-25T08:57:22.6414507Z          assert Config.DATABASE is not None
2026-01-25T08:57:22.6415051Z          assert len(Config.DATABASE) > 0
2026-01-25T08:57:22.6415527Z -        
2026-01-25T08:57:22.6415900Z +
2026-01-25T08:57:22.6416394Z          # Путь должен содержать имя файла БД
2026-01-25T08:57:22.6416907Z -        assert 'flask_blog.sqlite' in Config.DATABASE
2026-01-25T08:57:22.6417550Z +        assert "flask_blog.sqlite" in Config.DATABASE
2026-01-25T08:57:22.6418052Z  
2026-01-25T08:57:22.6418465Z      def test_admin_password_configuration(self):
2026-01-25T08:57:22.6419201Z          """Проверка конфигурации пароля администратора."""
2026-01-25T08:57:22.6419749Z          from config import Config
2026-01-25T08:57:22.6420188Z -        
2026-01-25T08:57:22.6420467Z +
2026-01-25T08:57:22.6421121Z          # ADMIN_PASSWORD может быть None (из переменной окружения)
2026-01-25T08:57:22.6421762Z          # или строка
2026-01-25T08:57:22.6422420Z          assert Config.ADMIN_PASSWORD is None or isinstance(Config.ADMIN_PASSWORD, str)
2026-01-25T08:57:22.6423380Z  
2026-01-25T08:57:22.6423652Z  
2026-01-25T08:57:22.6424004Z @@ -239,37 +250,34 @@
2026-01-25T08:57:22.6424489Z      """Тесты фабрики приложений."""
2026-01-25T08:57:22.6424946Z  
2026-01-25T08:57:22.6425308Z      def test_app_creation(self):
2026-01-25T08:57:22.6425808Z          """Создание приложения."""
2026-01-25T08:57:22.6426376Z          from app import create_app
2026-01-25T08:57:22.6427213Z -        
2026-01-25T08:57:22.6427495Z +
2026-01-25T08:57:22.6427794Z          app = create_app()
2026-01-25T08:57:22.6428254Z          assert app is not None
2026-01-25T08:57:22.6428754Z -        assert app.name == 'app'
2026-01-25T08:57:22.6429190Z +        assert app.name == "app"
2026-01-25T08:57:22.6429603Z  
2026-01-25T08:57:22.6429960Z      def test_app_creation_with_config(self):
2026-01-25T08:57:22.6430625Z          """Создание приложения с кастомной конфигурацией."""
2026-01-25T08:57:22.6431137Z          from app import create_app
2026-01-25T08:57:22.6431588Z -        
2026-01-25T08:57:22.6431887Z -        test_config = {
2026-01-25T08:57:22.6432259Z -            'TESTING': True,
2026-01-25T08:57:22.6432717Z -            'SECRET_KEY': 'test-secret-key'
2026-01-25T08:57:22.6433502Z -        }
2026-01-25T08:57:22.6433832Z -        
2026-01-25T08:57:22.6434104Z +
2026-01-25T08:57:22.6434514Z +        test_config = {"TESTING": True, "SECRET_KEY": "test-secret-key"}
2026-01-25T08:57:22.6435208Z +
2026-01-25T08:57:22.6435628Z          app = create_app(test_config)
2026-01-25T08:57:22.6436135Z -        assert app.config['TESTING'] is True
2026-01-25T08:57:22.6436842Z -        assert app.config['SECRET_KEY'] == 'test-secret-key'
2026-01-25T08:57:22.6437418Z +        assert app.config["TESTING"] is True
2026-01-25T08:57:22.6437971Z +        assert app.config["SECRET_KEY"] == "test-secret-key"
2026-01-25T08:57:22.6438512Z  
2026-01-25T08:57:22.6438923Z      def test_blueprints_registration(self):
2026-01-25T08:57:22.6439532Z          """Регистрация blueprint'ов."""
2026-01-25T08:57:22.6439981Z          from app import create_app
2026-01-25T08:57:22.6440393Z -        
2026-01-25T08:57:22.6440670Z +
2026-01-25T08:57:22.6440951Z          app = create_app()
2026-01-25T08:57:22.6441486Z -        
2026-01-25T08:57:22.6441766Z +
2026-01-25T08:57:22.6442194Z          # Проверяем, что blueprint'ы зарегистрированы
2026-01-25T08:57:22.6442869Z          blueprints = [bp.name for bp in app.blueprints.values()]
2026-01-25T08:57:22.6443735Z -        
2026-01-25T08:57:22.6444005Z +
2026-01-25T08:57:22.6444481Z          # Основные blueprint'ы должны быть зарегистрированы
2026-01-25T08:57:22.6445285Z -        expected_blueprints = ['auth', 'main']
2026-01-25T08:57:22.6445832Z +        expected_blueprints = ["auth", "main"]
2026-01-25T08:57:22.6446464Z          for bp_name in expected_blueprints:
2026-01-25T08:57:22.6447012Z              if bp_name in blueprints:
2026-01-25T08:57:22.6447457Z                  assert True
2026-01-25T08:57:22.6492247Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_main.py
2026-01-25T08:57:22.6493605Z --- /home/runner/work/flask_blog/flask_blog/tests/test_main.py	2026-01-25 08:57:06.654994+00:00
2026-01-25T08:57:22.6494657Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_main.py	2026-01-25 08:57:22.643724+00:00
2026-01-25T08:57:22.6495381Z @@ -8,192 +8,189 @@
2026-01-25T08:57:22.6495734Z  class TestMainRoutes:
2026-01-25T08:57:22.6496428Z      """Тесты основных страниц приложения."""
2026-01-25T08:57:22.6496967Z  
2026-01-25T08:57:22.6497307Z      def test_index_page_loads(self, client):
2026-01-25T08:57:22.6497963Z          """Главная страница должна загружаться."""
2026-01-25T08:57:22.6498467Z -        response = client.get('/')
2026-01-25T08:57:22.6498941Z +        response = client.get("/")
2026-01-25T08:57:22.6499442Z          assert response.status_code == 200
2026-01-25T08:57:22.6500153Z -        assert 'Flask Blog'.encode('utf-8') in response.data
2026-01-25T08:57:22.6500811Z +        assert "Flask Blog".encode("utf-8") in response.data
2026-01-25T08:57:22.6501312Z  
2026-01-25T08:57:22.6501731Z      def test_index_page_context(self, client, app):
2026-01-25T08:57:22.6502392Z          """Проверка контекста главной страницы."""
2026-01-25T08:57:22.6502868Z          with app.app_context():
2026-01-25T08:57:22.6503581Z -            response = client.get('/')
2026-01-25T08:57:22.6504081Z +            response = client.get("/")
2026-01-25T08:57:22.6504618Z              assert response.status_code == 200
2026-01-25T08:57:22.6505727Z -            
2026-01-25T08:57:22.6506054Z +
2026-01-25T08:57:22.6506496Z      def test_index_with_authenticated_user(self, client, auth):
2026-01-25T08:57:22.6507353Z          """Главная страница для аутентифицированного пользователя."""
2026-01-25T08:57:22.6507893Z          auth.login()
2026-01-25T08:57:22.6508273Z -        response = client.get('/')
2026-01-25T08:57:22.6508753Z +        response = client.get("/")
2026-01-25T08:57:22.6509219Z          assert response.status_code == 200
2026-01-25T08:57:22.6509659Z -        
2026-01-25T08:57:22.6509975Z +
2026-01-25T08:57:22.6510287Z      def test_about_page(self, client):
2026-01-25T08:57:22.6510813Z          """Страница о проекте."""
2026-01-25T08:57:22.6511240Z -        response = client.get('/about')
2026-01-25T08:57:22.6511707Z +        response = client.get("/about")
2026-01-25T08:57:22.6512231Z          # Если страница существует
2026-01-25T08:57:22.6512676Z          if response.status_code == 200:
2026-01-25T08:57:22.6513546Z -            assert 'О проекте'.encode('utf-8') in response.data
2026-01-25T08:57:22.6514292Z +            assert "О проекте".encode("utf-8") in response.data
2026-01-25T08:57:22.6514876Z  
2026-01-25T08:57:22.6515139Z  
2026-01-25T08:57:22.6515446Z  class TestPostManagement:
2026-01-25T08:57:22.6515935Z      """Тесты управления постами."""
2026-01-25T08:57:22.6516331Z  
2026-01-25T08:57:22.6516712Z      def test_create_post_requires_login(self, client):
2026-01-25T08:57:22.6517387Z          """Создание поста требует аутентификации."""
2026-01-25T08:57:22.6518001Z -        response = client.get('/post/create', follow_redirects=False)
2026-01-25T08:57:22.6518734Z +        response = client.get("/post/create", follow_redirects=False)
2026-01-25T08:57:22.6519371Z          assert response.status_code == 302
2026-01-25T08:57:22.6519918Z -        assert '/auth/login' in response.headers['Location']
2026-01-25T08:57:22.6520548Z +        assert "/auth/login" in response.headers["Location"]
2026-01-25T08:57:22.6521104Z  
2026-01-25T08:57:22.6521534Z      def test_create_post_authenticated(self, client, auth, app):
2026-01-25T08:57:22.6522524Z          """Создание поста аутентифицированным пользователем."""
2026-01-25T08:57:22.6523378Z          auth.login()
2026-01-25T08:57:22.6523814Z -        response = client.get('/post/create')
2026-01-25T08:57:22.6524310Z +        response = client.get("/post/create")
2026-01-25T08:57:22.6524808Z          assert response.status_code == 200
2026-01-25T08:57:22.6525488Z -        assert 'Создать'.encode('utf-8') in response.data
2026-01-25T08:57:22.6526211Z +        assert "Создать".encode("utf-8") in response.data
2026-01-25T08:57:22.6526713Z  
2026-01-25T08:57:22.6527125Z      def test_post_creation_success(self, client, auth, app):
2026-01-25T08:57:22.6527844Z          """Успешное создание поста."""
2026-01-25T08:57:22.6528300Z          auth.login()
2026-01-25T08:57:22.6528658Z -        
2026-01-25T08:57:22.6528941Z +
2026-01-25T08:57:22.6529236Z          with app.app_context():
2026-01-25T08:57:22.6530054Z              # Пробуем создать пост
2026-01-25T08:57:22.6530527Z              response = client.post(
2026-01-25T08:57:22.6530950Z -                '/post/create',
2026-01-25T08:57:22.6531358Z +                "/post/create",
2026-01-25T08:57:22.6531739Z                  data={
2026-01-25T08:57:22.6532331Z -                    'title': 'Тестовый пост',
2026-01-25T08:57:22.6533189Z -                    'content': 'Это содержимое тестового поста',
2026-01-25T08:57:22.6533844Z +                    "title": "Тестовый пост",
2026-01-25T08:57:22.6534465Z +                    "content": "Это содержимое тестового поста",
2026-01-25T08:57:22.6534935Z                  },
2026-01-25T08:57:22.6535298Z -                follow_redirects=True
2026-01-25T08:57:22.6535767Z +                follow_redirects=True,
2026-01-25T08:57:22.6536174Z              )
2026-01-25T08:57:22.6536482Z -            
2026-01-25T08:57:22.6536806Z +
2026-01-25T08:57:22.6537226Z              # Если маршрут существует и работает
2026-01-25T08:57:22.6537764Z              if response.status_code == 200:
2026-01-25T08:57:22.6538417Z                  # Проверяем, что пост создан (если есть БД)
2026-01-25T08:57:22.6538876Z                  try:
2026-01-25T08:57:22.6539269Z                      from app.db.db import get_db
2026-01-25T08:57:22.6539710Z +
2026-01-25T08:57:22.6540004Z                      db = get_db()
2026-01-25T08:57:22.6540429Z                      post = db.execute(
2026-01-25T08:57:22.6540926Z -                        'SELECT * FROM post WHERE title = ?',
2026-01-25T08:57:22.6541538Z -                        ('Тестовый пост',)
2026-01-25T08:57:22.6542246Z +                        "SELECT * FROM post WHERE title = ?", ("Тестовый пост",)
2026-01-25T08:57:22.6542821Z                      ).fetchone()
2026-01-25T08:57:22.6543591Z                      assert post is not None
2026-01-25T08:57:22.6544043Z                  except Exception:
2026-01-25T08:57:22.6544669Z                      pass  # БД может быть не настроена в тестах
2026-01-25T08:57:22.6545204Z  
2026-01-25T08:57:22.6545532Z      def test_view_post(self, client, app):
2026-01-25T08:57:22.6546337Z          """Просмотр отдельного поста."""
2026-01-25T08:57:22.6546833Z          with app.app_context():
2026-01-25T08:57:22.6547493Z              # Пробуем просмотреть пост с ID 1 (создается в conftest.py)
2026-01-25T08:57:22.6548100Z -            response = client.get('/post/1')
2026-01-25T08:57:22.6548609Z +            response = client.get("/post/1")
2026-01-25T08:57:22.6549181Z              # Должен вернуть 200 (пост есть)
2026-01-25T08:57:22.6549758Z              assert response.status_code == 200
2026-01-25T08:57:22.6550394Z              # Проверяем, что в ответе есть содержимое поста
2026-01-25T08:57:22.6551064Z -            assert b'Test Post' in response.data or b'post' in response.data
2026-01-25T08:57:22.6551831Z +            assert b"Test Post" in response.data or b"post" in response.data
2026-01-25T08:57:22.6552396Z  
2026-01-25T08:57:22.6552796Z      def test_edit_post_requires_login(self, client):
2026-01-25T08:57:22.6553719Z          """Редактирование поста требует аутентификации."""
2026-01-25T08:57:22.6554352Z -        response = client.get('/post/1/edit', follow_redirects=False)
2026-01-25T08:57:22.6555071Z +        response = client.get("/post/1/edit", follow_redirects=False)
2026-01-25T08:57:22.6555676Z          assert response.status_code == 302
2026-01-25T08:57:22.6556245Z -        assert '/auth/login' in response.headers['Location']
2026-01-25T08:57:22.6556876Z +        assert "/auth/login" in response.headers["Location"]
2026-01-25T08:57:22.6557382Z  
2026-01-25T08:57:22.6557800Z      def test_delete_post_requires_login(self, client):
2026-01-25T08:57:22.6558466Z          """Удаление поста требует аутентификации."""
2026-01-25T08:57:22.6559095Z -        response = client.post('/post/1/delete', follow_redirects=False)
2026-01-25T08:57:22.6559877Z +        response = client.post("/post/1/delete", follow_redirects=False)
2026-01-25T08:57:22.6560787Z          assert response.status_code == 302
2026-01-25T08:57:22.6561376Z -        assert '/auth/login' in response.headers['Location']
2026-01-25T08:57:22.6562036Z +        assert "/auth/login" in response.headers["Location"]
2026-01-25T08:57:22.6562604Z  
2026-01-25T08:57:22.6562854Z  
2026-01-25T08:57:22.6563347Z  class TestErrorHandlers:
2026-01-25T08:57:22.6563853Z      """Тесты обработчиков ошибок."""
2026-01-25T08:57:22.6564262Z  
2026-01-25T08:57:22.6564574Z      def test_404_error(self, client):
2026-01-25T08:57:22.6565199Z          """Страница 404 должна возвращать правильный статус."""
2026-01-25T08:57:22.6565763Z -        response = client.get('/nonexistent-page')
2026-01-25T08:57:22.6566328Z +        response = client.get("/nonexistent-page")
2026-01-25T08:57:22.6566861Z          assert response.status_code == 404
2026-01-25T08:57:22.6567302Z  
2026-01-25T08:57:22.6567639Z      def test_404_error_content(self, client):
2026-01-25T08:57:22.6568323Z          """Страница 404 должна содержать сообщение об ошибке."""
2026-01-25T08:57:22.6568987Z -        response = client.get('/nonexistent-page')
2026-01-25T08:57:22.6569202Z +        response = client.get("/nonexistent-page")
2026-01-25T08:57:22.6569374Z          if response.status_code == 404:
2026-01-25T08:57:22.6569667Z              # Проверяем наличие сообщения об ошибке
2026-01-25T08:57:22.6570010Z -            assert b'404' in response.data or b'ne naidena' in response.data.lower()
2026-01-25T08:57:22.6570357Z +            assert b"404" in response.data or b"ne naidena" in response.data.lower()
2026-01-25T08:57:22.6570482Z  
2026-01-25T08:57:22.6570688Z      def test_500_error_handling(self, client, app):
2026-01-25T08:57:22.6570917Z          """Обработка ошибки 500."""
2026-01-25T08:57:22.6571253Z          # Этот тест требует специальной настройки для вызова 500 ошибки
2026-01-25T08:57:22.6571539Z          # Пока просто проверяем, что приложение не падает
2026-01-25T08:57:22.6571705Z          with app.app_context():
2026-01-25T08:57:22.6571898Z -            response = client.get('/')
2026-01-25T08:57:22.6572051Z +            response = client.get("/")
2026-01-25T08:57:22.6572516Z              assert response.status_code in [200, 302, 404, 500]
2026-01-25T08:57:22.6572644Z -
2026-01-25T08:57:22.6572760Z -
2026-01-25T08:57:22.6572881Z  
2026-01-25T08:57:22.6573174Z  
2026-01-25T08:57:22.6573356Z  class TestDatabaseOperations:
2026-01-25T08:57:22.6573608Z      """Тесты операций с базой данных."""
2026-01-25T08:57:22.6573722Z  
2026-01-25T08:57:22.6573942Z      def test_database_initialization(self, app):
2026-01-25T08:57:22.6574197Z          """Инициализация базы данных."""
2026-01-25T08:57:22.6574355Z          with app.app_context():
2026-01-25T08:57:22.6574554Z              from app.db.db import init_db, get_db
2026-01-25T08:57:22.6574672Z -            
2026-01-25T08:57:22.6574785Z +
2026-01-25T08:57:22.6575075Z              # Инициализация должна работать без ошибок
2026-01-25T08:57:22.6575207Z              init_db()
2026-01-25T08:57:22.6575349Z -            
2026-01-25T08:57:22.6575467Z +
2026-01-25T08:57:22.6575722Z              # Подключение к БД должно работать
2026-01-25T08:57:22.6575893Z              db = get_db()
2026-01-25T08:57:22.6576045Z              assert db is not None
2026-01-25T08:57:22.6576163Z  
2026-01-25T08:57:22.6576357Z      def test_database_connection(self, app):
2026-01-25T08:57:22.6576584Z          """Подключение к базе данных."""
2026-01-25T08:57:22.6576731Z          with app.app_context():
2026-01-25T08:57:22.6576903Z              from app.db.db import get_db
2026-01-25T08:57:22.6577021Z -            
2026-01-25T08:57:22.6577133Z +
2026-01-25T08:57:22.6577278Z              db = get_db()
2026-01-25T08:57:22.6577436Z              assert db is not None
2026-01-25T08:57:22.6577560Z -            
2026-01-25T08:57:22.6577672Z +
2026-01-25T08:57:22.6577933Z              # Простая проверка выполнения запроса
2026-01-25T08:57:22.6578065Z              try:
2026-01-25T08:57:22.6578276Z -                result = db.execute('SELECT 1').fetchone()
2026-01-25T08:57:22.6578769Z +                result = db.execute("SELECT 1").fetchone()
2026-01-25T08:57:22.6578952Z                  assert result[0] == 1
2026-01-25T08:57:22.6579101Z              except Exception:
2026-01-25T08:57:22.6579417Z                  pass  # Таблиц может не существовать
2026-01-25T08:57:22.6579546Z -
2026-01-25T08:57:22.6579663Z  
2026-01-25T08:57:22.6579776Z  
2026-01-25T08:57:22.6579940Z  class TestConfiguration:
2026-01-25T08:57:22.6580172Z      """Тесты конфигурации приложения."""
2026-01-25T08:57:22.6580296Z  
2026-01-25T08:57:22.6580459Z      def test_development_config(self):
2026-01-25T08:57:22.6580691Z          """Конфигурация для разработки."""
2026-01-25T08:57:22.6580887Z          from config import DevelopmentConfig
2026-01-25T08:57:22.6581006Z -        
2026-01-25T08:57:22.6581122Z +
2026-01-25T08:57:22.6581323Z          assert DevelopmentConfig.DEBUG is True
2026-01-25T08:57:22.6581555Z -        assert hasattr(DevelopmentConfig, 'SECRET_KEY')
2026-01-25T08:57:22.6581827Z -        assert hasattr(DevelopmentConfig, 'DATABASE')
2026-01-25T08:57:22.6582093Z +        assert hasattr(DevelopmentConfig, "SECRET_KEY")
2026-01-25T08:57:22.6582314Z +        assert hasattr(DevelopmentConfig, "DATABASE")
2026-01-25T08:57:22.6582435Z  
2026-01-25T08:57:22.6582599Z      def test_production_config(self):
2026-01-25T08:57:22.6582841Z          """Конфигурация для продакшена."""
2026-01-25T08:57:22.6583236Z          from config import ProductionConfig
2026-01-25T08:57:22.6583377Z -        
2026-01-25T08:57:22.6583495Z +
2026-01-25T08:57:22.6583699Z          assert ProductionConfig.DEBUG is False
2026-01-25T08:57:22.6583922Z -        assert hasattr(ProductionConfig, 'SECRET_KEY')
2026-01-25T08:57:22.6584132Z -        assert hasattr(ProductionConfig, 'DATABASE')
2026-01-25T08:57:22.6584347Z +        assert hasattr(ProductionConfig, "SECRET_KEY")
2026-01-25T08:57:22.6584549Z +        assert hasattr(ProductionConfig, "DATABASE")
2026-01-25T08:57:22.6584687Z  
2026-01-25T08:57:22.6584843Z      def test_testing_config(self):
2026-01-25T08:57:22.6585103Z          """Конфигурация для тестирования."""
2026-01-25T08:57:22.6585473Z          from config import TestingConfig
2026-01-25T08:57:22.6585612Z -        
2026-01-25T08:57:22.6585728Z +
2026-01-25T08:57:22.6585921Z          assert TestingConfig.TESTING is True
2026-01-25T08:57:22.6586129Z -        assert TestingConfig.DATABASE == ':memory:'
2026-01-25T08:57:22.6586327Z +        assert TestingConfig.DATABASE == ":memory:"
2026-01-25T08:57:22.6586452Z  
2026-01-25T08:57:22.6586611Z      def test_config_values(self):
2026-01-25T08:57:22.6586885Z          """Проверка значений конфигурации."""
2026-01-25T08:57:22.6587036Z          from config import Config
2026-01-25T08:57:22.6587245Z -        
2026-01-25T08:57:22.6587427Z -        assert hasattr(Config, 'SECRET_KEY')
2026-01-25T08:57:22.6587589Z -        assert hasattr(Config, 'BASE_DIR')
2026-01-25T08:57:22.6587751Z -        assert hasattr(Config, 'DATABASE')
2026-01-25T08:57:22.6588156Z -        assert hasattr(Config, 'ADMIN_PASSWORD')
2026-01-25T08:57:22.6588274Z -        
2026-01-25T08:57:22.6588387Z +
2026-01-25T08:57:22.6588574Z +        assert hasattr(Config, "SECRET_KEY")
2026-01-25T08:57:22.6588737Z +        assert hasattr(Config, "BASE_DIR")
2026-01-25T08:57:22.6588905Z +        assert hasattr(Config, "DATABASE")
2026-01-25T08:57:22.6589090Z +        assert hasattr(Config, "ADMIN_PASSWORD")
2026-01-25T08:57:22.6589203Z +
2026-01-25T08:57:22.6589424Z          # Проверка пути к БД
2026-01-25T08:57:22.6589631Z -        assert 'flask_blog.sqlite' in Config.DATABASE
2026-01-25T08:57:22.6589828Z +        assert "flask_blog.sqlite" in Config.DATABASE
2026-01-25T08:57:22.7428329Z --- /home/runner/work/flask_blog/flask_blog/tests/test_validation_stubs.py	2026-01-25 08:57:06.654994+00:00
2026-01-25T08:57:22.7430472Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_validation_stubs.py	2026-01-25 08:57:22.740389+00:00
2026-01-25T08:57:22.7454890Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_validation_stubs.py
2026-01-25T08:57:22.7455112Z @@ -3,130 +3,128 @@
2026-01-25T08:57:22.7455238Z  
2026-01-25T08:57:22.7455403Z  import pytest
2026-01-25T08:57:22.7455581Z  from flask import Flask
2026-01-25T08:57:22.7455720Z  
2026-01-25T08:57:22.7456071Z  from app.forms import Form, StringField, DataRequired, Length, EqualTo
2026-01-25T08:57:22.7456548Z +
2026-01-25T08:57:22.7457378Z  # TODO: Regexp будет реализован в будущем
2026-01-25T08:57:22.7457957Z  from app.forms.csrf import generate_csrf_token, validate_csrf_token
2026-01-25T08:57:22.7459424Z  
2026-01-25T08:57:22.7459720Z  
2026-01-25T08:57:22.7461182Z  @pytest.fixture
2026-01-25T08:57:22.7461583Z  def app():
2026-01-25T08:57:22.7461954Z      app = Flask(__name__)
2026-01-25T08:57:22.7463811Z -    app.config['SECRET_KEY'] = 'test-key-12345'
2026-01-25T08:57:22.7464555Z -    app.config['TESTING'] = False  # Включаем CSRF для тестов
2026-01-25T08:57:22.7465084Z +    app.config["SECRET_KEY"] = "test-key-12345"
2026-01-25T08:57:22.7467890Z +    app.config["TESTING"] = False  # Включаем CSRF для тестов
2026-01-25T08:57:22.7468040Z      return app
2026-01-25T08:57:22.7468611Z  
2026-01-25T08:57:22.7468757Z  
2026-01-25T08:57:22.7468924Z  class TestForm(Form):
2026-01-25T08:57:22.7469224Z      """Тестовая форма с валидаторами."""
2026-01-25T08:57:22.7469420Z -    name = StringField('Name', validators=[
2026-01-25T08:57:22.7469633Z -        DataRequired(message='Name required'),
2026-01-25T08:57:22.7469872Z -        Length(min=3, max=10, message='Invalid length'),
2026-01-25T08:57:22.7470417Z -        # TODO: Regexp(r'^[a-zA-Z]+$', message='Only letters') - будет реализован в будущем
2026-01-25T08:57:22.7470560Z -    ])
2026-01-25T08:57:22.7470780Z -    confirm = StringField('Confirm', validators=[
2026-01-25T08:57:22.7470966Z -        EqualTo('name', message='Must match')
2026-01-25T08:57:22.7471101Z -    ])
2026-01-25T08:57:22.7471221Z +
2026-01-25T08:57:22.7471379Z +    name = StringField(
2026-01-25T08:57:22.7471530Z +        "Name",
2026-01-25T08:57:22.7471681Z +        validators=[
2026-01-25T08:57:22.7471933Z +            DataRequired(message="Name required"),
2026-01-25T08:57:22.7472168Z +            Length(min=3, max=10, message="Invalid length"),
2026-01-25T08:57:22.7472718Z +            # TODO: Regexp(r'^[a-zA-Z]+$', message='Only letters') - будет реализован в будущем
2026-01-25T08:57:22.7472859Z +        ],
2026-01-25T08:57:22.7473228Z +    )
2026-01-25T08:57:22.7473641Z +    confirm = StringField("Confirm", validators=[EqualTo("name", message="Must match")])
2026-01-25T08:57:22.7473778Z  
2026-01-25T08:57:22.7473895Z  
2026-01-25T08:57:22.7474106Z  def test_all_validators_are_stubs():
2026-01-25T08:57:22.7474446Z      """Проверяем что все валидаторы - заглушки."""
2026-01-25T08:57:22.7474588Z      validators = [
2026-01-25T08:57:22.7474781Z          DataRequired(),
2026-01-25T08:57:22.7474951Z          Length(min=3, max=10),
2026-01-25T08:57:22.7475306Z          # TODO: Regexp(r'test'),  # будет реализован в будущем
2026-01-25T08:57:22.7475762Z -        EqualTo('field'),
2026-01-25T08:57:22.7475907Z +        EqualTo("field"),
2026-01-25T08:57:22.7476062Z      ]
2026-01-25T08:57:22.7476189Z -    
2026-01-25T08:57:22.7476448Z -    test_values = ['', None, 'test', 'a' * 1000, 'invalid!@#']
2026-01-25T08:57:22.7476590Z -    
2026-01-25T08:57:22.7476716Z +
2026-01-25T08:57:22.7476954Z +    test_values = ["", None, "test", "a" * 1000, "invalid!@#"]
2026-01-25T08:57:22.7477078Z +
2026-01-25T08:57:22.7477245Z      for validator in validators:
2026-01-25T08:57:22.7477401Z          for value in test_values:
2026-01-25T08:57:22.7477627Z -            if validator.__class__.__name__ == 'EqualTo':
2026-01-25T08:57:22.7477843Z +            if validator.__class__.__name__ == "EqualTo":
2026-01-25T08:57:22.7478030Z                  result = validator(value, None)
2026-01-25T08:57:22.7478164Z              else:
2026-01-25T08:57:22.7478327Z                  result = validator(value)
2026-01-25T08:57:22.7478453Z -            
2026-01-25T08:57:22.7478892Z -            assert result == (True, None), f"{validator.__class__.__name__}({value}) = {result}"
2026-01-25T08:57:22.7479030Z +
2026-01-25T08:57:22.7479188Z +            assert result == (
2026-01-25T08:57:22.7479318Z +                True,
2026-01-25T08:57:22.7479473Z +                None,
2026-01-25T08:57:22.7479779Z +            ), f"{validator.__class__.__name__}({value}) = {result}"
2026-01-25T08:57:22.7479954Z  
2026-01-25T08:57:22.7480077Z  
2026-01-25T08:57:22.7480299Z  def test_form_always_valid_with_stubs(app):
2026-01-25T08:57:22.7480694Z      """Форма с заглушками всегда валидна при правильном CSRF."""
2026-01-25T08:57:22.7480986Z -    with app.test_request_context(method='POST'):
2026-01-25T08:57:22.7481204Z +    with app.test_request_context(method="POST"):
2026-01-25T08:57:22.7481391Z          token = generate_csrf_token()
2026-01-25T08:57:22.7481522Z -        
2026-01-25T08:57:22.7481639Z +
2026-01-25T08:57:22.7481941Z          # Даже некорректные данные проходят валидацию
2026-01-25T08:57:22.7482116Z          invalid_data = {
2026-01-25T08:57:22.7482686Z -            'name': '',  # DataRequired error (но заглушка)
2026-01-25T08:57:22.7483303Z -            'confirm': 'different',  # EqualTo error (но заглушка)
2026-01-25T08:57:22.7483473Z -            'csrf_token': token
2026-01-25T08:57:22.7483822Z +            "name": "",  # DataRequired error (но заглушка)
2026-01-25T08:57:22.7484243Z +            "confirm": "different",  # EqualTo error (но заглушка)
2026-01-25T08:57:22.7484402Z +            "csrf_token": token,
2026-01-25T08:57:22.7484527Z          }
2026-01-25T08:57:22.7484658Z -        
2026-01-25T08:57:22.7484781Z +
2026-01-25T08:57:22.7484948Z          form = TestForm(invalid_data)
2026-01-25T08:57:22.7485120Z          assert form.validate() is True
2026-01-25T08:57:22.7485514Z          assert not form.errors  # Заглушки не генерируют ошибки
2026-01-25T08:57:22.7485634Z  
2026-01-25T08:57:22.7485759Z  
2026-01-25T08:57:22.7485975Z  def test_form_still_requires_csrf(app):
2026-01-25T08:57:22.7486304Z      """Форма всё ещё требует валидный CSRF токен."""
2026-01-25T08:57:22.7486560Z -    with app.test_request_context(method='POST'):
2026-01-25T08:57:22.7486768Z +    with app.test_request_context(method="POST"):
2026-01-25T08:57:22.7487016Z          # Форма без CSRF токена
2026-01-25T08:57:22.7487147Z -        data = {
2026-01-25T08:57:22.7487290Z -            'name': 'valid',
2026-01-25T08:57:22.7487438Z -            'confirm': 'valid'
2026-01-25T08:57:22.7487559Z -        }
2026-01-25T08:57:22.7487678Z -        
2026-01-25T08:57:22.7487889Z +        data = {"name": "valid", "confirm": "valid"}
2026-01-25T08:57:22.7488026Z +
2026-01-25T08:57:22.7488194Z          form = TestForm(data)
2026-01-25T08:57:22.7488561Z          assert form.validate() is False  # CSRF ошибка
2026-01-25T08:57:22.7488973Z -        assert 'csrf' in form.errors  # CSRF ошибка в списке ошибок
2026-01-25T08:57:22.7489107Z -
2026-01-25T08:57:22.7489223Z -
2026-01-25T08:57:22.7489623Z +        assert "csrf" in form.errors  # CSRF ошибка в списке ошибок
2026-01-25T08:57:22.7490051Z  
2026-01-25T08:57:22.7490173Z  
2026-01-25T08:57:22.7490435Z  def test_form_with_valid_csrf_and_invalid_data(app):
2026-01-25T08:57:22.7490918Z      """Тест: валидный CSRF + невалидные данные = форма валидна (из-за заглушек)."""
2026-01-25T08:57:22.7491141Z -    with app.test_request_context(method='POST'):
2026-01-25T08:57:22.7491343Z +    with app.test_request_context(method="POST"):
2026-01-25T08:57:22.7491514Z          token = generate_csrf_token()
2026-01-25T08:57:22.7491634Z -        
2026-01-25T08:57:22.7491758Z +
2026-01-25T08:57:22.7492095Z          # Данные которые должны были бы вызвать ошибки валидации
2026-01-25T08:57:22.7492228Z          data = {
2026-01-25T08:57:22.7492416Z -            'name': '',  # DataRequired error
2026-01-25T08:57:22.7492602Z -            'confirm': 'mismatch',  # EqualTo error
2026-01-25T08:57:22.7492757Z -            'csrf_token': token
2026-01-25T08:57:22.7493146Z +            "name": "",  # DataRequired error
2026-01-25T08:57:22.7493378Z +            "confirm": "mismatch",  # EqualTo error
2026-01-25T08:57:22.7493548Z +            "csrf_token": token,
2026-01-25T08:57:22.7493685Z          }
2026-01-25T08:57:22.7493807Z -        
2026-01-25T08:57:22.7493932Z +
2026-01-25T08:57:22.7494085Z          form = TestForm(data)
2026-01-25T08:57:22.7494207Z -        
2026-01-25T08:57:22.7494336Z +
2026-01-25T08:57:22.7494602Z          # С заглушками форма валидна
2026-01-25T08:57:22.7494784Z          assert form.validate() is True
2026-01-25T08:57:22.7494943Z          assert not form.errors
2026-01-25T08:57:22.7495068Z -        
2026-01-25T08:57:22.7495186Z +
2026-01-25T08:57:22.7495449Z          # Но данные поля заполняются
2026-01-25T08:57:22.7495606Z -        assert form.name.data == ''
2026-01-25T08:57:22.7495823Z -        assert form.confirm.data == 'mismatch'
2026-01-25T08:57:22.7495997Z +        assert form.name.data == ""
2026-01-25T08:57:22.7496198Z +        assert form.confirm.data == "mismatch"
2026-01-25T08:57:22.7496349Z  
2026-01-25T08:57:22.7496491Z  
2026-01-25T08:57:22.7496700Z  def test_form_field_still_populates_data(app):
2026-01-25T08:57:22.7497249Z      """Поля формы всё ещё заполняются данными."""
2026-01-25T08:57:22.7497449Z      with app.test_request_context():
2026-01-25T08:57:22.7497583Z -        data = {
2026-01-25T08:57:22.7497743Z -            'name': 'test_name',
2026-01-25T08:57:22.7497894Z -            'confirm': 'test_name'
2026-01-25T08:57:22.7498017Z -        }
2026-01-25T08:57:22.7498143Z -        
2026-01-25T08:57:22.7498372Z +        data = {"name": "test_name", "confirm": "test_name"}
2026-01-25T08:57:22.7498489Z +
2026-01-25T08:57:22.7498649Z          form = TestForm(data)
2026-01-25T08:57:22.7498828Z -        assert form.name.data == 'test_name'
2026-01-25T08:57:22.7499029Z -        assert form.confirm.data == 'test_name'
2026-01-25T08:57:22.7499203Z +        assert form.name.data == "test_name"
2026-01-25T08:57:22.7499408Z +        assert form.confirm.data == "test_name"
2026-01-25T08:57:22.7499554Z  
2026-01-25T08:57:22.7499672Z  
2026-01-25T08:57:22.7499871Z  def test_form_error_structure_unchanged(app):
2026-01-25T08:57:22.7500183Z      """Структура ошибок формы не изменилась."""
2026-01-25T08:57:22.7500395Z -    with app.test_request_context(method='POST'):
2026-01-25T08:57:22.7500596Z +    with app.test_request_context(method="POST"):
2026-01-25T08:57:22.7500817Z          # Форма без CSRF
2026-01-25T08:57:22.7500966Z          form = TestForm({})
2026-01-25T08:57:22.7501097Z -        
2026-01-25T08:57:22.7501213Z +
2026-01-25T08:57:22.7501480Z          # Ошибки должны быть в том же формате
2026-01-25T08:57:22.7501827Z          errors = form.errors
2026-01-25T08:57:22.7502029Z          assert isinstance(errors, dict)
2026-01-25T08:57:22.7502510Z          # TODO: С заглушками CSRF ошибки может не быть если WTF_CSRF_ENABLED=False
2026-01-25T08:57:22.7503283Z          # Когда будет полная реализация, проверить наличие 'csrf' в errors
2026-01-25T08:57:22.7540712Z --- /home/runner/work/flask_blog/flask_blog/tests/test_security.py	2026-01-25 08:57:06.654994+00:00
2026-01-25T08:57:22.7541537Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_security.py	2026-01-25 08:57:22.751760+00:00
2026-01-25T08:57:22.7541682Z @@ -24,60 +24,53 @@
2026-01-25T08:57:22.7541917Z              self.assert_csrf_validation(token, True)
2026-01-25T08:57:22.7542039Z  
2026-01-25T08:57:22.7542268Z      def test_csrf_validation_wrong_tokens(self, app):
2026-01-25T08:57:22.7542716Z          """Валидация неправильных CSRF токенов."""
2026-01-25T08:57:22.7543115Z          with app.test_request_context():
2026-01-25T08:57:22.7543462Z -            wrong_tokens = ['wrong_token', '', None, 'invalid', '123']
2026-01-25T08:57:22.7543721Z +            wrong_tokens = ["wrong_token", "", None, "invalid", "123"]
2026-01-25T08:57:22.7543882Z              for token in wrong_tokens:
2026-01-25T08:57:22.7544107Z                  self.assert_csrf_validation(token, False)
2026-01-25T08:57:22.7544225Z  
2026-01-25T08:57:22.7544534Z      def test_csrf_in_registration_form(self, security_client):
2026-01-25T08:57:22.7544839Z          """CSRF защита при регистрации."""
2026-01-25T08:57:22.7545112Z          # Правильный токен должен работать всегда
2026-01-25T08:57:22.7545380Z          form_data = FormTestHelper.create_form_data_with_csrf(
2026-01-25T08:57:22.7545541Z -            security_client,
2026-01-25T08:57:22.7545707Z -            username='csrf_test_user1',
2026-01-25T08:57:22.7545883Z -            password='testpass123'
2026-01-25T08:57:22.7546005Z -        )
2026-01-25T08:57:22.7546335Z -        response = security_client.post('/auth/register', data=form_data)
2026-01-25T08:57:22.7549122Z +            security_client, username="csrf_test_user1", ***
2026-01-25T08:57:22.7549315Z +        )
2026-01-25T08:57:22.7549690Z +        response = security_client.post("/auth/register", data=form_data)
2026-01-25T08:57:22.7549933Z          self.assert_success_response(response)
2026-01-25T08:57:22.7550055Z  
2026-01-25T08:57:22.7550484Z          # Неправильный токен должен блокироваться
2026-01-25T08:57:22.7550639Z          wrong_form_data = {
2026-01-25T08:57:22.7551323Z -            'username': 'csrf_test_user2',
2026-01-25T08:57:22.7551593Z -            'password': 'testpass123',
2026-01-25T08:57:22.7551755Z -            'csrf_token': 'wrong_token'
2026-01-25T08:57:22.7551928Z +            "username": "csrf_test_user2",
2026-01-25T08:57:22.7552096Z +            "password": "testpass123",
2026-01-25T08:57:22.7552256Z +            "csrf_token": "wrong_token",
2026-01-25T08:57:22.7552386Z          }
2026-01-25T08:57:22.7552771Z -        response = security_client.post('/auth/register', data=wrong_form_data)
2026-01-25T08:57:22.7553484Z +        response = security_client.post("/auth/register", data=wrong_form_data)
2026-01-25T08:57:22.7553723Z          self.assert_form_validation_error(response)
2026-01-25T08:57:22.7553843Z  
2026-01-25T08:57:22.7554148Z          # Отсутствие токена должно блокироваться
2026-01-25T08:57:22.7554334Z -        no_token_data = {
2026-01-25T08:57:22.7554502Z -            'username': 'csrf_test_user3',
2026-01-25T08:57:22.7554706Z -            'password': 'testpass123'
2026-01-25T08:57:22.7554830Z -        }
2026-01-25T08:57:22.7555185Z -        response = security_client.post('/auth/register', data=no_token_data)
2026-01-25T08:57:22.7555546Z +        no_token_data = {"username": "csrf_test_user3", "password": "testpass123"}
2026-01-25T08:57:22.7555882Z +        response = security_client.post("/auth/register", data=no_token_data)
2026-01-25T08:57:22.7556105Z          self.assert_form_validation_error(response)
2026-01-25T08:57:22.7556229Z  
2026-01-25T08:57:22.7556464Z      def test_csrf_in_login_form(self, security_client):
2026-01-25T08:57:22.7556729Z          """CSRF защита при входе."""
2026-01-25T08:57:22.7557007Z          # Правильный токен должен работать всегда
2026-01-25T08:57:22.7557274Z          form_data = FormTestHelper.create_form_data_with_csrf(
2026-01-25T08:57:22.7557440Z -            security_client,
2026-01-25T08:57:22.7558197Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_security.py
2026-01-25T08:57:22.7558383Z -            username='test_user#1234',
2026-01-25T08:57:22.7558564Z -            password='test_pass'
2026-01-25T08:57:22.7558681Z -        )
2026-01-25T08:57:22.7558973Z -        response = security_client.post('/auth/login', data=form_data)
2026-01-25T08:57:22.7566533Z +            security_client, username="test_user#1234", ***
2026-01-25T08:57:22.7566732Z +        )
2026-01-25T08:57:22.7567063Z +        response = security_client.post("/auth/login", data=form_data)
2026-01-25T08:57:22.7567311Z          self.assert_success_response(response)
2026-01-25T08:57:22.7567424Z  
2026-01-25T08:57:22.7567698Z          # Неправильный токен должен блокироваться
2026-01-25T08:57:22.7567834Z          wrong_form_data = {
2026-01-25T08:57:22.7568056Z -            'username': 'test_user#1234',
2026-01-25T08:57:22.7568193Z -            'password': 'test_pass',
2026-01-25T08:57:22.7568351Z -            'csrf_token': 'wrong_token'
2026-01-25T08:57:22.7568510Z +            "username": "test_user#1234",
2026-01-25T08:57:22.7568650Z +            "password": "test_pass",
2026-01-25T08:57:22.7568780Z +            "csrf_token": "wrong_token",
2026-01-25T08:57:22.7568888Z          }
2026-01-25T08:57:22.7569206Z -        response = security_client.post('/auth/login', data=wrong_form_data)
2026-01-25T08:57:22.7569551Z +        response = security_client.post("/auth/login", data=wrong_form_data)
2026-01-25T08:57:22.7569764Z          self.assert_form_validation_error(response)
2026-01-25T08:57:22.7569867Z  
2026-01-25T08:57:22.7570188Z      def test_csrf_in_post_operations(self, security_client, security_auth):
2026-01-25T08:57:22.7570416Z          """CSRF защита в операциях с постами."""
2026-01-25T08:57:22.7570617Z          # Вход с правильным токеном
2026-01-25T08:57:22.7570746Z @@ -85,221 +78,221 @@
2026-01-25T08:57:22.7570934Z          assert login_response.status_code == 302
2026-01-25T08:57:22.7571057Z  
2026-01-25T08:57:22.7571396Z          # Правильный токен должен работать для создания поста
2026-01-25T08:57:22.7571999Z          form_data = FormTestHelper.create_form_data_with_csrf(
2026-01-25T08:57:22.7572204Z              security_client,
2026-01-25T08:57:22.7572365Z -            title='CSRF Test Post',
2026-01-25T08:57:22.7572656Z -            content='This is a test post with enough content length'
2026-01-25T08:57:22.7572787Z -        )
2026-01-25T08:57:22.7583599Z -        response = security_client.post('/post/create', data=form_data)
2026-01-25T08:57:22.7583734Z +            title="CSRF Test Post",
2026-01-25T08:57:22.7583917Z +            content="This is a test post with enough content length",
2026-01-25T08:57:22.7583992Z +        )
2026-01-25T08:57:22.7584184Z +        response = security_client.post("/post/create", data=form_data)
2026-01-25T08:57:22.7584297Z          self.assert_success_response(response)
2026-01-25T08:57:22.7584368Z  
2026-01-25T08:57:22.7584804Z          # Неправильный токен должен блокироваться
2026-01-25T08:57:22.7584894Z          wrong_form_data = {
2026-01-25T08:57:22.7584999Z -            'title': 'CSRF Test Post 2',
2026-01-25T08:57:22.7585118Z -            'content': 'This is another test post',
2026-01-25T08:57:22.7585206Z -            'csrf_token': 'wrong_token'
2026-01-25T08:57:22.7585291Z +            "title": "CSRF Test Post 2",
2026-01-25T08:57:22.7585405Z +            "content": "This is another test post",
2026-01-25T08:57:22.7585487Z +            "csrf_token": "wrong_token",
2026-01-25T08:57:22.7585562Z          }
2026-01-25T08:57:22.7585753Z -        response = security_client.post('/post/create', data=wrong_form_data)
2026-01-25T08:57:22.7585950Z +        response = security_client.post("/post/create", data=wrong_form_data)
2026-01-25T08:57:22.7586079Z          self.assert_form_validation_error(response)
2026-01-25T08:57:22.7586147Z  
2026-01-25T08:57:22.7586211Z  
2026-01-25T08:57:22.7586330Z  class TestPasswordSecurity(BaseTestCase):
2026-01-25T08:57:22.7586477Z      """Тесты безопасности паролей."""
2026-01-25T08:57:22.7586542Z  
2026-01-25T08:57:22.7586669Z      def test_password_hashing_uniqueness(self):
2026-01-25T08:57:22.7586817Z          """Разные пароли должны давать разные хэши."""
2026-01-25T08:57:22.7586924Z          from app.auth import hash_password
2026-01-25T08:57:22.7586996Z -        
2026-01-25T08:57:22.7587095Z -        password1 = 'secure_password_123'
2026-01-25T08:57:22.7587194Z -        password2 = 'different_password'
2026-01-25T08:57:22.7587259Z -        
2026-01-25T08:57:22.7587323Z +
2026-01-25T08:57:22.7587419Z +        password1 = "secure_password_123"
2026-01-25T08:57:22.7587507Z +        password2 = "different_password"
2026-01-25T08:57:22.7587570Z +
2026-01-25T08:57:22.7587693Z          hashed1, salt1 = hash_password(password1)
2026-01-25T08:57:22.7587796Z          hashed2, salt2 = hash_password(password2)
2026-01-25T08:57:22.7587867Z -        
2026-01-25T08:57:22.7587929Z +
2026-01-25T08:57:22.7588026Z          assert hashed1 != hashed2
2026-01-25T08:57:22.7588112Z          assert salt1 != salt2
2026-01-25T08:57:22.7588174Z  
2026-01-25T08:57:22.7588410Z      def test_password_verification_correct(self):
2026-01-25T08:57:22.7588555Z          """Проверка правильного пароля."""
2026-01-25T08:57:22.7588697Z          from app.auth import hash_password, verify_password
2026-01-25T08:57:22.7588781Z -        
2026-01-25T08:57:22.7588880Z -        password = 'secure_password_123'
2026-01-25T08:57:22.7588943Z +
2026-01-25T08:57:22.7589090Z +        password = "secure_password_123"
2026-01-25T08:57:22.7589225Z          hashed, salt = hash_password(password)
2026-01-25T08:57:22.7589289Z -        
2026-01-25T08:57:22.7589356Z +
2026-01-25T08:57:22.7589502Z          assert verify_password(hashed, password, salt) is True
2026-01-25T08:57:22.7589564Z  
2026-01-25T08:57:22.7589703Z      def test_password_verification_incorrect(self):
2026-01-25T08:57:22.7589834Z          """Проверка неправильного пароля."""
2026-01-25T08:57:22.7589998Z          from app.auth import hash_password, verify_password
2026-01-25T08:57:22.7590069Z -        
2026-01-25T08:57:22.7590167Z -        password = 'secure_password_123'
2026-01-25T08:57:22.7590231Z +
2026-01-25T08:57:22.7590325Z +        password = "secure_password_123"
2026-01-25T08:57:22.7590425Z          hashed, salt = hash_password(password)
2026-01-25T08:57:22.7590497Z -        
2026-01-25T08:57:22.7590663Z -        assert verify_password(hashed, 'wrong_password', salt) is False
2026-01-25T08:57:22.7590785Z -        assert verify_password(hashed, '', salt) is False
2026-01-25T08:57:22.7590854Z +
2026-01-25T08:57:22.7591014Z +        assert verify_password(hashed, "wrong_password", salt) is False
2026-01-25T08:57:22.7591131Z +        assert verify_password(hashed, "", salt) is False
2026-01-25T08:57:22.7591260Z          assert verify_password(hashed, None, salt) is False
2026-01-25T08:57:22.7591324Z  
2026-01-25T08:57:22.7591433Z      def test_password_hash_with_same_salt(self):
2026-01-25T08:57:22.7591727Z          """Одинаковые пароли с одинаковой солью дают одинаковые хэши."""
2026-01-25T08:57:22.7591867Z          from app.auth import hash_password
2026-01-25T08:57:22.7591937Z -        
2026-01-25T08:57:22.7592031Z -        password = 'test_password'
2026-01-25T08:57:22.7592127Z -        custom_salt = b'1234567890123456'
2026-01-25T08:57:22.7592209Z -        
2026-01-25T08:57:22.7592272Z +
2026-01-25T08:57:22.7592357Z +        password = "test_password"
2026-01-25T08:57:22.7592447Z +        custom_salt = b"1234567890123456"
2026-01-25T08:57:22.7592511Z +
2026-01-25T08:57:22.7592638Z          hashed1, _ = hash_password(password, custom_salt)
2026-01-25T08:57:22.7592766Z          hashed2, _ = hash_password(password, custom_salt)
2026-01-25T08:57:22.7592832Z -        
2026-01-25T08:57:22.7593237Z +
2026-01-25T08:57:22.7593380Z          assert hashed1 == hashed2
2026-01-25T08:57:22.7593498Z  
2026-01-25T08:57:22.7593660Z      def test_salt_generation(self):
2026-01-25T08:57:22.7593837Z          """Генерация соли должна быть уникальной."""
2026-01-25T08:57:22.7593951Z          from app.auth import hash_password
2026-01-25T08:57:22.7594034Z -        
2026-01-25T08:57:22.7594108Z +
2026-01-25T08:57:22.7594179Z          salts = []
2026-01-25T08:57:22.7594276Z          for _ in range(10):
2026-01-25T08:57:22.7594384Z -            _, salt = hash_password('test_password')
2026-01-25T08:57:22.7594510Z +            _, salt = hash_password("test_password")
2026-01-25T08:57:22.7594601Z              assert salt is not None
2026-01-25T08:57:22.7594686Z              assert len(salt) == 16
2026-01-25T08:57:22.7594777Z              salts.append(salt)
2026-01-25T08:57:22.7594842Z -        
2026-01-25T08:57:22.7594906Z +
2026-01-25T08:57:22.7595042Z          # Все соли должны быть уникальными
2026-01-25T08:57:22.7595136Z          assert len(set(salts)) == len(salts)
2026-01-25T08:57:22.7595199Z  
2026-01-25T08:57:22.7595268Z  
2026-01-25T08:57:22.7595409Z  class TestFormSecurity(BaseTestCase, FormTestHelper):
2026-01-25T08:57:22.7595536Z      """Тесты безопасности форм."""
2026-01-25T08:57:22.7595609Z  
2026-01-25T08:57:22.7595688Z      @pytest.fixture
2026-01-25T08:57:22.7595931Z      def app(self):
2026-01-25T08:57:22.7596019Z          app = Flask(__name__)
2026-01-25T08:57:22.7596137Z -        app.config['SECRET_KEY'] = 'test-key-12345'
2026-01-25T08:57:22.7596235Z -        app.config['TESTING'] = True
2026-01-25T08:57:22.7596351Z -        app.config['WTF_CSRF_ENABLED'] = False
2026-01-25T08:57:22.7596457Z +        app.config["SECRET_KEY"] = "test-key-12345"
2026-01-25T08:57:22.7596550Z +        app.config["TESTING"] = True
2026-01-25T08:57:22.7596647Z +        app.config["WTF_CSRF_ENABLED"] = False
2026-01-25T08:57:22.7596762Z          return app
2026-01-25T08:57:22.7596867Z  
2026-01-25T08:57:22.7596950Z      class TestForm(Form):
2026-01-25T08:57:22.7597093Z          """Тестовая форма с валидаторами."""
2026-01-25T08:57:22.7597198Z -        name = StringField('Name', validators=[
2026-01-25T08:57:22.7597317Z -            DataRequired(message='Name required'),
2026-01-25T08:57:22.7597474Z -            Length(min=3, max=10, message='Invalid length'),
2026-01-25T08:57:22.7597579Z -        ])
2026-01-25T08:57:22.7597697Z -        confirm = StringField('Confirm', validators=[
2026-01-25T08:57:22.7597809Z -            EqualTo('name', message='Must match')
2026-01-25T08:57:22.7597874Z -        ])
2026-01-25T08:57:22.7597953Z +
2026-01-25T08:57:22.7598042Z +        name = StringField(
2026-01-25T08:57:22.7598137Z +            "Name",
2026-01-25T08:57:22.7598220Z +            validators=[
2026-01-25T08:57:22.7598359Z +                DataRequired(message="Name required"),
2026-01-25T08:57:22.7598484Z +                Length(min=3, max=10, message="Invalid length"),
2026-01-25T08:57:22.7598568Z +            ],
2026-01-25T08:57:22.7598640Z +        )
2026-01-25T08:57:22.7598720Z +        confirm = StringField(
2026-01-25T08:57:22.7598892Z +            "Confirm", validators=[EqualTo("name", message="Must match")]
2026-01-25T08:57:22.7599092Z +        )
2026-01-25T08:57:22.7599155Z  
2026-01-25T08:57:22.7599270Z      def test_form_without_csrf_token(self, app):
2026-01-25T08:57:22.7599509Z          """Форма без CSRF токена должна быть невалидной когда CSRF включен."""
2026-01-25T08:57:22.7599609Z          with app.test_request_context():
2026-01-25T08:57:22.7599741Z              # Пропускаем тест если CSRF отключен
2026-01-25T08:57:22.7599888Z -            if not app.config.get('WTF_CSRF_ENABLED', False):
2026-01-25T08:57:22.7600033Z +            if not app.config.get("WTF_CSRF_ENABLED", False):
2026-01-25T08:57:22.7600105Z                  return
2026-01-25T08:57:22.7600172Z -                
2026-01-25T08:57:22.7600239Z +
2026-01-25T08:57:22.7600309Z              data = {
2026-01-25T08:57:22.7600387Z -                'name': 'valid',
2026-01-25T08:57:22.7600472Z -                'confirm': 'valid',
2026-01-25T08:57:22.7600627Z -                'csrf_token': None  # Явно передаем None
2026-01-25T08:57:22.7600727Z +                "name": "valid",
2026-01-25T08:57:22.7600816Z +                "confirm": "valid",
2026-01-25T08:57:22.7600978Z +                "csrf_token": None,  # Явно передаем None
2026-01-25T08:57:22.7601051Z              }
2026-01-25T08:57:22.7601116Z -            
2026-01-25T08:57:22.7601180Z +
2026-01-25T08:57:22.7601273Z              form = self.TestForm(data)
2026-01-25T08:57:22.7601368Z              assert form.validate() is False
2026-01-25T08:57:22.7613418Z -            assert 'csrf' in form.errors
2026-01-25T08:57:22.7613638Z +            assert "csrf" in form.errors
2026-01-25T08:57:22.7613765Z  
2026-01-25T08:57:22.7613961Z      def test_form_with_valid_csrf_token(self, app):
2026-01-25T08:57:22.7614204Z          """Форма с валидным CSRF токеном должна быть валидной."""
2026-01-25T08:57:22.7614370Z          with app.test_request_context():
2026-01-25T08:57:22.7614495Z              token = generate_csrf_token()
2026-01-25T08:57:22.7614587Z -            data = {
2026-01-25T08:57:22.7614671Z -                'name': 'valid',
2026-01-25T08:57:22.7614782Z -                'confirm': 'valid',
2026-01-25T08:57:22.7614872Z -                'csrf_token': token
2026-01-25T08:57:22.7615150Z -            }
2026-01-25T08:57:22.7615237Z -            
2026-01-25T08:57:22.7615426Z +            data = {"name": "valid", "confirm": "valid", "csrf_token": token}
2026-01-25T08:57:22.7615501Z +
2026-01-25T08:57:22.7615604Z              form = self.TestForm(data)
2026-01-25T08:57:22.7615815Z              # С заглушками валидаторов форма всегда валидна при правильном CSRF
2026-01-25T08:57:22.7615919Z              assert form.validate() is True
2026-01-25T08:57:22.7616008Z              assert not form.errors
2026-01-25T08:57:22.7616074Z  
2026-01-25T08:57:22.7616218Z      def test_form_field_structure_unchanged(self, app):
2026-01-25T08:57:22.7616372Z          """Структура полей формы не изменилась."""
2026-01-25T08:57:22.7616476Z          with app.test_request_context():
2026-01-25T08:57:22.7616566Z              form = self.TestForm({})
2026-01-25T08:57:22.7616652Z -            
2026-01-25T08:57:22.7616724Z +
2026-01-25T08:57:22.7616843Z              # Проверяем наличие полей
2026-01-25T08:57:22.7617009Z -            self.assert_form_fields_exist(form, 'name', 'confirm')
2026-01-25T08:57:22.7617084Z -            
2026-01-25T08:57:22.7617220Z +            self.assert_form_fields_exist(form, "name", "confirm")
2026-01-25T08:57:22.7617286Z +
2026-01-25T08:57:22.7617410Z              # Проверяем типы полей
2026-01-25T08:57:22.7617512Z -            assert hasattr(form.name, 'data')
2026-01-25T08:57:22.7617619Z -            assert hasattr(form.confirm, 'data')
2026-01-25T08:57:22.7617713Z +            assert hasattr(form.name, "data")
2026-01-25T08:57:22.7617809Z +            assert hasattr(form.confirm, "data")
2026-01-25T08:57:22.7617880Z  
2026-01-25T08:57:22.7617944Z  
2026-01-25T08:57:22.7618049Z  class TestSessionSecurity(BaseTestCase):
2026-01-25T08:57:22.7618176Z      """Тесты безопасности сессий."""
2026-01-25T08:57:22.7618243Z  
2026-01-25T08:57:22.7618572Z      def test_session_cleared_on_logout(self, client, auth):
2026-01-25T08:57:22.7618729Z          """Выход должен очищать сессию."""
2026-01-25T08:57:22.7618822Z          # Вход
2026-01-25T08:57:22.7618907Z          auth.login()
2026-01-25T08:57:22.7618975Z -        
2026-01-25T08:57:22.7619040Z +
2026-01-25T08:57:22.7619190Z          # Проверяем, что сессия установлена
2026-01-25T08:57:22.7619302Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.7619387Z -            assert 'user_id' in sess
2026-01-25T08:57:22.7619494Z -            original_user_id = sess['user_id']
2026-01-25T08:57:22.7619560Z -        
2026-01-25T08:57:22.7619644Z +            assert "user_id" in sess
2026-01-25T08:57:22.7619801Z +            original_user_id = sess["user_id"]
2026-01-25T08:57:22.7619930Z +
2026-01-25T08:57:22.7620027Z          # Выход
2026-01-25T08:57:22.7620115Z          auth.logout()
2026-01-25T08:57:22.7620182Z -        
2026-01-25T08:57:22.7620263Z +
2026-01-25T08:57:22.7620393Z          # Проверяем, что сессия очищена
2026-01-25T08:57:22.7620500Z          with client.session_transaction() as sess:
2026-01-25T08:57:22.7620700Z -            assert 'user_id' not in sess or sess.get('user_id') != original_user_id
2026-01-25T08:57:22.7620874Z +            assert "user_id" not in sess or sess.get("user_id") != original_user_id
2026-01-25T08:57:22.7620940Z  
2026-01-25T08:57:22.7621122Z      def test_session_persistence_during_requests(self, client, auth):
2026-01-25T08:57:22.7621278Z          """Сессия должна сохраняться между запросами."""
2026-01-25T08:57:22.7621494Z          auth.login()
2026-01-25T08:57:22.7621561Z -        
2026-01-25T08:57:22.7621655Z +
2026-01-25T08:57:22.7621783Z          # Делаем несколько запросов
2026-01-25T08:57:22.7621924Z          for _ in range(3):
2026-01-25T08:57:22.7622068Z -            response = client.get('/')
2026-01-25T08:57:22.7622162Z +            response = client.get("/")
2026-01-25T08:57:22.7622271Z              self.assert_success_response(response)
2026-01-25T08:57:22.7622350Z -            
2026-01-25T08:57:22.7622422Z +
2026-01-25T08:57:22.7622692Z              # Проверяем, что сессия всё ещё активна
2026-01-25T08:57:22.7622815Z              with client.session_transaction() as sess:
2026-01-25T08:57:22.7623201Z -                assert 'user_id' in sess
2026-01-25T08:57:22.7623305Z +                assert "user_id" in sess
2026-01-25T08:57:22.7623382Z  
2026-01-25T08:57:22.7623470Z  
2026-01-25T08:57:22.7623651Z  class TestUsernameDiscriminatorSecurity(BaseTestCase):
2026-01-25T08:57:22.7623844Z      """Тесты безопасности системы дискриминаторов."""
2026-01-25T08:57:22.7623911Z  
2026-01-25T08:57:22.7624084Z      def test_discriminator_uniqueness_for_same_username(self, app):
2026-01-25T08:57:22.7624316Z          """Для одного username должны генерироваться разные дискриминаторы."""
2026-01-25T08:57:22.7624448Z          with app.app_context():
2026-01-25T08:57:22.7624596Z              from app.auth.utils import generate_discriminator
2026-01-25T08:57:22.7624707Z              from app.db.db import get_db
2026-01-25T08:57:22.7624776Z -            
2026-01-25T08:57:22.7624847Z +
2026-01-25T08:57:22.7624935Z              db = get_db()
2026-01-25T08:57:22.7625004Z -            
2026-01-25T08:57:22.7625077Z +
2026-01-25T08:57:22.7625161Z              discriminators = []
2026-01-25T08:57:22.7625241Z              for _ in range(5):
2026-01-25T08:57:22.7625376Z -                disc = generate_discriminator(db, 'testuser')
2026-01-25T08:57:22.7625499Z +                disc = generate_discriminator(db, "testuser")
2026-01-25T08:57:22.7625586Z                  assert disc is not None
2026-01-25T08:57:22.7625682Z                  assert 1 <= disc <= 9999
2026-01-25T08:57:22.7625782Z                  discriminators.append(disc)
2026-01-25T08:57:22.7625860Z -            
2026-01-25T08:57:22.7625926Z +
2026-01-25T08:57:22.7626081Z              # Все дискриминаторы должны быть уникальными
2026-01-25T08:57:22.7626236Z              assert len(set(discriminators)) == len(discriminators)
2026-01-25T08:57:22.7626428Z  
2026-01-25T08:57:22.7626618Z      def test_different_usernames_independent_discriminators(self, app):
2026-01-25T08:57:22.7626862Z          """Разные usernames должны иметь независимые наборы дискриминаторов."""
2026-01-25T08:57:22.7626954Z          with app.app_context():
2026-01-25T08:57:22.7627085Z              from app.auth.utils import generate_discriminator
2026-01-25T08:57:22.7627182Z              from app.db.db import get_db
2026-01-25T08:57:22.7627248Z -            
2026-01-25T08:57:22.7627320Z +
2026-01-25T08:57:22.7627398Z              db = get_db()
2026-01-25T08:57:22.7627465Z -            
2026-01-25T08:57:22.7627535Z +
2026-01-25T08:57:22.7627690Z              # Генерируем дискриминаторы для разных имён
2026-01-25T08:57:22.7627804Z -            disc1 = generate_discriminator(db, 'alice')
2026-01-25T08:57:22.7627923Z -            disc2 = generate_discriminator(db, 'bob')
2026-01-25T08:57:22.7627990Z -            
2026-01-25T08:57:22.7628115Z +            disc1 = generate_discriminator(db, "alice")
2026-01-25T08:57:22.7628225Z +            disc2 = generate_discriminator(db, "bob")
2026-01-25T08:57:22.7628311Z +
2026-01-25T08:57:22.7628405Z              assert disc1 is not None
2026-01-25T08:57:22.7628495Z              assert disc2 is not None
2026-01-25T08:57:22.7628579Z              assert 1 <= disc1 <= 9999
2026-01-25T08:57:22.7628665Z              assert 1 <= disc2 <= 9999
2026-01-25T08:57:22.8700117Z --- /home/runner/work/flask_blog/flask_blog/tests/test_posts.py	2026-01-25 08:57:06.654994+00:00
2026-01-25T08:57:22.8701181Z +++ /home/runner/work/flask_blog/flask_blog/tests/test_posts.py	2026-01-25 08:57:22.866809+00:00
2026-01-25T08:57:22.8701860Z @@ -1,6 +1,7 @@
2026-01-25T08:57:22.8702474Z  """Тесты для функционала постов блога."""
2026-01-25T08:57:22.8703133Z +
2026-01-25T08:57:22.8703403Z  import pytest
2026-01-25T08:57:22.8703778Z  from flask import session
2026-01-25T08:57:22.8704141Z  
2026-01-25T08:57:22.8704444Z  from app.models import Post
2026-01-25T08:57:22.8704876Z  from app.services import PostService
2026-01-25T08:57:22.8705244Z @@ -12,41 +13,39 @@
2026-01-25T08:57:22.8705983Z      def test_create_post(self, app, client, auth):
2026-01-25T08:57:22.8706618Z          """Создание поста должно работать корректно."""
2026-01-25T08:57:22.8707134Z          # Сначала регистрируем и логинимся
2026-01-25T08:57:22.8707545Z          auth.register()
2026-01-25T08:57:22.8707907Z          auth.login()
2026-01-25T08:57:22.8708244Z -        
2026-01-25T08:57:22.8708539Z +
2026-01-25T08:57:22.8708964Z          # Создаём пост через модель
2026-01-25T08:57:22.8709416Z          with app.app_context():
2026-01-25T08:57:22.8709824Z              post = PostService.create(
2026-01-25T08:57:22.8710462Z                  author_id=1,  # ID первого пользователя
2026-01-25T08:57:22.8711111Z                  title="Тестовый пост",
2026-01-25T08:57:22.8711462Z -                content="Это содержание тестового поста."
2026-01-25T08:57:22.8711871Z -            )
2026-01-25T08:57:22.8712536Z -            
2026-01-25T08:57:22.8713278Z +                content="Это содержание тестового поста.",
2026-01-25T08:57:22.8713790Z +            )
2026-01-25T08:57:22.8713981Z +
2026-01-25T08:57:22.8714360Z              assert post.id is not None
2026-01-25T08:57:22.8714972Z              assert post.title == "Тестовый пост"
2026-01-25T08:57:22.8715629Z              assert post.content == "Это содержание тестового поста."
2026-01-25T08:57:22.8716169Z              assert post.author_id == 1
2026-01-25T08:57:22.8716686Z              assert post.created is not None
2026-01-25T08:57:22.8717144Z  
2026-01-25T08:57:22.8717514Z      def test_find_post_by_id(self, app, auth):
2026-01-25T08:57:22.8718141Z          """Поиск поста по ID должен работать."""
2026-01-25T08:57:22.8718605Z          auth.register()
2026-01-25T08:57:22.8718966Z          auth.login()
2026-01-25T08:57:22.8719280Z -        
2026-01-25T08:57:22.8719565Z +
2026-01-25T08:57:22.8719873Z          with app.app_context():
2026-01-25T08:57:22.8720382Z              # Создаём пост
2026-01-25T08:57:22.8720823Z              created_post = PostService.create(
2026-01-25T08:57:22.8721301Z -                author_id=1,
2026-01-25T08:57:22.8721790Z -                title="Тестовый пост",
2026-01-25T08:57:22.8722320Z -                content="Содержание"
2026-01-25T08:57:22.8722720Z -            )
2026-01-25T08:57:22.8723208Z -            
2026-01-25T08:57:22.8723553Z +                author_id=1, title="Тестовый пост", content="Содержание"
2026-01-25T08:57:22.8723871Z +            )
2026-01-25T08:57:22.8724038Z +
2026-01-25T08:57:22.8724296Z              # Ищем пост по ID
2026-01-25T08:57:22.8724788Z              found_post = PostService.find_by_id(created_post.id)
2026-01-25T08:57:22.8725312Z -            
2026-01-25T08:57:22.8725581Z +
2026-01-25T08:57:22.8725889Z              assert found_post is not None
2026-01-25T08:57:22.8726371Z              assert found_post.id == created_post.id
2026-01-25T08:57:22.8727010Z              assert found_post.title == "Тестовый пост"
2026-01-25T08:57:22.8727664Z              assert found_post.content == "Содержание"
2026-01-25T08:57:22.8728451Z              assert found_post.author_username is not None
2026-01-25T08:57:22.8728993Z @@ -60,79 +59,87 @@
2026-01-25T08:57:22.8729316Z  
2026-01-25T08:57:22.8729553Z      def test_get_all_posts(self, app, auth):
2026-01-25T08:57:22.8730040Z          """Получение всех постов должно работать."""
2026-01-25T08:57:22.8730526Z          auth.register()
2026-01-25T08:57:22.8730853Z          auth.login()
2026-01-25T08:57:22.8731187Z -        
2026-01-25T08:57:22.8731467Z +
2026-01-25T08:57:22.8731775Z          with app.app_context():
2026-01-25T08:57:22.8732303Z              # Создаём несколько постов
2026-01-25T08:57:22.8733269Z -            post1 = PostService.create(author_id=1, title="Пост 1", content="Содержание 1")
2026-01-25T08:57:22.8734364Z -            post2 = PostService.create(author_id=1, title="Пост 2", content="Содержание 2")
2026-01-25T08:57:22.8735069Z -            
2026-01-25T08:57:22.8735418Z +            post1 = PostService.create(
2026-01-25T08:57:22.8736152Z +                author_id=1, title="Пост 1", content="Содержание 1"
2026-01-25T08:57:22.8736690Z +            )
2026-01-25T08:57:22.8737044Z +            post2 = PostService.create(
2026-01-25T08:57:22.8737700Z +                author_id=1, title="Пост 2", content="Содержание 2"
2026-01-25T08:57:22.8738211Z +            )
2026-01-25T08:57:22.8738513Z +
2026-01-25T08:57:22.8738874Z              # Получаем все посты
2026-01-25T08:57:22.8739382Z              all_posts = PostService.get_all()
2026-01-25T08:57:22.8739852Z -            
2026-01-25T08:57:22.8740172Z +
2026-01-25T08:57:22.8740490Z              assert len(all_posts) >= 2
2026-01-25T08:57:22.8741155Z              # Посты должны быть отсортированы по дате создания (новые первые)
2026-01-25T08:57:22.8741786Z              assert all_posts[0].created >= all_posts[1].created
2026-01-25T08:57:22.8742266Z  
2026-01-25T08:57:22.8742593Z      def test_update_post(self, app, auth):
2026-01-25T08:57:22.8743696Z          """Обновление поста должно работать."""
2026-01-25T08:57:22.8744194Z          auth.register()
2026-01-25T08:57:22.8744572Z          auth.login()
2026-01-25T08:57:22.8744908Z -        
2026-01-25T08:57:22.8745188Z +
2026-01-25T08:57:22.8745526Z          with app.app_context():
2026-01-25T08:57:22.8746014Z              # Создаём пост
2026-01-25T08:57:22.8746899Z -            post = PostService.create(author_id=1, title="Старый заголовок", content="Старое содержание")
2026-01-25T08:57:22.8747663Z -            
2026-01-25T08:57:22.8748032Z +            post = PostService.create(
2026-01-25T08:57:22.8748803Z +                author_id=1, title="Старый заголовок", content="Старое содержание"
2026-01-25T08:57:22.8749404Z +            )
2026-01-25T08:57:22.8749714Z +
2026-01-25T08:57:22.8750108Z              # Обновляем пост
2026-01-25T08:57:22.8750810Z              PostService.update(post.id, "Новый заголовок", "Новое содержание")
2026-01-25T08:57:22.8751452Z -            
2026-01-25T08:57:22.8751751Z +
2026-01-25T08:57:22.8752164Z              # Проверяем изменения
2026-01-25T08:57:22.8752708Z              updated_post = PostService.find_by_id(post.id)
2026-01-25T08:57:22.8753728Z              assert updated_post.title == "Новый заголовок"
2026-01-25T08:57:22.8754508Z              assert updated_post.content == "Новое содержание"
2026-01-25T08:57:22.8754880Z  
2026-01-25T08:57:22.8755195Z      def test_delete_post(self, app, auth):
2026-01-25T08:57:22.8755715Z          """Удаление поста должно работать."""
2026-01-25T08:57:22.8756098Z          auth.register()
2026-01-25T08:57:22.8756409Z          auth.login()
2026-01-25T08:57:22.8756692Z -        
2026-01-25T08:57:22.8756967Z +
2026-01-25T08:57:22.8757226Z          with app.app_context():
2026-01-25T08:57:22.8757627Z              # Создаём пост
2026-01-25T08:57:22.8758311Z -            post = PostService.create(author_id=1, title="Пост для удаления", content="Содержание")
2026-01-25T08:57:22.8758972Z +            post = PostService.create(
2026-01-25T08:57:22.8759588Z +                author_id=1, title="Пост для удаления", content="Содержание"
2026-01-25T08:57:22.8760304Z +            )
2026-01-25T08:57:22.8760604Z              post_id = post.id
2026-01-25T08:57:22.8760920Z -            
2026-01-25T08:57:22.8761168Z +
2026-01-25T08:57:22.8761471Z              # Удаляем пост
2026-01-25T08:57:22.8761822Z              PostService.delete(post_id)
2026-01-25T08:57:22.8762192Z -            
2026-01-25T08:57:22.8762480Z +
2026-01-25T08:57:22.8762806Z              # Проверяем, что пост удалён
2026-01-25T08:57:22.8763466Z              deleted_post = PostService.find_by_id(post_id)
2026-01-25T08:57:22.8763941Z              assert deleted_post is None
2026-01-25T08:57:22.8764291Z  
2026-01-25T08:57:22.8764559Z      def test_is_author(self, app, auth):
2026-01-25T08:57:22.8765032Z          """Проверка авторства должна работать."""
2026-01-25T08:57:22.8765430Z          auth.register()
2026-01-25T08:57:22.8765815Z          auth.login()
2026-01-25T08:57:22.8766148Z -        
2026-01-25T08:57:22.8766394Z +
2026-01-25T08:57:22.8766668Z          with app.app_context():
2026-01-25T08:57:22.8767149Z              # Создаём пост от пользователя с ID=1
2026-01-25T08:57:22.8767833Z              post = PostService.create(author_id=1, title="Пост", content="Содержание")
2026-01-25T08:57:22.8768426Z -            
2026-01-25T08:57:22.8768701Z +
2026-01-25T08:57:22.8768997Z              # Проверяем авторство
2026-01-25T08:57:22.8769387Z              assert post.is_author(1) is True
2026-01-25T08:57:22.8769831Z              assert post.is_author(2) is False
2026-01-25T08:57:22.8770193Z  
2026-01-25T08:57:22.8770490Z      def test_author_display_name(self, app, auth):
2026-01-25T08:57:22.8771106Z          """Отображаемое имя автора должно форматироваться правильно."""
2026-01-25T08:57:22.8771550Z          auth.register()
2026-01-25T08:57:22.8771857Z          auth.login()
2026-01-25T08:57:22.8772153Z -        
2026-01-25T08:57:22.8772581Z +
2026-01-25T08:57:22.8772834Z          with app.app_context():
2026-01-25T08:57:22.8773447Z              # Создаём пост
2026-01-25T08:57:22.8774142Z              post = PostService.create(author_id=1, title="Пост", content="Содержание")
2026-01-25T08:57:22.8774733Z -            
2026-01-25T08:57:22.8775002Z +
2026-01-25T08:57:22.8775354Z              # Проверяем формат имени автора
2026-01-25T08:57:22.8775808Z              display_name = post.author_display_name
2026-01-25T08:57:22.8776274Z              assert "#" in display_name
2026-01-25T08:57:22.8776869Z              # Пользователь в conftest.py имеет дискриминатор 1234
2026-01-25T08:57:22.8777384Z              assert display_name.endswith("#1234")
2026-01-25T08:57:22.8777836Z @@ -144,267 +151,306 @@
2026-01-25T08:57:22.8778234Z      def test_index_page_shows_posts(self, client, auth):
2026-01-25T08:57:22.8778833Z          """Главная страница должна показывать посты."""
2026-01-25T08:57:22.8779289Z          # Создаём пост
2026-01-25T08:57:22.8779650Z          auth.register()
2026-01-25T08:57:22.8779964Z          auth.login()
2026-01-25T08:57:22.8780254Z -        
2026-01-25T08:57:22.8780520Z +
2026-01-25T08:57:22.8780917Z          # Создаём пост через POST запрос
2026-01-25T08:57:22.8781209Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8781543Z -            'title': 'Тестовый пост',
2026-01-25T08:57:22.8781863Z -            'content': 'Содержание тестового поста',
2026-01-25T08:57:22.8782156Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8782432Z -        })
2026-01-25T08:57:22.8782707Z -        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8783251Z -        
2026-01-25T08:57:22.8783436Z +        response = client.post(
2026-01-25T08:57:22.8783678Z +            "/post/create",
2026-01-25T08:57:22.8783885Z +            data={
2026-01-25T08:57:22.8784122Z +                "title": "Тестовый пост",
2026-01-25T08:57:22.8784448Z +                "content": "Содержание тестового поста",
2026-01-25T08:57:22.8784784Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8785062Z +            },
2026-01-25T08:57:22.8785254Z +        )
2026-01-25T08:57:22.8785508Z +        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8785818Z +
2026-01-25T08:57:22.8786019Z          # Выходим из системы
2026-01-25T08:57:22.8786238Z          auth.logout()
2026-01-25T08:57:22.8786422Z -        
2026-01-25T08:57:22.8786687Z +
2026-01-25T08:57:22.8787067Z          # Проверяем главную страницу
2026-01-25T08:57:22.8787502Z -        response = client.get('/')
2026-01-25T08:57:22.8787943Z +        response = client.get("/")
2026-01-25T08:57:22.8788427Z          assert response.status_code == 200
2026-01-25T08:57:22.8789116Z -        assert 'Тестовый пост' in response.get_data(as_text=True)
2026-01-25T08:57:22.8789662Z would reformat /home/runner/work/flask_blog/flask_blog/tests/test_posts.py
2026-01-25T08:57:22.8790379Z +        assert "Тестовый пост" in response.get_data(as_text=True)
2026-01-25T08:57:22.8791097Z  
2026-01-25T08:57:22.8791483Z      def test_create_post_requires_login(self, client):
2026-01-25T08:57:22.8792135Z          """Создание поста должно требовать авторизации."""
2026-01-25T08:57:22.8792649Z -        response = client.get('/post/create')
2026-01-25T08:57:22.8793402Z +        response = client.get("/post/create")
2026-01-25T08:57:22.8793931Z          assert response.status_code == 302  # Redirect to login
2026-01-25T08:57:22.8794417Z  
2026-01-25T08:57:22.8794732Z      def test_create_post_form(self, client, auth):
2026-01-25T08:57:22.8795292Z          """Форма создания поста должна работать."""
2026-01-25T08:57:22.8795685Z          auth.register()
2026-01-25T08:57:22.8796010Z          auth.login()
2026-01-25T08:57:22.8796345Z -        
2026-01-25T08:57:22.8796656Z -        response = client.get('/post/create')
2026-01-25T08:57:22.8797055Z +
2026-01-25T08:57:22.8797351Z +        response = client.get("/post/create")
2026-01-25T08:57:22.8797841Z          assert response.status_code == 200
2026-01-25T08:57:22.8798472Z -        assert 'Создать новую статью' in response.get_data(as_text=True)
2026-01-25T08:57:22.8799153Z +        assert "Создать новую статью" in response.get_data(as_text=True)
2026-01-25T08:57:22.8799605Z  
2026-01-25T08:57:22.8800010Z      def test_create_post_submission(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8800631Z          """Создание поста должно работать."""
2026-01-25T08:57:22.8801032Z          auth.register()
2026-01-25T08:57:22.8801336Z          auth.login()
2026-01-25T08:57:22.8801622Z -        
2026-01-25T08:57:22.8801900Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8802242Z -        
2026-01-25T08:57:22.8802572Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8803382Z -            'title': 'Новый пост',
2026-01-25T08:57:22.8803855Z -            'content': 'Содержание нового поста',
2026-01-25T08:57:22.8804307Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8804765Z -        })
2026-01-25T08:57:22.8805021Z +
2026-01-25T08:57:22.8805490Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8805881Z +
2026-01-25T08:57:22.8806156Z +        response = client.post(
2026-01-25T08:57:22.8806537Z +            "/post/create",
2026-01-25T08:57:22.8806881Z +            data={
2026-01-25T08:57:22.8807308Z +                "title": "Новый пост",
2026-01-25T08:57:22.8807796Z +                "content": "Содержание нового поста",
2026-01-25T08:57:22.8808290Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8808732Z +            },
2026-01-25T08:57:22.8808992Z +        )
2026-01-25T08:57:22.8809408Z          assert response.status_code == 302  # Redirect to post view
2026-01-25T08:57:22.8809915Z -        
2026-01-25T08:57:22.8810159Z +
2026-01-25T08:57:22.8810490Z          # Проверяем, что пост создан
2026-01-25T08:57:22.8810893Z -        response = client.get('/')
2026-01-25T08:57:22.8811471Z -        assert 'Новый пост' in response.get_data(as_text=True)
2026-01-25T08:57:22.8811969Z +        response = client.get("/")
2026-01-25T08:57:22.8812523Z +        assert "Новый пост" in response.get_data(as_text=True)
2026-01-25T08:57:22.8813132Z  
2026-01-25T08:57:22.8813496Z      def test_view_post(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8814094Z          """Просмотр поста должен работать."""
2026-01-25T08:57:22.8814502Z          auth.register()
2026-01-25T08:57:22.8814813Z          auth.login()
2026-01-25T08:57:22.8815105Z -        
2026-01-25T08:57:22.8815405Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8815761Z -        
2026-01-25T08:57:22.8816110Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8816698Z -            'title': 'Пост для просмотра',
2026-01-25T08:57:22.8817228Z -            'content': 'Содержание для просмотра',
2026-01-25T08:57:22.8817713Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8818137Z -        })
2026-01-25T08:57:22.8818764Z -        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8819268Z -        
2026-01-25T08:57:22.8819547Z +
2026-01-25T08:57:22.8819829Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8820170Z +
2026-01-25T08:57:22.8820443Z +        response = client.post(
2026-01-25T08:57:22.8820823Z +            "/post/create",
2026-01-25T08:57:22.8821159Z +            data={
2026-01-25T08:57:22.8821576Z +                "title": "Пост для просмотра",
2026-01-25T08:57:22.8822099Z +                "content": "Содержание для просмотра",
2026-01-25T08:57:22.8822577Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8823234Z +            },
2026-01-25T08:57:22.8823517Z +        )
2026-01-25T08:57:22.8823929Z +        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8824443Z +
2026-01-25T08:57:22.8824862Z          # Извлекаем ID поста из URL редиректа
2026-01-25T08:57:22.8825499Z -        assert response.status_code == 302, f"Expected redirect, got {response.status_code}"
2026-01-25T08:57:22.8826227Z -        post_id = response.location.split('/')[-1]
2026-01-25T08:57:22.8826657Z -        
2026-01-25T08:57:22.8826916Z +        assert (
2026-01-25T08:57:22.8827227Z +            response.status_code == 302
2026-01-25T08:57:22.8827704Z +        ), f"Expected redirect, got {response.status_code}"
2026-01-25T08:57:22.8828221Z +        post_id = response.location.split("/")[-1]
2026-01-25T08:57:22.8828638Z +
2026-01-25T08:57:22.8828965Z          # Просматриваем пост
2026-01-25T08:57:22.8829366Z -        response = client.get(f'/post/{post_id}')
2026-01-25T08:57:22.8829901Z +        response = client.get(f"/post/{post_id}")
2026-01-25T08:57:22.8830376Z          assert response.status_code == 200
2026-01-25T08:57:22.8831027Z -        assert 'Пост для просмотра' in response.get_data(as_text=True)
2026-01-25T08:57:22.8831787Z -        assert 'Содержание для просмотра' in response.get_data(as_text=True)
2026-01-25T08:57:22.8832552Z +        assert "Пост для просмотра" in response.get_data(as_text=True)
2026-01-25T08:57:22.8833632Z +        assert "Содержание для просмотра" in response.get_data(as_text=True)
2026-01-25T08:57:22.8834157Z  
2026-01-25T08:57:22.8834487Z      def test_view_nonexistent_post(self, client):
2026-01-25T08:57:22.8835110Z          """Просмотр несуществующего поста должен возвращать 404."""
2026-01-25T08:57:22.8835621Z -        response = client.get('/post/999999')
2026-01-25T08:57:22.8836098Z +        response = client.get("/post/999999")
2026-01-25T08:57:22.8836555Z          assert response.status_code == 404
2026-01-25T08:57:22.8836960Z  
2026-01-25T08:57:22.8837412Z      def test_edit_post_requires_login(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8838167Z          """Редактирование поста должно требовать авторизации."""
2026-01-25T08:57:22.8838695Z          # Сначала создаём пост
2026-01-25T08:57:22.8839059Z          auth.register()
2026-01-25T08:57:22.8839446Z          auth.login()
2026-01-25T08:57:22.8839748Z -        
2026-01-25T08:57:22.8840047Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8840436Z -        
2026-01-25T08:57:22.8840790Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8841327Z -            'title': 'Пост',
2026-01-25T08:57:22.8841771Z -            'content': 'Содержание',
2026-01-25T08:57:22.8842240Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8842692Z -        })
2026-01-25T08:57:22.8843311Z -        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8843919Z -        post_id = response.location.split('/')[-1]
2026-01-25T08:57:22.8844367Z +
2026-01-25T08:57:22.8844651Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8845021Z +
2026-01-25T08:57:22.8845297Z +        response = client.post(
2026-01-25T08:57:22.8845688Z +            "/post/create",
2026-01-25T08:57:22.8846036Z +            data={
2026-01-25T08:57:22.8846416Z +                "title": "Пост",
2026-01-25T08:57:22.8847104Z +                "content": "Содержание",
2026-01-25T08:57:22.8847593Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8848039Z +            },
2026-01-25T08:57:22.8848341Z +        )
2026-01-25T08:57:22.8848759Z +        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8849368Z +        post_id = response.location.split("/")[-1]
2026-01-25T08:57:22.8849801Z          auth.logout()
2026-01-25T08:57:22.8850095Z -        
2026-01-25T08:57:22.8850343Z +
2026-01-25T08:57:22.8850719Z          # Пытаемся редактировать без авторизации
2026-01-25T08:57:22.8851201Z -        response = client.get(f'/post/{post_id}/edit')
2026-01-25T08:57:22.8851709Z +        response = client.get(f"/post/{post_id}/edit")
2026-01-25T08:57:22.8852263Z          assert response.status_code == 302  # Redirect to login
2026-01-25T08:57:22.8852734Z  
2026-01-25T08:57:22.8853333Z      def test_edit_post_author_only(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8853796Z          """Редактировать пост может только автор."""
2026-01-25T08:57:22.8854123Z          # Создаём первого пользователя и пост
2026-01-25T08:57:22.8854458Z -        auth.register(username='user1', password='test_pass')
2026-01-25T08:57:22.8854838Z -        auth.login(username='user1', password='test_pass')
2026-01-25T08:57:22.8855116Z -        
2026-01-25T08:57:22.8855302Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8855522Z -        
2026-01-25T08:57:22.8855728Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8856049Z -            'title': 'Пост user1',
2026-01-25T08:57:22.8856331Z -            'content': 'Содержание user1',
2026-01-25T08:57:22.8856608Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8857055Z -        })
2026-01-25T08:57:22.8857480Z -        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8858126Z -        post_id = response.location.split('/')[-1]
2026-01-25T08:57:22.8858853Z +        auth.register(username="user1", ***)
2026-01-25T08:57:22.8859587Z +        auth.login(username="user1", ***)
2026-01-25T08:57:22.8859999Z +
2026-01-25T08:57:22.8860273Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8860605Z +
2026-01-25T08:57:22.8860880Z +        response = client.post(
2026-01-25T08:57:22.8861328Z +            "/post/create",
2026-01-25T08:57:22.8861595Z +            data={
2026-01-25T08:57:22.8861888Z +                "title": "Пост user1",
2026-01-25T08:57:22.8862191Z +                "content": "Содержание user1",
2026-01-25T08:57:22.8862493Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8862778Z +            },
2026-01-25T08:57:22.8863201Z +        )
2026-01-25T08:57:22.8863477Z +        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8863850Z +        post_id = response.location.split("/")[-1]
2026-01-25T08:57:22.8864134Z          auth.logout()
2026-01-25T08:57:22.8864341Z -        
2026-01-25T08:57:22.8864498Z +
2026-01-25T08:57:22.8864723Z          # Создаём второго пользователя
2026-01-25T08:57:22.8865050Z -        auth.register(username='user2', password='test_pass')
2026-01-25T08:57:22.8865424Z -        auth.login(username='user2', password='test_pass')
2026-01-25T08:57:22.8865705Z -        
2026-01-25T08:57:22.8866016Z +        auth.register(username="user2", ***)
2026-01-25T08:57:22.8866340Z +        auth.login(username="user2", ***)
2026-01-25T08:57:22.8866570Z +
2026-01-25T08:57:22.8866811Z          # Пытаемся редактировать пост первого пользователя
2026-01-25T08:57:22.8867136Z -        response = client.get(f'/post/{post_id}/edit')
2026-01-25T08:57:22.8867452Z +        response = client.get(f"/post/{post_id}/edit")
2026-01-25T08:57:22.8867764Z          assert response.status_code == 403  # Forbidden
2026-01-25T08:57:22.8868029Z  
2026-01-25T08:57:22.8868268Z      def test_edit_post_form(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8868877Z          """Форма редактирования поста должна работать для автора."""
2026-01-25T08:57:22.8869173Z          auth.register()
2026-01-25T08:57:22.8869391Z          auth.login()
2026-01-25T08:57:22.8869572Z -        
2026-01-25T08:57:22.8869750Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8869974Z -        
2026-01-25T08:57:22.8870189Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8870541Z -            'title': 'Оригинальный заголовок',
2026-01-25T08:57:22.8870861Z -            'content': 'Оригинальное содержание',
2026-01-25T08:57:22.8871170Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8871433Z -        })
2026-01-25T08:57:22.8871651Z -        post_id = response.location.split('/')[-1]
2026-01-25T08:57:22.8871920Z -        
2026-01-25T08:57:22.8872076Z +
2026-01-25T08:57:22.8872252Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8872479Z +
2026-01-25T08:57:22.8872645Z +        response = client.post(
2026-01-25T08:57:22.8873088Z +            "/post/create",
2026-01-25T08:57:22.8873319Z +            data={
2026-01-25T08:57:22.8873697Z +                "title": "Оригинальный заголовок",
2026-01-25T08:57:22.8874037Z +                "content": "Оригинальное содержание",
2026-01-25T08:57:22.8874345Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8874633Z +            },
2026-01-25T08:57:22.8874834Z +        )
2026-01-25T08:57:22.8875046Z +        post_id = response.location.split("/")[-1]
2026-01-25T08:57:22.8875317Z +
2026-01-25T08:57:22.8875520Z          # Получаем форму редактирования
2026-01-25T08:57:22.8875850Z -        response = client.get(f'/post/{post_id}/edit')
2026-01-25T08:57:22.8876172Z +        response = client.get(f"/post/{post_id}/edit")
2026-01-25T08:57:22.8876466Z          assert response.status_code == 200
2026-01-25T08:57:22.8876861Z -        assert 'Оригинальный заголовок' in response.get_data(as_text=True)
2026-01-25T08:57:22.8877371Z -        assert 'Оригинальное содержание' in response.get_data(as_text=True)
2026-01-25T08:57:22.8877843Z +        assert "Оригинальный заголовок" in response.get_data(as_text=True)
2026-01-25T08:57:22.8878298Z +        assert "Оригинальное содержание" in response.get_data(as_text=True)
2026-01-25T08:57:22.8878607Z  
2026-01-25T08:57:22.8878865Z      def test_edit_post_submission(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8879279Z          """Отправка формы редактирования должна работать."""
2026-01-25T08:57:22.8879558Z          auth.register()
2026-01-25T08:57:22.8879763Z          auth.login()
2026-01-25T08:57:22.8879942Z -        
2026-01-25T08:57:22.8880120Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8880347Z -        
2026-01-25T08:57:22.8880560Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8880904Z -            'title': 'Старый заголовок',
2026-01-25T08:57:22.8881198Z -            'content': 'Старое содержание',
2026-01-25T08:57:22.8881477Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8881867Z -        })
2026-01-25T08:57:22.8882076Z -        post_id = response.location.split('/')[-1]
2026-01-25T08:57:22.8882346Z -        
2026-01-25T08:57:22.8882496Z +
2026-01-25T08:57:22.8882665Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8883061Z +
2026-01-25T08:57:22.8883328Z +        response = client.post(
2026-01-25T08:57:22.8883566Z +            "/post/create",
2026-01-25T08:57:22.8883789Z +            data={
2026-01-25T08:57:22.8884037Z +                "title": "Старый заголовок",
2026-01-25T08:57:22.8884342Z +                "content": "Старое содержание",
2026-01-25T08:57:22.8884634Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8884908Z +            },
2026-01-25T08:57:22.8885073Z +        )
2026-01-25T08:57:22.8885276Z +        post_id = response.location.split("/")[-1]
2026-01-25T08:57:22.8885536Z +
2026-01-25T08:57:22.8885769Z          # Редактируем пост
2026-01-25T08:57:22.8886043Z -        response = client.post(f'/post/{post_id}/edit', data={
2026-01-25T08:57:22.8886424Z -            'title': 'Новый заголовок',
2026-01-25T08:57:22.8886715Z -            'content': 'Новое содержание',
2026-01-25T08:57:22.8886998Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8887271Z -        })
2026-01-25T08:57:22.8887450Z +        response = client.post(
2026-01-25T08:57:22.8887687Z +            f"/post/{post_id}/edit",
2026-01-25T08:57:22.8887944Z +            data={
2026-01-25T08:57:22.8888174Z +                "title": "Новый заголовок",
2026-01-25T08:57:22.8888522Z +                "content": "Новое содержание",
2026-01-25T08:57:22.8888852Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8889124Z +            },
2026-01-25T08:57:22.8889289Z +        )
2026-01-25T08:57:22.8889553Z          assert response.status_code == 302  # Redirect to post view
2026-01-25T08:57:22.8889881Z -        
2026-01-25T08:57:22.8890032Z +
2026-01-25T08:57:22.8890232Z          # Проверяем изменения
2026-01-25T08:57:22.8890513Z -        response = client.get(f'/post/{post_id}')
2026-01-25T08:57:22.8891040Z -        assert 'Новый заголовок' in response.get_data(as_text=True)
2026-01-25T08:57:22.8891465Z -        assert 'Новое содержание' in response.get_data(as_text=True)
2026-01-25T08:57:22.8891799Z +        response = client.get(f"/post/{post_id}")
2026-01-25T08:57:22.8892179Z +        assert "Новый заголовок" in response.get_data(as_text=True)
2026-01-25T08:57:22.8892580Z +        assert "Новое содержание" in response.get_data(as_text=True)
2026-01-25T08:57:22.8892882Z  
2026-01-25T08:57:22.8893375Z      def test_delete_post_requires_login(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8893825Z          """Удаление поста должно требовать авторизации."""
2026-01-25T08:57:22.8894130Z          # Сначала создаём пост
2026-01-25T08:57:22.8894353Z          auth.register()
2026-01-25T08:57:22.8894561Z          auth.login()
2026-01-25T08:57:22.8894754Z -        
2026-01-25T08:57:22.8894950Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8895174Z -        
2026-01-25T08:57:22.8895396Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8895715Z -            'title': 'Пост',
2026-01-25T08:57:22.8895976Z -            'content': 'Содержание',
2026-01-25T08:57:22.8896257Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8896531Z -        })
2026-01-25T08:57:22.8896790Z -        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8897153Z -        post_id = response.location.split('/')[-1]
2026-01-25T08:57:22.8897429Z +
2026-01-25T08:57:22.8897601Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8897817Z +
2026-01-25T08:57:22.8897997Z +        response = client.post(
2026-01-25T08:57:22.8898231Z +            "/post/create",
2026-01-25T08:57:22.8898433Z +            data={
2026-01-25T08:57:22.8898660Z +                "title": "Пост",
2026-01-25T08:57:22.8898938Z +                "content": "Содержание",
2026-01-25T08:57:22.8899365Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8899645Z +            },
2026-01-25T08:57:22.8899822Z +        )
2026-01-25T08:57:22.8900075Z +        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8900433Z +        post_id = response.location.split("/")[-1]
2026-01-25T08:57:22.8900515Z          auth.logout()
2026-01-25T08:57:22.8900582Z -        
2026-01-25T08:57:22.8900648Z +
2026-01-25T08:57:22.8900786Z          # Пытаемся удалить без авторизации
2026-01-25T08:57:22.8900914Z -        response = client.post(f'/post/{post_id}/delete')
2026-01-25T08:57:22.8901052Z +        response = client.post(f"/post/{post_id}/delete")
2026-01-25T08:57:22.8901196Z          assert response.status_code == 302  # Redirect to login
2026-01-25T08:57:22.8901262Z  
2026-01-25T08:57:22.8901449Z      def test_delete_post_author_only(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8901582Z          """Удалять пост может только автор."""
2026-01-25T08:57:22.8901735Z          # Создаём первого пользователя и пост
2026-01-25T08:57:22.8901896Z -        auth.register(username='user1', password='test_pass')
2026-01-25T08:57:22.8902027Z -        auth.login(username='user1', password='test_pass')
2026-01-25T08:57:22.8902094Z -        
2026-01-25T08:57:22.8902186Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8902252Z -        
2026-01-25T08:57:22.8902377Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8902493Z -            'title': 'Пост user1',
2026-01-25T08:57:22.8902620Z -            'content': 'Содержание user1',
2026-01-25T08:57:22.8902746Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8902821Z -        })
2026-01-25T08:57:22.8903191Z -        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8903321Z -        post_id = response.location.split('/')[-1]
2026-01-25T08:57:22.8903499Z +        auth.register(username="user1", ***)
2026-01-25T08:57:22.8903656Z +        auth.login(username="user1", ***)
2026-01-25T08:57:22.8903726Z +
2026-01-25T08:57:22.8903956Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8904030Z +
2026-01-25T08:57:22.8904122Z +        response = client.post(
2026-01-25T08:57:22.8904204Z +            "/post/create",
2026-01-25T08:57:22.8904272Z +            data={
2026-01-25T08:57:22.8904407Z +                "title": "Пост user1",
2026-01-25T08:57:22.8904545Z +                "content": "Содержание user1",
2026-01-25T08:57:22.8904666Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8904732Z +            },
2026-01-25T08:57:22.8904806Z +        )
2026-01-25T08:57:22.8904969Z +        assert response.status_code == 302  # Redirect after creation
2026-01-25T08:57:22.8905092Z +        post_id = response.location.split("/")[-1]
2026-01-25T08:57:22.8905169Z          auth.logout()
2026-01-25T08:57:22.8905234Z -        
2026-01-25T08:57:22.8905308Z +
2026-01-25T08:57:22.8905425Z          # Создаём второго пользователя
2026-01-25T08:57:22.8905579Z -        auth.register(username='user2', password='test_pass')
2026-01-25T08:57:22.8905721Z -        auth.login(username='user2', password='test_pass')
2026-01-25T08:57:22.8905790Z -        
2026-01-25T08:57:22.8905952Z +        auth.register(username="user2", ***)
2026-01-25T08:57:22.8906084Z +        auth.login(username="user2", ***)
2026-01-25T08:57:22.8906159Z +
2026-01-25T08:57:22.8906316Z          # Пытаемся удалить пост первого пользователя
2026-01-25T08:57:22.8906459Z -        response = client.post(f'/post/{post_id}/delete')
2026-01-25T08:57:22.8906585Z +        response = client.post(f"/post/{post_id}/delete")
2026-01-25T08:57:22.8906705Z          assert response.status_code == 403  # Forbidden
2026-01-25T08:57:22.8906770Z  
2026-01-25T08:57:22.8906921Z      def test_delete_post(self, client, auth, setup_csrf_token):
2026-01-25T08:57:22.8907182Z          """Удаление поста должно работать."""
2026-01-25T08:57:22.8907291Z          auth.register()
2026-01-25T08:57:22.8907493Z          auth.login()
2026-01-25T08:57:22.8907558Z -        
2026-01-25T08:57:22.8907656Z -        token = setup_csrf_token()
2026-01-25T08:57:22.8907727Z -        
2026-01-25T08:57:22.8907848Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8907980Z -            'title': 'Пост для удаления',
2026-01-25T08:57:22.8908116Z -            'content': 'Содержание для удаления',
2026-01-25T08:57:22.8908229Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8908301Z -        })
2026-01-25T08:57:22.8908418Z -        post_id = response.location.split('/')[-1]
2026-01-25T08:57:22.8908483Z -        
2026-01-25T08:57:22.8908555Z +
2026-01-25T08:57:22.8908638Z +        token = setup_csrf_token()
2026-01-25T08:57:22.8908703Z +
2026-01-25T08:57:22.8908795Z +        response = client.post(
2026-01-25T08:57:22.8908873Z +            "/post/create",
2026-01-25T08:57:22.8908946Z +            data={
2026-01-25T08:57:22.8909073Z +                "title": "Пост для удаления",
2026-01-25T08:57:22.8909223Z +                "content": "Содержание для удаления",
2026-01-25T08:57:22.8909357Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8909425Z +            },
2026-01-25T08:57:22.8909491Z +        )
2026-01-25T08:57:22.8909604Z +        post_id = response.location.split("/")[-1]
2026-01-25T08:57:22.8909669Z +
2026-01-25T08:57:22.8909770Z          # Удаляем пост
2026-01-25T08:57:22.8909930Z -        response = client.post(f'/post/{post_id}/delete', data={
2026-01-25T08:57:22.8910041Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8910113Z -        })
2026-01-25T08:57:22.8910203Z +        response = client.post(
2026-01-25T08:57:22.8910289Z +            f"/post/{post_id}/delete",
2026-01-25T08:57:22.8910424Z +            data={"csrf_token": "test_csrf_token_for_testing"},
2026-01-25T08:57:22.8910492Z +        )
2026-01-25T08:57:22.8910631Z          assert response.status_code == 302  # Redirect to index
2026-01-25T08:57:22.8910710Z -        
2026-01-25T08:57:22.8910781Z +
2026-01-25T08:57:22.8910920Z          # Проверяем, что пост удалён
2026-01-25T08:57:22.8911127Z -        response = client.get(f'/post/{post_id}')
2026-01-25T08:57:22.8911233Z +        response = client.get(f"/post/{post_id}")
2026-01-25T08:57:22.8911334Z          assert response.status_code == 404
2026-01-25T08:57:22.8911398Z  
2026-01-25T08:57:22.8911559Z      def test_post_form_validation_placeholder(self, client, auth):
2026-01-25T08:57:22.8911714Z          """Тест валидации формы поста с заглушками.
2026-01-25T08:57:22.8911781Z -        
2026-01-25T08:57:22.8911846Z +
2026-01-25T08:57:22.8912042Z          TODO: После реализации валидаторов этот тест должен проверять:
2026-01-25T08:57:22.8912195Z          - Валидацию пустого заголовка (DataRequired)
2026-01-25T08:57:22.8912352Z          - Валидацию короткого содержания (Length min=10)
2026-01-25T08:57:22.8912536Z          - Валидацию максимальной длины заголовка (Length max=200)
2026-01-25T08:57:22.8912692Z          """
2026-01-25T08:57:22.8912779Z          auth.register()
2026-01-25T08:57:22.8912868Z          auth.login()
2026-01-25T08:57:22.8913156Z -        
2026-01-25T08:57:22.8913230Z +
2026-01-25T08:57:22.8913432Z          # Эти данные должны вызывать ошибки валидации после реализации
2026-01-25T08:57:22.8913561Z -        response = client.post('/post/create', data={
2026-01-25T08:57:22.8913755Z -            'title': '',  # TODO: Должно быть ошибкой (DataRequired)
2026-01-25T08:57:22.8913968Z -            'content': '123',  # TODO: Должно быть ошибкой (Length min=10)
2026-01-25T08:57:22.8914084Z -            'csrf_token': 'test_csrf_token_for_testing'
2026-01-25T08:57:22.8914157Z -        })
2026-01-25T08:57:22.8914224Z -        
2026-01-25T08:57:22.8914347Z +        response = client.post(
2026-01-25T08:57:22.8914428Z +            "/post/create",
2026-01-25T08:57:22.8914510Z +            data={
2026-01-25T08:57:22.8914707Z +                "title": "",  # TODO: Должно быть ошибкой (DataRequired)
2026-01-25T08:57:22.8914930Z +                "content": "123",  # TODO: Должно быть ошибкой (Length min=10)
2026-01-25T08:57:22.8915064Z +                "csrf_token": "test_csrf_token_for_testing",
2026-01-25T08:57:22.8915136Z +            },
2026-01-25T08:57:22.8915202Z +        )
2026-01-25T08:57:22.8915293Z +
2026-01-25T08:57:22.8915510Z          # Сейчас все валидаторы - заглушки, поэтому форма проходит валидацию
2026-01-25T08:57:22.8915781Z          # TODO: После реализации валидаторов ожидать status_code 200 (форма показана снова с ошибками)
2026-01-25T08:57:22.8916052Z          assert response.status_code == 302  # Редирект после успешного создания поста
2026-01-25T08:57:22.8916084Z 
2026-01-25T08:57:22.8916196Z Oh no! 💥 💔 💥
2026-01-25T08:57:22.8916356Z 35 files would be reformatted, 1 file would be left unchanged.
2026-01-25T08:57:22.9137368Z ##[error]Process completed with exit code 1.
2026-01-25T08:57:22.9225998Z ##[group]Run actions/upload-artifact@v4
2026-01-25T08:57:22.9226133Z with:
2026-01-25T08:57:22.9226233Z   name: security-report
2026-01-25T08:57:22.9226322Z   path: bandit-report.json
2026-01-25T08:57:22.9226405Z   if-no-files-found: warn
2026-01-25T08:57:22.9226493Z   compression-level: 6
2026-01-25T08:57:22.9226569Z   overwrite: false
2026-01-25T08:57:22.9226666Z   include-hidden-files: false
2026-01-25T08:57:22.9226738Z env:
2026-01-25T08:57:22.9226820Z   PYTHON_VERSION: 3.13
2026-01-25T08:57:22.9226980Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:22.9227216Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.11/x64/lib/pkgconfig
2026-01-25T08:57:22.9227388Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:22.9227533Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:22.9227668Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.11/x64
2026-01-25T08:57:22.9227877Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.11/x64/lib
2026-01-25T08:57:22.9227956Z ##[endgroup]
2026-01-25T08:57:23.1681134Z ##[warning]No files were found with the provided path: bandit-report.json. No artifacts will be uploaded.
2026-01-25T08:57:23.1839336Z Post job cleanup.
2026-01-25T08:57:23.2879889Z [command]/usr/bin/git version
2026-01-25T08:57:23.2927984Z git version 2.52.0
2026-01-25T08:57:23.2974555Z Temporarily overriding HOME='/home/runner/work/_temp/095ea238-db1d-4cb2-9599-ee9d4a918343' before making global git config changes
2026-01-25T08:57:23.2975798Z Adding repository directory to the temporary git global config as a safe directory
2026-01-25T08:57:23.2980532Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/flask_blog/flask_blog
2026-01-25T08:57:23.3019122Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2026-01-25T08:57:23.3051990Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2026-01-25T08:57:23.3345743Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2026-01-25T08:57:23.3371487Z http.https://github.com/.extraheader
2026-01-25T08:57:23.3385709Z [command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader
2026-01-25T08:57:23.3419280Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2026-01-25T08:57:23.3663996Z [command]/usr/bin/git config --local --name-only --get-regexp ^includeIf\.gitdir:
2026-01-25T08:57:23.3699144Z [command]/usr/bin/git submodule foreach --recursive git config --local --show-origin --name-only --get-regexp remote.origin.url
2026-01-25T08:57:23.4039004Z Cleaning up orphan processes
